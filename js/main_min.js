var phpDoc=function(){Ext.QuickTips.init();Ext.BLANK_IMAGE_URL="/extjs/resources/images/default/s.gif";return{TaskPing:"",storeCommitLogMessage:"",storeFilesError:"",storeFilesNeedUpdate:"",storeFilesNeedReviewed:"",storePendingCommit:"",storePendingPatch:"",storeMailing:"",storeBugs:"",storeTranslators:"",storeSummary:"",userLoggin:"",userLang:"",appName:"PhpDocumentation Online Editor",appVer:"0.2",userConf:{conf_needupdate_diff:"using-exec",conf_needupdate_scrollbars:true,conf_error_skipnbliteraltag:true,conf_error_scrollbars:true,conf_reviewed_scrollbars:true,conf_patch_scrollbars:true,conf_theme:"xtheme-default.css"},treeAllFiles:"",treeSort:"",treeAllFilesRoot:"",filePendingOpen:"",init:function(){Ext.getBody().on("contextmenu",function(a){a.stopEvent()},this);Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"get-conf"},success:function(a){var b=Ext.util.JSON.decode(a.responseText);if(b.success){this.userLoggin=b.mess.userLoggin;this.userLang=b.mess.userLang;this.userConf.conf_needupdate_diff=b.mess.userConf.conf_needupdate_diff;this.userConf.conf_needupdate_scrollbars=b.mess.userConf.conf_needupdate_scrollbars;this.userConf.conf_error_skipnbliteraltag=b.mess.userConf.conf_error_skipnbliteraltag;this.userConf.conf_error_scrollbars=b.mess.userConf.conf_error_scrollbars;this.userConf.conf_reviewed_scrollbars=b.mess.userConf.conf_reviewed_scrollbars;this.userConf.conf_theme=b.mess.userConf.conf_theme;Ext.util.CSS.swapStyleSheet("appTheme",this.userConf.conf_theme);this.loadDataStore();this.drawInterface()}}})},loadDataStore:function(){this.storeCommitLogMessage=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-commit-log-message"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"text",mapping:"text"}])});this.storeFilesError=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"GetFilesError"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"name",mapping:"name"},{name:"maintainer",mapping:"maintainer"},{name:"type",mapping:"type"},{name:"value_en",mapping:"value_en"},{name:"value_lang",mapping:"value_lang"},{name:"needcommit",mapping:"needcommit"}]),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(a){Ext.getDom("acc-error-nb").innerHTML=a.getCount()}}});this.storeFilesNeedUpdate=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"GetFilesNeedUpdate"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"name",mapping:"name"},{name:"revision",mapping:"revision"},{name:"en_revision",mapping:"en_revision"},{name:"maintainer",mapping:"maintainer"},{name:"needcommit",mapping:"needcommit"},{name:"isCritical",mapping:"isCritical"}]),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(a){Ext.getDom("acc-need-update-nb").innerHTML=a.getCount()}}});this.storePendingCommit=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"GetFilesPendingCommit"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"name",mapping:"name"},{name:"by",mapping:"by"},{name:"date",mapping:"date"}]),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(a){Ext.getDom("acc-pendingCommit-nb").innerHTML=a.getCount()},add:function(a){Ext.getDom("acc-pendingCommit-nb").innerHTML=a.getCount()}}});this.storePendingPatch=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"GetFilesPendingPatch"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"name",mapping:"name"},{name:"by",mapping:"by"},{name:"uniqID",mapping:"uniqID"},{name:"date",mapping:"date"}]),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(a){Ext.getDom("acc-pendingPatch-nb").innerHTML=a.getCount()},add:function(a){Ext.getDom("acc-pendingPatch-nb").innerHTML=a.getCount()}}});this.storeFilesNeedReviewed=new Ext.data.GroupingStore({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"GetFilesNeedReviewed"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"name",mapping:"name"},{name:"reviewed",mapping:"reviewed"},{name:"maintainer",mapping:"maintainer"},{name:"needcommit",mapping:"needcommit"}]),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(a){Ext.getDom("acc-need-reviewed-nb").innerHTML=a.getCount()}}});this.storeMailing=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-mailing-info"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"title",mapping:"title"},{name:"link",mapping:"link"},{name:"description",mapping:"description"},{name:"pubDate",mapping:"pubDate",type:"date",dateFormat:"Y/m/d H:i:s"}])});this.storeMailing.setDefaultSort("pubDate","desc");this.storeBugs=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-open-bugs"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"title",mapping:"title"},{name:"link",mapping:"link"},{name:"description",mapping:"description"}])});this.storeTranslators=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-translator-info"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"name",mapping:"name"},{name:"email",mapping:"mail"},{name:"nick",mapping:"nick"},{name:"cvs",mapping:"cvs"},{name:"uptodate",mapping:"uptodate",type:"int"},{name:"old",mapping:"old",type:"int"},{name:"critical",mapping:"critical",type:"int"},{name:"sum",mapping:"sum",type:"int"}])});this.storeTranslators.setDefaultSort("nick","asc");this.storeSummary=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-summary-info"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"libel",mapping:"libel"},{name:"nbFiles",mapping:"nbFiles"},{name:"percentFiles",mapping:"percentFiles"},{name:"sizeFiles",mapping:"sizeFiles"},{name:"percentSize",mapping:"percentSize"}])})},openFile:function(d,a){Ext.getCmp("acc-all-files").expand();var c=d.split("/");function b(f,e){f.expand(false,true,function(h){var g;h.ensureVisible();if(c[0]&&c[0]!==""){for(g=0;g<h.childNodes.length;g=g+1){if(h.childNodes[g].text===c[0]){c.shift();b(h.childNodes[g],e)}}}else{for(g=0;g<h.childNodes.length;g=g+1){if(h.childNodes[g].text===a){h.childNodes[g].ensureVisible();h.childNodes[g].ui.highlight();e.treeAllFiles.fireEvent("dblclick",h.childNodes[g])}}}})}b(this.treeAllFilesRoot,this)},rejectPatch:function(f,d,a,e,g,c){function b(h){if(h==="yes"){var i=Ext.MessageBox.wait("Please, wait...");Ext.Ajax.request({scope:c,url:"../php/controler.php",params:{task:"after-patch-reject",PatchUniqID:e},success:function(){this.storePendingPatch.remove(this.storePendingPatch.getAt(g));this.storePendingPatch.fireEvent("add",this.storePendingPatch);Ext.getCmp("main-panel").remove("PP-"+f);i.hide()}})}}Ext.MessageBox.confirm("Confirm","This action will <b>reject</b> this patch, send an email to his author and close this tab.",b,c)},saveFileViaPatch:function(e,c,a,d,g,b){function f(h){if(h==="yes"){Ext.getCmp("PP-PATCH-PANEL-btn-save-"+e).disable();Ext.getCmp("PP-PATCH-"+e).isModified=false;Ext.getCmp("PP-PATCH-PANEL-"+e).setTitle(Ext.getCmp("PP-PATCH-PANEL-"+e).originTitle);Ext.getCmp("PP-"+e).setTitle(Ext.getCmp("PP-"+e).originTitle);var i=Ext.MessageBox.wait("Saving data...");Ext.Ajax.request({scope:b,url:"../php/controler.php",params:{task:"save-file",filePath:c,fileName:a,fileLang:"all",fileContent:Ext.getCmp("PP-PATCH-"+e).getCode()},success:function(k,j){var l=Ext.util.JSON.decode(k.responseText);if(l.success){this.addToPendingCommit(c,a);this.storePendingPatch.remove(this.storePendingPatch.getAt(g));this.storePendingPatch.fireEvent("add",this.storePendingPatch);Ext.Ajax.request({scope:b,url:"../php/controler.php",params:{task:"after-patch-accept",PatchUniqID:d}});i.hide();Ext.getCmp("main-panel").remove("PP-"+e)}}})}}Ext.MessageBox.confirm("Confirm","This action will accept this patch, send an email to his author, save the file and close this tab.",f,b)},saveEnFile:function(e,c,a,d,g,b){Ext.getCmp(d+"-EN-PANEL-btn-save-"+e).disable();Ext.getCmp(d+"-"+e).isModifiedEn=false;Ext.getCmp(d+"-EN-PANEL-"+e).setTitle(Ext.getCmp(d+"-EN-PANEL-"+e).originTitle);if(!Ext.getCmp(d+"-"+e).isModifiedEn&&!Ext.getCmp(d+"-"+e).isModifiedLang){Ext.getCmp(d+"-"+e).setTitle(Ext.getCmp(d+"-"+e).originTitle)}var f=Ext.MessageBox.wait("Saving data...");Ext.Ajax.request({scope:b,url:"../php/controler.php",params:{task:"save-file",filePath:c,fileName:a,fileLang:"en",fileContent:Ext.getCmp(d+"-EN-"+e).getCode()},success:function(i,h){var j=Ext.util.JSON.decode(i.responseText);if(j.success){if(d==="FNU"){this.storeFilesNeedUpdate.getAt(g).set("en_revision","1."+j.en_revision);this.storeFilesNeedUpdate.getAt(g).set("needcommit",true)}if(d==="FE"){this.storeFilesError.getAt(g).set("needcommit",true)}if(d==="FNR"){this.storeFilesNeedReviewed.getAt(g).set("needcommit",true)}this.addToPendingCommit("en"+c,a);f.hide()}}})},savePatch:function(d,g,a,c,h,i){var b,f,e;if(d==="en"){b="-EN"}else{if(d==="all"){b=""}else{b="-LANG"}}if(i.userLoggin!=="cvsread"){f=i.userLoggin+"@php.net"}e=new Ext.Window({title:"Do you want to be alerted ?",iconCls:"patchAlert",width:350,height:150,resizable:false,modal:true,autoScroll:true,bodyStyle:"padding: 5px;",layout:"form",labelWidth:50,items:[{xtype:"panel",baseCls:"x-plain",bodyStyle:"padding-bottom: 10px;",html:"If you want to be notified when your patch will be dealt with, thank you to leave an email address below."},{xtype:"textfield",fieldLabel:"Email",name:"patch-email-alert",anchor:"100%",value:f}],buttons:[{text:"Save",handler:function(){var j,k;j=this.ownerCt.items.items[1].getValue();k=Ext.MessageBox.wait("Saving data as a patch...");e.close();if(d!=="all"){Ext.getCmp(h+b+"-PANEL-btn-saveas-"+g).disable();Ext.getCmp(h+b+"-"+g).isModifiedLang=false;Ext.getCmp(h+b+"-PANEL-"+g).setTitle(Ext.getCmp(h+b+"-PANEL-"+g).originTitle);Ext.getCmp(h+"-"+g).setTitle(Ext.getCmp(h+"-"+g).originTitle)}else{Ext.getCmp("AF-PANEL-btn-saveas-"+g).disable();Ext.getCmp("AF-FILE-"+g).isModified=false;Ext.getCmp("AF-PANEL-"+g).setTitle(Ext.getCmp("AF-PANEL-"+g).originTitle);Ext.getCmp("AF-"+g).setTitle(Ext.getCmp("AF-"+g).originTitle)}Ext.Ajax.request({scope:i,url:"../php/controler.php",params:{task:"save-file",filePath:a,fileName:c,fileLang:d,fileContent:(d!=="all")?Ext.getCmp(h+b+"-"+g).getCode():Ext.getCmp("AF-FILE-"+g).getCode(),type:"patch",emailAlert:j},success:function(m,l){var n=Ext.util.JSON.decode(m.responseText);if(n.success){if(d!=="all"){this.addToPendingPatch(d+a,c,n.uniqID)}else{this.addToPendingPatch(a,c,n.uniqID)}k.hide()}}})}},{text:"Cancel",handler:function(){e.close()}}]});e.show()},saveLangFile:function(f,d,b,e,g,c){function a(h){if(h==="no"){Ext.getCmp(e+"-LANG-PANEL-btn-save-"+f).disable();Ext.getCmp(e+"-"+f).isModifiedLang=false;Ext.getCmp(e+"-LANG-PANEL-"+f).setTitle(Ext.getCmp(e+"-LANG-PANEL-"+f).originTitle);if(!Ext.getCmp(e+"-"+f).isModifiedEn&&!Ext.getCmp(e+"-"+f).isModifiedLang){Ext.getCmp(e+"-"+f).setTitle(Ext.getCmp(e+"-"+f).originTitle)}var i=Ext.MessageBox.wait("Saving data...");Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"save-file",filePath:d,fileName:b,fileLang:this.userLang,fileContent:Ext.getCmp(e+"-LANG-"+f).getCode()},success:function(k,j){var l=Ext.util.JSON.decode(k.responseText);if(l.success){if(e==="FE"){this.storeFilesError.getAt(g).set("needcommit",true);this.storeFilesError.getAt(g).set("maintainer",l.maintainer)}if(e==="FNU"){this.storeFilesNeedUpdate.getAt(g).set("revision","1."+l.new_revision);this.storeFilesNeedUpdate.getAt(g).set("needcommit",true);this.storeFilesNeedUpdate.getAt(g).set("maintainer",l.maintainer)}if(e==="FNR"){this.storeFilesNeedReviewed.getAt(g).set("needcommit",true);this.storeFilesNeedReviewed.getAt(g).set("maintainer",l.maintainer);this.storeFilesNeedReviewed.getAt(g).set("reviewed",l.reviewed)}this.addToPendingCommit(this.userLang+d,b);i.hide()}}})}else{if(h==="yes"){Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Checking for error. Please, wait...');Ext.getCmp(e+"-LANG-PANEL-btn-save-"+f).disable();Ext.getCmp(e+"-"+f).isModifiedLang=false;Ext.getCmp(e+"-LANG-PANEL-"+f).setTitle(Ext.getCmp(e+"-LANG-PANEL-"+f).originTitle);if(!Ext.getCmp(e+"-"+f).isModifiedEn&&!Ext.getCmp(e+"-"+f).isModifiedLang){Ext.getCmp(e+"-"+f).setTitle(Ext.getCmp(e+"-"+f).originTitle)}Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"check-file-error",FilePath:d,FileName:b,FileLang:this.userLang,FileContent:Ext.getCmp(e+"-LANG-"+f).getCode()},success:function(k,j){Ext.getBody().unmask();var l=Ext.util.JSON.decode(k.responseText);if(l.success){if(l.error&&l.error_first!=="-No error-"){Ext.getCmp("main-panel").add({closable:true,title:"Error in "+b,iconCls:"FilesError",id:"FE-help-"+f,autoScroll:true,autoLoad:"/error_type.php?dir="+d+"&file="+b});Ext.getCmp("main-panel").setActiveTab("FE-help-"+f);this.storeFilesError.reload()}else{Ext.MessageBox.show({title:"Check for errors",msg:"There is no error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"save-file",filePath:d,fileName:b,fileLang:this.userLang,fileContent:Ext.getCmp(e+"-LANG-"+f).getCode()},success:function(n,m){var p=Ext.util.JSON.decode(n.responseText);if(p.success){if(e==="FE"){this.storeFilesError.getAt(g).set("needcommit",true);this.storeFilesError.getAt(g).set("maintainer",p.maintainer)}if(e==="FNU"){this.storeFilesNeedUpdate.getAt(g).set("revision","1."+p.new_revision);this.storeFilesNeedUpdate.getAt(g).set("needcommit",true);this.storeFilesNeedUpdate.getAt(g).set("maintainer",p.maintainer)}if(e==="FNR"){this.storeFilesNeedReviewed.getAt(g).set("needcommit",true);this.storeFilesNeedReviewed.getAt(g).set("maintainer",p.maintainer);this.storeFilesNeedReviewed.getAt(g).set("reviewed",p.reviewed)}this.addToPendingCommit(this.userLang+d,b)}}});if(e==="FE"){Ext.getCmp(e+"-error-type-"+f).setSrc("/error_type.php?dir="+d+"&file="+b+"&nocache="+new Date().getTime())}}}})}}}Ext.MessageBox.show({scope:c,title:"Confirm",msg:"Do you want to check for error before saving ?",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,fn:a})},getFile:function(e,d,a,c,b){Ext.get(c+e).mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Loading...');Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"get-file",FilePath:d,FileName:a},success:function(h,g){var i,f;i=Ext.util.JSON.decode(h.responseText);if(i.success){Ext.getCmp(b+e).setCode(i.content);Ext.get(c+e).unmask();if(c==="FE-LANG-PANEL-"||c==="FNR-LANG-PANEL-"||c==="FNR-EN-PANEL-"||c==="AF-PANEL-"){f=Ext.getCmp(c+e).getSize();f.height=f.height+1;Ext.getCmp(c+e).setSize(f);Ext.getCmp(c+e).fireEvent("resize")}}},callback:function(){if(this.filePendingOpen[0]){this.filePendingOpen.shift();if(this.filePendingOpen[0]){if(this.filePendingOpen[0][0]){this.openFile(this.filePendingOpen[0][0],this.filePendingOpen[0][1])}}}}})},addToPendingPatch:function(b,a,e){var d,c;d=new Date();c=new this.storePendingPatch.recordType({id:Ext.id("",""),path:b,name:a,by:this.userLoggin,uniqID:e,date:d.format("Y-m-d H:i:s")});this.storePendingPatch.insert(0,c)},addToPendingCommit:function(d,a){var c,e,b;c=false;this.storePendingCommit.each(function(f){if(f.data.path===d&&f.data.name===a){c=true}});if(!c){e=new Date();b=new this.storePendingCommit.recordType({id:Ext.id("",""),path:d,name:a,by:this.userLoggin,date:e.format("Y-m-d H:i:s")});this.storePendingCommit.insert(0,b)}},rendererNumUptodate:function(a){if(a==="0"){return}else{return'<span style="color:green; font-weight: bold;">'+a+"</span>"}},rendererNumCritical:function(a){if(a==="0"){return}else{return'<span style="color:red; font-weight: bold;">'+a+"</span>"}},rendererTotalTranslator:function(a,c,b){return a?((a===0||a>1)?"("+a+" Translators)":"(1 Translator)"):""},rendererSum:function(a){return(a==="0")?"":a},NewTabBugs:function(a,b,c){Ext.getCmp("main-panel").add({xtype:"iframepanel",id:"mifp_bugs_"+a,title:"Loading...",tabTip:c,iconCls:"iconBugs",loadMask:true,defaultSrc:b,listeners:{documentloaded:function(d){d.ownerCt.setTitle(Ext.util.Format.substr(c,0,20)+"...")}}});Ext.getCmp("main-panel").setActiveTab("mifp_bugs_"+a)},NewTabMailing:function(a,c,b){Ext.getCmp("main-panel").add({xtype:"iframepanel",id:"mifp_"+a,title:"Loading...",tabTip:b,iconCls:"home-mailing-title",loadMask:true,defaultSrc:c,listeners:{documentloaded:function(d){d.ownerCt.setTitle(Ext.util.Format.substr(b,0,20)+"...")}}});Ext.getCmp("main-panel").setActiveTab("mifp_"+a)},winDiff:function(d,b,c,a){Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Finding the diff. Please, wait...');Ext.Ajax.request({url:"./php/controler.php",params:{task:"get-diff2",FilePath:d,FileName:b,Rev1:c,Rev2:a},success:function(f){var g,e;g=Ext.util.JSON.decode(f.responseText);if(g.success){Ext.getBody().unmask();e=new Ext.Window({title:"Diff between "+c+" & "+a,width:650,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:'<div class="diff-content">'+g.content+"</div>",buttons:[{text:"Close",handler:function(){e.close()}}]});e.show()}},failure:function(){}})},removeTabEvent:function(d,e){var b,c,f,a;a=e.id.split("-");if((a[0]==="FE"||a[0]==="FNU"||a[0]==="FNR"||a[0]==="PP")&&a[1]!=="help"){if(a[0]==="FE"){b=Ext.getCmp("FE-"+a[1]).isModifiedLang}if(a[0]==="FNU"){b=Ext.getCmp("FNU-"+a[1]).isModifiedLang}if(a[0]==="FNR"){b=Ext.getCmp("FNR-"+a[1]).isModifiedLang}if(a[0]==="FE"){c=Ext.getCmp("FE-"+a[1]).isModifiedEn}if(a[0]==="FNU"){c=Ext.getCmp("FNU-"+a[1]).isModifiedEn}if(a[0]==="FNR"){c=Ext.getCmp("FNR-"+a[1]).isModifiedEn}if(a[0]==="PP"){f=Ext.getCmp("PP-PATCH-"+a[1]).isModified}if(c||b||f){Ext.Msg.show({scope:this,title:"Confirm",msg:"This file has been modified without being saved.<br/>Do you really want to close?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(g,h){if(g==="yes"){d.un("beforeremove",this.removeTabEvent,this);d.remove(e);d.addListener("beforeremove",this.removeTabEvent,this)}}})}else{return true}return false}else{return true}},WinCommit:function(i,h,e){var f,c,g,a,b,d;c=Ext.get("acc-need-update");if(!f){f=new Ext.Window({scope:this,id:"winCvsCommit",title:"CVS commit",closable:false,layout:"form",width:400,height:480,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",items:[{xtype:"checktreepanel",id:"tree-panel",anchor:"100%",height:180,autoScroll:true,rootVisible:false,root:{text:"root",expanded:true,children:[]}},{scope:this,xtype:"combo",fieldLabel:"Older messages",editable:false,name:"first2",anchor:"100%",store:this.storeCommitLogMessage,triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.text.split("\n").join("<br/>")]}</div></tpl>',valueField:"id",displayField:"text",listeners:{scope:this,render:function(){this.storeCommitLogMessage.load()},select:function(l,j,k){Ext.getCmp("form-commit-message-log").setValue(j.data.text)}}},{xtype:"textarea",id:"form-commit-message-log",fieldLabel:"Log message",name:"first3",anchor:"100%",height:150,value:""}],tools:[{scope:this,id:"gear",qtip:"Configure this tools",handler:function(){var m,k,l;function j(n){return n.split("\n").join("<br/>")}m=new Ext.form.TextArea({grow:true,growMin:120});k=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{id:"GridManageLog",header:"Log Message",dataIndex:"text",renderer:j,editor:new Ext.Editor(m,{shadow:false,autoSize:true,listeners:{scope:this,complete:function(p,q,o){var n=p.record.data.id;Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"save-LogMessage",messID:n,mess:q},success:function(s,r){var t=Ext.util.JSON.decode(s.responseText);if(t.success){this.storeCommitLogMessage.getById(n).commit()}}})}}})}]);l=new Ext.Window({title:"Manage Log Message",iconCls:"winManageLog",width:650,height:350,layout:"fit",resizable:false,modal:true,autoScroll:true,html:'<div class="diff-content"></div>',items:[{xtype:"editorgrid",store:this.storeCommitLogMessage,loadMask:true,cm:k,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:"GridManageLog",listeners:{scope:this,rowcontextmenu:function(n,q,o){o.stopEvent();n.getSelectionModel().selectRow(q);var p=new Ext.menu.Menu({items:[{text:"Delete this Log Message",iconCls:"iconDelete",scope:this,handler:function(){Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"delete-LogMessage",messID:this.storeCommitLogMessage.getAt(q).data.id},success:function(s,r){var t=Ext.util.JSON.decode(s.responseText);if(t.success){this.storeCommitLogMessage.remove(this.storeCommitLogMessage.getAt(q))}}})}}]});p.showAt(o.getXY())}}}],buttons:[{text:"Close",handler:function(){l.close()}}],listeners:{scope:this,close:function(){this.storeCommitLogMessage.reload()}}});l.show()}}],buttons:[{scope:this,text:"Submit",id:"win-commit-btn-submit",handler:function(){var j,n,q,s,k,l,o=[],r,p="",m;if(this.userLoggin==="cvsread"){f.close();Ext.MessageBox.show({title:"Cvsread restriction",msg:"You are logging in with Cvsread account.<br><br>You can't commit anything with this account.",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});return}j=Ext.getCmp("tree-panel").getValue();n=[];for(m=0;m<j.length;m=m+1){q=Ext.getCmp("tree-panel").getNodeById(j[m]).attributes;s="FE-"+Ext.util.md5("FE-"+q.FilePath+q.FileName);k="FNU-"+Ext.util.md5("FNU-"+q.FilePath+q.FileName);l="FNR-"+Ext.util.md5("FNR-"+q.FilePath+q.FileName);if(Ext.getCmp("main-panel").findById(s)||Ext.getCmp("main-panel").findById(k)||Ext.getCmp("main-panel").findById(l)){if(Ext.getCmp("main-panel").findById(s)){r=s}if(Ext.getCmp("main-panel").findById(k)){r=k}if(Ext.getCmp("main-panel").findById(l)){r=l}o[0]=r;o[1]=q.FileName;n.push(o)}}if(n.length>0){for(m=0;m<n.length;m=m+1){p+=n[m][1]+"<br>"}Ext.MessageBox.show({scope:this,title:"Warning",msg:"There is "+n.length+" file"+((n.length>1)?"s":"")+" to close before commit.<br><br>"+p+"<br><br>Would you like I close it for you ?",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,fn:function(t){if(t==="yes"){for(m=0;m<n.length;m=m+1){Ext.getCmp("main-panel").remove(n[m][0])}this.WinCommitLastStep(j,this)}else{return}}})}else{this.WinCommitLastStep(j,this)}return}},{text:"Close",id:"win-commit-btn-close",handler:function(){f.close()}}]})}f.show(c);if(i){a=this.storePendingCommit.getAt(h).data.path;b=this.storePendingCommit.getAt(h).data.name;g=Ext.util.md5(a+b);d=new Ext.tree.TreeNode({id:"need-commit-"+g,text:a+b,FilePath:a,FileName:b,leaf:true,checked:true,uiProvider:Ext.ux.tree.CheckTreeNodeUI});Ext.getCmp("tree-panel").getRootNode().appendChild(d)}else{this.storePendingCommit.each(function(j){if(e&&e==="by me"&&j.data.by!==this.userLoggin){}else{a=j.data.path;b=j.data.name;g=Ext.util.md5(a+b);d=new Ext.tree.TreeNode({id:"need-commit-"+g,text:a+b,FilePath:a,FileName:b,leaf:true,checked:true,uiProvider:Ext.ux.tree.CheckTreeNodeUI});Ext.getCmp("tree-panel").getRootNode().appendChild(d)}},this)}},WinCommitLastStep:function(g,d){Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, wait until commit...');var a=[],f,c,e,b;for(b=0;b<g.length;b=b+1){f=Ext.getCmp("tree-panel").getNodeById(g[b]);c=[];c[0]=f.attributes.FilePath;c[1]=f.attributes.FileName;a.push(c)}e=Ext.getCmp("form-commit-message-log").getValue();Ext.getCmp("winCvsCommit").close();Ext.Ajax.request({url:"../php/controler.php",params:{task:"cvs-commit",nodes:Ext.util.JSON.encode(a),logMessage:e},success:function(i){var j,h;j=Ext.util.JSON.decode(i.responseText);if(j.success){Ext.getBody().unmask();h=new Ext.Window({title:"Status",width:450,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:j.mess.join("<br>"),buttons:[{text:"Close",handler:function(){h.close()}}]});h.show();Ext.Ajax.request({url:"../php/controler.php",params:{task:"on-succes-commit",nodes:Ext.util.JSON.encode(a),logMessage:e},success:function(k){d.storeFilesError.reload();d.storeFilesNeedReviewed.reload();d.storeFilesNeedUpdate.reload();d.storePendingCommit.reload();d.storeTranslators.reload();d.storeSummary.reload()}})}else{}}})},WinUpdate:function(){var e,d;function c(f){f.TaskPing.cancel();Ext.get("wizard-step-1").replaceClass("wizard-step-before","wizard-step-working");Ext.get("wizard-step-1.1").replaceClass("wizard-wait","wizard-show");Ext.Ajax.request({scope:f,url:"../php/controler.php",params:{task:"update-repo"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);if(h.success){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");b(f)}},failure:function(){function h(){Ext.Ajax.request({scope:f,url:"../php/controler.php",params:{task:"check-lock-file",lockFile:"lock_update_repository"},success:function(i){var j=Ext.util.JSON.decode(i.responseText);if(!j.success){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");b(this)}else{g.delay(5000)}},failure:function(){g.delay(5000)}})}var g=new Ext.util.DelayedTask(function(){h()});g.delay(5000)}})}function b(f){Ext.get("wizard-step-2").replaceClass("wizard-step-before","wizard-step-working");Ext.Ajax.request({scope:f,url:"../php/controler.php",params:{task:"apply-tools"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);if(h.success){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");a(this)}},failure:function(){function h(){Ext.Ajax.request({scope:f,url:"../php/controler.php",params:{task:"check-lock-file",lockFile:"lock_apply_tools"},success:function(i){var j=Ext.util.JSON.decode(i.responseText);if(!j.success){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");a(this)}else{g.delay(5000)}},failure:function(){g.delay(5000)}})}var g=new Ext.util.DelayedTask(function(){h()});g.delay(5000)}})}function a(f){Ext.get("wizard-step-3").replaceClass("wizard-step-before","wizard-step-working");f.storeFilesNeedUpdate.reload();f.storeTranslators.reload();f.storeFilesError.reload();Ext.get("wizard-step-3").replaceClass("wizard-step-working","wizard-step-done");Ext.getCmp("btn-start-refresh").setIconClass("finishRefresh");Ext.getCmp("btn-start-refresh").setText("Finish !");Ext.getCmp("btn-start-refresh").setHandler(function(){e.close()});Ext.getCmp("btn-start-refresh").enable();f.TaskPing.delay(30000);e.tools.close.setVisible(true)}d=Ext.get("acc-need-update");if(!e){e=new Ext.Window({title:"Refresh all data",layout:"form",width:300,height:200,resizable:false,modal:true,bodyStyle:"padding:15px 15px 0",iconCls:"refresh",html:'<div id="wizard-step-1" class="wizard-step-before">Update all files from Cvs</div><div id="wizard-step-1.1" class="wizard-wait">This may take time. Thank you for your patience...</div><div id="wizard-step-2" class="wizard-step-before">Apply all tools</div><div id="wizard-step-3" class="wizard-step-before">Reload data</div>',buttons:[{scope:this,text:"Start",id:"btn-start-refresh",iconCls:"startRefresh",handler:function(){Ext.getCmp("btn-start-refresh").disable();e.tools.close.setVisible(false);c(this)}}]})}e.show(d)},WinCheckBuild:function(){var c,a;a=Ext.get("acc-need-update");function b(d){Ext.Ajax.request({scope:d,url:"./php/controler.php",params:{task:"get-logfile",file:"log_check_build"},success:function(f){var g,e;g=Ext.util.JSON.decode(f.responseText);if(g.success){this.TaskPing.delay(30000);e=new Ext.Window({title:"Status",width:450,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:g.mess,buttons:[{text:"Close",handler:function(){e.close()}}]});e.show()}}})}if(!c){c=new Ext.Window({title:"Check Build",iconCls:"checkBuild",layout:"form",width:350,height:200,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",buttons:[{scope:this,text:"Go !",id:"win-check-build-btn-submit",handler:function(){var d=Ext.getCmp("option-xml-details").checked;c.close();Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, wait until the build is checked...');this.TaskPing.cancel();Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"check-build",xmlDetails:d},success:function(e){var f=Ext.util.JSON.decode(e.responseText);if(f.success){Ext.getBody().unmask();b(this)}},failure:function(g){function e(){Ext.Ajax.request({url:"../php/controler.php",params:{task:"check-lock-file",lockFile:"lock_check_build"},success:function(h){var i=Ext.util.JSON.decode(h.responseText);if(!i.success){Ext.getBody().unmask();b()}else{f.delay(5000)}},failure:function(){f.delay(5000)}})}var f=new Ext.util.DelayedTask(function(){e()});f.delay(5000)}})}}],items:[{xtype:"panel",baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:"You're about to check the build via this command :<br/><br/>/usr/bin/php configure.php --with-lang="+this.userLang+"<br><br>",modal:false},{xtype:"checkbox",hideLabel:true,checked:false,boxLabel:"Enable detailed XML error messages",name:"option-xml-details",id:"option-xml-details"}]})}c.show(a)},WinConf:function(){var a,c,e,d,b;if(!a){b=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="tplMenu-{id}">','<div class="thumb"><img src="/img/{img}" title=""></div>',"<span>{label}</span></div>","</tpl>");b.compile();d=[["1","go-home.png","Main"],["2","edit-redo.png",'Module "Files Need Update"'],["3","dialog-cancel.png",'Module "Files with Error"'],["4","document-properties.png",'Module "Files need Reviewed"'],["5","view-media-playlist.png",'Module "Pending Patch"']];e=new Ext.data.SimpleStore({id:0,fields:[{name:"id"},{name:"img"},{name:"label"}]});e.loadData(d);c=new Ext.DataView({tpl:b,singleSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",store:e,listeners:{selectionchange:function(f,g){var h=f.getSelectedRecords();Ext.getCmp("confCard").layout.setActiveItem("conf-card-"+h[0].data.id)}}});a=new Ext.Window({scope:this,layout:"border",width:550,height:400,iconCls:"iconConf",modal:true,title:"Configuration",plain:true,closeAction:"hide",listeners:{show:function(){c.select(c.getNode(0))}},items:[{scope:this,region:"west",width:190,id:"confMenu",autoScroll:true,items:c},{scope:this,layout:"slide",region:"center",id:"confCard",width:375,frame:true,activeItem:0,bbar:new Ext.StatusBar({defaultText:"All changes take effect immediately",defaultIconCls:"confStatusBar"}),items:[{scope:this,id:"conf-card-1",xtype:"form",bodyStyle:"padding: 10px;",items:[{xtype:"fieldset",title:"Themes",autoHeight:true,defaults:{hideLabel:true},items:[{xtype:"combo",store:new Ext.data.SimpleStore({fields:["themeFile",{name:"themeName",type:"string"}],data:[["/themes/black/css/xtheme-black.css","Black"],["xtheme-default.css","Default"],["/themes/darkgray/css/xtheme-darkgray.css","DarkGray"],["/extjs/resources/css/xtheme-gray.css","Gray"],["/themes/gray-extend/css/xtheme-gray-extend.css","Gray Extend"],["/themes/indigo/css/xtheme-indigo.css","Indigo"],["/themes/midnight/css/xtheme-midnight.css","Midnight"],["/themes/olive/css/xtheme-olive.css","Olive"],["/themes/purple/css/xtheme-purple.css","Purple"],["/extjs/resources/css/xtheme-slate.css","Slate"],["/themes/silverCherry/css/xtheme-silverCherry.css","SilverCherry"]]}),valueField:"themeFile",displayField:"themeName",triggerAction:"all",mode:"local",forceSelection:true,editable:false,fieldLabel:"fieldlabel",value:this.userConf.conf_theme,listeners:{scope:this,select:function(h,f,g){Ext.util.CSS.swapStyleSheet("appTheme",h.getValue());this.confUpdate("conf_theme",h.getValue())}}}]}]},{scope:this,id:"conf-card-2",xtype:"form",bodyStyle:"padding: 10px;",items:[{xtype:"fieldset",title:"Diff view",autoHeight:true,defaults:{hideLabel:true},defaultType:"radio",items:[{scope:this,checked:(this.userConf.conf_needupdate_diff==="using-viewvc")?true:false,boxLabel:"Using ViewVc from php web site",name:"conf_needupdate_diff",inputValue:"using-viewvc",listeners:{scope:this,check:function(g){if(g.checked){this.confUpdate("conf_needupdate_diff",g.getRawValue())}}}},{checked:(this.userConf.conf_needupdate_diff==="using-exec")?true:false,boxLabel:"Using diff -kk -u command line",name:"conf_needupdate_diff",inputValue:"using-exec",listeners:{scope:this,check:function(g){if(g.checked){this.confUpdate("conf_needupdate_diff",g.getRawValue())}}}}]},{xtype:"fieldset",title:"Editor",autoHeight:true,defaults:{hideLabel:true},defaultType:"checkbox",items:[{scope:this,checked:(this.userConf.conf_needupdate_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_needupdate_scrollbars",listeners:{scope:this,check:function(g){this.confUpdate("conf_needupdate_scrollbars",g.getValue())}}}]}]},{id:"conf-card-3",xtype:"form",bodyStyle:"padding: 10px;",items:[{xtype:"fieldset",title:"Error type",autoHeight:true,defaults:{hideLabel:true},defaultType:"checkbox",items:[{scope:this,checked:(this.userConf.conf_error_skipnbliteraltag==="true")?true:false,boxLabel:"Skip nbLiteralTag error",name:"conf_error_skipnbliteraltag",listeners:{scope:this,check:function(g){this.confUpdate("conf_error_skipnbliteraltag",g.getValue())}}}]},{xtype:"fieldset",title:"Editor",autoHeight:true,defaults:{hideLabel:true},defaultType:"checkbox",items:[{scope:this,checked:(this.userConf.conf_error_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_error_scrollbars",listeners:{scope:this,check:function(g){this.confUpdate("conf_error_scrollbars",g.getValue())}}}]}]},{id:"conf-card-4",xtype:"form",bodyStyle:"padding: 10px;",items:[{xtype:"fieldset",title:"Editor",autoHeight:true,defaults:{hideLabel:true},defaultType:"checkbox",items:[{scope:this,checked:(this.userConf.conf_reviewed_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_reviewed_scrollbars",listeners:{scope:this,check:function(g){this.confUpdate("conf_reviewed_scrollbars",g.getValue())}}}]}]},{id:"conf-card-5",xtype:"form",bodyStyle:"padding: 10px;",items:[{xtype:"fieldset",title:"Editor",autoHeight:true,defaults:{hideLabel:true},defaultType:"checkbox",items:[{scope:this,checked:(this.userConf.conf_patch_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_patch_scrollbars",listeners:{scope:this,check:function(g){this.confUpdate("conf_patch_scrollbars",g.getValue())}}}]}]}]}],buttons:[{text:"Close",handler:function(){a.hide()}}]})}a.show(Ext.get("winconf-btn"))},confUpdate:function(b,a){Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"conf-update",item:b,value:a},success:function(c){if(b==="conf_needupdate_diff"){this.userConf.conf_needupdate_diff=a}if(b==="conf_needupdate_scrollbars"){this.userConf.conf_needupdate_scrollbars=""+a+""}if(b==="conf_error_skipnbliteraltag"){this.userConf.conf_error_skipnbliteraltag=""+a+"";this.storeFilesError.reload()}if(b==="conf_error_scrollbars"){this.userConf.conf_error_scrollbars=""+a+""}if(b==="conf_reviewed_scrollbars"){this.userConf.conf_reviewed_scrollbars=""+a+""}if(b==="conf_patch_scrollbars"){this.userConf.conf_patch_scrollbars=""+a+""}}})},WinAbout:function(){var a;if(!a){a=new Ext.Window({layout:"fit",width:515,height:320,iconCls:"iconHelp",modal:true,title:"About "+this.appName,closeAction:"hide",plain:true,bodyStyle:"color:#000",items:new Ext.TabPanel({autoTabs:true,activeTab:0,border:false,defaults:{autoScroll:true},items:[{title:"About",html:'<div id="phd-oe-about"><img src="/img/logo.png" alt="'+this.appName+'" /></div><div id="phd-oe-about-info">'+this.appName+" ver "+this.appVer+' (c) 2008-2009, Yannick Torr&egrave;ss - <a href="mailto:yannick@php.net">yannick@php.net</a></div>'},{title:"Credits",bodyStyle:"padding:15px",html:'<div id="phd-oe-credit"><ul><li><a href="http://extjs.com" target="_blank">ExtJs Team</a><div class="phd-oe-credit-info">Javascript FrameWork</div></li><li><a href="http://marijn.haverbeke.nl/codemirror/" target="_blank">CodeMirror</a><div class="phd-oe-credit-info">Code editor</div></li><li><a href="http://famfamfam.com" target="_blank">famfamfam.com</a><div class="phd-oe-credit-info">Icon pack</div></li></ul></div>'},{title:"License",autoLoad:{url:"/license_LGPL_v2.txt"}}]}),buttons:[{text:"Close",handler:function(){a.hide()}}]})}a.show(Ext.get("winabout-btn"))},sendEmail:function(b,a){var c,d;c=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,url:"save-form.php",defaultType:"textfield",items:[{fieldLabel:"Send To",name:"to",readOnly:true,anchor:"100%",value:'"'+b+'" <'+a+">"},{fieldLabel:"Subject",name:"subject",anchor:"100%"},{xtype:"textarea",hideLabel:true,name:"msg",anchor:"100% -53"}]});d=new Ext.Window({title:"Send an email",width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:c,iconCls:"iconSendEmail",buttons:[{text:"Send",handler:function(){var e=c.getForm().getValues();Ext.Ajax.request({url:"./php/controler.php",params:{task:"send-email",to:e.to,subject:e.subject,msg:e.msg},success:function(f){var g=Ext.util.JSON.decode(f.responseText);if(g.success){d.close();Ext.MessageBox.alert("Status","Email sent to "+b+" with success!")}},failure:function(){}})}},{text:"Cancel",handler:function(){d.close()}}]});d.show()},drawInterface:function(){var j,l,a,c,h,g,f,i,e,k,b,d;this.TaskPing=new Ext.util.DelayedTask(function(){Ext.Ajax.request({url:"./php/controler.php",params:{task:"ping"},success:function(m){if(m.responseText!=="pong"){window.location.href="/login.php"}},failure:function(){window.location.href="/login.php"}});this.TaskPing.delay(30000)},this);this.TaskPing.delay(30000);j=new Ext.grid.GridPanel({store:this.storeFilesError,loadMask:true,columns:[{id:"name",header:"Files",sortable:true,dataIndex:"name"},{header:"Maintainer",width:45,sortable:true,dataIndex:"maintainer"},{header:"Type",width:45,sortable:true,dataIndex:"type"},{header:"Path",dataIndex:"path",hidden:true}],view:new Ext.grid.GroupingView({emptyText:'<div style="text-align: center;">No files</div>',forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "Files" : "File"]})',getRowClass:function(m,p,o,n){if(m.data.needcommit){return"file-need-commit"}}}),autoExpandColumn:"name",bodyBorder:false,listeners:{scope:this,render:function(m){j.view.refresh()},rowdblclick:function(o,y,u){var n,p,v,t,w,m,s,r,q,z,x;n=this.storeFilesError.getAt(y).data.path;p=this.storeFilesError.getAt(y).data.name;v=Ext.util.md5("FE-"+this.userLang+n+p);t=this.storeFilesError.getAt(y).data.needcommit;if(!Ext.getCmp("main-panel").findById("FE-"+v)){w=[];this.storeFilesError.each(function(A){if(A.data.path===n&&A.data.name===p){if(!w[A.data.type]){w.push(A.data.type)}}});m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:this.userLang+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});m.setDefaultSort("date","desc");s=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:"en"+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});s.setDefaultSort("date","desc");r=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(B){var A=B.getCount();if(A===2){return false}},rowselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FE-PANEL-btn-logLang-"+v).enable();Ext.get("FE-PANEL-btn-logLang-"+v).frame("3F8538")}else{Ext.getCmp("FE-PANEL-btn-logLang-"+v).disable()}},rowdeselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FE-PANEL-btn-logLang-"+v).enable();Ext.get("FE-PANEL-btn-logLang-"+v).frame("3F8538")}else{Ext.getCmp("FE-PANEL-btn-logLang-"+v).disable()}}}});q=new Ext.grid.GridPanel({store:m,loadMask:true,columns:[r,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:r,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FE-PANEL-btn-logLang-"+v,disabled:true,handler:function(){var C,B,A;C=r.getSelections();B=C[0].data.revision;A=C[1].data.revision;this.winDiff(this.userLang+n,p,B,A)}}]});z=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(B){var A=B.getCount();if(A===2){return false}},rowselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FE-PANEL-btn-logEn-"+v).enable();Ext.get("FE-PANEL-btn-logEn-"+v).frame("3F8538")}else{Ext.getCmp("FE-PANEL-btn-logEn-"+v).disable()}},rowdeselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FE-PANEL-btn-logEn-"+v).enable();Ext.get("FE-PANEL-btn-logEn-"+v).frame("3F8538")}else{Ext.getCmp("FE-PANEL-btn-logEn-"+v).disable()}}}});x=new Ext.grid.GridPanel({store:s,loadMask:true,columns:[z,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:z,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FE-PANEL-btn-logEn-"+v,disabled:true,handler:function(){var C,B,A;C=z.getSelections();B=C[0].data.revision;A=C[1].data.revision;this.winDiff("en"+n,p,B,A)}}]});Ext.getCmp("main-panel").add({closable:true,title:p,originTitle:p,tabTip:"File with error : in "+n,iconCls:"iconTabError",id:"FE-"+v,isModifiedLang:false,isModifiedEn:false,layout:"border",defaults:{collapsible:true,split:true},items:[{xtype:"panel",layout:"fit",region:"north",title:"Error description",id:"FE-error-desc-"+v,height:150,collapsed:true,items:{xtype:"iframepanel",id:"FE-error-type-"+v,loadMask:true,defaultSrc:"/error_type.php?dir="+n+"&file="+p}},{region:"west",xtype:"panel",layout:"fit",bodyBorder:false,title:"CvsLog",collapsed:true,width:375,items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[{layout:"fit",title:this.userLang,items:[q]},{layout:"fit",title:"En",items:[x]}]}},{title:this.userLang+" File: "+n+p,originTitle:this.userLang+" File: "+n+p,collapsible:false,id:"FE-LANG-PANEL-"+v,region:"center",xtype:"form",height:"auto",width:"auto",items:[{xtype:"codemirror",id:"FE-LANG-"+v,listeners:{scope:this,initialize:function(A){this.getFile(v,this.userLang+n,p,"FE-LANG-PANEL-","FE-LANG-")},cmcursormove:function(){var A=Ext.util.JSON.decode(Ext.getCmp("FE-LANG-"+v).getCursorPosition());Ext.get("FE-LANG-status-line-"+v).dom.innerHTML=A.line;Ext.get("FE-LANG-status-col-"+v).dom.innerHTML=A.caracter},cmchange:function(D,B,C){var A=Ext.util.JSON.decode(Ext.getCmp("FE-LANG-"+v).getCursorPosition());Ext.get("FE-LANG-status-line-"+v).dom.innerHTML=A.line;Ext.get("FE-LANG-status-col-"+v).dom.innerHTML=A.caracter;if(D!==27&&D!==33&&D!==34&&D!==37&&D!==38&&D!==39&&D!==40&&D!==17&&D!==16&&D!==67){if(!Ext.getCmp("FE-"+v).isModifiedLang){Ext.getCmp("FE-LANG-PANEL-"+v).setTitle(Ext.getCmp("FE-LANG-PANEL-"+v).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FE-"+v).setTitle(Ext.getCmp("FE-"+v).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FE-LANG-PANEL-btn-save-"+v).enable();Ext.get("FE-LANG-PANEL-btn-save-"+v).frame("3F8538");Ext.getCmp("FE-LANG-PANEL-btn-saveas-"+v).enable();Ext.get("FE-LANG-PANEL-btn-saveas-"+v).frame("3F8538");Ext.getCmp("FE-"+v).isModifiedLang=true}}},cmscroll:function(A){if(this.userConf.conf_error_scrollbars==="true"){Ext.getCmp("FE-EN-"+v).scrollTo(A)}}}}],bbar:[{scope:this,xtype:"checkbox",hideLabel:true,checked:(this.userConf.conf_error_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_error_scrollbars",listeners:{scope:this,check:function(A){this.confUpdate("conf_error_scrollbars",A.getValue())},render:function(A){Ext.DomHelper.insertHtml("beforeBegin",A.el.dom,'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FE-LANG-status-line-'+v+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FE-LANG-status-col-'+v+'">-</span></span></div>&nbsp;&nbsp;')}}}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FE-LANG-PANEL-btn-save-"+v,disabled:true,handler:function(){this.saveLangFile(v,n,p,"FE",y,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FE-LANG-PANEL-btn-saveas-"+v,disabled:true,handler:function(){this.savePatch(this.userLang,v,n,p,"FE",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FE-LANG-"+v).reIndentAll()}}]},{title:"En File: "+n+p,originTitle:"En File: "+n+p,collapsible:false,id:"FE-EN-PANEL-"+v,region:"east",xtype:"form",height:"auto",width:575,items:[{xtype:"codemirror",id:"FE-EN-"+v,listeners:{scope:this,initialize:function(A){this.getFile(v,"en"+n,p,"FE-EN-PANEL-","FE-EN-")},cmchange:function(D,B,C){var A=Ext.util.JSON.decode(Ext.getCmp("FE-EN-"+v).getCursorPosition());Ext.get("FE-EN-status-line-"+v).dom.innerHTML=A.line;Ext.get("FE-EN-status-col-"+v).dom.innerHTML=A.caracter;if(D!==27&&D!==33&&D!==34&&D!==37&&D!==38&&D!==39&&D!==40&&D!==17&&D!==16&&D!==67){if(!Ext.getCmp("FE-"+v).isModifiedEn){Ext.getCmp("FE-EN-PANEL-"+v).setTitle(Ext.getCmp("FE-EN-PANEL-"+v).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FE-"+v).setTitle(Ext.getCmp("FE-"+v).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FE-EN-PANEL-btn-save-"+v).enable();Ext.get("FE-EN-PANEL-btn-save-"+v).frame("3F8538");Ext.getCmp("FE-EN-PANEL-btn-saveas-"+v).enable();Ext.get("FE-EN-PANEL-btn-saveas-"+v).frame("3F8538");Ext.getCmp("FE-"+v).isModifiedEn=true}}},cmscroll:function(A){if(this.userConf.conf_error_scrollbars==="true"){Ext.getCmp("FE-LANG-"+v).scrollTo(A)}},cmcursormove:function(B){var A=Ext.util.JSON.decode(Ext.getCmp("FE-EN-"+v).getCursorPosition());Ext.get("FE-EN-status-line-"+v).dom.innerHTML=A.line;Ext.get("FE-EN-status-col-"+v).dom.innerHTML=A.caracter}}}],bbar:[{scope:this,xtype:"panel",height:21,baseCls:"",bodyStyle:"padding-top:5px;",html:'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FE-EN-status-line-'+v+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FE-EN-status-col-'+v+'">-</span></span></div>&nbsp;&nbsp;'}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FE-EN-PANEL-btn-save-"+v,disabled:true,handler:function(){this.saveEnFile(v,n,p,"FE",y,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FE-EN-PANEL-btn-saveas-"+v,disabled:true,handler:function(){this.savePatch("en",v,n,p,"FE",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FE-EN-"+v).reIndentAll()}}]}]});Ext.getCmp("main-panel").setActiveTab("FE-"+v);if(Ext.getCmp("FE-"+v).getLayout().north.collapsedEl){Ext.getCmp("FE-"+v).getLayout().north.collapsedEl.addClass("x-layout-collapsed-east-error-desc")}}else{Ext.getCmp("main-panel").setActiveTab("FE-"+v)}},rowcontextmenu:function(o,t,r){var p,m,q,n="",s;o.getSelectionModel().selectRow(t);p=this.storeFilesError.getAt(t).data.path;m=this.storeFilesError.getAt(t).data.name;q=Ext.util.md5("FE-"+p+m);if(this.storeFilesError.getAt(t).data.needcommit){n={text:"View Diff",iconCls:"iconViewDiff",scope:this,handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+t,title:"Diff",tabTip:"Diff",closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+t+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+t);Ext.get("diff_panel_"+t).mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, Wait...');Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"get-diff",FilePath:this.userLang+p,FileName:m},success:function(u){var v=Ext.util.JSON.decode(u.responseText);if(v.success){Ext.get("diff_content_"+t).dom.innerHTML=v.content;Ext.get("diff_panel_"+t).unmask()}},failure:function(){}})}}}s=new Ext.menu.Menu({items:[{text:"<b>Edit in a new Tab</b>",iconCls:"FilesError",scope:this,handler:function(){j.fireEvent("rowdblclick",o,t,r)}},n,"-",{text:"About error type",iconCls:"iconHelp",scope:this,handler:function(){Ext.getCmp("main-panel").add({closable:true,title:"About error type",iconCls:"iconHelp",id:"FE-help-"+q,autoScroll:true,autoLoad:"/error_type.php"});Ext.getCmp("main-panel").setActiveTab("FE-help-"+q)}}]});s.showAt(r.getXY())}}});l=new Ext.grid.GridPanel({store:this.storeFilesNeedUpdate,loadMask:true,columns:[{id:"name",header:"Files",sortable:true,dataIndex:"name"},{header:"EN revision",width:45,sortable:true,dataIndex:"en_revision"},{header:Ext.util.Format.uppercase(this.userLang)+" revision",width:45,sortable:true,dataIndex:"revision"},{header:"Maintainer",width:45,sortable:true,dataIndex:"maintainer"},{header:"Path",dataIndex:"path",hidden:true}],view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "Files" : "File"]})',getRowClass:function(m,p,o,n){if(m.data.needcommit){return"file-need-commit"}if(m.data.isCritical){return"file-critical"}},emptyText:'<div style="text-align: center;">No Files</div>'}),autoExpandColumn:"name",bodyBorder:false,listeners:{scope:this,rowcontextmenu:function(o,s,q){var p,m,n="",r;p=this.storeFilesNeedUpdate.getAt(s).data.path;m=this.storeFilesNeedUpdate.getAt(s).data.name;o.getSelectionModel().selectRow(s);if(this.storeFilesNeedUpdate.getAt(s).data.needcommit){n={text:"View Diff",iconCls:"iconViewDiff",scope:this,handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+s,title:"Diff",tabTip:"Diff",closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+s+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+s);Ext.get("diff_panel_"+s).mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, Wait...');Ext.Ajax.request({url:"./php/controler.php",params:{task:"get-diff",FilePath:this.userLang+p,FileName:m},success:function(t){var u=Ext.util.JSON.decode(t.responseText);if(u.success){Ext.get("diff_content_"+s).dom.innerHTML=u.content;Ext.get("diff_panel_"+s).unmask()}},failure:function(){}})}}}r=new Ext.menu.Menu({items:[{text:"<b>Edit in a new Tab</b>",iconCls:"iconTabNeedUpdate",scope:this,handler:function(){l.fireEvent("rowdblclick",o,s,q)}},n]});q.stopEvent();r.showAt(q.getXY())},rowdblclick:function(o,x,v){var n,p,z,y,t,u,m,s,r,q,B,w,A;n=this.storeFilesNeedUpdate.getAt(x).data.path;p=this.storeFilesNeedUpdate.getAt(x).data.name;z=this.storeFilesNeedUpdate.getAt(x).data.en_revision;y=this.storeFilesNeedUpdate.getAt(x).data.revision;t=this.storeFilesNeedUpdate.getAt(x).data.needcommit;u=Ext.util.md5("FNU-"+this.userLang+n+p);if(!Ext.getCmp("main-panel").findById("FNU-"+u)){m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:this.userLang+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});m.setDefaultSort("date","desc");s=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:"en"+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});s.setDefaultSort("date","desc");r=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(D){var C=D.getCount();if(C===2){return false}},rowselect:function(D){var C=D.getCount();if(C===2){Ext.getCmp("FNU-PANEL-btn-logLang-"+u).enable();Ext.get("FNU-PANEL-btn-logLang-"+u).frame("3F8538")}else{Ext.getCmp("FNU-PANEL-btn-logLang-"+u).disable()}},rowdeselect:function(D){var C=D.getCount();if(C===2){Ext.getCmp("FNU-PANEL-btn-logLang-"+u).enable();Ext.get("FNU-PANEL-btn-logLang-"+u).frame("3F8538")}else{Ext.getCmp("FNU-PANEL-btn-logLang-"+u).disable()}}}});q=new Ext.grid.GridPanel({store:m,loadMask:true,columns:[r,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:r,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FNU-PANEL-btn-logLang-"+u,disabled:true,handler:function(){var E,D,C;E=r.getSelections();D=E[0].data.revision;C=E[1].data.revision;this.winDiff(this.userLang+n,p,D,C)}}]});B=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(D){var C=D.getCount();if(C===2){return false}},rowselect:function(D){var C=D.getCount();if(C===2){Ext.getCmp("FNU-PANEL-btn-logEn-"+u).enable();Ext.get("FNU-PANEL-btn-logEn-"+u).frame("3F8538")}else{Ext.getCmp("FNU-PANEL-btn-logEn-"+u).disable()}},rowdeselect:function(D){var C=D.getCount();if(C===2){Ext.getCmp("FNU-PANEL-btn-logEn-"+u).enable();Ext.get("FNU-PANEL-btn-logEn-"+u).frame("3F8538")}else{Ext.getCmp("FNU-PANEL-btn-logEn-"+u).disable()}}}});w=new Ext.grid.GridPanel({store:s,loadMask:true,columns:[B,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:B,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FNU-PANEL-btn-logEn-"+u,disabled:true,handler:function(){var E,D,C;E=B.getSelections();D=E[0].data.revision;C=E[1].data.revision;this.winDiff("en"+n,p,D,C)}}]});if(this.userConf.conf_needupdate_diff==="using-viewvc"){A={xtype:"panel",layout:"fit",region:"north",title:"Diff From cvs",height:150,collapsed:true,items:{xtype:"iframepanel",id:"FNU-diff-"+u,loadMask:true,defaultSrc:"http://cvs.php.net/viewvc.cgi/phpdoc/en"+n+p+"?r1="+y+"&r2="+z}}}else{if(this.userConf.conf_needupdate_diff==="using-exec"){A={xtype:"panel",layout:"fit",region:"north",title:"Diff From cvs",height:150,autoScroll:true,collapsed:true,html:'<div id="FNU-diff-'+u+'" class="diff-content"></div>',listeners:{render:function(){Ext.Ajax.request({url:"./php/controler.php",params:{task:"get-diff2",FilePath:"en"+n,FileName:p,Rev2:y,Rev1:z},success:function(C){var D=Ext.util.JSON.decode(C.responseText);if(D.success){Ext.get("FNU-diff-"+u).dom.innerHTML=D.content}},failure:function(){}})}}}}}Ext.getCmp("main-panel").add({closable:true,title:p,originTitle:p,tabTip:"Need Update : in "+n,iconCls:"iconTabNeedUpdate",id:"FNU-"+u,isModifiedLang:false,isModifiedEn:false,layout:"border",defaults:{collapsible:true,split:true},items:[A,{region:"west",xtype:"panel",layout:"fit",bodyBorder:false,title:"CvsLog",collapsed:true,width:375,items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[{layout:"fit",title:this.userLang,items:[q]},{layout:"fit",title:"En",items:[w]}]}},{scope:this,title:this.userLang+" File: "+n+p,originTitle:this.userLang+" File: "+n+p,collapsible:false,id:"FNU-LANG-PANEL-"+u,region:"center",xtype:"form",height:"auto",width:"auto",items:[{xtype:"codemirror",id:"FNU-LANG-"+u,listeners:{scope:this,initialize:function(){this.getFile(u,this.userLang+n,p,"FNU-LANG-PANEL-","FNU-LANG-")},cmcursormove:function(){var C=Ext.util.JSON.decode(Ext.getCmp("FNU-LANG-"+u).getCursorPosition());Ext.get("FNU-LANG-status-line-"+u).dom.innerHTML=C.line;Ext.get("FNU-LANG-status-col-"+u).dom.innerHTML=C.caracter},cmchange:function(F,D,E){var C=Ext.util.JSON.decode(Ext.getCmp("FNU-LANG-"+u).getCursorPosition());Ext.get("FNU-LANG-status-line-"+u).dom.innerHTML=C.line;Ext.get("FNU-LANG-status-col-"+u).dom.innerHTML=C.caracter;if(F!==27&&F!==33&&F!==34&&F!==37&&F!==38&&F!==39&&F!==40&&F!==17&&F!==16&&F!==67){if(!Ext.getCmp("FNU-"+u).isModifiedLang){Ext.getCmp("FNU-LANG-PANEL-"+u).setTitle(Ext.getCmp("FNU-LANG-PANEL-"+u).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FNU-"+u).setTitle(Ext.getCmp("FNU-"+u).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FNU-LANG-PANEL-btn-save-"+u).enable();Ext.get("FNU-LANG-PANEL-btn-save-"+u).frame("3F8538");Ext.getCmp("FNU-LANG-PANEL-btn-saveas-"+u).enable();Ext.get("FNU-LANG-PANEL-btn-saveas-"+u).frame("3F8538");Ext.getCmp("FNU-"+u).isModifiedLang=true}}},cmscroll:function(C){if(this.userConf.conf_needupdate_scrollbars==="true"){Ext.getCmp("FNU-EN-"+u).scrollTo(C)}}}}],bbar:[{scope:this,xtype:"checkbox",hideLabel:true,checked:(this.userConf.conf_needupdate_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_needupdate_scrollbars",listeners:{scope:this,check:function(C){this.confUpdate("conf_needupdate_scrollbars",C.getValue())},render:function(C){Ext.DomHelper.insertHtml("beforeBegin",C.el.dom,'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FNU-LANG-status-line-'+u+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FNU-LANG-status-col-'+u+'">-</span></span></div>&nbsp;&nbsp;')}}}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FNU-LANG-PANEL-btn-save-"+u,disabled:true,handler:function(){this.saveLangFile(u,n,p,"FNU",x,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FNU-LANG-PANEL-btn-saveas-"+u,disabled:true,handler:function(){this.savePatch(this.userLang,u,n,p,"FNU",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FNU-LANG-"+u).reIndentAll()}},{tooltip:"Insert <b>Reviewed</b> tag",text:"Reviewed tag",iconCls:"iconInsertCode",handler:function(){Ext.getCmp("FNU-LANG-"+u).insertIntoLine(2,"end","\n<!-- Reviewed: no -->");Ext.getCmp("FNU-LANG-"+u).focus()}},{tooltip:"Insert <b>Revcheck</b> tag",text:"Rev tag",iconCls:"iconInsertCode",handler:function(){Ext.getCmp("FNU-LANG-"+u).insertIntoLine(2,"end","\n<!-- EN-Revision: 1.XX Maintainer: "+this.userLoggin+" Status: ready -->");Ext.getCmp("FNU-LANG-"+u).focus()}}]},{title:"En File: "+n+p,originTitle:"En File: "+n+p,collapsible:false,id:"FNU-EN-PANEL-"+u,region:"east",xtype:"form",height:"auto",width:575,items:[{xtype:"codemirror",id:"FNU-EN-"+u,listeners:{scope:this,initialize:function(){this.getFile(u,"en"+n,p,"FNU-EN-PANEL-","FNU-EN-")},cmchange:function(F,D,E){var C=Ext.util.JSON.decode(Ext.getCmp("FNU-EN-"+u).getCursorPosition());Ext.get("FNU-EN-status-line-"+u).dom.innerHTML=C.line;Ext.get("FNU-EN-status-col-"+u).dom.innerHTML=C.caracter;if(F!==27&&F!==33&&F!==34&&F!==37&&F!==38&&F!==39&&F!==40&&F!==17&&F!==16&&F!==67){if(!Ext.getCmp("FNU-"+u).isModifiedEn){Ext.getCmp("FNU-EN-PANEL-"+u).setTitle(Ext.getCmp("FNU-EN-PANEL-"+u).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FNU-"+u).setTitle(Ext.getCmp("FNU-"+u).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FNU-EN-PANEL-btn-save-"+u).enable();Ext.get("FNU-EN-PANEL-btn-save-"+u).frame("3F8538");Ext.getCmp("FNU-EN-PANEL-btn-saveas-"+u).enable();Ext.get("FNU-EN-PANEL-btn-saveas-"+u).frame("3F8538");Ext.getCmp("FNU-"+u).isModifiedEn=true}}},cmscroll:function(C){if(this.userConf.conf_needupdate_scrollbars==="true"){Ext.getCmp("FNU-LANG-"+u).scrollTo(C)}},cmcursormove:function(D){var C=Ext.util.JSON.decode(Ext.getCmp("FNU-EN-"+u).getCursorPosition());Ext.get("FNU-EN-status-line-"+u).dom.innerHTML=C.line;Ext.get("FNU-EN-status-col-"+u).dom.innerHTML=C.caracter}}}],bbar:[{scope:this,xtype:"panel",height:21,baseCls:"",bodyStyle:"padding-top:5px;",html:'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FNU-EN-status-line-'+u+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FNU-EN-status-col-'+u+'">-</span></span></div>&nbsp;&nbsp;'}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FNU-EN-PANEL-btn-save-"+u,disabled:true,handler:function(){this.saveEnFile(u,n,p,"FNU",x,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FNU-EN-PANEL-btn-saveas-"+u,disabled:true,handler:function(){this.savePatch("en",u,n,p,"FNU",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FNU-EN-"+u).reIndentAll()}}]}]});Ext.getCmp("main-panel").setActiveTab("FNU-"+u)}else{Ext.getCmp("main-panel").setActiveTab("FNU-"+u)}}}});a=new Ext.grid.GridPanel({store:this.storePendingPatch,loadMask:true,columns:[{id:"name",header:"Files",sortable:true,dataIndex:"name"},{header:"Posted by",width:45,sortable:true,dataIndex:"by"},{header:"Date",width:45,sortable:true,dataIndex:"date"},{header:"Path",dataIndex:"path",hidden:true}],view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "Files" : "File"]})',emptyText:'<div style="text-align: center;">No pending Patch</div>'}),autoExpandColumn:"name",bodyBorder:false,listeners:{scope:this,rowcontextmenu:function(n,t,r){var o,m,p,q,s;o=this.storePendingPatch.getAt(t).data.path;m=this.storePendingPatch.getAt(t).data.name;p=this.storePendingPatch.getAt(t).data.uniqID;q=Ext.util.md5("PP-"+p+o+m);n.getSelectionModel().selectRow(t);s=new Ext.menu.Menu({items:[{text:"<b>Edit in a new Tab</b>",iconCls:"PendingPatch",scope:this,handler:function(){a.fireEvent("rowdblclick",n,t,r)}},"-",{text:"Reject this patch",iconCls:"iconPageDelete",scope:this,handler:function(){this.rejectPatch(q,o,m,p,t,this)}}]});s.showAt(r.getXY())},rowdblclick:function(n,u,s){var m,o,v,t,r,q,p;m=this.storePendingPatch.getAt(u).data.path;o=this.storePendingPatch.getAt(u).data.name;v=this.storePendingPatch.getAt(u).data.uniqID;t=Ext.util.md5("PP-"+v+m+o);if(!Ext.getCmp("main-panel").findById("FE-"+t)){r=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:m,File:o},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});r.setDefaultSort("date","desc");q=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(x){var w=x.getCount();if(w===2){return false}},rowselect:function(x){var w=x.getCount();if(w===2){Ext.getCmp("PP-PANEL-btn-log-"+t).enable();Ext.get("PP-PANEL-btn-log-"+t).frame("3F8538")}else{Ext.getCmp("PP-PANEL-btn-log-"+t).disable()}},rowdeselect:function(x){var w=x.getCount();if(w===2){Ext.getCmp("PP-PANEL-btn-log-"+t).enable();Ext.get("PP-PANEL-btn-log-"+t).frame("3F8538")}else{Ext.getCmp("PP-PANEL-btn-log-"+t).disable()}}}});p=new Ext.grid.GridPanel({store:r,loadMask:true,columns:[q,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:q,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"PP-PANEL-btn-log-"+t,disabled:true,handler:function(){var y,x,w;y=q.getSelections();x=y[0].data.revision;w=y[1].data.revision;this.winDiff(m,o,x,w)}}]});Ext.getCmp("main-panel").add({closable:true,title:o,originTitle:o,tabTip:"Patch for "+m+o,iconCls:"PendingPatch",id:"PP-"+t,layout:"border",defaults:{collapsible:true,split:true},items:[{xtype:"panel",layout:"fit",region:"north",title:"Patch content",id:"PP-patch-desc-"+t,height:150,autoScroll:true,collapsed:true,html:'<div id="diff_content_'+t+'" class="diff-content"></div>',listeners:{render:function(){Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"get-diff",FilePath:m,FileName:o,type:"patch",uniqID:v},success:function(w){var x=Ext.util.JSON.decode(w.responseText);if(x.success){Ext.get("diff_content_"+t).dom.innerHTML=x.content}},failure:function(){}})}}},{region:"west",xtype:"panel",layout:"fit",bodyBorder:false,title:"CvsLog",collapsed:true,width:375,items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[{layout:"fit",title:"Log",items:[p]}]}},{title:"Proposed Patch for "+m+o,originTitle:"Proposed Patch for "+m+o,collapsible:false,id:"PP-PATCH-PANEL-"+t,region:"center",xtype:"form",height:"auto",width:"auto",items:[{xtype:"codemirror",id:"PP-PATCH-"+t,isModified:false,listeners:{scope:this,initialize:function(w){this.getFile(t,m,o+"."+v+".patch","PP-PATCH-PANEL-","PP-PATCH-")},cmcursormove:function(){var w=Ext.util.JSON.decode(Ext.getCmp("PP-PATCH-"+t).getCursorPosition());Ext.get("PP-PATCH-status-line-"+t).dom.innerHTML=w.line;Ext.get("PP-PATCH-status-col-"+t).dom.innerHTML=w.caracter},cmchange:function(z,x,y){var w=Ext.util.JSON.decode(Ext.getCmp("PP-PATCH-"+t).getCursorPosition());Ext.get("PP-PATCH-status-line-"+t).dom.innerHTML=w.line;Ext.get("PP-PATCH-status-col-"+t).dom.innerHTML=w.caracter;if(z!==27&&z!==33&&z!==34&&z!==37&&z!==38&&z!==39&&z!==40&&z!==17&&z!==16&&z!==67){if(!Ext.getCmp("PP-PATCH-"+t).isModified){Ext.getCmp("PP-PATCH-PANEL-"+t).setTitle(Ext.getCmp("PP-PATCH-PANEL-"+t).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("PP-"+t).setTitle(Ext.getCmp("PP-"+t).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("PP-PATCH-"+t).isModified=true}}},cmscroll:function(w){if(this.userConf.conf_patch_scrollbars==="true"){Ext.getCmp("PP-ORIGIN-"+t).scrollTo(w)}}}}],bbar:[{scope:this,xtype:"checkbox",hideLabel:true,checked:(this.userConf.conf_patch_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_patch_scrollbars",listeners:{scope:this,check:function(w){this.confUpdate("conf_patch_scrollbars",w.getValue())},render:function(w){Ext.DomHelper.insertHtml("beforeBegin",w.el.dom,'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="PP-PATCH-status-line-'+t+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="PP-PATCH-status-col-'+t+'">-</span></span></div>&nbsp;&nbsp;')}}}],tbar:[{scope:this,tooltip:"<b>Accept</b> this patch and <b>Save</b> the file",iconCls:"saveFile",id:"PP-PATCH-PANEL-btn-save-"+t,handler:function(){this.saveFileViaPatch(t,m,o,v,u,this)}},{scope:this,tooltip:"<b>Reject</b> this patch",iconCls:"iconPageDelete",id:"PP-PATCH-PANEL-btn-reject-"+t,handler:function(){this.rejectPatch(t,m,o,v,u,this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("PP-PATCH-"+t).reIndentAll()}}]},{title:"Original File: "+m+o,originTitle:"Original File: "+m+o,collapsible:false,id:"PP-ORIGIN-PANEL-"+t,region:"east",xtype:"form",height:"auto",width:575,items:[{xtype:"codemirror",id:"PP-ORIGIN-"+t,readOnly:true,listeners:{scope:this,initialize:function(w){this.getFile(t,m,o,"PP-ORIGIN-PANEL-","PP-ORIGIN-")},cmscroll:function(w){if(this.userConf.conf_patch_scrollbars==="true"){Ext.getCmp("PP-PATCH-"+t).scrollTo(w)}},cmcursormove:function(x){var w=Ext.util.JSON.decode(Ext.getCmp("PP-ORIGIN-"+t).getCursorPosition());Ext.get("PP-ORIGIN-status-line-"+t).dom.innerHTML=w.line;Ext.get("PP-ORIGIN-status-col-"+t).dom.innerHTML=w.caracter}}}],bbar:[{scope:this,xtype:"panel",height:21,baseCls:"",bodyStyle:"padding-top:5px;",html:'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="PP-ORIGIN-status-line-'+t+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="PP-ORIGIN-status-col-'+t+'">-</span></span></div>&nbsp;&nbsp;'}],tbar:[{}]}]});Ext.getCmp("main-panel").setActiveTab("PP-"+t);if(Ext.getCmp("PP-"+t).getLayout().north.collapsedEl){Ext.getCmp("PP-"+t).getLayout().north.collapsedEl.addClass("x-layout-collapsed-east-patch-desc")}}}}});c=new Ext.grid.GridPanel({store:this.storePendingCommit,loadMask:true,columns:[{id:"name",header:"Files",sortable:true,dataIndex:"name"},{header:"Modified by",width:45,sortable:true,dataIndex:"by"},{header:"Date",width:45,sortable:true,dataIndex:"date"},{header:"Path",dataIndex:"path",hidden:true}],view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "Files" : "File"]})',emptyText:'<div style="text-align: center;">No pending for Commit</div>'}),autoExpandColumn:"name",bodyBorder:false,listeners:{scope:this,rowcontextmenu:function(n,r,p){var o,m,q;o=this.storePendingCommit.getAt(r).data.path;m=this.storePendingCommit.getAt(r).data.name;n.getSelectionModel().selectRow(r);q=new Ext.menu.Menu({items:[{text:"<b>Edit in a new Tab</b>",iconCls:"PendingCommit",scope:this,handler:function(){c.fireEvent("rowdblclick",n,r,p)}},"-",{text:"View Diff",iconCls:"iconViewDiff",scope:this,handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+r,title:"Diff",tabTip:"Diff",closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+r+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+r);Ext.get("diff_panel_"+r).mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, Wait...');Ext.Ajax.request({url:"./php/controler.php",params:{task:"get-diff",FilePath:o,FileName:m},success:function(s){var t=Ext.util.JSON.decode(s.responseText);if(t.success){Ext.get("diff_content_"+r).dom.innerHTML=t.content;Ext.get("diff_panel_"+r).unmask()}},failure:function(){}})}},{text:"Download the diff as a patch",iconCls:"iconCommitFileCvs",scope:this,handler:function(){window.location.href="./dl_Patch.php?FilePath="+o+"&FileName="+m}},"-",{text:"Clear this change",iconCls:"iconPageDelete",scope:this,handler:function(){function s(t){if(t==="yes"){if(Ext.getCmp("main-panel").findById("FNU-"+Ext.util.md5("FNU-"+o+m))){Ext.getCmp("main-panel").remove("FNU-"+Ext.util.md5("FNU-"+o+m))}Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"clear-local-change",FilePath:o,FileName:m},success:function(u){var v=Ext.util.JSON.decode(u.responseText);if(v.success){this.storeFilesNeedUpdate.reload();this.storeFilesError.reload();this.storeFilesNeedReviewed.reload();this.storePendingCommit.remove(this.storePendingCommit.getAt(r));this.storePendingCommit.fireEvent("add",this.storePendingCommit)}},failure:function(){}})}}Ext.MessageBox.confirm("Confirm","This action will clear your local modification and take back this file from his original stats.<br/>You need confirm.",s,this)}},"-",{text:"Commit...",iconCls:"iconCommitFileCvs",scope:this,menu:new Ext.menu.Menu({items:[{text:"...this file",iconCls:"iconCommitFileCvs",scope:this,handler:function(){this.WinCommit(true,r)}},{text:"...all files modified by me",iconCls:"iconCommitFileCvs",scope:this,handler:function(){this.WinCommit(false,"","by me")}},{text:"...all files modified",iconCls:"iconCommitFileCvs",scope:this,handler:function(){this.WinCommit(false)}}]})}]});q.showAt(p.getXY())},rowdblclick:function(n,q,p){var o,m;o=this.storePendingCommit.getAt(q).data.path;m=this.storePendingCommit.getAt(q).data.name;this.openFile(o,m)}}});h=new Ext.grid.GridPanel({store:this.storeFilesNeedReviewed,loadMask:true,columns:[{id:"name",header:"Files",sortable:true,dataIndex:"name"},{header:"Reviewed",width:45,sortable:true,dataIndex:"reviewed"},{header:"Maintainer",width:45,sortable:true,dataIndex:"maintainer"},{header:"Path",dataIndex:"path",hidden:true}],view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "Files" : "File"]})',getRowClass:function(m,p,o,n){if(m.data.needcommit){return"file-need-commit"}},emptyText:'<div style="text-align: center;">No files</div>'}),autoExpandColumn:"name",bodyBorder:false,listeners:{scope:this,rowcontextmenu:function(n,t,r){var m,p,s,o="",v="",u,q;n.getSelectionModel().selectRow(t);m=this.storeFilesNeedReviewed.getAt(t).data.path;p=this.storeFilesNeedReviewed.getAt(t).data.name;s=Ext.util.md5("FNR-"+this.userLang+m+p);if(this.storeFilesNeedReviewed.getAt(t).data.needcommit){o={text:"View Diff",iconCls:"iconViewDiff",scope:this,handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+t,title:"Diff",tabTip:"Diff",closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+t+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+t);Ext.get("diff_panel_"+t).mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, Wait...');Ext.Ajax.request({scope:this,url:"./php/controler.php",params:{task:"get-diff",FilePath:this.userLang+m,FileName:p},success:function(w){var x=Ext.util.JSON.decode(w.responseText);if(x.success){Ext.get("diff_content_"+t).dom.innerHTML=x.content;Ext.get("diff_panel_"+t).unmask()}},failure:function(){}})}}}u=m.split("/");if(u[1]==="reference"){v={text:"Open all files about "+u[2]+" extension",iconCls:"iconViewDiff",scope:this,handler:function(){Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Open all files about '+u[2]+" extension. Please, wait...");Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"all-files-about-extension",ExtName:u[2]},success:function(y,x){var z,w;z=Ext.util.JSON.decode(y.responseText);this.filePendingOpen=[];for(w=0;w<z.files.length;w=w+1){this.filePendingOpen[w]=[this.userLang+z.files[w].path,z.files[w].name]}this.openFile(this.filePendingOpen[0][0],this.filePendingOpen[0][1]);Ext.getBody().unmask()}})}}}q=new Ext.menu.Menu({scope:this,items:[{text:"<b>Edit in a new Tab</b>",iconCls:"FilesNeedReviewed",scope:this,handler:function(){h.fireEvent("rowdblclick",n,t,r)}},o,"-",v]});r.stopEvent();q.showAt(r.getXY())},rowdblclick:function(o,y,v){var n,p,s,u,w,m,t,r,q,z,x;n=this.storeFilesNeedReviewed.getAt(y).data.path;p=this.storeFilesNeedReviewed.getAt(y).data.name;s=this.storeFilesNeedReviewed.getAt(y).data.reviewed;u=this.storeFilesNeedReviewed.getAt(y).data.needcommit;w=Ext.util.md5("FNR-"+this.userLang+n+p);if(!Ext.getCmp("main-panel").findById("FNR-"+w)){m=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:this.userLang+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});m.setDefaultSort("date","desc");t=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:"en"+n,File:p},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});t.setDefaultSort("date","desc");r=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(B){var A=B.getCount();if(A===2){return false}},rowselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FNR-PANEL-btn-logLang-"+w).enable();Ext.get("FNR-PANEL-btn-logLang-"+w).frame("3F8538")}else{Ext.getCmp("FNR-PANEL-btn-logLang-"+w).disable()}},rowdeselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FNR-PANEL-btn-logLang-"+w).enable();Ext.get("FNR-PANEL-btn-logLang-"+w).frame("3F8538")}else{Ext.getCmp("FNR-PANEL-btn-logLang-"+w).disable()}}}});q=new Ext.grid.GridPanel({store:m,loadMask:true,columns:[r,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:r,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FNR-PANEL-btn-logLang-"+w,disabled:true,handler:function(){var C,B,A;C=r.getSelections();B=C[0].data.revision;A=C[1].data.revision;this.winDiff(this.userLang+n,p,B,A)}}]});z=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(B){var A=B.getCount();if(A===2){return false}},rowselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FNR-PANEL-btn-logEn-"+w).enable();Ext.get("FNR-PANEL-btn-logEn-"+w).frame("3F8538")}else{Ext.getCmp("FNR-PANEL-btn-logEn-"+w).disable()}},rowdeselect:function(B){var A=B.getCount();if(A===2){Ext.getCmp("FNR-PANEL-btn-logEn-"+w).enable();Ext.get("FNR-PANEL-btn-logEn-"+w).frame("3F8538")}else{Ext.getCmp("FNR-PANEL-btn-logEn-"+w).disable()}}}});x=new Ext.grid.GridPanel({store:t,loadMask:true,columns:[z,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:z,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"FNR-PANEL-btn-logEn-"+w,disabled:true,handler:function(){var C,B,A;C=z.getSelections();B=C[0].data.revision;A=C[1].data.revision;this.winDiff("en"+n,p,B,A)}}]});Ext.getCmp("main-panel").add({closable:true,title:p,originTitle:p,tabTip:"Need Reviewed : in "+n,iconCls:"iconTabNeedReviewed",id:"FNR-"+w,isModifiedLang:false,isModifiedEn:false,layout:"border",defaults:{collapsible:true,split:true},items:[{region:"west",xtype:"panel",layout:"fit",bodyBorder:false,title:"CvsLog",collapsed:true,width:375,items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[{layout:"fit",title:this.userLang,items:[q]},{layout:"fit",title:"En",items:[x]}]}},{title:this.userLang+" File: "+n+p,originTitle:this.userLang+" File: "+n+p,collapsible:false,id:"FNR-LANG-PANEL-"+w,region:"center",xtype:"form",height:"auto",width:"auto",items:[{xtype:"codemirror",id:"FNR-LANG-"+w,listeners:{scope:this,initialize:function(){this.getFile(w,this.userLang+n,p,"FNR-LANG-PANEL-","FNR-LANG-")},cmcursormove:function(B){var A=Ext.util.JSON.decode(Ext.getCmp("FNR-LANG-"+w).getCursorPosition());Ext.get("FNR-LANG-status-line-"+w).dom.innerHTML=A.line;Ext.get("FNR-LANG-status-col-"+w).dom.innerHTML=A.caracter},cmchange:function(D,B,C){var A=Ext.util.JSON.decode(Ext.getCmp("FNR-LANG-"+w).getCursorPosition());Ext.get("FNR-LANG-status-line-"+w).dom.innerHTML=A.line;Ext.get("FNR-LANG-status-col-"+w).dom.innerHTML=A.caracter;if(D!==27&&D!==33&&D!==34&&D!==37&&D!==38&&D!==39&&D!==40&&D!==17&&D!==16&&D!==67){if(!Ext.getCmp("FNR-"+w).isModifiedLang){Ext.getCmp("FNR-LANG-PANEL-"+w).setTitle(Ext.getCmp("FNR-LANG-PANEL-"+w).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FNR-"+w).setTitle(Ext.getCmp("FNR-"+w).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FNR-LANG-PANEL-btn-save-"+w).enable();Ext.get("FNR-LANG-PANEL-btn-save-"+w).frame("3F8538");Ext.getCmp("FNR-LANG-PANEL-btn-saveas-"+w).enable();Ext.get("FNR-LANG-PANEL-btn-saveas-"+w).frame("3F8538");Ext.getCmp("FNR-"+w).isModifiedLang=true}}},cmscroll:function(A){if(this.userConf.conf_reviewed_scrollbars==="true"){Ext.getCmp("FNR-EN-"+w).scrollTo(A)}}}}],bbar:[{scope:this,xtype:"checkbox",hideLabel:true,checked:(this.userConf.conf_reviewed_scrollbars==="true")?true:false,boxLabel:"Synchronize scroll bars",name:"conf_reviewed_scrollbars",listeners:{scope:this,check:function(A){this.confUpdate("conf_reviewed_scrollbars",A.getValue())},render:function(A){Ext.DomHelper.insertHtml("beforeBegin",A.el.dom,'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FNR-LANG-status-line-'+w+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FNR-LANG-status-col-'+w+'">-</span></span></div>&nbsp;&nbsp;')}}}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FNR-LANG-PANEL-btn-save-"+w,disabled:true,handler:function(){this.saveLangFile(w,n,p,"FNR",y,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FNR-LANG-PANEL-btn-saveas-"+w,disabled:true,handler:function(){this.savePatch(this.userLang,w,n,p,"FNR",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FNR-LANG-"+w).reIndentAll()}},{tooltip:"Insert <b>Reviewed</b> tag",text:"Reviewed tag",iconCls:"iconInsertCode",handler:function(){Ext.getCmp("FNR-LANG-"+w).insertIntoLine(2,"end","\n<!-- Reviewed: no -->");Ext.getCmp("FNR-LANG-"+w).focus()}},{tooltip:"Insert <b>Revcheck</b> tag",text:"Rev tag",iconCls:"iconInsertCode",handler:function(){Ext.getCmp("FNR-LANG-"+w).insertIntoLine(2,"end","\n<!-- EN-Revision: 1.XX Maintainer: "+this.userLoggin+" Status: ready -->");Ext.getCmp("FNR-LANG-"+w).focus()}}]},{title:"En File: "+n+p,originTitle:"En File: "+n+p,collapsible:false,id:"FNR-EN-PANEL-"+w,region:"east",xtype:"form",height:"auto",width:575,items:[{xtype:"codemirror",id:"FNR-EN-"+w,listeners:{scope:this,initialize:function(){this.getFile(w,"en"+n,p,"FNR-EN-PANEL-","FNR-EN-")},cmchange:function(D,B,C){var A=Ext.util.JSON.decode(Ext.getCmp("FNR-EN-"+w).getCursorPosition());Ext.get("FNR-EN-status-line-"+w).dom.innerHTML=A.line;Ext.get("FNR-EN-status-col-"+w).dom.innerHTML=A.caracter;if(D!==27&&D!==33&&D!==34&&D!==37&&D!==38&&D!==39&&D!==40&&D!==17&&D!==16&&D!==67){if(!Ext.getCmp("FNR-"+w).isModifiedEn){Ext.getCmp("FNR-EN-PANEL-"+w).setTitle(Ext.getCmp("FNR-EN-PANEL-"+w).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("FNR-"+w).setTitle(Ext.getCmp("FNR-"+w).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("FNR-EN-PANEL-btn-save-"+w).enable();Ext.get("FNR-EN-PANEL-btn-save-"+w).frame("3F8538");Ext.getCmp("FNR-EN-PANEL-btn-saveas-"+w).enable();Ext.get("FNR-EN-PANEL-btn-saveas-"+w).frame("3F8538");Ext.getCmp("FNR-"+w).isModifiedEn=true}}},cmscroll:function(A){if(this.userConf.conf_reviewed_scrollbars==="true"){Ext.getCmp("FNR-LANG-"+w).scrollTo(A)}},cmcursormove:function(B){var A=Ext.util.JSON.decode(Ext.getCmp("FNR-EN-"+w).getCursorPosition());Ext.get("FNR-EN-status-line-"+w).dom.innerHTML=A.line;Ext.get("FNR-EN-status-col-"+w).dom.innerHTML=A.caracter}}}],bbar:[{scope:this,xtype:"panel",height:21,baseCls:"",bodyStyle:"padding-top:5px;",html:'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="FNR-EN-status-line-'+w+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="FNR-EN-status-col-'+w+'">-</span></span></div>&nbsp;&nbsp;'}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"FNR-EN-PANEL-btn-save-"+w,disabled:true,handler:function(){this.saveEnFile(w,n,p,"FNR",y,this)}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"FNR-EN-PANEL-btn-saveas-"+w,disabled:true,handler:function(){this.savePatch("en",w,n,p,"FNR",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("FNR-EN-"+w).reIndentAll()}}]}]});Ext.getCmp("main-panel").setActiveTab("FNR-"+w)}else{Ext.getCmp("main-panel").setActiveTab("FNR-"+w)}}}});g=new Ext.grid.GridPanel({title:"Summary",iconCls:"flag-"+this.userLang,store:this.storeSummary,loadMask:true,columns:[new Ext.grid.RowNumberer(),{id:"StatusType",header:"File status type",width:180,sortable:true,dataIndex:"libel"},{header:"Number of files",width:110,sortable:true,dataIndex:"nbFiles"},{header:"Percent of files",width:110,sortable:true,dataIndex:"percentFiles"},{header:"Size of files (kB)",width:110,sortable:true,dataIndex:"sizeFiles"},{header:"Percent of size",width:110,sortable:true,dataIndex:"percentSize"}],autoScroll:true,height:400,width:800,view:new Ext.grid.GridView({getRowClass:function(m,p,o,n){if(m.data.id===1){return"summary_1"}if(m.data.id===2){return"summary_2"}if(m.data.id===3){return"summary_3"}if(m.data.id===4){return"summary_4"}if(m.data.id===5){return"summary_5"}}}),listeners:{scope:this,render:function(m){m.store.load()}}});f=new Ext.grid.GridPanel({title:"Translators",iconCls:"iconTranslator",store:this.storeTranslators,loadMask:true,columns:[new Ext.grid.RowNumberer(),{id:"GridTransName",header:"Name",sortable:true,dataIndex:"name",summaryType:"count",summaryRenderer:this.rendererTotalTranslator},{header:"Email",width:110,sortable:true,dataIndex:"email"},{header:"Nick",width:70,sortable:true,dataIndex:"nick"},{header:"Cvs",width:45,sortable:true,dataIndex:"cvs"},{header:"UptoDate",width:60,sortable:true,renderer:this.rendererNumUptodate,dataIndex:"uptodate",summaryType:"sum"},{header:"Old",width:45,sortable:true,renderer:this.rendererSum,dataIndex:"old",summaryType:"sum"},{header:"Critical",width:60,sortable:true,renderer:this.rendererNumCritical,dataIndex:"critical",summaryType:"sum"},{header:"Sum",width:50,sortable:true,renderer:this.rendererSum,dataIndex:"sum",summaryType:"sum"}],plugins:[new Ext.ux.grid.GridSummary()],autoScroll:true,autoExpandColumn:"GridTransName",height:400,width:800,listeners:{scope:this,render:function(){this.storeTranslators.load()},rowdblclick:function(o,q,p){var m,n;o.getSelectionModel().selectRow(q);m=this.storeTranslators.getAt(q).data.email;n=this.storeTranslators.getAt(q).data.name;this.sendEmail(n,m)},rowcontextmenu:function(o,r,p){var m,n,q;o.getSelectionModel().selectRow(r);m=this.storeTranslators.getAt(r).data.email;n=this.storeTranslators.getAt(r).data.name;q=new Ext.menu.Menu({id:"submenu",items:[{scope:this,text:"<b>Send an email to "+n+"</b>",iconCls:"iconSendEmail",handler:function(){this.sendEmail(n,m)}},"-",{scope:this,text:"Send an email to the doc-"+this.userLang+"@lists.php.net",iconCls:"iconSendEmail",handler:function(){this.sendEmail("Php Doc Team "+this.userLang,"doc-"+this.userLang+"@lists.php.net")}}]});q.showAt(p.getXY())}}});i=new Ext.grid.GridPanel({store:this.storeMailing,title:"Mails from doc-"+this.userLang,iconCls:"home-mailing-title",loadMask:true,columns:[new Ext.grid.RowNumberer(),{id:"GridMailingTitle",header:"Title",sortable:true,dataIndex:"title"},{header:"By",width:110,sortable:true,dataIndex:"description"},{header:"Date",width:140,sortable:true,dataIndex:"pubDate",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoScroll:true,height:400,width:800,autoExpandColumn:"GridMailingTitle",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:[{scope:this,tooltip:"Refresh this grid",iconCls:"refresh",handler:function(){this.storeMailing.reload()}}],listeners:{scope:this,render:function(){this.storeMailing.load()},rowcontextmenu:function(m,p,n){var o;m.getSelectionModel().selectRow(p);o=new Ext.menu.Menu({id:"submenu",items:[{text:"<b>Open in a new Tab</b>",iconCls:"openInTab",scope:this,handler:function(){i.fireEvent("rowdblclick",m,p,n)}},"-",{text:"Refresh this grid",iconCls:"refresh",scope:this,handler:function(){this.storeMailing.reload()}}]});o.showAt(n.getXY())},rowdblclick:function(n,r,p){var m,q,o;m=this.storeMailing.getAt(r).data.pubDate;q=this.storeMailing.getAt(r).data.link;o=this.storeMailing.getAt(r).data.title;this.NewTabMailing(m,q,o)}}});e=new Ext.grid.GridPanel({store:this.storeBugs,title:"Open bugs for doc-"+this.userLang,iconCls:"iconBugs",loadMask:true,columns:[{id:"GridBugTitle",header:"Title",sortable:true,dataIndex:"title"}],stripeRows:true,autoHeight:true,viewConfig:{emptyText:"No open Bugs",forceFit:true,enableRowBody:true,getRowClass:function(m,q,o,n){o.body='<p class="bug-desc">'+m.data.description+"</p>";return"x-grid3-row-expanded"}},autoExpandColumn:"GridBugTitle",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),width:800,tbar:[{scope:this,tooltip:"Refresh this grid",iconCls:"refresh",handler:function(){this.storeBugs.reload()}}],listeners:{scope:this,render:function(){this.storeBugs.load()},rowcontextmenu:function(m,p,n){var o;m.getSelectionModel().selectRow(p);o=new Ext.menu.Menu({id:"submenu",items:[{text:"<b>Open in a new Tab</b>",iconCls:"openInTab",scope:this,handler:function(){e.fireEvent("rowdblclick",m,p,n)}},"-",{text:"Refresh this grid",iconCls:"refresh",scope:this,handler:function(){this.storeBugs.reload()}}]});o.showAt(n.getXY())},rowdblclick:function(o,r,q){var m,n,p;m=this.storeBugs.getAt(r).data.id;n=this.storeBugs.getAt(r).data.link;p=this.storeBugs.getAt(r).data.title;this.NewTabBugs(m,n,p)}}});k={title:"Graphics",layout:"fit",autoHeight:true,iconCls:"home-graphic-title",html:'<div align="center" id="graph_container" style="width: 530px; height: 302px"><img id="graph_picture" src="" height="300"></div>',listeners:{afterlayout:function(){var m,o,n;m=Ext.get("graph_picture");o=Ext.get("graph_container");m.setVisibilityMode(Ext.Element.VISIBILITY);n=new Ext.LoadMask(o);m.on("load",function(){m.stopFx();n.hide();m.fadeIn({duration:2})});n.show();m.hide();m.dom.src="/php/image_info.php"}}};this.treeAllFiles=new Ext.tree.TreePanel({animate:true,autoScroll:true,useArrows:true,loader:new Ext.tree.TreeLoader({dataUrl:"./php/controler.php",baseParams:{task:"getAllFiles"}}),enableDD:false,containerScroll:true,bodyBorder:false,listeners:{scope:this,dblclick:function(q,v){var n,m,w,y,u,r,p,o,s,x;if(q.attributes.type==="file"){n=q.attributes.text;m=q.attributes.id;w=Ext.util.md5("AF-"+m+n);if(!Ext.getCmp("main-panel").findById("AF-"+w)){y=m.split("/");y.shift();y.shift();y.pop();m=y.join("/")+"/";u="xml";if(q.attributes.extension==="xml"){u="xml"}if(q.attributes.extension==="html"){u="html"}if(q.attributes.extension==="php"){u="php"}r=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"/php/controler.php"}),baseParams:{task:"get-log",Path:m,File:n},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},[{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}])});r.setDefaultSort("date","desc");p=new Ext.grid.CheckboxSelectionModel({singleSelect:false,width:22,header:"",listeners:{beforerowselect:function(z){var t=z.getCount();if(t===2){return false}},rowselect:function(z){var t=z.getCount();if(t===2){Ext.getCmp("AF-PANEL-btn-log-"+w).enable();Ext.get("AF-PANEL-btn-log-"+w).frame("3F8538")}else{Ext.getCmp("AF-PANEL-btn-log-"+w).disable()}},rowdeselect:function(z){var t=z.getCount();if(t===2){Ext.getCmp("AF-PANEL-btn-log-"+w).enable();Ext.get("AF-PANEL-btn-log-"+w).frame("3F8538")}else{Ext.getCmp("AF-PANEL-btn-log-"+w).disable()}}}});o=new Ext.grid.GridPanel({store:r,id:"AF-PANEL-log-"+w,loadMask:true,columns:[p,{id:"id",header:"Rev.",width:40,sortable:false,dataIndex:"revision"},{header:"Content",width:130,sortable:true,dataIndex:"content"},{header:"By",width:50,sortable:true,dataIndex:"author"},{header:"Date",width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y/m/d, H:i")}],autoHeight:true,autoExpandColumn:"content",bodyBorder:false,sm:p,view:new Ext.grid.GridView({forceFit:true}),tbar:[{scope:this,tooltip:"<b>View</b> the diff",iconCls:"iconViewDiff",id:"AF-PANEL-btn-log-"+w,disabled:true,handler:function(){var A,z,t;A=p.getSelections();z=A[0].data.revision;t=A[1].data.revision;this.winDiff(m,n,z,t)}}]});s={region:"west",xtype:"panel",layout:"fit",bodyBorder:false,title:"CvsLog",collapsed:true,width:375,items:{scope:this,xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[{layout:"fit",title:"Log",items:[o]}]}};x={title:"File: "+m+n,originTitle:"File: "+m+n,collapsible:false,id:"AF-PANEL-"+w,region:"center",xtype:"form",height:"auto",width:"auto",items:[{xtype:"codemirror",id:"AF-FILE-"+w,isModified:false,parser:u,listeners:{scope:this,initialize:function(){this.getFile(w,m,n,"AF-PANEL-","AF-FILE-")},cmchange:function(B,z,A){var t=Ext.util.JSON.decode(Ext.getCmp("AF-FILE-"+w).getCursorPosition());Ext.get("AF-status-line-"+w).dom.innerHTML=t.line;Ext.get("AF-status-col-"+w).dom.innerHTML=t.caracter;if(B!==27&&B!==33&&B!==34&&B!==37&&B!==38&&B!==39&&B!==40&&B!==17&&B!==16&&B!==67){if(!Ext.getCmp("AF-FILE-"+w).isModified){Ext.getCmp("AF-PANEL-"+w).setTitle(Ext.getCmp("AF-PANEL-"+w).originTitle+' <span style="color:#ff0000; font-weight: bold;">[modified]</span>');Ext.getCmp("AF-"+w).setTitle(Ext.getCmp("AF-"+w).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp("AF-PANEL-btn-save-"+w).enable();Ext.get("AF-PANEL-btn-save-"+w).frame("3F8538");Ext.getCmp("AF-PANEL-btn-saveas-"+w).enable();Ext.get("AF-PANEL-btn-saveas-"+w).frame("3F8538");Ext.getCmp("AF-FILE-"+w).isModified=true}}},cmcursormove:function(){var t=Ext.util.JSON.decode(Ext.getCmp("AF-FILE-"+w).getCursorPosition());Ext.get("AF-status-line-"+w).dom.innerHTML=t.line;Ext.get("AF-status-col-"+w).dom.innerHTML=t.caracter}}}],bbar:[{scope:this,xtype:"panel",height:21,baseCls:"",bodyStyle:"padding-top:5px;",html:'<div style="display: inline;" class="x-statusbar"><span class="x-status-text-panel">Line: <span id="AF-status-line-'+w+'">-</span></span>&nbsp;&nbsp;<span class="x-status-text-panel">Col: <span id="AF-status-col-'+w+'">-</span></span></div>&nbsp;&nbsp;'}],tbar:[{scope:this,tooltip:"<b>Save</b> this file",iconCls:"saveFile",id:"AF-PANEL-btn-save-"+w,disabled:true,handler:function(){Ext.getCmp("AF-PANEL-btn-save-"+w).disable();Ext.getCmp("AF-FILE-"+w).isModified=false;Ext.getCmp("AF-PANEL-"+w).setTitle(Ext.getCmp("AF-PANEL-"+w).originTitle);Ext.getCmp("AF-"+w).setTitle(Ext.getCmp("AF-"+w).originTitle);var t=Ext.MessageBox.wait("Saving data...");Ext.Ajax.request({scope:this,url:"../php/controler.php",params:{task:"save-file",filePath:m,fileName:n,fileLang:"all",fileContent:Ext.getCmp("AF-FILE-"+w).getCode()},success:function(A,z){var B=Ext.util.JSON.decode(A.responseText);if(B.success){this.addToPendingCommit(m,n);t.hide()}}})}},{scope:this,tooltip:"<b>Save as</b> a patch",iconCls:"saveAsFile",id:"AF-PANEL-btn-saveas-"+w,disabled:true,handler:function(){this.savePatch("all",w,m,n,"AF",this)}},"->",{tooltip:"<b>Re-indent</b> all this file",iconCls:"iconIndent",handler:function(){Ext.getCmp("AF-FILE-"+w).reIndentAll()}}]};if(q.attributes.extension==="gif"||q.attributes.extension==="png"){x={xtype:"panel",layout:"fit",bodyStyle:"padding:5px 5px 0",html:'<img src="/data/'+this.userLoggin+"/phpdoc-"+this.userLang+m+'" />'};s={}}Ext.getCmp("main-panel").add({closable:true,title:n,originTitle:n,tabTip:"in "+m,iconCls:"AllFiles",id:"AF-"+w,layout:"border",defaults:{collapsible:true,split:true},items:[x,s]});Ext.getCmp("main-panel").setActiveTab("AF-"+w)}else{Ext.getCmp("main-panel").setActiveTab("AF-"+w)}}}}});this.treeSort=new Ext.tree.TreeSorter(this.treeAllFiles,{folderSort:true});this.treeAllFilesRoot=new Ext.tree.AsyncTreeNode({text:"Repository",draggable:false,id:"/"});this.treeAllFiles.setRootNode(this.treeAllFilesRoot);b=new Ext.menu.Menu({id:"mainMenu",items:[{scope:this,text:"Refresh all data",iconCls:"refresh",tooltip:"<b>Refresh all data</b><br>Cvs update & apply all tools",handler:this.WinUpdate},{scope:this,text:"Check Build",iconCls:"checkBuild",tooltip:"<b>Check your build</b> using configure.php script",handler:this.WinCheckBuild},"-",{scope:this,text:"Configure",iconCls:"iconConf",tooltip:"<b>Configure</b> this tool",id:"winconf-btn",handler:this.WinConf},"-",{scope:this,text:"Erase my personal data",iconCls:"iconErasePersonalData",tooltip:"<b>Log out</b>",handler:function(){Ext.MessageBox.confirm("Confirm","This action will erase your personal data. All content about this account will be deleted definitively. Are you sure you want to do that ?",function(m){if(m==="yes"){Ext.getBody().mask('<img src="/img/loading.gif" style="vertical-align: middle;" /> Please, wait...');Ext.Ajax.request({url:"./php/controler.php",params:{task:"erase-personal-data"},success:function(n){Ext.getBody().unmask();var p=Ext.util.JSON.decode(n.responseText);if(p.success){Ext.MessageBox.show({title:"Thanks !",msg:"Thank you for using this application !",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function(){window.location.href="/logout.php"}})}}})}})}},"-",{text:"Log out",iconCls:"iconLogOut",tooltip:"<b>Log out</b>",handler:function(){Ext.MessageBox.confirm("Confirm","Are you sure you want to logout?",function(m){if(m==="yes"){window.location.href="/logout.php"}})}},"-",{scope:this,text:"About",iconCls:"iconHelp",tooltip:"<b>About</b><br/>"+this.appName,id:"winabout-btn",handler:function(){this.WinAbout()}}]});d=new Ext.Viewport({layout:"border",items:[{region:"north",html:'<h1 class="x-panel-header"><img src="/img/mini_php.png" style="vertical-align: middle;" />&nbsp;&nbsp;'+this.appName+"</h1>",autoHeight:true,border:false,margins:"0 0 5 0"},{region:"west",collapsible:true,collapseMode:"mini",animate:true,split:true,layout:"fit",width:300,autoScroll:true,items:[{layout:"accordion",animate:true,bodyBorder:false,border:false,tbar:[{text:"Main Menu",iconCls:"MainMenu",menu:b}],items:[{title:'Files Need Update - <em id="acc-need-update-nb">0</em>',id:"acc-need-update",layout:"fit",iconCls:"FilesNeedUpdate",items:[l],collapsed:true},{title:'Error in current translation - <em id="acc-error-nb">0</em>',id:"acc-error",layout:"fit",iconCls:"FilesError",items:[j],collapsed:true},{title:'Files Need Reviewed - <em id="acc-need-reviewed-nb">0</em>',id:"acc-need-reviewed",layout:"fit",iconCls:"FilesNeedReviewed",items:[h],collapsed:true},{title:"All files",id:"acc-all-files",layout:"fit",iconCls:"AllFiles",items:[this.treeAllFiles],collapsed:true},{title:'Pending for commit - <em id="acc-pendingCommit-nb">0</em>',id:"acc-need-pendingCommit",layout:"fit",iconCls:"PendingCommit",items:[c],collapsed:true},{title:'Pending Patch - <em id="acc-pendingPatch-nb">0</em>',id:"acc-need-pendingPatch",layout:"fit",iconCls:"PendingPatch",items:[a],collapsed:true}]}]},{region:"center",xtype:"tabpanel",id:"main-panel",activeTab:0,enableTabScroll:true,plugins:new Ext.ux.TabCloseMenu(),listeners:{scope:this,beforeremove:this.removeTabEvent},items:[{title:"Home",baseCls:"MainInfoTabPanel",xtype:"panel",autoScroll:true,id:"MainInfoTabPanel",plain:true,items:[{xtype:"panel",border:false,html:'<div class="res-block"><div class="res-block-inner"><h3>Connected as <em>'+this.userLoggin+"</em></h3></div></div>"},{xtype:"tabpanel",activeTab:0,plain:true,autoScroll:true,height:400,border:false,defaults:{border:true},items:[g,f,i,e,k]}]}]}]})}}}();Ext.EventManager.onDocumentReady(phpDoc.init,phpDoc,true);