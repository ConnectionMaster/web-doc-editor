Ext.BLANK_IMAGE_URL="http://extjs.cachefly.net/ext-3.2.0/resources/images/default/s.gif";String.prototype.ucFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1,this.length)};function log(){if(console){console.log.apply(this,arguments)}}function _(c){try{var f=i18n[c];if(f===undefined){f=c;log("FIX ME : i18n not found for the string: "+c)}return f}catch(d){return c}}function XHR(e){var d=e.success,f=e.failure,c=e.callback;e.url="./do/"+e.params.task;delete e.params.task;e.failure=e.success=Ext.emptyFn;e.callback=function(h,k,g){var j=null;try{j=Ext.decode(g.responseText)}catch(i){log("Invalid XHR JSON Response:"+g.responseText)}if(k&&j&&j.success){if(d!==undefined){Ext.callback(d,e.scope,[g,h])}}else{if(f!==undefined){Ext.callback(f,e.scope,[g,h])}}if(c!==undefined){Ext.callback(c,e.scope,[h,k,g])}};Ext.Ajax.request(e)}
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(c,d){this.portal=c;Ext.dd.ScrollManager.register(c.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,c.bwrap.dom,d);c.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(d,h,g,f,j,i){return{portal:this.portal,panel:g.panel,columnIndex:f,column:j,position:i,data:g,source:d,rawEvent:h,status:this.dropAllowed}},notifyOver:function(y,w,z){var i=w.getXY(),d=this.portal,r=y.proxy;if(!this.grid){this.grid=this.getGrid()}var f=d.body.dom.clientWidth;if(!this.lastCW){this.lastCW=f}else{if(this.lastCW!=f){this.lastCW=f;d.doLayout();this.grid=this.getGrid()}}var g=0,o=this.grid.columnX,q=false;for(var v=o.length;g<v;g++){if(i[0]<(o[g].x+o[g].w)){q=true;break}}if(!q){g--}var t,m=false,k=0,x=d.items.itemAt(g),s=x.items.items,l=false;for(var v=s.length;k<v;k++){t=s[k];var u=t.el.getHeight();if(u===0){l=true}else{if((t.el.getY()+(u/2))>i[1]){m=true;break}}}k=(m&&t?k:x.items.getCount())+(l?-1:0);var j=this.createEvent(y,w,z,g,x,k);if(d.fireEvent("validatedrop",j)!==false&&d.fireEvent("beforedragover",j)!==false){r.getProxy().setWidth("auto");if(t){r.moveProxy(t.el.dom.parentNode,m?t.el.dom:null)}else{r.moveProxy(x.el.dom,null)}this.lastPos={c:x,col:g,p:l||(m&&t)?k:false};this.scrollPos=d.body.getScroll();d.fireEvent("dragover",j);return j.status}else{return j.status}},notifyOut:function(){delete this.grid},notifyDrop:function(m,i,h){delete this.grid;if(!this.lastPos){return}var k=this.lastPos.c,g=this.lastPos.col,l=this.lastPos.p;var f=this.createEvent(m,i,h,g,k,l!==false?l:k.items.getCount());if(this.portal.fireEvent("validatedrop",f)!==false&&this.portal.fireEvent("beforedrop",f)!==false){m.proxy.getProxy().remove();m.panel.el.dom.parentNode.removeChild(m.panel.el.dom);if(l!==false){if(k==m.panel.ownerCt&&(k.items.items.indexOf(m.panel)<=l)){l++}k.insert(l,m.panel)}else{k.add(m.panel)}k.doLayout();this.portal.fireEvent("drop",f);var o=this.scrollPos.top;if(o){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=o},10)}}delete this.lastPos},getGrid:function(){var c=this.portal.bwrap.getBox();c.columnX=[];this.portal.items.each(function(d){c.columnX.push({x:d.el.getX(),w:d.el.getWidth()})});return c},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(c){this.grid=c;this.ownerCt=c;if(this.clicksToEdit===2){c.on("rowdblclick",this.onRowDblClick,this)}else{c.on("rowclick",this.onRowClick,this);if(Ext.isIE){c.on("rowdblclick",this.onRowDblClick,this)}}c.getStore().on("remove",function(){this.stopEditing(false)},this);c.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});c.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});c.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var c;this.items.each(function(d){if(String(this.values[d.id])!==String(d.getValue())){c=true;return false}},this);return c},startEditing:function(m,s){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(m)){m=this.grid.getStore().indexOf(m)}if(this.fireEvent("beforeedit",this,m)!==false){this.editing=true;var j=this.grid,o=j.getView(),r=o.getRow(m),e=j.store.getAt(m);this.record=e;this.rowIndex=m;this.values={};if(!this.rendered){this.render(o.getEditorParent())}var p=Ext.fly(r).getWidth();this.setSize(p);if(!this.initialized){this.initFields()}var q=j.getColumnModel(),h=this.items.items,l,c;for(var d=0,k=q.getColumnCount();d<k;d++){c=this.preEditValue(e,q.getDataIndex(d));l=h[d];l.setValue(c);this.values[l.id]=Ext.isEmpty(c)?"":c}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(r).getXY())}else{this.el.setXY(Ext.fly(r).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(s!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(o){this.editing=false;if(!this.isVisible()){return}if(o===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,o===false);return}var j={},d=this.record,k=false,m=this.grid.colModel,g=this.items.items;for(var f=0,h=m.getColumnCount();f<h;f++){if(!m.isHidden(f)){var e=m.getDataIndex(f);if(!Ext.isEmpty(e)){var c=d.data[e],l=this.postEditValue(g[f].getValue(),c,d,e);if(String(c)!==String(l)){j[e]=l;k=true}}}}if(k&&this.fireEvent("validateedit",this,j,d,this.rowIndex)!==false){d.beginEdit();Ext.iterate(j,function(i,p){d.set(i,p)});d.endEdit();this.fireEvent("afteredit",this,j,d,this.rowIndex)}this.hide()},verifyLayout:function(g){if(this.el&&(this.isVisible()||g===true)){var j=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(j).getWidth(),Ext.isIE?Ext.fly(j).getHeight()+9:undefined);var e=this.grid.colModel,d=this.items.items;for(var f=0,c=e.getColumnCount();f<c;f++){if(!e.isHidden(f)){var h=0;if(f===(c-1)){h+=3}else{h+=1}d[f].show();d[f].setWidth(e.getColumnWidth(f)-h)}else{d[f].hide()}}this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var e=this.grid.getColumnModel(),h=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var g=0,d=e.getColumnCount();g<d;g++){var j=e.getColumnAt(g),f=j.getEditor();if(!f){f=j.displayEditor||new Ext.form.DisplayField()}if(g==0){f.margins=h("0 1 2 1")}else{if(g==d-1){f.margins=h("0 0 2 1")}else{f.margins=h("0 1 2")}}f.setWidth(e.getColumnWidth(g));f.column=j;if(f.ownerCt!==this){f.on("focus",this.ensureVisible,this);f.on("specialkey",this.onKey,this)}this.insert(g,f)}this.initialized=true},onKey:function(c,d){if(d.getKey()===d.ENTER){this.stopEditing(true);d.stopPropagation()}},onGridKey:function(f){if(f.getKey()===f.ENTER&&!this.isVisible()){var d=this.grid.getSelectionModel().getSelected();if(d){var c=this.grid.store.indexOf(d);this.startEditing(c);f.stopPropagation()}}},ensureVisible:function(c){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(c.column.id),true)}},onRowClick:function(d,h,f){if(this.clicksToEdit=="auto"){var c=this.lastClickIndex;this.lastClickIndex=h;if(c!=h&&!this.isVisible()){return}}this.startEditing(h,false);this.doFocus.defer(this.focusDelay,this,[f.getPoint()])},onRowDblClick:function(c,f,d){this.startEditing(f,false);this.doFocus.defer(this.focusDelay,this,[d.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var i=this.grid,f=this.el.dom.clientHeight,d=i.getView(),c=d.scroller.dom.scrollLeft,j=this.btns.getWidth(),e=Math.min(i.getWidth(),i.getColumnModel().getTotalWidth());this.btns.el.shift({left:(e/2)-(j/2)+c,top:f-2,stopFx:true,duration:0.2})}},preEditValue:function(c,e){var d=c.data[e];return this.autoEncode&&typeof d==="string"?Ext.util.Format.htmlDecode(d):d},postEditValue:function(e,c,d,f){return this.autoEncode&&typeof e=="string"?Ext.util.Format.htmlEncode(e):e},doFocus:function(h){if(this.isVisible()){var f=0,e=this.grid.getColumnModel(),j;if(h){f=this.getTargetColumnIndex(h)}for(var g=f||0,d=e.getColumnCount();g<d;g++){j=e.getColumnAt(g);if(!j.hidden&&j.getEditor()){j.getEditor().focus();break}}}},getTargetColumnIndex:function(m){var d=this.grid,l=d.view,k=m.left,h=d.colModel.config,e=0,f=false;for(var g=h.length,j;j=h[e];e++){if(!j.hidden){if(Ext.fly(l.getHeaderCell(e)).getRegion().right>=k){f=e;break}}}return f},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var c=true;this.items.each(function(d){if(!d.isValid(true)){c=false;return false}});return c},bindHandler:function(){if(!this.bound){return false}var c=this.isValid();if(!c&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!c);this.fireEvent("validation",this,c)},showTooltip:function(i){var e=this.tooltip;if(!e){e=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var d=this.grid.getView(),g=parseInt(this.el.dom.style.top,10),c=d.scroller.dom.scrollTop,f=this.el.getHeight();if(g+f>=c){e.initTarget(this.items.last().getEl());if(!e.rendered){e.show();e.hide()}e.body.update(i);e.doAutoWidth(20);e.show()}else{if(e.rendered){e.hide()}}},getErrorText:function(){var c=["<ul>"];this.items.each(function(d){if(!d.isValid(true)){c.push("<li>",d.getActiveError(),"</li>")}});c.push("</ul>");return c}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.form");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(e){var d=Ext.copyTo({},e,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var f=this.spinner=new Ext.ux.Spinner(d);var c=e.plugins?(Ext.isArray(e.plugins)?e.plugins.push(f):[e.plugins,f]):f;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(e,{plugins:c}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},validateBlur:function(){return true}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(c){Ext.ux.Spinner.superclass.constructor.call(this,c);Ext.apply(this,c);this.mimicing=false},init:function(c){this.field=c;c.afterMethod("onRender",this.doRender,this);c.afterMethod("onEnable",this.doEnable,this);c.afterMethod("onDisable",this.doDisable,this);c.afterMethod("afterRender",this.doAfterRender,this);c.afterMethod("onResize",this.doResize,this);c.afterMethod("onFocus",this.doFocus,this);c.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(d,c){var e=this.el=this.field.getEl();var g=this.field;if(!g.wrap){g.wrap=this.wrap=e.wrap({cls:"x-form-field-wrap"})}else{this.wrap=g.wrap.addClass("x-form-field-wrap")}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!g.width){this.wrap.setWidth(e.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var c;if(Ext.isIE&&this.el.getY()!=(c=this.trigger.getY())){this.el.position();this.el.setY(c)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(c,d){if(typeof c=="number"){this.el.setWidth(c-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this)}},checkTab:function(c){if(c.getKey()==c.TAB){this.triggerBlur()}},mimicBlur:function(c){if(!this.wrap.contains(c.target)&&this.field.validateBlur(c)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(c){c.preventDefault();this.onSpinUp()},down:function(c){c.preventDefault();this.onSpinDown()},pageUp:function(c){c.preventDefault();this.onSpinUpAlternate()},pageDown:function(c){c.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var c=this.getMiddle();if(((Ext.EventObject.getPageY()>c)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<c)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var d=this.getMiddle();var c=(Ext.EventObject.getPageY()<d)?"Up":"Down";this["onSpin"+c]()},getMiddle:function(){var d=this.trigger.getTop();var e=this.trigger.getHeight();var c=d+(e/2);return c},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(c){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return}var d=c.getWheelDelta();if(d>0){this.onSpinUp();c.stopEvent()}else{if(d<0){this.onSpinDown();c.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var d=Ext.fly(this.dd.getDragEl()).getTop();var c="";if(this._previousY>d){c="Up"}if(this._previousY<d){c="Down"}if(c!=""){this["onSpin"+c]()}this._previousY=d},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},spin:function(f,d){var c=parseFloat(this.field.getValue());var e=(d==true)?this.alternateIncrementValue:this.incrementValue;(f==true)?c-=e:c+=e;c=(isNaN(c))?this.defaultValue:c;c=this.fixBoundries(c);this.field.setRawValue(c)},fixBoundries:function(d){var c=d;if(this.field.minValue!=undefined&&c<this.field.minValue){c=this.field.minValue}if(this.field.maxValue!=undefined&&c>this.field.maxValue){c=this.field.maxValue}return this.fixPrecision(c)},fixPrecision:function(d){var c=isNaN(d);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||c||!d){return c?"":d}return parseFloat(parseFloat(d).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.Spinner=Ext.ux.Spinner;
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right"){this.cls+=" x-status-right"}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var c=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(c){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}this.doLayout()},setStatus:function(f){f=f||{};if(typeof f=="string"){f={text:f}}if(f.text!==undefined){this.setText(f.text)}if(f.iconCls!==undefined){this.setIcon(f.iconCls)}if(f.clear){var g=f.clear,e=this.autoClear,d={useDefaults:true,anim:true};if(typeof g=="object"){g=Ext.applyIf(g,d);if(g.wait){e=g.wait}}else{if(typeof g=="number"){e=g;g=d}else{if(typeof g=="boolean"){g=d}}}g.threadId=this.activeThreadId;this.clearStatus.defer(e,this,[g])}return this},clearStatus:function(e){e=e||{};if(e.threadId&&e.threadId!==this.activeThreadId){return this}var d=e.useDefaults?this.defaultText:this.emptyText,c=e.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(e.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:d,iconCls:c});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:d,iconCls:c});this.statusEl.show()}return this},setText:function(c){this.activeThreadId++;this.text=c||"";if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(c){this.activeThreadId++;c=c||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(c.length>0){this.statusEl.addClass(c);this.currIconCls=c}}else{this.currIconCls=c}return this},showBusy:function(c){if(typeof c=="string"){c={text:c}}c=Ext.applyIf(c||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(c)}});Ext.reg("statusbar",Ext.ux.StatusBar);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:_("Close Tab"),closeOtherTabsText:_("Close Other Tabs"),showCloseAll:true,closeAllTabsText:_("Close All Tabs"),constructor:function(c){Ext.apply(this,c||{})},init:function(c){this.tabs=c;c.on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy})},destroy:function(){Ext.destroy(this.menu);delete this.menu;delete this.tabs;delete this.active},onContextMenu:function(d,f,i){this.active=f;var c=this.createMenu(),g=true,j=true,h=c.getComponent("closeall");c.getComponent("close").setDisabled(!f.closable);d.items.each(function(){if(this.closable){g=false;if(this!=f){j=false;return false}}});c.getComponent("closeothers").setDisabled(j);if(h){h.setDisabled(g)}i.stopEvent();c.showAt(i.getPoint())},createMenu:function(){if(!this.menu){var c=[{itemId:"close",text:this.closeTabText,scope:this,handler:this.onClose}];if(this.showCloseAll){c.push("-")}c.push({itemId:"closeothers",iconCls:"iconCloseOthersTabs",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});if(this.showCloseAll){c.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll})}this.menu=new Ext.menu.Menu({items:c})}return this.menu},onClose:function(){this.tabs.remove(this.active)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(d){var c=[];this.tabs.items.each(function(e){if(e.closable){if(!d||e!=this.active){c.push(e)}}},this);Ext.each(c,function(e){this.tabs.remove(e)},this)}});Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);Ext.ux.DblClickCloseTabs=Ext.extend(Object,{init:function(c){this.panel=c;c.initEvents=c.initEvents.createSequence(this.initEvents,this)},initEvents:function(){this.panel.mon(this.panel.strip,{dblclick:this.onDblClick.createDelegate(this,[this.panel],0)});delete this.panel},onDblClick:function(c,d){if(c.getActiveTab().closable){c.remove(c.getActiveTab())}}});Ext.preg("dblclickclosetabs",Ext.ux.DblClickCloseTabs);Ext.util.md5=function(t,c,p,l){c=(typeof c==="undefined"?false:c);p=(typeof p==="undefined"?false:p);l=(typeof l==="undefined"?8:l);function j(r,v){var u=((r&65535)+(v&65535)),s=((r>>16)+(v>>16)+(u>>16));return(s<<16)|(u&65535)}function o(r,s){return(r<<s)|(r>>>(32-s))}function f(z,v,u,r,y,w){return j(o(j(j(v,z),j(r,w)),y),u)}function k(v,u,A,z,r,y,w){return f((u&A)|((~u)&z),v,u,r,y,w)}function e(v,u,A,z,r,y,w){return f((u&z)|(A&(~z)),v,u,r,y,w)}function m(v,u,A,z,r,y,w){return f(u^A^z,v,u,r,y,w)}function i(v,u,A,z,r,y,w){return f(A^(u|(~z)),v,u,r,y,w)}function h(D,y){var C=1732584193,B=-271733879,A=-1732584194,z=271733878,u,w,v,s,r;D[y>>5]|=128<<((y)%32);D[(((y+64)>>>9)<<4)+14]=y;for(u=0;u<D.length;u+=16){w=C;v=B;s=A;r=z;C=k(C,B,A,z,D[u+0],7,-680876936);z=k(z,C,B,A,D[u+1],12,-389564586);A=k(A,z,C,B,D[u+2],17,606105819);B=k(B,A,z,C,D[u+3],22,-1044525330);C=k(C,B,A,z,D[u+4],7,-176418897);z=k(z,C,B,A,D[u+5],12,1200080426);A=k(A,z,C,B,D[u+6],17,-1473231341);B=k(B,A,z,C,D[u+7],22,-45705983);C=k(C,B,A,z,D[u+8],7,1770035416);z=k(z,C,B,A,D[u+9],12,-1958414417);A=k(A,z,C,B,D[u+10],17,-42063);B=k(B,A,z,C,D[u+11],22,-1990404162);C=k(C,B,A,z,D[u+12],7,1804603682);z=k(z,C,B,A,D[u+13],12,-40341101);A=k(A,z,C,B,D[u+14],17,-1502002290);B=k(B,A,z,C,D[u+15],22,1236535329);C=e(C,B,A,z,D[u+1],5,-165796510);z=e(z,C,B,A,D[u+6],9,-1069501632);A=e(A,z,C,B,D[u+11],14,643717713);B=e(B,A,z,C,D[u+0],20,-373897302);C=e(C,B,A,z,D[u+5],5,-701558691);z=e(z,C,B,A,D[u+10],9,38016083);A=e(A,z,C,B,D[u+15],14,-660478335);B=e(B,A,z,C,D[u+4],20,-405537848);C=e(C,B,A,z,D[u+9],5,568446438);z=e(z,C,B,A,D[u+14],9,-1019803690);A=e(A,z,C,B,D[u+3],14,-187363961);B=e(B,A,z,C,D[u+8],20,1163531501);C=e(C,B,A,z,D[u+13],5,-1444681467);z=e(z,C,B,A,D[u+2],9,-51403784);A=e(A,z,C,B,D[u+7],14,1735328473);B=e(B,A,z,C,D[u+12],20,-1926607734);C=m(C,B,A,z,D[u+5],4,-378558);z=m(z,C,B,A,D[u+8],11,-2022574463);A=m(A,z,C,B,D[u+11],16,1839030562);B=m(B,A,z,C,D[u+14],23,-35309556);C=m(C,B,A,z,D[u+1],4,-1530992060);z=m(z,C,B,A,D[u+4],11,1272893353);A=m(A,z,C,B,D[u+7],16,-155497632);B=m(B,A,z,C,D[u+10],23,-1094730640);C=m(C,B,A,z,D[u+13],4,681279174);z=m(z,C,B,A,D[u+0],11,-358537222);A=m(A,z,C,B,D[u+3],16,-722521979);B=m(B,A,z,C,D[u+6],23,76029189);C=m(C,B,A,z,D[u+9],4,-640364487);z=m(z,C,B,A,D[u+12],11,-421815835);A=m(A,z,C,B,D[u+15],16,530742520);B=m(B,A,z,C,D[u+2],23,-995338651);C=i(C,B,A,z,D[u+0],6,-198630844);z=i(z,C,B,A,D[u+7],10,1126891415);A=i(A,z,C,B,D[u+14],15,-1416354905);B=i(B,A,z,C,D[u+5],21,-57434055);C=i(C,B,A,z,D[u+12],6,1700485571);z=i(z,C,B,A,D[u+3],10,-1894986606);A=i(A,z,C,B,D[u+10],15,-1051523);B=i(B,A,z,C,D[u+1],21,-2054922799);C=i(C,B,A,z,D[u+8],6,1873313359);z=i(z,C,B,A,D[u+15],10,-30611744);A=i(A,z,C,B,D[u+6],15,-1560198380);B=i(B,A,z,C,D[u+13],21,1309151649);C=i(C,B,A,z,D[u+4],6,-145523070);z=i(z,C,B,A,D[u+11],10,-1120210379);A=i(A,z,C,B,D[u+2],15,718787259);B=i(B,A,z,C,D[u+9],21,-343485551);C=j(C,w);B=j(B,v);A=j(A,s);z=j(z,r)}return[C,B,A,z]}function d(v){var u=[],r=((1<<l)-1),s;for(s=0;s<v.length*l;s+=l){u[s>>5]|=(v.charCodeAt(s/l)&r)<<(s%32)}return u}function g(u){var v="",r=((1<<l)-1),s;for(s=0;s<u.length*32;s+=l){v+=String.fromCharCode((u[s>>5]>>>(s%32))&r)}return v}function q(u){var s=((p)?"0123456789ABCDEF":"0123456789abcdef"),v="",r;for(r=0;r<u.length*4;r++){v+=s.charAt((u[r>>2]>>((r%4)*8+4))&15)+s.charAt((u[r>>2]>>((r%4)*8))&15)}return v}return(c?g(h(d(t),t.length*l)):q(h(d(t),t.length*l)))};Ext.ux.CodeMirror=Ext.extend(Ext.BoxComponent,{readOnly:(this.readOnly)?this.readOnly:false,width:"auto",height:"auto",autoResize:true,initialised:false,documentDurty:false,spellCheck:(this.spellCheck)?this.spellCheck:false,parser:(this.parser)?this.parser:"xml",parserFile:"parsexml.js",parserStylesheet:"js/ux/codemirror/css/xmlcolors.css",initComponent:function(){Ext.ux.CodeMirror.superclass.initComponent.apply(this);this.addEvents({initialize:true,codemodified:true,coderestored:true,cursormove:true,scroll:true});if(this.parser==="xml"){this.parserFile="parsexml.js";this.parserStylesheet="js/ux/codemirror/css/xmlcolors.css"}if(this.parser==="html"){this.parserFile=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","parsehtmlmixed.js"];this.parserStylesheet=["js/ux/codemirror/css/xmlcolors.css","js/ux/codemirror/css/jscolors.css","js/ux/codemirror/css/csscolors.css"]}if(this.parser==="php"){this.parserFile=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","../contrib/php/js/tokenizephp.js","../contrib/php/js/parsephp.js","../contrib/php/js/parsephphtmlmixed.js"];this.parserStylesheet=["js/ux/codemirror/css/xmlcolors.css","js/ux/codemirror/css/jscolors.css","js/ux/codemirror/css/csscolors.css","js/ux/codemirror/contrib/php/css/phpcolors.css"]}},onRender:function(d,c){Ext.ux.CodeMirror.superclass.onRender.apply(this,[d,c])},resize:function(){this.mirror.frame.style.height=this.ownerCt.lastSize.height-89+"px";this.mirror.frame.style.width=this.ownerCt.lastSize.width-35+"px"},onInit:function(c,d){var e=Ext.getCmp(d),f=e.mirror;e.ownerCt.fireEvent("resize");e.fireEvent("initialize");e.initialised=true;e.documentDurty=false;f.editor.keyUp=function(i){var h=f.cursorPosition(),g=f.lineNumber(h.line),j=h.character;e.fireEvent("cursormove",g,j);if(Ext.getCmp(d).documentDurty===true&&i.keyCode!==8&&i.keyCode!==46){}else{e.manageCodeChange(d)}};Ext.EventManager.addListener(f.frame.contentWindow,"scroll",function(g){e.monitorScroll(g,e)},this)},onCursorActivity:function(d){var f=Ext.getCmp(d),g=f.mirror,e=g.cursorPosition(),c=g.lineNumber(e.line),h=e.character;f.fireEvent("cursormove",c,h)},manageCodeChange:function(e,g){var f=Ext.getCmp(e),i=f.mirror,c=i.originalContent,d=i.getCode(),h=Ext.getCmp(e+"-btn-undo");if(c){if(c===d){if(f.documentDurty===true){f.fireEvent("coderestored");f.documentDurty=false}}else{h.enable();if(f.documentDurty===false){f.fireEvent("codemodified");f.documentDurty=true}}}},saveFunction:function(c){var d=Ext.getCmp(c+"-btn-save");if(!d.disabled){d.handler.call(d.scope||d,d)}},monitorScroll:function(d,c){c.fireEvent("scroll",d.target.body.scrollTop,this)},afterRender:function(){this.mirror=new CodeMirror(CodeMirror.replace(Ext.get(this.id).dom),{textWrapping:false,saveFunction:this.saveFunction,width:"100%",height:this.ownerCt.lastSize.height,readOnly:this.readOnly,content:this.value,originalContent:false,parserfile:this.parserFile,parserConfig:{alignCDATA:true,useHTMLKludges:false},indentUnit:1,cmId:this.id,lineNumbers:true,continuousScanning:(this.readOnly)?false:500,stylesheet:this.parserStylesheet,path:"js/ux/codemirror/js/",initCallback:this.onInit,autoMatchParens:true,disableSpellcheck:!this.spellCheck,onChange:this.manageCodeChange,cursorActivity:this.onCursorActivity});this.ownerCt.on("resize",function(d,e,g,c,f){this.resize()},this)},getCode:function(){return this.mirror.getCode()},setCode:function(c){if(!this.initialised){var d=new Ext.util.DelayedTask(function(){this.setCode(c)},this);d.delay(500)}else{this.mirror.setCode(c);this.mirror.originalContent=c}},reIndentAll:function(){this.mirror.reindent()},undo:function(c,d){this.mirror.undo();Ext.getCmp(c+"-FILE-"+d+"-btn-redo").enable();if(!this.mirror.editor.history.history.length){Ext.getCmp(c+"-FILE-"+d+"-btn-undo").disable()}},redo:function(c,d){this.mirror.redo();Ext.getCmp(c+"-FILE-"+d+"-btn-undo").enable();if(!this.mirror.editor.history.redoHistory.length){Ext.getCmp(c+"-FILE-"+d+"-btn-redo").disable()}},setLineContent:function(c,e){var d=this.mirror.nthLine(c);this.mirror.setLineContent(d,e)},insertIntoLine:function(d,c,f){var e=this.mirror.nthLine(d);this.mirror.insertIntoLine(e,c,f)},scrollTo:function(c){this.mirror.frame.contentWindow.document.body.scrollTop=c},focus:function(){this.mirror.focus()},setOriginalCode:function(){this.mirror.originalContent=this.getCode();this.documentDurty=false},getCursorPosition:function(){var d=this.mirror.cursorPosition(),c=this.mirror.lineNumber(d.line),e=d.character;return"{line:"+c+", caracter:"+e+"}"},nthLine:function(c){return this.mirror.nthLine(c)},setSpellcheck:function(c){return this.mirror.setSpellcheck(c)}});Ext.reg("codemirror",Ext.ux.CodeMirror);Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(c){Ext.apply(this,c)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(d){this.grid=d;this.cm=d.getColumnModel();this.view=d.getView();var c=this.view;c.onLayout=this.onLayout;c.afterMethod("render",this.refreshSummary,this);c.afterMethod("refresh",this.refreshSummary,this);c.afterMethod("syncScroll",this.syncSummaryScroll,this);c.afterMethod("onColumnWidthUpdated",this.doWidth,this);c.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);c.afterMethod("onColumnHiddenUpdated",this.doHidden,this);d.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(e,o){var g={},m=o.config,h,d,k,f,c,l,p;for(h=0,l=m.length;h<l;h++){d=m[h];k=d.dataIndex;g[k]=0;if(d.summaryType){for(f=0,p=e.length;f<p;f++){c=e[f];g[k]=Ext.ux.grid.GridSummary.Calculations[d.summaryType](c.get(k),c,k,g,f)}}}return g},onLayout:function(c,d){if(Ext.type(d)!=="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(d-this.summary.getHeight())}},syncSummaryScroll:function(){var c=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft},doWidth:function(e,c,d){var f=this.view.summary.dom;f.firstChild.style.width=d;f.firstChild.rows[0].childNodes[e].style.width=c},doAllWidths:function(c,d){var g=this.view.summary.dom,h=c.length,f,e;g.firstChild.style.width=d;f=g.firstChild.rows[0].childNodes;for(e=0;e<h;e++){f[e].style.width=c[e]}},doHidden:function(d,f,c){var e=this.view.summary.dom,g=f?"none":"";e.firstChild.style.width=c;e.firstChild.rows[0].childNodes[d].style.display=g},renderSummary:function(f,k,q){k=k||this.view.getColumnData();var l=q.config,g=[],r=k.length-1,m,e,d,h,j;for(h=0,j=k.length;h<j;h++){m=k[h];e=l[h];d={};d.id=m.id;d.style=m.style;d.css=h===0?"x-grid3-cell-first ":(h===r?"x-grid3-cell-last ":"");if(e.summaryType||e.summaryRenderer){d.value=(e.summaryRenderer||m.renderer)(f.data[m.name],d,f)}else{d.value=""}if(d.value===undefined||d.value===""){d.value="&#160;"}g[g.length]=this.cellTpl.apply(d)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:g.join("")})},refreshSummary:function(){var h=this.grid,j=h.store,f=this.view.getColumnData(),c=this.cm,d=j.getRange(),i=this.calculate(d,c),e=this.renderSummary({data:i},f,c);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(e).first()},toggleSummary:function(d){var c=this.grid.getGridEl();if(c){if(d===undefined){d=c.hasClass("x-grid-hide-gridsummary")}c[d?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(d,c,e,g,f){return g[e]+Ext.num(d,0)},count:function(d,c,e,g,f){return f+1},max:function(d,c,e,g,f){return Math.max(Ext.num(d,0),g[e])},min:function(d,c,e,g,f){return Math.min(Ext.num(d,0),g[e])},average:function(d,c,f,i,h){var e=i[f]+Ext.num(d,0),g=c.store.getCount();return h===g-1?(e/g):e}};Ext.ux.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(d,c){d.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));var e=document.createElement("iframe"),f=function(g){d.unmask()};e.id=this.id;e.name=this.id;e.src=this.url;e.frameBorder=0;this.el=d.appendChild(e);if(Ext.isIE){document.frames[this.url].name=this.id}e[Ext.isIE?"onreadystatechange":"onload"]=f.createDelegate(e)}});Ext.ux.FixedMultiSelectionModel=Ext.extend(Ext.tree.MultiSelectionModel,{normalClick:false,init:function(c){this.tree=c;c.getTreeEl().on("keydown",this.onKeyDown,this);c.on("dblclick",this.onDoubleClick,this);c.on("click",this.onNodeClick,this)},onDrag:function(){this.normalClick=false},onNodeClick:function(c,d){if(d.shiftKey){d.preventDefault()}if(!this.tree.dragZone||!this.tree.dragZone.isMultiSelect){this.onMouseDown(c,d);this.onMouseUp(c,d)}},onMouseDown:function(c,d){if(c.isSelected()){if(d.ctrlKey){this.unselect(c);this.normalClick=false;return}this.normalClick=!d.shiftKey}else{this.select(c,d,d.ctrlKey);this.normalClick=false}},onMouseUp:function(c,d){if(this.normalClick){this.select(c,d,d.ctrlKey);this.normalClick=false}},onDoubleClick:function(){this.normalClick=false},compareNodeOrder:document.compareDocumentPosition?function(d,c){return 3-(d.ui.elNode.compareDocumentPosition(c.ui.elNode)&6)}:(typeof document.documentElement.sourceIndex!=="undefined"?function(d,c){return d.ui.elNode.sourceIndex-c.ui.elNode.sourceIndex}:function(f,e){if(f==e){return 0}var d=document.createRange();d.selectNode(a.ui.elNode);d.collapse(true);var c=document.createRange();c.selectNode(b.ui.elNode);c.collapse(true);return d.compareBoundaryPoints(Range.START_TO_END,c)}),sortSelNodes:function(){if(this.selNodes.length>1){if(!this.selNodes[0].ui.elNode){return}this.selNodes.sort(this.compareNodeOrder)}},selectNode:function(d,c){if(!this.isSelected(d)){this.selNodes.push(d);this.selMap[d.id]=d;d.ui.onSelectedChange(true)}},select:function(d,h,l){if(d instanceof Array){for(var i=0;i<d.length;i++){this.selectNode(d[i])}this.sortSelNodes();this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode);return d}if(h&&h.shiftKey&&this.selNodes.length>0){this.lastSelNode=this.lastSelNode||this.selNodes[0];var j=this.compareNodeOrder(this.lastSelNode,d)>0;this.clearSelections(true);var m=true;var f=false;var k=this.lastSelNode;do{for(var g=k;g!=null;g=(j?g.previousSibling:g.nextSibling)){f=f||(j&&(g==d||g.contains(d)));if(g.isExpanded()){g.cascade(function(c){if(m!=f){this.selectNode(c)}m=(m&&c!=d);return true},this)}else{this.selectNode(g);m=(g!=d)}if(!m){break}}if(!m){break}while((k=k.parentNode)!=null){if(j){this.selectNode(k)}m=(m&&k!=d);if(j&&k.previousSibling){k=k.previousSibling;break}if(!j&&k.nextSibling){k=k.nextSibling;break}}if(!m){break}}while(k!=null);this.selectNode(d);this.sortSelNodes();this.fireEvent("selectionchange",this,this.selNodes,d);h.preventDefault();return d}else{if(l!==true){this.clearSelections(true)}}if(this.isSelected(d)){if(l===true){this.unselect(d);if(this.lastSelNode===d){this.lastSelNode=this.selNodes[0]}return d}this.lastSelNode=d;return d}this.selectNode(d);this.sortSelNodes();this.lastSelNode=d;this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode);return d},getUniqueSelectedNodes:function(){var d=[];for(var f=0;f<this.selNodes.length;f++){var e=this.selNodes[f];d.push(e);while((f+1)<this.selNodes.length&&e.contains(this.selNodes[f+1])){f++}}return d},unselect:function(d,e){if(e){for(var f=this.selNodes.length-1;f>=0;f--){if(this.selNodes[f].isAncestor(d)){Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,this.selNodes[f])}}}return Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,d)},selectPrevious:function(e){var c=this.selNodes[0];if(!c){return null}var f=c.previousSibling;if(f){if(!f.isExpanded()||f.childNodes.length<1){return this.select(f,null,e)}else{var d=f.lastChild;while(d&&d.isExpanded()&&d.childNodes.length>0){d=d.lastChild}return this.select(d,null,e)}}else{if(c.parentNode&&(this.tree.rootVisible||!c.parentNode.isRoot)){return this.select(c.parentNode,null,e)}}return null},selectNext:function(e){var d=this.selNodes[this.selNodes.length-1];if(!d){return null}if(d.firstChild&&d.isExpanded()){return this.select(d.firstChild,null,e)}else{if(d.nextSibling){return this.select(d.nextSibling,null,e)}else{if(d.parentNode){var c=null;d.parentNode.bubble(function(){if(this.nextSibling){c=this.getOwnerTree().selModel.select(this.nextSibling,null,e);return false}});return c}}}return null},onKeyDown:function(f){var d=this.selNode||this.lastSelNode;var g=this;if(!d){return}var c=f.getKey();switch(c){case f.DOWN:f.stopEvent();this.selectNext(f.shiftKey||f.ctrlKey);break;case f.UP:f.stopEvent();this.selectPrevious(f.shiftKey||f.ctrlKey);break;case f.RIGHT:f.preventDefault();if(d.hasChildNodes()){if(!d.isExpanded()){d.expand()}else{if(d.firstChild){this.select(d.firstChild,f,f.shiftKey||f.ctrlKey)}}}break;case f.LEFT:f.preventDefault();if(d.hasChildNodes()&&d.isExpanded()){d.collapse()}else{if(d.parentNode&&(this.tree.rootVisible||d.parentNode!=this.tree.getRootNode())){this.select(d.parentNode,f,f.shiftKey||f.ctrlKey)}}break}}});Ext.ux.MultiSelectTreeDragZone=Ext.extend(Ext.tree.TreeDragZone,{isMultiSelect:true,onBeforeDrag:function(d,f){if(d.nodes&&d.nodes.length>0){for(var g=0;g<d.nodes.length;g++){n=d.nodes[g];if(n.draggable===false||n.disabled){return false}}return true}else{if(d.node){if(d.node.draggable===false||d.node.disabled){return false}}}return false},alignElWithMouse:function(d,f,e){Ext.ux.MultiSelectTreeDragZone.superclass.alignElWithMouse.apply(this,arguments);if(Ext.fly(d).isVisible()){var c=this.tree.getSelectionModel();if(c&&c.onDrag){c.onDrag.call(c)}}},onMouseUp:function(f){var c=this.tree.getSelectionModel();if(c&&c.onMouseUp){var d=Ext.dd.Registry.getHandleFromEvent(f);if(d!=null){c.onMouseUp.call(c,d.node,f)}}Ext.ux.MultiSelectTreeDragZone.superclass.onMouseUp.apply(this,arguments)},getDragData:function(p){var q=Ext.dd.Registry.getHandleFromEvent(p);if(q==null){return}var h=[];var l=this.tree.getSelectionModel();if(l.onMouseDown){l.onMouseDown.call(l,q.node,p);h=l.getUniqueSelectedNodes()}else{h=[q.node]}if(!h||h.length<1){return}var j={nodes:h};var f=document.createElement("ul");f.className="x-tree-node-ct x-tree-lines";var x=0;for(var k=0,m=h.length;k<m;k++){var v=h[k].ui.wrap.cloneNode(true);var u=h[k].ui.indentNode.childNodes.length+1;if(u>0){var w=Ext.query(h[k].ui.indentNode.nodeName+".x-tree-node-indent",v);for(var s=0,t=w.length;s<t;s++){var g=w[s];var o=g.childNodes.length;if(o<=u){g.innerHTML="";if(o<u){g.parentNode.removeChild(w[s].nextSibling)}}else{for(var d=0;d<u;d++){w[s].removeChild(w[s].firstChild)}}}}f.appendChild(v);Ext.fly(v).removeClass(["x-tree-selected","x-tree-node-over"])}j.ddel=f;return j},onInitDrag:function(d){var c=this.dragData;this.tree.eventModel.disable();this.proxy.update("");this.proxy.ghost.dom.appendChild(c.ddel);this.tree.fireEvent("startdrag",this.tree,c.nodes,d)},getTreeNode:function(){return this.dragData.nodes},getRepairXY:function(d,c){return c.nodes[0].ui.getDDRepairXY()},onEndDrag:function(c,d){this.tree.eventModel.enable.defer(100,this.tree.eventModel);this.tree.fireEvent("enddrag",this.tree,c.nodes||[c.node],d)},onValidDrop:function(c,d,f){this.tree.fireEvent("dragdrop",this.tree,this.dragData.nodes,c,d);this.hideProxy()},beforeInvalidDrop:function(c,f){var d=this.tree.getSelectionModel()}});Ext.ux.MultiSelectTreeDropZone=Ext.extend(Ext.tree.TreeDropZone,{isValidDropPoint:function(f,o,l,i,h){if(!f||!h){return false}var j=f.node;var d=h.nodes?h.nodes:[h.node];if(!(j&&j.isTarget&&o)){return false}if(o=="append"&&j.allowChildren===false){return false}if((o=="above"||o=="below")&&(j.parentNode&&j.parentNode.allowChildren===false)){return false}for(var k=0;k<d.length;k++){if(d[k]&&(j==d[k]||d[k].contains(j))){return false}}var g=this.dragOverData;g.tree=this.tree;g.target=j;g.data=h;g.point=o;g.source=l;g.rawEvent=i;g.dropNode=d;g.cancel=false;var m=this.tree.fireEvent("nodedragover",g);return g.cancel===false&&m!==false},getDropPoint:function(i,g,m,h){var o=g.node;if(o.isRoot){return this.isValidDropPoint(g,"append",m,i,h)?"append":false}var d=g.ddel;var p=Ext.lib.Dom.getY(d),k=p+d.offsetHeight;var j=Ext.lib.Event.getPageY(i);var l=o.allowChildren===false||o.isLeaf()||!this.isValidDropPoint(g,"append",m,i,h);if(!this.appendOnly&&o.parentNode.allowChildren!==false){var f=false;if(!this.allowParentInsert){f=o.hasChildNodes()&&o.isExpanded()}var c=(k-p)/(l?2:3);if(j>=p&&j<(p+c)&&this.isValidDropPoint(g,"above",m,i,h)){return"above"}else{if(!f&&(l||j>=k-c&&j<=k)&&this.isValidDropPoint(g,"below",m,i,h)){return"below"}}}return l?false:"append"},onNodeOver:function(d,j,i,h){var l=this.getDropPoint(i,d,j,h);var f=d.node;if(!this.expandProcId&&l=="append"&&f.hasChildNodes()&&!d.node.isExpanded()){this.queueExpand(f)}else{if(l!="append"){this.cancelExpand()}}var g=this.dropNotAllowed;if(l){var c=d.ddel;var k;if(l=="above"){g=d.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";k="x-tree-drag-insert-above"}else{if(l=="below"){g=d.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";k="x-tree-drag-insert-below"}else{g="x-tree-drop-ok-append";k="x-tree-drag-append"}}if(this.lastInsertClass!=k){Ext.fly(c).replaceClass(this.lastInsertClass,k);this.lastInsertClass=k}}return g},onNodeDrop:function(f,l,h,g){var k=this.getDropPoint(h,f,l,g);var i=f.node;i.ui.startDrop();if(k===false){i.ui.endDrop();return false}var j=g.node||(l.getTreeNode?l.getTreeNode(g,i,k,h):null);var d={tree:this.tree,target:i,data:g,point:k,source:l,rawEvent:h,dropNode:j,cancel:!j,dropStatus:false};var c=this.tree.fireEvent("beforenodedrop",d);if(c===false||d.cancel===true||!d.dropNode){i.ui.endDrop();return d.dropStatus}i=d.target;if(k=="append"&&!i.isExpanded()){i.expand(false,null,function(){this.completeDrop(d)}.createDelegate(this))}else{this.completeDrop(d)}return true},afterRepair:function(f){if(f&&Ext.enableFx){var e=f.nodes?f.nodes:[f.node];for(var g=0,d=e.length;g<d;g++){e[g].ui.highlight()}}this.hideProxy()},onContainerDrop:function(c,j,h){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",c,j,h)){var i=this.tree.getRootNode();i.ui.startDrop();var f=h.node||(c.getTreeNode?c.getTreeNode(h,i,"append",j):null);var g={tree:this.tree,target:i,data:h,point:"append",source:c,rawEvent:j,dropNode:f,cancel:!f,dropStatus:false};var d=this.tree.fireEvent("beforenodedrop",g);if(d===false||g.cancel===true||!g.dropNode){i.ui.endDrop();return g.dropStatus}i=g.target;if(!i.isExpanded()){i.expand(false,null,function(){this.completeDrop(g)}.createDelegate(this))}else{this.completeDrop(g)}return true}return false},onContainerOver:function(c,f,d){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",c,f,d)){return this.dropAllowed}return this.dropNotAllowed}});Ext.ux.MultiSelectTreePanel=Ext.extend(Ext.tree.TreePanel,{getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.ux.FixedMultiSelectionModel()}return this.selModel},initEvents:function(){if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new Ext.ux.MultiSelectTreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.ddAppendOnly===true})}if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new Ext.ux.MultiSelectTreeDragZone(this,{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})}Ext.ux.MultiSelectTreePanel.superclass.initEvents.apply(this,arguments);this.on("remove",function(c,d,e){c.getSelectionModel().unselect(e,true)})}});Ext.reg("multiselecttreepanel",Ext.ux.MultiSelectTreePanel);Ext.namespace("Ext.ux");Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",cls:"x-notification",width:250,autoHeight:true,draggable:false,bodyStyle:"text-align:center; padding: 10px;"});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(c){this.body.update(c)},setTitle:function(d,c){Ext.ux.Notification.superclass.setTitle.call(this,d,c||this.iconCls)},onRender:function(d,c){Ext.ux.Notification.superclass.onRender.call(this,d,c)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass("fixed");if(this.autoDestroy){this.task.cancel()}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on("click",this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,"br-br",[-20,-20-((this.getSize().height+10)*this.pos)]);this.el.slideIn("b",{duration:1,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.el.shadow.hide();this.el.ghost("b",{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn});Ext.ns("Ext.ux");Ext.ux.PanelCollapsedTitle=(function(){var c="x-panel-header-rotated";var e=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var d=function(){var j=((this.region=="east")||(this.region=="west"));var k="overflow: visible; padding: 0; border: none; background: none;";if(j&&e){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"});var i="http://www.w3.org/2000/svg";var h=document.createElementNS(i,"svg");this.collapsedHeader.dom.appendChild(h);h.setAttribute("width","100%");h.setAttribute("height","100%");var l=document.createElementNS(i,"text");l.setAttribute("x",6);l.setAttribute("y",1);l.setAttribute("transform","rotate(90 6 1)");l.setAttribute("class","x-panel-header "+c);h.appendChild(l);this.collapsedHeaderText=document.createTextNode(this.title);l.appendChild(this.collapsedHeaderText);var g=Ext.fly(l).getStyle("color");l.setAttribute("style",k+";fill: "+g+";")}else{var f="position: relative;";if(j){f+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;"}else{f+="top: 2px;";k+="padding-left: 4px; margin-right: 18px;"}this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:k,cls:"x-panel-header "+c,html:'<span style="'+f+'">'+this.title+"</span>"});this.collapsedHeaderText=this.collapsedHeader.first()}if(this.collapsedIconCls){this.setCollapsedIconClass(this.collapsedIconCls)}};this.init=function(g){if(g.collapsible){var f=((g.region=="east")||(g.region=="west"));g.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(h){if(this.rendered&&this.collapsedHeaderText){if(this.collapsedHeaderText.dom){this.collapsedHeaderText.dom.innerHTML=h}else{if(this.collapsedHeaderText.replaceData){this.collapsedHeaderText.nodeValue=h}}}});g.setCollapsedIconClass=function(i){var h=this.collapsedIconCls;this.collapsedIconCls=i;if(this.rendered&&this.collapsedHeader){var k=this.collapsedHeader,j=k.child("img.x-panel-inline-icon");if(j){if(this.collapsedIconCls){Ext.fly(j).replaceClass(h,this.collapsedIconCls)}else{Ext.fly(j).remove()}}else{if(this.collapsedIconCls){Ext.DomHelper.insertBefore(k.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:f?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"})}}}};g.on("render",function(){if(this.ownerCt.rendered&&this.ownerCt.layout.hasLayout){d.call(g)}else{this.ownerCt.on("afterlayout",d,g,{single:true})}},g)}};return this})();Ext.ux.SlidingTabPanel=Ext.extend(Ext.TabPanel,{initTab:function(d,c){Ext.ux.SlidingTabPanel.superclass.initTab.call(this,d,c);this.addEvents({startDrag:true,endDrag:true});var e=this.getTemplateArgs(d);if(!this.slidingTabsID){this.slidingTabsID=Ext.id()}new Ext.ux.DDSlidingTab(e,this.slidingTabsID,{tabpanel:this})}});Ext.ux.DDSlidingTab=Ext.extend(Ext.dd.DDProxy,{constructor:function(){Ext.ux.DDSlidingTab.superclass.constructor.apply(this,arguments);this.setYConstraint(0,0,0);this.tabpanel=this.config.tabpanel;this.slideDuration=this.tabpanel.slideDuration;if(!this.slideDuration){this.slideDuration=0.1}},handleMouseDown:function(f,d){if(this.primaryButtonOnly&&f.button!=0){return}if(this.isLocked()){return}this.DDM.refreshCache(this.groups);var c=new Ext.lib.Point(Ext.lib.Event.getPageX(f),Ext.lib.Event.getPageY(f));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(c,this)){}else{if(this.clickValidator(f)){this.setStartPosition();this.b4MouseDown(f);this.onMouseDown(f);this.DDM.handleMouseDown(f,this)}}},startDrag:function(c,j){this.tabpanel.fireEvent("startDrag",this.tabpanel,this.tabpanel.getActiveTab());Ext.dd.DDM.useCache=false;Ext.dd.DDM.mode=1;this.proxyWrapper=Ext.get(this.getDragEl());this.proxyWrapper.update();this.proxyWrapper.applyStyles("z-index:1001;border:0 none;");this.proxyWrapper.addClass("tab-proxy");this.stripWrap=this.proxyWrapper.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',true);this.dragEl=this.stripWrap.insertHtml("afterBegin","<div></div>",true);this.tab=Ext.get(this.getEl());this.tab.applyStyles("visibility:hidden;");this.dragEl.insertHtml("afterBegin",this.tab.dom.innerHTML,false);this.dragEl.dom.className=this.tab.dom.className;var i=this.tabpanel.el.getWidth();var g=this.tabpanel.el.getX();var h=this.tab.getX();var d=this.tab.getWidth();var f=h-g;var e=g+i-h-d;this.resetConstraints();this.setXConstraint(f,e)},onDragOver:function(f,i){f.stopEvent();var g=Ext.get(i[0].id);var k=g.getWidth();var j=g.getX();var h=j+(k/2);var d=this.tab.getX();var l=this.proxyWrapper.getX();var c=this.proxyWrapper.getWidth();if(l<j&&((l+c)>h)){if(g.next()!=this.tab){g.applyStyles("visibility:hidden;");this.tab.insertAfter(g);this.targetProxy=this.createSliderProxy(j,g);if(!this.targetProxy.hasActiveFx()){this.animateSliderProxy(g,this.targetProxy,d)}}}if(l>j&&(l<h)){if(this.tab.next()!=g){g.applyStyles("visibility:hidden;");this.tab.insertBefore(g);this.targetProxy=this.createSliderProxy(j,g);if(!this.targetProxy.hasActiveFx()){this.animateSliderProxy(g,this.targetProxy,d)}}}},animateSliderProxy:function(d,c,e){c.shift({x:e,easing:"easeOut",duration:this.slideDuration,callback:function(){c.remove();d.applyStyles("visibility:visible;")},scope:this})},createSliderProxy:function(d,f){var e=Ext.getBody().insertHtml("afterBegin",'<div class="tab-proxy" style="position:absolute;visibility:visible;z-index:999;left:'+d+'px;"></div>',true);e.stripWrapper=e.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',true);e.dragEl=e.stripWrapper.insertHtml("afterBegin","<div></div>",true);e.dragEl.update(f.dom.innerHTML);e.dragEl.dom.className=f.dom.className;var c=parseInt(f.getTop(false));e.setTop(c);return e},onDragDrop:function(d,c){d.stopEvent()},endDrag:function(c){var d=this.tab.getX();this.proxyWrapper.applyStyles("visibility:visible;");this.proxyWrapper.shift({x:d,easing:"easeOut",duration:this.slideDuration,callback:function(){this.proxyWrapper.applyStyles("visibility:hidden;");this.tab.applyStyles("visibility:visible;");this.stripWrap.remove();this.dragEl.remove();if(!this.targetProxy){return}this.targetProxy.stripWrapper.remove();this.targetProxy.dragEl.remove()},scope:this});Ext.dd.DDM.useCache=true;this.reorderTab();this.tabpanel.fireEvent("endDrag",this.tabpanel,this.tabpanel.getActiveTab())},reorderTab:function(){var e=this.tabpanel.header.child("ul").dom.children,c=[],f=[];for(var d=0;d<e.length;d++){if(e[d].id.substr(0,this.tabpanel.id.length)==this.tabpanel.id){c.push(e[d].id.substr((this.tabpanel.id.length+2),e[d].id.length))}}for(var d=0;d<this.tabpanel.items.items.length;d++){f[this.tabpanel.items.items[d].id]=this.tabpanel.items.items[d]}for(var d=0;d<c.length;d++){this.tabpanel.items.keys[d]=c[d];this.tabpanel.items.items[d]=f[c[d]]}}});Ext.namespace("ui","ui.task");ui.task.AcceptPatchTask=function(c){Ext.apply(this,c);if(PhDOE.userLogin==="anonymous"){PhDOE.winForbidden();return}Ext.MessageBox.confirm(_("Confirm"),_("This action will accept this patch, send an email to his author, save the file and close this tab."),function(d){if(d==="yes"){Ext.getCmp("PP-PATCH-FILE-"+this.fid).isModified=false;Ext.getCmp("PP-PATCH-PANEL-"+this.fid).setTitle(Ext.getCmp("PP-PATCH-PANEL-"+this.fid).originTitle);Ext.getCmp("PP-"+this.fid).setTitle(Ext.getCmp("PP-"+this.fid).originTitle);var e=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"saveFile",filePath:this.fpath,fileName:this.fname,fileLang:"all",fileContent:Ext.getCmp("PP-PATCH-FILE-"+this.fid).getCode()},success:function(g){var h=Ext.util.JSON.decode(g.responseText),f=ui.component.PendingPatchGrid.getInstance();ui.component.PendingCommitGrid.getInstance().addRecord(h.id,this.fpath,this.fname,"update");f.store.remove(this.storeRecord);f.store.fireEvent("datachanged",f.store);XHR({scope:this,params:{task:"afterPatchAccept",PatchUniqID:this.fuid}});Ext.getCmp("main-panel").remove("PP-"+this.fid);e.hide();PhDOE.notify("info",_("Patch accepted successfully"),_("The Patch was accepted successfully !"))},failure:function(){e.hide()}})}},this)};Ext.namespace("ui","ui.task","ui.task._CheckBuildTask");ui.task._CheckBuildTask.display=function(){XHR({params:{task:"getLogFile",file:"project_"+PhDOE.project+"_log_check_build_"+PhDOE.userLang},success:function(c){var d=Ext.util.JSON.decode(c.responseText);Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);if(Ext.getCmp("main-panel").findById("check_build_panel_"+PhDOE.userLang)){Ext.getCmp("main-panel").remove("check_build_panel_"+PhDOE.userLang)}Ext.getCmp("main-panel").add({xtype:"panel",id:"check_build_panel_"+PhDOE.userLang,title:String.format(_("Check Build Result for {0}"),Ext.util.Format.uppercase(PhDOE.userLang)),tabTip:String.format(_("Check Build Result for the documentation {0}"),Ext.util.Format.uppercase(PhDOE.userLang)),closable:true,autoScroll:true,iconCls:"iconCheckBuild",html:'<div class="check-build-content">'+d.mess+"</div>"});Ext.getCmp("main-panel").setActiveTab("check_build_panel_"+PhDOE.userLang)}})};ui.task._CheckBuildTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.userLang},success:function(){ui.task._CheckBuildTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._CheckBuildTask.display()}else{ui.task._CheckBuildTask.poll.delay(5000)}}})});ui.task.CheckBuildTask=function(c){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until the build is checked..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"checkBuild",xmlDetails:Ext.getCmp("option-xml-details").checked},success:function(){new ui.task._CheckBuildTask.display()},failure:function(d){var e=Ext.util.JSON.decode(d.responseText);if(e&&e.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._CheckBuildTask.poll.delay(5000)}}})};Ext.namespace("ui","ui.task","ui.task._CheckEntitiesTask");ui.task._CheckEntitiesTask.display=function(){BtnViewResult=Ext.getCmp("btn-check-entities-view-last-result");Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);if(Ext.getCmp("main-panel").findById("tab-check-entities")){Ext.getCmp("main-panel").remove("tab-check-entities")}BtnViewResult.handler.call(BtnViewResult.scope||BtnViewResult,BtnViewResult)};ui.task._CheckEntitiesTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){ui.task._CheckEntitiesTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._CheckEntitiesTask.display()}else{ui.task._CheckEntitiesTask.poll.delay(5000)}}})});ui.task.CheckEntitiesTask=function(c){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until entities are checked..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"checkEntities"},success:function(d){new ui.task._CheckEntitiesTask.display()},failure:function(d){var e=Ext.util.JSON.decode(d.responseText);if(e&&e.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._CheckEntitiesTask.poll.delay(5000)}}})};Ext.namespace("ui","ui.task");ui.task.CheckFileTask=function(c){Ext.apply(this,c);if(PhDOE.userLogin==="anonymous"){PhDOE.winForbidden();return}Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Checking for error. Please, wait..."));XHR({scope:this,params:{task:"checkFileError",FilePath:this.fpath,FileName:this.fname,FileLang:this.lang,FileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(d){Ext.getBody().unmask();var e=Ext.util.JSON.decode(d.responseText);if(e.error&&e.error_first!=="-No error-"){Ext.getCmp("main-panel").add({id:"FE-help-"+this.fid,title:"Error in "+this.fname,iconCls:"iconFilesError",closable:true,autoScroll:true,autoLoad:"./error?dir="+this.fpath+"&file="+this.fname});Ext.getCmp("main-panel").setActiveTab("FE-help-"+this.fid)}else{Ext.MessageBox.show({title:_("Check for errors"),msg:_("There is no error."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});if(this.prefix==="FE"){Ext.getCmp("FE-error-desc-"+this.fid).body.updateManager.refresh()}ui.component.ErrorFileGrid.getInstance().store.reload()}})};Ext.namespace("ui","ui.task");ui.task.ClearLocalChangeTask=function(c){Ext.apply(this,c);if(PhDOE.userLogin==="anonymous"){PhDOE.winForbidden();return}Ext.MessageBox.confirm(_("Confirm"),_("This action will clear your local modification and take back this file from his original stats.<br/>You need confirm."),function(f){if(f==="yes"){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));var d=["FNT","FNU","FE","FNR","FNIEN","AF"];for(var e=0;e<d.length;e++){if(Ext.getCmp("main-panel").findById(d[e]+"-"+Ext.util.md5(d[e]+"-"+this.fpath+this.fname))){Ext.getCmp("main-panel").remove(d[e]+"-"+Ext.util.md5(d[e]+"-"+this.fpath+this.fname))}}XHR({scope:this,params:{task:"clearLocalChange",FileType:this.ftype,FilePath:this.fpath,FileName:this.fname},success:function(i){var g=ui.component.PendingCommitGrid.getInstance(),j=Ext.util.JSON.decode(i.responseText),h;g.store.remove(this.storeRecord);g.store.fireEvent("datachanged",g.store);if(j.lang==="en"&&this.ftype==="update"){ui.component.StaleFileGrid.getInstance().store.each(function(k){if((k.data.path)==="/"+j.path&&k.data.name===j.name){k.set("needCommitEN",false);k.set("en_revision",j.revision);k.commit()}},this);ui.component.ErrorFileGrid.getInstance().store.each(function(k){if((PhDOE.userLang+k.data.path)===this.fpath&&k.data.name===this.fname){k.set("needcommit",false)}},this);h=false;h=ui.component.RepositoryTree.getInstance().getNodeById("/"+this.fpath+this.fname);if(h){h.getUI().removeClass("modified")}Ext.getBody().unmask();return}ui.component.PendingTranslateGrid.getInstance().store.each(function(k){if((PhDOE.userLang+k.data.path)===this.fpath&&k.data.name===this.fname){k.set("needcommit",false)}},this);ui.component.StaleFileGrid.getInstance().store.each(function(k){if((PhDOE.userLang+k.data.path)===this.fpath&&k.data.name===this.fname){k.set("needCommitLang",false);k.set("revision",j.revision);k.set("maintainer",j.maintainer);k.commit()}},this);ui.component.PendingReviewGrid.getInstance().store.each(function(k){if((PhDOE.userLang+k.data.path)===this.fpath&&k.data.name===this.fname){k.set("needcommit",false)}},this);ui.component.NotInENGrid.getInstance().store.each(function(k){if((PhDOE.userLang+k.data.path)===this.fpath&&k.data.name===this.fname){k.set("needcommit",false)}},this);h=false;h=ui.component.RepositoryTree.getInstance().getNodeById("/"+this.fpath+this.fname);if(h){h.getUI().removeClass("modified")}Ext.getBody().unmask()},failure:function(){Ext.getBody().unmask();PhDOE.winForbidden()}})}},this)};Ext.namespace("ui","ui.task");ui.task.GetFileInfoByXmlID=function(c){Ext.apply(this,c);XHR({scope:this,params:{task:"getFileInfoByXmlID",xmlID:this.xmlID},success:function(d){var e=Ext.util.JSON.decode(d.responseText);ui.component.RepositoryTree.getInstance().openFile(e.lang+e.path,e.name)}})};Ext.namespace("ui","ui.task");ui.task.GetFileTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,f=(this.ftype=="NotInEN")?true:false,e=(this.ftype==="GGTRANS")?true:false;Ext.get(c+"-PANEL-"+this.fid).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));XHR({scope:this,params:{task:"getFile",FilePath:this.fpath,FileName:this.fname,readOriginal:f,ggTranslate:e},success:function(h){var k=Ext.util.JSON.decode(h.responseText),j="http://"+window.location.host+":"+window.location.port+window.location.pathname+"?perm=/"+this.fpath.split("/")[0]+"/"+k.xmlid.split("|")[0]+".php&project="+PhDOE.project,g='<a href="'+j+'" target="_blank"><img src="themes/img/anchor.png" alt="permlink" style="vertical-align: middle;" ext:qtip="'+_("Permanent link to this page")+'" /></a>&nbsp;',i=Ext.getCmp(c+"-PANEL-"+this.fid);if(this.prefix==="PP"||this.ftype==="TRANS"||this.prefix==="FNIEN"){i.permlink=""}else{if(this.ftype==="GGTRANS"){i.setTitle('<img src="themes/img/google.png" alt="permlink" style="vertical-align: middle;"> '+i.originTitle)}else{i.permlink=(k.xmlid!="NULL")?g:"";i.setTitle(i.permlink+i.originTitle)}}Ext.getCmp(c+"-FILE-"+this.fid).setCode(k.content);if(this.ftype==="GGTRANS"){Ext.getCmp(c+"-FILE-"+this.fid).reIndentAll()}Ext.get(c+"-PANEL-"+this.fid).unmask();if(k.warn_tab){Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The file <b> {0}</b> contains some tab characters.<br>The editor have replace it with space characters."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});Ext.getCmp(c+"-FILE-"+this.fid).manageCodeChange(c+"-FILE-"+this.fid)}if(k.warn_encoding){Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The editor have modified automatically the file {0} into UTF-8 encoding."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});Ext.getCmp(c+"-FILE-"+this.fid).setLineContent(1,'<?xml version="1.0" encoding="utf-8"?>');Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").enable()}},callback:function(){if(this.prefix=="FNT"){if(this.ftype=="TRANS"){Ext.getCmp(this.prefix+"-"+this.fid).panTRANSLoaded=true}if(this.ftype=="GGTRANS"){Ext.getCmp(this.prefix+"-"+this.fid).panGGTRANSLoaded=true}}if(this.prefix=="FNU"){if(this.ftype=="LANG"){Ext.getCmp(this.prefix+"-"+this.fid).panLANGLoaded=true}if(this.ftype=="EN"){Ext.getCmp(this.prefix+"-"+this.fid).panENLoaded=true}}if(this.prefix=="FE"){if(this.ftype=="LANG"){Ext.getCmp(this.prefix+"-"+this.fid).panLANGLoaded=true}if(this.ftype=="EN"){Ext.getCmp(this.prefix+"-"+this.fid).panENLoaded=true}}if(this.prefix=="FNR"){if(this.ftype=="LANG"){Ext.getCmp(this.prefix+"-"+this.fid).panLANGLoaded=true}if(this.ftype=="EN"){Ext.getCmp(this.prefix+"-"+this.fid).panENLoaded=true}}if(this.prefix=="FNIEN"){Ext.getCmp(this.prefix+"-"+this.fid).panLANGLoaded=true}if(this.prefix=="AF"){Ext.getCmp(this.prefix+"-"+this.fid).panLoaded=true}if(this.prefix=="PP"){if(this.ftype=="PATCH"){Ext.getCmp(this.prefix+"-"+this.fid).panPatchLoaded=true}if(this.ftype=="ORIGIN"){Ext.getCmp(this.prefix+"-"+this.fid).panOriginLoaded=true}}Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})};Ext.namespace("ui","ui.task");ui.task.GetGGTranslation=function(c){Ext.apply(this,c);Ext.get("GGTranslate-result").dom.innerHTML="";Ext.getCmp("GGTranslate-btn").disable();Ext.getCmp("GGTranslate-btn").setText(_("Please, wait..."));XHR({scope:this,params:{task:"getGGTranslation",str:this.str},success:function(d){var e=Ext.util.JSON.decode(d.responseText);Ext.get("GGTranslate-result").dom.innerHTML=e.translation;Ext.getCmp("GGTranslate-btn").setText(_("Translate !"));Ext.getCmp("GGTranslate-btn").enable()}})};Ext.namespace("ui","ui.task");ui.task.LoadConfigTask=function(c){Ext.apply(this,c);XHR({params:{task:"getConf"},success:function(d){var e=Ext.decode(d.responseText);PhDOE.userLogin=e.mess.userLogin;PhDOE.userLang=e.mess.userLang;PhDOE.userConf=e.mess.userConf;PhDOE.project=e.mess.project;PhDOE.appConf=e.mess.appConf;Ext.get("appTheme").dom.href=PhDOE.userConf.theme;PhDOE.drawInterface()}})};Ext.namespace("ui","ui.task");ui.task.MarkDeleteTask=function(c){Ext.apply(this,c);Ext.MessageBox.confirm(_("Confirm"),_("This action will mark this file as need deleted.<br/><br/>You need commit this change to take it effect.<br/><br/>Please, confirm this action."),function(d){if(d==="yes"){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"markAsNeedDelete",FilePath:PhDOE.userLang+this.fpath,FileName:this.fname},success:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask();ui.component.PendingCommitGrid.getInstance().addRecord(f.id,PhDOE.userLang+this.fpath,this.fname,"delete");this.storeRecord.set("needcommit",true)}})}},this)};Ext.namespace("ui","ui.task","ui.task._PingTask");ui.task.PingTask=function(){this.task=new Ext.util.DelayedTask(function(){XHR({params:{task:"ping"},success:function(e){var f=Ext.util.JSON.decode(e.responseText),d;if(f.ping!=="pong"){window.location.href="./"}else{if(PhDOE.userLang!=="en"){var c=false;if(ui.component.PendingTranslateGrid.getInstance().store.getTotalCount()!=f.totalData.NbPendingTranslate){ui.component.PendingTranslateGrid.getInstance().store.reload();c=true}if(ui.component.StaleFileGrid.getInstance().store.getTotalCount()!=f.totalData.NbPendingUpdate){ui.component.StaleFileGrid.getInstance().store.reload();c=true}if(ui.component.ErrorFileGrid.getInstance().store.getTotalCount()!=f.totalData.NbFilesError){ui.component.ErrorFileGrid.getInstance().store.reload();c=true}if(ui.component.PendingReviewGrid.getInstance().store.getTotalCount()!=f.totalData.NbPendingReview){ui.component.PendingReviewGrid.getInstance().store.reload();c=true}if(ui.component.NotInENGrid.getInstance().store.getTotalCount()!=f.totalData.NbNotInEn){ui.component.NotInENGrid.getInstance().store.reload();c=true}if(c){ui.component.PortletSummary.getInstance().store.reload()}}if(ui.component.PendingCommitGrid.getInstance().store.getCount()!=f.totalData.NbPendingCommit){ui.component.PendingCommitGrid.getInstance().store.reload()}if(ui.component.PendingPatchGrid.getInstance().store.getCount()!=f.totalData.NbPendingPatch){ui.component.PendingPatchGrid.getInstance().store.reload()}}},failure:function(){window.location.href="./"}});this.task.delay(30000)},this)};ui.task.PingTask.prototype.delay=function(d,f,e,c){this.task.delay(d,f,e,c)};ui.task.PingTask.prototype.cancel=function(){this.task.cancel()};ui.task._PingTask.instance=null;ui.task.PingTask.getInstance=function(){if(!ui.task._PingTask.instance){ui.task._PingTask.instance=new ui.task.PingTask()}return ui.task._PingTask.instance};Ext.namespace("ui","ui.task");ui.task.RejectPatchTask=function(c){Ext.apply(this,c);if(PhDOE.userLogin==="anonymous"){PhDOE.winForbidden();return}Ext.MessageBox.confirm(_("Confirm"),_("This action will <b>reject</b> this patch, send an email to his author and close this tab."),function(d){if(d==="yes"){var e=Ext.MessageBox.wait(_("Please, wait..."));XHR({scope:this,params:{task:"afterPatchReject",PatchUniqID:this.fuid},success:function(){var f=ui.component.PendingPatchGrid.getInstance();f.store.remove(this.storeRecord);f.store.fireEvent("datachanged",f.store);Ext.getCmp("main-panel").remove("PP-"+this.fid);e.hide();PhDOE.notify("info",_("Patch rejected successfully"),_("The Patch was rejected successfully !"))},failure:function(){e.hide();PhDOE.winForbidden()}})}},this)};Ext.namespace("ui","ui.task");ui.task.SaveFileTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("Saving data..."));if(PhDOE.userLogin==="anonymous"){e.hide();PhDOE.winForbidden();return}XHR({scope:this,params:{task:"saveFile",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(g){var h=Ext.util.JSON.decode(g.responseText);if(this.prefix==="FNU"){if(this.lang==="en"){this.storeRecord.set("en_revision",h.revision);this.storeRecord.set("needCommitEN",true)}else{this.storeRecord.set("revision",h.en_revision);this.storeRecord.set("needCommitLang",true);this.storeRecord.set("maintainer",h.maintainer)}this.storeRecord.commit()}if(this.prefix==="FE"){if(this.lang!=="en"){this.storeRecord.set("maintainer",h.maintainer)}this.storeRecord.set("needcommit",true);this.storeRecord.commit()}if(this.prefix==="FNR"){if(this.lang!=="en"){this.storeRecord.set("maintainer",h.maintainer);this.storeRecord.set("reviewed",h.reviewed)}this.storeRecord.set("needcommit",true);this.storeRecord.commit()}if(this.prefix==="AF"){this.storeRecord.getUI().addClass("modified")}ui.component.PendingCommitGrid.getInstance().addRecord(h.id,this.lang+this.fpath,this.fname,"update");Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false;Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).permlink+Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);var f;if(this.lang==="en"){f=Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid)}else{f=Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid)}if(this.ftype==="ALL"||!f.isModified){Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}e.hide();PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.type){PhDOE.winForbidden(g.type)}else{PhDOE.winForbidden()}}})};Ext.namespace("ui","ui.task");ui.task.SavePatchTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("Saving data as a patch..."));Ext.getCmp(c+"-FILE-"+this.fid+"-btn-saveas").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false;Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).permlink+Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);if((this.prefix==="AF")||(this.prefix==="FNT")||(this.lang==="en"&&!Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid).isModified)||(this.lang!=="en"&&!Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid).isModified)){Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}XHR({scope:this,params:{task:"saveFile",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:Ext.getCmp(c+"-FILE-"+this.fid).getCode(),type:"patch",emailAlert:this.email},success:function(g){var h=Ext.util.JSON.decode(g.responseText),f=ui.component.PendingPatchGrid.getInstance();f.store.insert(0,new f.store.recordType({id:Ext.id("",""),path:this.lang+this.fpath,name:this.fname,by:PhDOE.userLogin,uniqID:h.uniqId,date:new Date()}));e.hide();PhDOE.notify("info",_("Patch saved"),_("Patch saved successfully !"))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.type){PhDOE.winForbidden(g.type)}else{PhDOE.winForbidden()}}})};Ext.namespace("ui","ui.task");ui.task.SaveTransFileTask=function(d){Ext.apply(this,d);if(PhDOE.userLogin==="anonymous"){PhDOE.winForbidden();return}var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"saveFile",type:"trans",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(f){var g=Ext.util.JSON.decode(f.responseText);this.storeRecord.set("needcommit",true);this.storeRecord.commit();ui.component.PendingCommitGrid.getInstance().addRecord(g.id,this.lang+this.fpath,this.fname,"new");Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false;Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle);e.hide();PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.type){PhDOE.winForbidden(g.type)}else{PhDOE.winForbidden()}}})};Ext.namespace("ui","ui.task","ui.task._SystemUpdateTask");ui.task._SystemUpdateTask.refresh_ui=function(){Ext.get("wizard-step-3").replaceClass("wizard-step-before","wizard-step-working");PhDOE.reloadAllStore();Ext.get("wizard-step-3").replaceClass("wizard-step-working","wizard-step-done");Ext.getCmp("btn-start-refresh").setIconClass("iconFinishRefresh");Ext.getCmp("btn-start-refresh").setText(_("Finish !"));Ext.getCmp("btn-start-refresh").setHandler(function(){Ext.getCmp("sys-update-win").close()});Ext.getCmp("btn-start-refresh").enable();ui.task.PingTask.getInstance().delay(30000);Ext.getCmp("sys-update-win").tools.close.setVisible(true)};ui.task._SystemUpdateTask.poll_apply_tool=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_apply_tools"},success:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");new ui.task._SystemUpdateTask.refresh_ui()}else{ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)}}})});ui.task._SystemUpdateTask.apply_tool=function(){Ext.get("wizard-step-2").replaceClass("wizard-step-before","wizard-step-working");XHR({params:{task:"applyTools"},success:function(){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");new ui.task._SystemUpdateTask.refresh_ui()},failure:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)}})};ui.task._SystemUpdateTask.vcs_poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_update_repository"},success:function(){ui.task._SystemUpdateTask.vcs_poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");new ui.task._SystemUpdateTask.apply_tool()}else{ui.task._SystemUpdateTask.vcs_poll.delay(5000)}}})});ui.task.SystemUpdateTask=function(){ui.task.PingTask.getInstance().cancel();Ext.get("wizard-step-1").replaceClass("wizard-step-before","wizard-step-working");Ext.get("wizard-step-1.1").replaceClass("wizard-wait","wizard-show");XHR({params:{task:"updateRepository"},success:function(){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");new ui.task._SystemUpdateTask.apply_tool()},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.getCmp("sys-update-win").close();PhDOE.winForbidden()}else{ui.task._SystemUpdateTask.vcs_poll.delay(5000)}}})};Ext.namespace("ui","ui.task");ui.task.UpdateConfTask=function(c){Ext.apply(this,c);XHR({scope:this,params:{task:"confUpdate",item:this.item,value:this.value},success:function(){PhDOE.userConf[this.item]=this.value;if(this.item=="errorSkipNbLiteralTag"){ui.component.ErrorFileGrid.getInstance().store.reload()}if(this.item=="needUpdateNbDisplay"){ui.component.StaleFileGrid.getInstance().store.reload()}if(this.item=="reviewedNbDisplay"){ui.component.PendingReviewGrid.getInstance().store.reload()}if(this.item=="newFileNbDisplay"){ui.component.PendingTranslateGrid.getInstance().store.reload()}if(this.notify!==false){PhDOE.notify("info",_("Option saved"),_("Option has been saved successfully !"))}}})};Ext.namespace("ui","ui.task","ui.task._UpdateSingleFolderTask");ui.task._UpdateSingleFolderTask.getUpdateFolderResponse=function(c){XHR({params:{task:"getUpdateFolderResponse"},success:function(d){var e=Ext.util.JSON.decode(d.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(e,c)}})};ui.task._UpdateSingleFolderTask.poll=new Ext.util.DelayedTask(function(){var f=arguments[0],d=f.attributes.id.split("/"),c,e=new Array();d.shift();c=d[0];e.push(f);XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_"+c+"_lock_update_folder"},success:function(){ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,e)},failure:function(g){var h=Ext.util.JSON.decode(g.responseText);if(h&&h.success===false){new ui.task._UpdateSingleFolderTask.getUpdateFolderResponse(f)}else{ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,e)}}})});ui.task._UpdateSingleFolderTask.afterUpdate=function(e,d){Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);var c=Ext.util.JSON.decode(e.result);d.reload(function(){Ext.iterate(c.newFiles,function(g,f){d.findChild("text",g).getUI().addClass("treeFileUpdated")})},this);PhDOE.reloadAllStore()};ui.task._UpdateSingleFolderTask.update=function(d){var c=new Array();c.push(d);Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until update this folder..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"updateFolder",path:d.id},success:function(e){var f=Ext.util.JSON.decode(e.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(f,d)},failure:function(e){var f=Ext.util.JSON.decode(e.responseText);if(f&&f.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,c)}}})};ui.task.UpdateSingleFolderTask=function(c){if(PhDOE.userLogin==="anonymous"){Ext.getCmp("winVCSCommit").close();PhDOE.winForbidden();return}ui.task._UpdateSingleFolderTask.update(c)};Ext.namespace("ui","ui.task","ui.task._VCSCommitTask");ui.task._VCSCommitTask.getCommitResponse=function(){XHR({params:{task:"getCommitResponse"},success:function(c){var d=Ext.util.JSON.decode(c.responseText);ui.task._VCSCommitTask.afterCommit(d.mess)}})};ui.task._VCSCommitTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_"+PhDOE.userLogin+"_commit"},success:function(){ui.task._VCSCommitTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._VCSCommitTask.getCommitResponse()}else{ui.task._VCSCommitTask.poll.delay(5000)}}})});ui.task._VCSCommitTask.afterCommit=function(c){Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);new Ext.Window({title:_("Status"),width:450,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:c.join("<br/>"),buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}]}).show();PhDOE.reloadAllStore()};ui.task._VCSCommitTask.commit=function(g){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until commit..."));var c=[],f,e,d;for(d=0;d<g.length;d=d+1){f=Ext.getCmp("commit-tree-panel").getNodeById(g[d].id);c.push(f.attributes.FileDBID)}e=Ext.getCmp("form-commit-message-log").getValue();e=Ext.util.Format.trim(e);if(Ext.isEmpty(e)){Ext.getBody().unmask();Ext.getCmp("form-commit-message-log").markInvalid(_("The log message is required."));Ext.MessageBox.alert(_("Error"),_("The log message is required."));return}Ext.getCmp("winVCSCommit").close();ui.task.PingTask.getInstance().cancel();XHR({params:{task:"vcsCommit",nodes:Ext.util.JSON.encode(c),logMessage:e},success:function(h){var i=Ext.util.JSON.decode(h.responseText);ui.task._VCSCommitTask.afterCommit(i.mess)},failure:function(h){var i=Ext.util.JSON.decode(h.responseText);if(i&&i.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._VCSCommitTask.poll.delay(5000)}}})};ui.task.VCSCommitTask=function(){if(PhDOE.userLogin==="anonymous"){Ext.getCmp("winVCSCommit").close();PhDOE.winForbidden();return}var c=Ext.getCmp("commit-tree-panel").getChecked(),k=[],p,m,r,d,o,f,e,q,l="",h,g;for(h=0;h<c.length;++h){p=c[h].attributes;m="AF-"+Ext.util.md5("AF-"+p.FilePath+p.FileName);r="FE-"+Ext.util.md5("FE-"+p.FilePath+p.FileName);d="FNU-"+Ext.util.md5("FNU-"+p.FilePath+p.FileName);o="FNIEN-"+Ext.util.md5("FNIEN-"+p.FilePath+p.FileName);f="FNR-"+Ext.util.md5("FNR-"+p.FilePath+p.FileName);e="FNT-"+Ext.util.md5("FNT-"+p.FilePath+p.FileName);if(Ext.getCmp("main-panel").findById(m)||Ext.getCmp("main-panel").findById(r)||Ext.getCmp("main-panel").findById(o)||Ext.getCmp("main-panel").findById(d)||Ext.getCmp("main-panel").findById(f)||Ext.getCmp("main-panel").findById(e)){if(Ext.getCmp("main-panel").findById(m)){q=m}if(Ext.getCmp("main-panel").findById(r)){q=r}if(Ext.getCmp("main-panel").findById(d)){q=d}if(Ext.getCmp("main-panel").findById(o)){q=o}if(Ext.getCmp("main-panel").findById(f)){q=f}if(Ext.getCmp("main-panel").findById(e)){q=e}k.push([q,p.FileName])}}if(k.length>0){for(g=0;g<k.length;++g){l+=k[g][1]+"<br/>"}Ext.MessageBox.show({title:"Warning",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,msg:(k.length>1)?String.format(_("There are {0} files to close before commit.<br><br>{1}<br/><br/>Would you like me to close them for you ?"),k.length,l):String.format(_("There is {0} file to close before commit.<br><br>{1}<br/><br/>Would you like me to close it for you ?"),k.length,l),fn:function(s){if(s==="yes"){for(var i=0;i<k.length;++i){Ext.getCmp("main-panel").remove(k[i][0])}ui.task._VCSCommitTask.commit(c)}}})}else{ui.task._VCSCommitTask.commit(c)}};Ext.namespace("ui","ui.component");ui.component.About=Ext.extend(Ext.Window,{id:"win-about",iconCls:"iconHelp",layout:"fit",width:515,height:320,modal:true,plain:true,bodyStyle:"color:#000",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-about").close()}}],initComponent:function(){Ext.apply(this,{title:String.format(_("About {0}"),PhDOE.appName),items:{xtype:"tabpanel",activeTab:0,autoTabs:true,border:false,defaults:{autoScroll:true},items:[{title:_("About"),html:'<div id="phd-oe-about"><img src="themes/img/php.png" class="loading-php-logo" alt="PHP" />'+PhDOE.appName+'</div><div id="phd-oe-about-info">'+PhDOE.appName+" ver "+PhDOE.appVer+"<br/>UI: "+PhDOE.uiRevision+"<br/> Copyright &copy; 2008-2010 The PHP Group<br/>"+_("Author:")+' <a href="mailto:yannick@php.net">Yannick Torr&egrave;s</a> '+_('and <a href="http://svn.php.net/viewvc/web/doc-editor/" target="_blank">others</a>')+"</div>"},{title:_("Credits"),bodyStyle:"padding:15px",html:'<div id="phd-oe-credit"><ul><li><a href="http://extjs.com" target="_blank">ExtJs Team</a><div class="phd-oe-credit-info">'+_("Javascript FrameWork")+'</div></li><li><a href="http://marijn.haverbeke.nl/codemirror/" target="_blank">CodeMirror</a><div class="phd-oe-credit-info">'+_("Code editor")+'</div></li><li><a href="http://www.oxygen-icons.org/" target="_blank">Oxygen project from KDE</a><div class="phd-oe-credit-info">'+_("Icon pack")+"</div></li></ul></div>"},{title:_("License"),autoLoad:{url:"./LICENSE"}}]}});ui.component.About.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._BuildStatus");ui.component._BuildStatus.display=function(c){Ext.apply(this,c);if(Ext.getCmp("main-panel").findById("last_failed_build_"+this.lang)){Ext.getCmp("main-panel").remove("last_failed_build_"+this.lang)}Ext.getCmp("main-panel").add({xtype:"panel",id:"last_failed_build_"+this.lang,title:String.format(_("Last failed build for {0}"),Ext.util.Format.uppercase(this.lang)),tabTip:String.format(_("Last failed build for the documentation {0}"),Ext.util.Format.uppercase(this.lang)),closable:true,autoScroll:true,iconCls:"iconCheckBuild",html:'<div class="check-build-content" id="check-build-content"></div>'});Ext.getCmp("main-panel").setActiveTab("last_failed_build_"+this.lang);Ext.getCmp("main-panel").el.mask(_("Please, wait..."));XHR({scope:this,params:{task:"getFailedBuildData",idFailedBuild:this.idFailedBuild},success:function(d){var e=Ext.decode(d.responseText),f=e.mess.join("<br/>");if(e.state==="truncate"){Ext.get("check-build-content").dom.innerHTML=f+'<div style="text-align: center; margin: 20px 0 20px 0" class="x-toolbar">'+_("This log is too large and have been truncated. Use the following button to download the full content of it.")+'<div id="check-build-content-download-btn"></div></div>';new Ext.Button({scope:this,text:_("Download the full content of this log"),renderTo:"check-build-content-download-btn",style:{margin:"auto"},handler:function(){window.location.href="./do/downloadFailedBuildLog?idFailedBuild="+this.idFailedBuild}})}else{Ext.get("check-build-content").dom.innerHTML=f}Ext.getCmp("main-panel").el.unmask()}})};ui.component._BuildStatus.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getFailedBuild"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"lang",mapping:"lang"},{name:"date",mapping:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]))});ui.component._BuildStatus.ds.setDefaultSort("date","desc");ui.component._BuildStatus.rendererLanguage=function(c){return'<div><div class="flags flag-'+c+'" style="float: left;"></div><div style="padding-left: 24px">'+c+"</div></div>"};ui.component._BuildStatus.columns=[{id:"date",header:_("Date"),sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Language"),width:45,sortable:true,dataIndex:"lang",renderer:ui.component._BuildStatus.rendererLanguage}];ui.component._BuildStatus.menu=Ext.extend(Ext.menu.Menu,{setRowIndex:function(c){this.rowIndex=c},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIndex,this.event)}}]});ui.component._BuildStatus.menu.superclass.initComponent.call(this)}});ui.component.BuildStatus=Ext.extend(Ext.grid.GridPanel,{loadMask:true,bodyBorder:false,autoExpandColumn:"date",store:ui.component._BuildStatus.ds,columns:ui.component._BuildStatus.columns,view:new Ext.grid.GridView({forceFit:true}),listeners:{render:function(){this.store.load.defer(20,this.store)}},onRowdblclick:function(c,g,f){var d=this.store.getAt(g);new ui.component._BuildStatus.display({idFailedBuild:d.id,lang:d.data.lang})},onRowContextMenu:function(c,f,d){if(!this.menu){this.menu=new ui.component._BuildStatus.menu({grid:c,rowIdx:"",event:d})}d.stopEvent();this.getSelectionModel().selectRow(f);this.menu.setRowIndex(f);this.menu.showAt(d.getXY())},initComponent:function(c){ui.component.BuildStatus.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowdblclick",this.onRowdblclick,this);this.on("rowcontextmenu",this.onRowContextMenu,this)}});Ext.namespace("ui","ui.component");ui.component.CheckBuildPrompt=Ext.extend(Ext.Window,{title:_("Check Build"),iconCls:"iconCheckBuild",layout:"form",width:350,height:200,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",buttons:[{id:"win-check-build-btn-submit",text:_("Go !"),handler:function(){new ui.task.CheckBuildTask();this.ownerCt.ownerCt.close()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:false,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check the build via this command:")+"<br/><br/>/usr/bin/php configure.php --with-lang="+PhDOE.userLang+'<span id="option-xml-details-span" style="color: red; visibility: hidden;"> --enable-xml-details</span><br/><div id="option-xml-details-div" style="text-align: center; color: red; visibility: hidden;">'+_("<b>WARNING !</b><br/> This option use a lot of server ressource. If you don't know what are the consequence, please, don't use it.")+"</div>"},{xtype:"checkbox",id:"option-xml-details",name:"option-xml-details",checked:false,hideLabel:true,boxLabel:_("Enable detailed XML error messages"),listeners:{check:function(e,d){Ext.get("option-xml-details-span").dom.style.visibility=(d)?"visible":"hidden";Ext.get("option-xml-details-div").dom.style.visibility=(d)?"visible":"hidden"}}}]});ui.component.CheckBuildPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._CheckDoc");ui.component._CheckDoc.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckDocData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"path",mapping:"path"},{name:"extension",mapping:"extension"},{name:"check_oldstyle",mapping:"check_oldstyle",type:"int"},{name:"check_undoc",mapping:"check_undoc",type:"int"},{name:"check_roleerror",mapping:"check_roleerror",type:"int"},{name:"check_badorder",mapping:"check_badorder",type:"int"},{name:"check_noseealso",mapping:"check_noseealso",type:"int"},{name:"check_noreturnvalues",mapping:"check_noreturnvalues",type:"int"},{name:"check_noparameters",mapping:"check_noparameters",type:"int"},{name:"check_noexamples",mapping:"check_noexamples",type:"int"},{name:"check_noerrors",mapping:"check_noerrors",type:"int"}]))});ui.component._CheckDoc.ds.setDefaultSort("extension","asc");ui.component._CheckDoc.renderer=function(d,c){if(d>0){c.css="check_doc_cell";c.attr="ext:qtip=\"<img src='themes/img/help.png' style='vertical-align: middle;' /> "+_("Double-click the cell to open the file selection")+'"';return d}else{return}};ui.component._CheckDoc.columns=[new Ext.grid.RowNumberer(),{id:"extension",header:_("Extension"),sortable:true,dataIndex:"extension"},{header:_("Not documented"),width:45,sortable:true,dataIndex:"check_undoc",renderer:ui.component._CheckDoc.renderer},{header:_("Old style"),width:45,sortable:true,dataIndex:"check_oldstyle",renderer:ui.component._CheckDoc.renderer},{header:_("Bad refsect1 order"),width:45,sortable:true,dataIndex:"check_badorder",renderer:ui.component._CheckDoc.renderer},{header:_("No parameters"),width:45,sortable:true,dataIndex:"check_noparameters",renderer:ui.component._CheckDoc.renderer},{header:_("No return values"),width:45,sortable:true,dataIndex:"check_noreturnvalues",renderer:ui.component._CheckDoc.renderer},{header:_("No examples"),width:45,sortable:true,dataIndex:"check_noexamples",renderer:ui.component._CheckDoc.renderer},{header:_("No errors section"),width:45,sortable:true,dataIndex:"check_noerrors",renderer:ui.component._CheckDoc.renderer},{header:_("No see also"),width:45,sortable:true,dataIndex:"check_noseealso",renderer:ui.component._CheckDoc.renderer},{header:_("Refsect1 role error"),width:45,sortable:true,dataIndex:"check_roleerror",renderer:ui.component._CheckDoc.renderer}];ui.component._CheckDoc.fs=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"file"}]});ui.component._CheckDoc.FileGrid=Ext.extend(Ext.grid.GridPanel,{id:"check-doc-file-grid",store:ui.component._CheckDoc.fs,loadMask:true,bodyBorder:false,autoExpandColumn:"file",sm:new Ext.grid.RowSelectionModel({}),columns:[new Ext.grid.RowNumberer(),{id:"file",header:_("Files"),sortable:true,dataIndex:"file"}],onRowClick:function(){Ext.getCmp("check-doc-btn-open-selected-files").enable()},onRowContextMenu:function(c,f,d){d.stopEvent();c.getSelectionModel().selectRow(f)},onRowDblClick:function(c,f,d){ui.component.RepositoryTree.getInstance().openFile("byPath","en"+c.fpath,c.store.getAt(f).data.file);Ext.getCmp("check-doc-file-win").close()},initComponent:function(c){ui.component._CheckDoc.FileGrid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this);this.on("rowclick",this.onRowClick,this)}});ui.component._CheckDoc.FileWin=Ext.extend(Ext.Window,{id:"check-doc-file-win",title:_("Files"),width:450,height:350,labelWidth:50,resizable:false,modal:true,autoScroll:true,layout:"fit",iconCls:"iconFiles",buttons:[{text:_("Open all files"),handler:function(){var e=Ext.getCmp("check-doc-file-win"),c=ui.component._CheckDoc.fs,d;PhDOE.AFfilePendingOpen=[];for(d=0;d<c.getCount();++d){PhDOE.AFfilePendingOpen[d]={fpath:"en"+e.fpath,fname:c.getAt(d).data.file}}ui.component.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();e.close()}},{text:_("Open selected files"),id:"check-doc-btn-open-selected-files",disabled:true,handler:function(){var e=Ext.getCmp("check-doc-file-win"),d=Ext.getCmp("check-doc-file-grid").getSelectionModel().getSelections(),c;PhDOE.AFfilePendingOpen=[];for(c=0;c<d.length;++c){PhDOE.AFfilePendingOpen[c]={fpath:"en"+e.fpath,fname:d[c].data.file}}ui.component.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();e.close()}}]});ui.component.CheckDoc=Ext.extend(Ext.grid.GridPanel,{loadMask:true,bodyBorder:false,store:ui.component._CheckDoc.ds,columns:ui.component._CheckDoc.columns,autoExpandColumn:"extension",sm:new Ext.grid.CellSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true}),listeners:{render:function(c){this.store.load.defer(20,c.store)}},onCellContextMenu:function(d,g,c,f){f.stopEvent();this.sm.select(g,c)},onCellDblClick:function(f,k,g,j){var c=this.store.getAt(k),i=this.getColumnModel().getDataIndex(g),h=c.get(i),d=c.data.path;if(Ext.num(h,false)&&h!==0){this.el.mask(_("Please, wait..."));XHR({params:{task:"getCheckDocFiles",path:d,errorType:i},success:function(e){var m=Ext.decode(e.responseText),l;ui.component._CheckDoc.fs.removeAll();for(l=0;l<m.files.length;++l){ui.component._CheckDoc.fs.insert(0,new ui.component._CheckDoc.fs.recordType({id:l,file:m.files[l].name}))}ui.component._CheckDoc.fs.sort("file","asc");f.el.unmask();new ui.component._CheckDoc.FileWin({fpath:d,items:[new ui.component._CheckDoc.FileGrid({fpath:d})]}).show()}})}},initComponent:function(c){ui.component.CheckDoc.superclass.initComponent.call(this);Ext.apply(this,c);this.on("celldblclick",this.onCellDblClick,this);this.on("cellcontextmenu",this.onCellContextMenu,this)}});Ext.namespace("ui","ui.component","ui.component._CheckEntities");ui.component._CheckEntities.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckEntitiesData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"entities",mapping:"entities"},{name:"url",mapping:"url"},{name:"result",mapping:"result"},{name:"date",mapping:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]))});ui.component._CheckEntities.ds.setDefaultSort("entities","asc");ui.component._CheckEntities.rendererEntities=function(d,c){return"&"+d+";"};ui.component._CheckEntities.columns=[new Ext.grid.RowNumberer(),{id:"entities",header:_("Entities"),sortable:true,dataIndex:"entities",width:30,renderer:ui.component._CheckEntities.rendererEntities},{header:_("Url"),sortable:true,dataIndex:"url"},{header:_("Result"),width:30,sortable:true,dataIndex:"result"},{header:_("Date"),width:30,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.component.CheckEntities=Ext.extend(Ext.grid.GridPanel,{id:"check-entities-grid",loadMask:true,bodyBorder:false,store:ui.component._CheckEntities.ds,columns:ui.component._CheckEntities.columns,autoExpandColumn:"url",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true}),onRender:function(d,c){ui.component.CheckEntities.superclass.onRender.call(this,d,c);this.store.load.defer(20,this.store)},openTab:function(h){var g=this.store.getAt(h),d=g.data.url,f=Ext.util.md5(d),c="tab-check-entities-"+f,e=Ext.getCmp(c);if(!e){Ext.getCmp("main-panel").add({id:c,xtype:"panel",title:Ext.util.Format.ellipsis(d,20),tabTip:d,iconCls:"iconCheckEntities",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+c,url:d})]})}Ext.getCmp("main-panel").setActiveTab(c)},onRowdblclick:function(c,f,d){this.openTab(f)},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-checkentities",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.openTab(this.ctxRowIndex);this.menu.hide()}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxRowIndex){this.ctxRowIndex=null}this.ctxRowIndex=f;this.menu.showAt(d.getXY())},initComponent:function(c){this.tbar=[{xtype:"label",text:_("Status: ")},{xtype:"combo",typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["all",_("All status")],["FTP_CONNECT","FTP_CONNECT"],["FTP_LOGIN","FTP_LOGIN"],["FTP_NO_FILE","FTP_NO_FILE"],["HTTP_CONNECT","HTTP_CONNECT"],["HTTP_INTERNAL_ERROR","HTTP_INTERNAL_ERROR"],["HTTP_NOT_FOUND","HTTP_NOT_FOUND"],["HTTP_MOVED","HTTP_MOVED"],["HTTP_WRONG_HEADER","HTTP_WRONG_HEADER"],["SUCCESS","SUCCESS"],["UNKNOWN_HOST","UNKNOWN_HOST"]]}),value:"all",valueField:"myId",displayField:"displayText",editable:false,listeners:{select:function(g,d,e){var f=d.id;if(f==="all"){Ext.getCmp("check-entities-grid").store.clearFilter()}else{Ext.getCmp("check-entities-grid").store.filter("result",d.id)}}}}];ui.component.CheckEntities.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowdblclick,this)}});Ext.namespace("ui","ui.component");ui.component.CheckEntitiesPrompt=Ext.extend(Ext.Window,{title:_("Check Entities"),iconCls:"iconRun",id:"win-check-entities",layout:"fit",width:250,height:140,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0; text-align: center;",labelAlign:"top",closeAction:"hide",buttons:[{id:"win-check-entities-btn",text:_("Go !"),handler:function(){new ui.task.CheckEntitiesTask();Ext.getCmp("win-check-entities").hide()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:false,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check all entities.<br><br>This action takes time.")}]});ui.component.CheckEntitiesPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._CommitLogManager");ui.component._CommitLogManager.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCommitLogMessage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"text",mapping:"text"}]))});ui.component._CommitLogManager.editor=new Ext.ux.grid.RowEditor({saveText:_("Update"),cancelText:_("Cancel"),listeners:{afteredit:function(e,d,c,f){XHR({params:{task:"saveLogMessage",messID:c.data.id,mess:c.data.text},success:function(g){c.commit();PhDOE.notify("info",_("Message updated"),_("Log Message was updated successfully !"))},failure:function(g){PhDOE.winForbidden()}})}}});ui.component._CommitLogManager.cm=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{id:"log_msg",header:_("Log message"),dataIndex:"text",editor:{xtype:"textarea"},renderer:function(c){return c.split("\n").join("<br/>")}}]);ui.component._CommitLogManager.sm=new Ext.grid.RowSelectionModel({singleSelect:true});ui.component._CommitLogManager.menu=Ext.extend(Ext.menu.Menu,{setRowIdx:function(c){this.rowIdx=c},initComponent:function(c){Ext.apply(this,{items:[{scope:this,text:_("Delete this Log Message"),iconCls:"iconDelete",handler:function(){XHR({scope:this,params:{task:"deleteLogMessage",messID:ui.component._CommitLogManager.store.getAt(this.rowIdx).data.id},success:function(d){ui.component._CommitLogManager.store.remove(ui.component._CommitLogManager.store.getAt(this.rowIdx));PhDOE.notify("info",_("Message deleted"),_("Log Message was deleted successfully !"))},failure:function(d){PhDOE.winForbidden()}})}}]});ui.component._CommitLogManager.menu.superclass.initComponent.call(this)}});ui.component._CommitLogManager.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoExpandColumn:"log_msg",cm:ui.component._CommitLogManager.cm,sm:ui.component._CommitLogManager.sm,store:ui.component._CommitLogManager.store,plugins:[ui.component._CommitLogManager.editor],listeners:{render:function(c){c.store.load()}},onRowContextMenu:function(c,f,d){d.stopEvent();this.getSelectionModel().selectRow(f);if(!this.menu){this.menu=new ui.component._CommitLogManager.menu()}this.menu.setRowIdx(f);this.menu.showAt(d.getXY())},initComponent:function(c){ui.component._CommitLogManager.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onRowContextMenu,this)}});ui.component.CommitLogManager=Ext.extend(Ext.Window,{id:"commit-log-win",title:_("Manage Log Message"),iconCls:"iconWinManageLog",width:650,height:350,layout:"fit",resizable:false,modal:true,autoScroll:true,closeAction:"hide",store:ui.component._CommitLogManager.store,buttons:[{text:_("Close"),handler:function(){Ext.getCmp("commit-log-win").hide()}}],initComponent:function(){Ext.apply(this,{items:[new ui.component._CommitLogManager.grid()]});ui.component.CommitLogManager.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component");ui.component.CommitPrompt=Ext.extend(Ext.Window,{id:"winVCSCommit",layout:"form",title:_("VCS commit"),iconCls:"iconPendingCommit",closable:false,width:400,height:480,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",tools:[{id:"gear",qtip:_("Configure this tools"),handler:function(){if(!Ext.getCmp("commit-log-win")){new ui.component.CommitLogManager()}Ext.getCmp("commit-log-win").show(this.id)}}],buttons:[{id:"win-commit-btn-submit",text:_("Submit"),handler:function(){new ui.task.VCSCommitTask()}},{id:"win-commit-btn-close",text:_("Close"),handler:function(){Ext.getCmp("winVCSCommit").close()}}],initComponent:function(){var c=new Ext.tree.TreeNode({text:"root",expanded:true}),d;for(d=0;d<this.files.length;++d){c.appendChild(new Ext.tree.TreeNode({id:"need-commit-"+this.files[d].fid,text:this.files[d].fpath+this.files[d].fname,FileDBID:this.files[d].fdbid,FilePath:this.files[d].fpath,FileName:this.files[d].fname,leaf:true,checked:true}))}Ext.apply(this,{items:[{xtype:"treepanel",id:"commit-tree-panel",anchor:"100%",height:180,autoScroll:true,rootVisible:false,root:c},{xtype:"combo",name:"first2",fieldLabel:_("Older messages"),editable:false,anchor:"100%",store:ui.component._CommitLogManager.store,triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.text.split("\n").join("<br/>")]}</div></tpl>',valueField:"id",displayField:"text",listeners:{select:function(g,e,f){Ext.getCmp("form-commit-message-log").setValue(e.data.text)}}},{xtype:"textarea",id:"form-commit-message-log",name:"first3",fieldLabel:_("Log message"),anchor:"100%",height:150,value:""}]});ui.component.CommitPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._EditorConf");ui.component._EditorConf.tplMenu=new Ext.XTemplate('<tpl for=".">','<div class="menu-wrap" id="tplMenu-{id}">','<div class="menu {card}"></div>',"<span>{label}</span>","</div>","</tpl>");ui.component._EditorConf.tplMenu.compile();ui.component._EditorConf.menuDefEn=[["1","card1",_("Main")],["4","card4",_('Module "Files with Error"')],["6","card6",_('Module "All files"')],["7","card7",_('Module "Pending Patch"')]];ui.component._EditorConf.menuDefNonEn=[["1","card1",_("Main")],["2","card2",_('Module "Files Need Translate"')],["3","card3",_('Module "Files Need Update"')],["4","card4",_('Module "Files with Error"')],["5","card5",_('Module "Files need Reviewed"')],["6","card6",_('Module "All files"')],["7","card7",_('Module "Pending Patch"')]];ui.component._EditorConf.menuStore=new Ext.data.SimpleStore({id:0,fields:[{name:"id"},{name:"card"},{name:"label"}]});ui.component._EditorConf.viewMenu=Ext.extend(Ext.DataView,{id:"conf-menu-view",tpl:ui.component._EditorConf.tplMenu,singleSelect:true,overClass:"x-view-over",itemSelector:"div.menu-wrap",store:ui.component._EditorConf.menuStore,listeners:{selectionchange:function(c){var d=c.getSelectedRecords();Ext.getCmp("confCard").layout.setActiveItem("conf-card-"+d[0].data.id)}}});ui.component._EditorConf.themeStore=new Ext.data.SimpleStore({fields:["themeFile",{name:"themeName",type:"string"}],data:[["themes/ExtJsThemes/black/css/xtheme-black.css",_("Black")],["themes/empty.css",_("Default")],["themes/ExtJsThemes/darkgray/css/xtheme-darkgray.css",_("DarkGray")],["http://extjs.cachefly.net/ext-3.2.0/resources/css/xtheme-gray.css",_("Gray")],["themes/ExtJsThemes/gray-extend/css/xtheme-gray-extend.css",_("Gray Extend")],["themes/ExtJsThemes/indigo/css/xtheme-indigo.css",_("Indigo")],["themes/ExtJsThemes/midnight/css/xtheme-midnight.css",_("Midnight")],["themes/ExtJsThemes/olive/css/xtheme-olive.css",_("Olive")],["themes/ExtJsThemes/purple/css/xtheme-purple.css",_("Purple")],["themes/ExtJsThemes/silverCherry/css/xtheme-silverCherry.css",_("SilverCherry")],["themes/ExtJsThemes/ubuntu_human/css/xtheme-human.css",_("Ubuntu Human")]]});ui.component._EditorConf.CommitChange=new Ext.util.DelayedTask(function(){new ui.task.UpdateConfTask({item:this.name,value:this.getValue()})});ui.component._EditorConf.card1=Ext.extend(Ext.TabPanel,{id:"conf-card-1",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("Main Menu"),iconCls:"iconMenu",items:[{xtype:"spinnerfield",width:60,name:"mainAppMainMenuWidth",value:PhDOE.userConf.mainAppMainMenuWidth||300,fieldLabel:_("Main Menu width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){var c=Ext.getCmp("main-menu-panel"),d=this.getValue();PhDOE.userConf.mainAppMainMenuWidth=d;c.setWidth(d);c.ownerCt.doLayout();ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){var c=Ext.getCmp("main-menu-panel"),d=this.getValue();PhDOE.userConf.mainAppMainMenuWidth=d;c.setWidth(d);c.ownerCt.doLayout();ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]},{xtype:"fieldset",iconCls:"iconThemes",title:_("Appearance"),items:[{xtype:"combo",fieldLabel:_("Choose a theme"),id:"conf-combo-theme",valueField:"themeFile",displayField:"themeName",triggerAction:"all",mode:"local",forceSelection:true,editable:false,value:PhDOE.userConf.theme,store:ui.component._EditorConf.themeStore,listeners:{render:function(){Ext.getCmp("conf-combo-theme").store.sort("themeName")},select:function(e){var d=e.getValue();Ext.get("appTheme").dom.href=d;new ui.task.UpdateConfTask({item:"theme",value:d})}}}]},{xtype:"fieldset",title:_("On save file"),iconCls:"iconSaveFile",autoHeight:true,defaults:{hideLabel:true},defaultType:"radio",items:[{autoHeight:true,name:"onSaveFile",checked:(PhDOE.userConf.onSaveFile==="ask-me")?true:false,boxLabel:_("Ask me if I want to check for error before saving the file"),inputValue:"ask-me",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({item:"onSaveFile",value:c.getRawValue()})}}}},{autoHeight:true,name:"onSaveFile",checked:(PhDOE.userConf.onSaveFile==="always")?true:false,boxLabel:_("Always check for error before saving the file"),inputValue:"always",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({item:"onSaveFile",value:c.getRawValue()})}}}},{autoHeight:true,name:"onSaveFile",checked:(PhDOE.userConf.onSaveFile==="never")?true:false,boxLabel:_("Never check for error before saving the file"),inputValue:"never",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({item:"onSaveFile",value:c.getRawValue()})}}}}]}]},{title:_("External Data"),iconCls:"iconExternalData",items:[{xtype:"fieldset",title:_("About mails"),iconCls:"iconMailing",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"mainAppLoadMailsAtStartUp",checked:PhDOE.userConf.mainAppLoadMailsAtStartUp,boxLabel:_("Load Mails at startUp"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"mainAppLoadMailsAtStartUp",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("About bugs"),iconCls:"iconBugs",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"mainAppLoadBugsAtStartUp",checked:PhDOE.userConf.mainAppLoadBugsAtStartUp,boxLabel:_("Load Bugs at startUp"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"mainAppLoadBugsAtStartUp",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card1.superclass.initComponent.call(this)}});ui.component._EditorConf.card2=Ext.extend(Ext.TabPanel,{id:"conf-card-2",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},items:[{xtype:"spinnerfield",width:60,name:"newFileNbDisplay",value:PhDOE.userConf.newFileNbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"newFileScrollbars",checked:PhDOE.userConf.newFileScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"newFileScrollbars",value:c.getValue()})}}}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"newFileSpellCheck",checked:PhDOE.userConf.newFileSpellCheck,boxLabel:_("Enable spellChecking"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"newFileSpellCheck",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card2.superclass.initComponent.call(this)}});ui.component._EditorConf.card3=Ext.extend(Ext.TabPanel,{id:"conf-card-3",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},defaultType:"spinnerfield",items:[{width:60,name:"needUpdateNbDisplay",value:PhDOE.userConf.needUpdateNbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdateScrollbars",checked:PhDOE.userConf.needUpdateScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"needUpdateScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("VCS Log"),iconCls:"iconVCSLog",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdateDisplaylog",checked:PhDOE.userConf.needUpdateDisplaylog,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"needUpdateDisplaylog",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.needUpdateDisplaylogPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"needUpdateDisplaylogPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"needUpdateDisplaylogPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdateDisplaylogPanelWidth",value:PhDOE.userConf.needUpdateDisplaylogPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Diff view"),iconCls:"iconDiffView",defaults:{hideLabel:true},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.needUpdateDiffPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"needUpdateDiffPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"needUpdateDiffPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdateDiffPanelHeight",value:PhDOE.userConf.needUpdateDiffPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]},{name:"needUpdateDiff",checked:(PhDOE.userConf.needUpdateDiff==="using-viewvc")?true:false,boxLabel:_("Using ViewVc from php web site"),inputValue:"using-viewvc",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({item:"needUpdateDiff",value:c.getRawValue()})}}}},{name:"needUpdateDiff",checked:(PhDOE.userConf.needUpdateDiff==="using-exec")?true:false,boxLabel:_("Using diff -u command line"),inputValue:"using-exec",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({item:"needUpdateDiff",value:c.getRawValue()})}}}}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdateSpellCheckEn",checked:PhDOE.userConf.needUpdateSpellCheckEn,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"needUpdateSpellCheckEn",value:c.getValue()})}}},{name:"needUpdateSpellCheckLang",checked:PhDOE.userConf.needUpdateSpellCheckLang,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.userLang)),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"needUpdateSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card3.superclass.initComponent.call(this)}});ui.component._EditorConf.card4=Ext.extend(Ext.TabPanel,{id:"conf-card-4",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{hidden:(PhDOE.userLang==="en"),xtype:"fieldset",title:_("Error type"),iconCls:"iconFilesError",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"errorSkipNbLiteralTag",checked:PhDOE.userConf.errorSkipNbLiteralTag,boxLabel:_("Skip nbLiteralTag error"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorSkipNbLiteralTag",value:c.getValue()})}}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"errorScrollbars",checked:PhDOE.userConf.errorScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"errorLogLoadData",checked:PhDOE.userConf.errorLogLoadData,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorLogLoadData",value:c.getValue()})}}},{name:"errorEntitiesLoadData",checked:PhDOE.userConf.errorEntitiesLoadData,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorEntitiesLoadData",value:c.getValue()})}}},{name:"errorAcronymsLoadData",checked:PhDOE.userConf.errorAcronymsLoadData,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorAcronymsLoadData",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.errorDisplaylogPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"errorDisplaylogPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"errorDisplaylogPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"errorDisplaylogPanelWidth",value:PhDOE.userConf.errorDisplaylogPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Error description"),iconCls:"iconFilesError",defaults:{hideLabel:true},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.errorDescPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"errorDescPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"errorDescPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"errorDescPanelHeight",value:PhDOE.userConf.errorDescPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{hidden:(PhDOE.userLang==="en"),name:"errorSpellCheckEn",checked:PhDOE.userConf.errorSpellCheckEn,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorSpellCheckEn",value:c.getValue()})}}},{name:"errorSpellCheckLang",checked:PhDOE.userConf.errorSpellCheckLang,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.userLang)),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"errorSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card4.superclass.initComponent.call(this)}});ui.component._EditorConf.card5=Ext.extend(Ext.TabPanel,{id:"conf-card-5",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},defaultType:"spinnerfield",items:[{width:60,name:"reviewedNbDisplay",value:PhDOE.userConf.reviewedNbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:"User Interface",iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewedScrollbars",checked:PhDOE.userConf.reviewedScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"reviewedScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("VCS Log"),iconCls:"iconVCSLog",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewedDisplaylog",checked:PhDOE.userConf.reviewedDisplaylog,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"reviewedDisplaylog",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.reviewedDisplaylogPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"reviewedDisplaylogPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"reviewedDisplaylogPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"reviewedDisplaylogPanelWidth",value:PhDOE.userConf.reviewedDisplaylogPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:"Editor",iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewedSpellCheckEn",checked:PhDOE.userConf.reviewedSpellCheckEn,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"reviewedSpellCheckEn",value:c.getValue()})}}},{name:"reviewedSpellCheckLang",checked:PhDOE.userConf.reviewedSpellCheckLang,boxLabel:String.format(_("Enable spellChecking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.userLang)),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"reviewedSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card5.superclass.initComponent.call(this)}});ui.component._EditorConf.card6=Ext.extend(Ext.TabPanel,{id:"conf-card-6",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"allFilesDisplayLog",checked:PhDOE.userConf.allFilesDisplayLog,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"allFilesDisplayLog",value:c.getValue()})}}},{name:"allFilesEntitiesLoadData",checked:PhDOE.userConf.allFilesEntitiesLoadData,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"allFilesEntitiesLoadData",value:c.getValue()})}}},{name:"allFilesAcronymsLoadData",checked:PhDOE.userConf.allFilesAcronymsLoadData,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"allFilesAcronymsLoadData",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.allFilesDisplaylogPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"allFilesDisplaylogPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"allFilesDisplaylogPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"allFilesDisplaylogPanelWidth",value:PhDOE.userConf.allFilesDisplaylogPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"allFilesSpellCheck",checked:PhDOE.userConf.allFilesSpellCheck,boxLabel:_("Enable spellChecking"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"allFilesSpellCheck",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card6.superclass.initComponent.call(this)}});ui.component._EditorConf.card7=Ext.extend(Ext.TabPanel,{id:"conf-card-7",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"patchScrollbars",checked:PhDOE.userConf.patchScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"patchScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("VCS Log"),iconCls:"iconVCSLog",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"patchDisplaylog",checked:PhDOE.userConf.patchDisplaylog,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"patchDisplaylog",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.patchDisplaylogPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"patchDisplaylogPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"patchDisplaylogPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"patchDisplaylogPanelWidth",value:PhDOE.userConf.patchDisplaylogPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Patch content"),iconCls:"iconPendingPatch",defaults:{hideLabel:true},defaultType:"checkbox",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.userConf.patchDisplayContentPanel,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({item:"patchDisplayContentPanel",value:false})},expand:function(){new ui.task.UpdateConfTask({item:"patchDisplayContentPanel",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"patchDisplayContentPanelHeight",value:PhDOE.userConf.patchDisplayContentPanelHeight||375,fieldLabel:_("Panel height"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.component._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"patchSpellCheck",checked:PhDOE.userConf.patchSpellCheck,boxLabel:_("Enable spellChecking"),listeners:{check:function(c){new ui.task.UpdateConfTask({item:"patchSpellCheck",value:c.getValue()})}}}]}]}]});ui.component._EditorConf.card7.superclass.initComponent.call(this)}});ui.component.EditorConf=Ext.extend(Ext.Window,{id:"win-conf",layout:"border",width:700,height:470,iconCls:"iconConf",title:_("Configuration"),modal:true,plain:true,bodyBorder:false,closeAction:"hide",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-conf").hide()}}],listeners:{show:function(){var c=Ext.getCmp("conf-menu-view");c.select(c.getNode(0))}},initComponent:function(){if(PhDOE.userLang==="en"){ui.component._EditorConf.menuStore.loadData(ui.component._EditorConf.menuDefEn)}else{ui.component._EditorConf.menuStore.loadData(ui.component._EditorConf.menuDefNonEn)}Ext.apply(this,{items:[{id:"confMenu",region:"west",border:false,width:190,autoScroll:true,items:[new ui.component._EditorConf.viewMenu()]},{id:"confCard",region:"center",border:false,layout:"card",width:375,frame:true,activeItem:0,bbar:new Ext.ux.StatusBar({defaultText:_("All changes take effect immediately"),defaultIconCls:"confStatusBar"}),items:[new ui.component._EditorConf.card1(),new ui.component._EditorConf.card2(),new ui.component._EditorConf.card3(),new ui.component._EditorConf.card4(),new ui.component._EditorConf.card5(),new ui.component._EditorConf.card6(),new ui.component._EditorConf.card7()]}]});ui.component.EditorConf.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._EmailPrompt");ui.component.EmailPrompt=Ext.extend(Ext.Window,{title:_("Send an email"),width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",iconCls:"iconSendEmail",closeAction:"hide",buttons:[{text:_("Send"),handler:function(){var d=this.ownerCt.ownerCt,c=d.findByType("form").shift().getForm().getValues();XHR({params:{task:"sendEmail",to:c.to,subject:c.subject,msg:c.msg},success:function(e){d.hide();Ext.Msg.alert(_("Status"),String.format(_("Email sent to {0} with success!"),d.name),Ext.emptyFn)}})}},{text:_("Cancel"),handler:function(){this.ownerCt.ownerCt.hide()}}],setData:function(d,c){this.name=d;this.email=c;this.items.items[0].items.items[0].setValue('"'+this.name+'" <'+this.email+">");this.items.items[0].items.items[1].setValue("");this.items.items[0].items.items[2].setValue("")},initComponent:function(){Ext.apply(this,{items:new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,defaultType:"textfield",items:[{name:"to",fieldLabel:_("Send To"),readOnly:true,anchor:"100%",value:""},{name:"subject",fieldLabel:_("Subject"),anchor:"100%"},{name:"msg",xtype:"textarea",hideLabel:true,anchor:"100% -53"}]})});ui.component.EmailPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._EntitiesAcronymsPanel");ui.component._EntitiesAcronymsPanel.grid=Ext.extend(Ext.grid.GridPanel,{onRowClick:function(c,d,g){var f=c.getSelectionModel().getSelected().data;Ext.getCmp(this.dataType+"-details-"+this.fid).update(f.value)},onRowDblClick:function(d,g,i){var h=d.getSelectionModel().getSelected().data,f=Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid),c=Ext.util.JSON.decode(f.getCursorPosition()),j=(this.dataType=="entities")?"&"+h.items+";":"<acronym>"+h.items+"</acronym>";f.insertIntoLine(c.line,c.caracter,j)},initComponent:function(){var c;if(this.dataType=="entities"){c="./do/getEntities"}else{if(this.dataType=="acronyms"){c="./do/getAcronyms"}}Ext.apply(this,{region:"center",split:true,loadMask:true,autoScroll:true,bodyBorder:false,border:false,autoExpandColumn:this.dataType,columns:[{id:"items",header:_("Items"),sortable:true,dataIndex:"items"},{header:_("From"),sortable:true,dataIndex:"from",width:50}],viewConfig:{forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:false},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),store:new Ext.data.Store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:c}),listeners:{scope:this,load:function(){if(this.dataType=="entities"){Ext.getCmp(this.prefix+"-"+this.fid).panEntities=true}else{if(this.dataType=="acronyms"){Ext.getCmp(this.prefix+"-"+this.fid).panAcronyms=true}}Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"from",mapping:"from"},{name:"items",mapping:"items"},{name:"value",mapping:"value"}]))}),tbar:[{scope:this,tooltip:_("<b>Load/Refresh</b>"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},_("Filter: ")," ",new Ext.form.TwinTriggerField({width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(f,d){if(d.getKey()==d.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);this.ownerCt.ownerCt.store.clearFilter()},onTrigger2Click:function(){var d=this.getValue();if(d===""||d.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);this.ownerCt.ownerCt.store.filter("entities",d,true)}})]});ui.component._EntitiesAcronymsPanel.grid.superclass.initComponent.call(this);this.on("rowclick",this.onRowClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component.EntitiesAcronymsPanel=Ext.extend(Ext.Panel,{initComponent:function(){var c;if(this.dataType=="entities"){c=_("Click on a row to display the content of the entitie.<br>Double-click on it to insert it at the cursor position.")}else{if(this.dataType=="acronyms"){c=_("Click on a row to display the content of the acronym.<br>Double-click on it to insert it at the cursor position.")}}Ext.apply(this,{layout:"border",border:false,items:[new ui.component._EntitiesAcronymsPanel.grid({dataType:this.dataType,prefix:this.prefix,fid:this.fid,ftype:this.ftype,loadStore:this.loadStore}),{xtype:"panel",id:this.dataType+"-details-"+this.fid,region:"south",split:true,height:100,autoScroll:true,bodyBorder:false,bodyCssClass:this.dataType+"-details",html:c}]});ui.component.EntitiesAcronymsPanel.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._ErrorFileGrid");ui.component._ErrorFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesError"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"maintainer"},{name:"type"},{name:"value_en"},{name:"value_lang"},{name:"needcommit"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-error-nb").innerHTML=c.getCount()}}});ui.component._ErrorFileGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Type"),width:45,sortable:true,dataIndex:"type"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._ErrorFileGrid.view=new Ext.grid.GroupingView({emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",deferEmptyText:false,forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data.path]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(c){if(c.data.needcommit){return"file-need-commit"}return false}});ui.component._ErrorFileGrid.menu=function(c){Ext.apply(this,c);this.init();ui.component._ErrorFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.component._ErrorFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconFilesError",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideCommit,text:("View Diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+this.rowIdx,title:_("Diff"),tabTip:_("Diff"),closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+this.rowIdx+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+this.rowIdx);Ext.get("diff_panel_"+this.rowIdx).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" />'+_("Please, wait..."));XHR({scope:this,params:{task:"getDiff",DiffType:"file",FilePath:this.lang+this.fpath,FileName:this.fname},success:function(c){var d=Ext.util.JSON.decode(c.responseText);Ext.get("diff_content_"+this.rowIdx).dom.innerHTML=d.content;Ext.get("diff_panel_"+this.rowIdx).unmask()}})}},"-",{text:_("About error type"),iconCls:"iconHelp",handler:function(){if(!Ext.getCmp("main-panel").findById("FE-help")){Ext.getCmp("main-panel").add({id:"FE-help",title:_("About error type"),iconCls:"iconHelp",closable:true,autoScroll:true,autoLoad:"./error"})}Ext.getCmp("main-panel").setActiveTab("FE-help")}}]})}});ui.component.ErrorFileGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",view:ui.component._ErrorFileGrid.view,columns:ui.component._ErrorFileGrid.columns,listeners:{render:function(c){c.view.refresh()}},onRowContextMenu:function(d,h,g){g.stopEvent();var f=d.store.getAt(h).data.path,c=d.store.getAt(h).data.name;d.getSelectionModel().selectRow(h);new ui.component._ErrorFileGrid.menu({hideCommit:(d.store.getAt(h).data.needcommit===false),grid:d,event:g,rowIdx:h,lang:PhDOE.userLang,fpath:f,fname:c}).showAt(g.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(i){var g=this.store.getById(i),f=g.data.path,c=g.data.name,h=Ext.util.md5("FE-"+PhDOE.userLang+f+c),d=[],j,e;if(!Ext.getCmp("main-panel").findById("FE-"+h)){d=[];this.store.each(function(k){if(k.data.path===f&&k.data.name===c&&!d[k.data.type]){d.push(k.data.type)}});j=(PhDOE.userLang==="en")?[new ui.component.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.userLang.ucFirst()),prefix:"FE-LANG",fid:h,fpath:PhDOE.userLang+f,fname:c,loadStore:PhDOE.userConf.errorLogLoadData})]:[new ui.component.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.userLang.ucFirst()),prefix:"FE-LANG",fid:h,fpath:PhDOE.userLang+f,fname:c,loadStore:PhDOE.userConf.errorLogLoadData}),new ui.component.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FE-EN",fid:h,fpath:"en"+f,fname:c,loadStore:PhDOE.userConf.errorLogLoadData})];e=(PhDOE.userLang==="en")?[new ui.component.FilePanel({id:"FE-LANG-PANEL-"+h,region:"center",title:String.format(_("{0} File: "),PhDOE.userLang)+f+c,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.userConf.errorSpellCheckLang,spellCheckConf:"errorSpellCheckLang",fid:h,fpath:f,fname:c,lang:PhDOE.userLang,parser:"xml",storeRecord:g,syncScrollCB:false,syncScroll:false})]:[new ui.component.FilePanel({id:"FE-LANG-PANEL-"+h,region:"center",title:String.format(_("{0} File: "),PhDOE.userLang)+f+c,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.userConf.errorSpellCheckLang,spellCheckConf:"errorSpellCheckLang",fid:h,fpath:f,fname:c,lang:PhDOE.userLang,parser:"xml",storeRecord:g,syncScrollCB:true,syncScroll:true,syncScrollConf:"errorScrollbars"}),new ui.component.FilePanel({id:"FE-EN-PANEL-"+h,region:"east",title:_("en File: ")+f+c,prefix:"FE",ftype:"EN",spellCheck:PhDOE.userConf.errorSpellCheckEn,spellCheckConf:"errorSpellCheckEn",fid:h,fpath:f,fname:c,lang:"en",parser:"xml",storeRecord:g,syncScroll:true,syncScrollConf:"errorScrollbars"})];Ext.getCmp("main-panel").add({id:"FE-"+h,title:c,layout:"border",iconCls:"iconTabError",closable:true,tabLoaded:false,panVCSLang:!PhDOE.userConf.errorDisplayLog,panVCSEn:(PhDOE.userLang==="en")?true:!PhDOE.userConf.errorDisplayLog,panLANGLoaded:false,panENLoaded:(PhDOE.userLang==="en")?true:false,originTitle:c,defaults:{split:true},tabTip:String.format(_("File with error : in {0}"),f),listeners:{resize:function(k){(PhDOE.userLang!=="en")?Ext.getCmp("FE-EN-PANEL-"+h).setWidth(k.getWidth()/2):""}},items:[{xtype:"panel",id:"FE-error-desc-"+h,region:"north",layout:"fit",title:_("Error description"),iconCls:"iconFilesError",collapsedIconCls:"iconFilesError",plugins:[Ext.ux.PanelCollapsedTitle],height:PhDOE.userConf.errorDescPanelHeight||150,collapsible:true,collapsed:!PhDOE.userConf.errorDescPanel,autoScroll:true,autoLoad:"./error?dir="+f+"&file="+c,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"errorDescPanel",value:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"errorDescPanel",value:true})}},resize:function(m,k,l){if(this.ownerCt.tabLoaded&&l&&l>50&&l!=PhDOE.userConf.errorDescPanelHeight){new ui.task.UpdateConfTask({item:"errorDescPanelHeight",value:l})}}}},{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:true,collapsed:!PhDOE.userConf.errorLogPanel,layout:"fit",bodyBorder:false,width:PhDOE.userConf.errorLogPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"errorLogPanel",value:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"errorLogPanel",value:true})}},resize:function(k,l){if(this.ownerCt.tabLoaded&&l&&l!=PhDOE.userConf.errorLogPanelWidth){new ui.task.UpdateConfTask({item:"errorLogPanelWidth",value:l})}}},items:{xtype:"tabpanel",activeTab:0,defaults:{autoScroll:true},items:[j,{title:_("Entities"),layout:"fit",items:[new ui.component.EntitiesAcronymsPanel({dataType:"entities",prefix:"FE",ftype:"LANG",fid:h,loadStore:PhDOE.userConf.errorEntitiesLoadData})]},{title:_("Acronyms"),layout:"fit",items:[new ui.component.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"FE",ftype:"LANG",fid:h,loadStore:PhDOE.userConf.errorAcronymsLoadData})]}]}},e]})}Ext.getCmp("main-panel").setActiveTab("FE-"+h)},initComponent:function(){Ext.apply(this,{store:ui.component._ErrorFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FE-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(d,c){if(c.getKey()===c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.component._ErrorFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue();if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);ui.component._ErrorFileGrid.instance.store.filter("maintainer",c)}})]});ui.component.ErrorFileGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this);if(PhDOE.userLang==="en"){this.getColumnModel().setHidden(2,true)}}});ui.component._ErrorFileGrid.instance=null;ui.component.ErrorFileGrid.getInstance=function(c){if(!ui.component._ErrorFileGrid.instance){if(!c){c={}}ui.component._ErrorFileGrid.instance=new ui.component.ErrorFileGrid(c)}return ui.component._ErrorFileGrid.instance};Ext.namespace("ui","ui.component");ui.component.ExecDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",autoScroll:true,plugins:[Ext.ux.PanelCollapsedTitle],onRender:function(d,c){ui.component.ExecDiff.superclass.onRender.call(this,d,c);this.el.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));XHR({scope:this,params:{task:"getDiff",DiffType:"vcs",FilePath:"en"+this.fpath,FileName:this.fname,Rev1:this.rev1,Rev2:this.rev2},success:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.get(this.prefix+"-diff-"+this.fid).dom.innerHTML=f.content;this.el.unmask()},callback:function(){Ext.getCmp(this.prefix+"-"+this.fid).panDiffLoaded=true;Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})},initComponent:function(){Ext.apply(this,{html:'<div id="'+this.prefix+"-diff-"+this.fid+'" class="diff-content"></div>'});ui.component.ExecDiff.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._FilePanel");Ext.namespace("ui.component._FilePanel.tbar.menu");Ext.namespace("ui.component._FilePanel.tbar.items");ui.component._FilePanel.tbar.items.undoRedo=function(c){Ext.apply(this,c);this.init();ui.component._FilePanel.tbar.items.undoRedo.superclass.constructor.call(this)};Ext.extend(ui.component._FilePanel.tbar.items.undoRedo,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{id:this.id_prefix+"-FILE-"+this.fid+"-btn-undo",scope:this,tooltip:_("<b>Undo</b>"),disabled:true,iconCls:"iconUndo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).undo(this.id_prefix,this.fid)}},{id:this.id_prefix+"-FILE-"+this.fid+"-btn-redo",scope:this,tooltip:_("<b>Redo</b>"),disabled:true,iconCls:"iconRedo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).redo(this.id_prefix,this.fid)}}]})}});ui.component._FilePanel.tbar.items.common=function(c){Ext.apply(this,c);this.init();ui.component._FilePanel.tbar.items.common.superclass.constructor.call(this)};Ext.extend(ui.component._FilePanel.tbar.items.common,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{scope:this,tooltip:_("Close Tab"),iconCls:"iconClose",handler:function(){Ext.getCmp("main-panel").remove(this.prefix+"-"+this.fid)}},{id:this.prefix+"-"+this.fid+"-btn-tabLeft-"+this.ftype,scope:this,tooltip:_("Go to previous tab"),iconCls:"iconArrowLeft",handler:this.goToPreviousTab},{id:this.prefix+"-"+this.fid+"-btn-tabRight-"+this.ftype,scope:this,tooltip:_("Go to next tab"),disabled:true,iconCls:"iconArrowRight",handler:this.goToNextTab}]})}});ui.component._FilePanel.tbar.menu.lang=function(c){Ext.apply(this,c);this.init();ui.component._FilePanel.tbar.menu.lang.superclass.constructor.call(this)};Ext.extend(ui.component._FilePanel.tbar.menu.lang,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Reviewed tag"),handler:function(){Ext.getCmp(this.comp_id).insertIntoLine(2,"end","\n<!-- Reviewed: no -->");Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Revcheck tag"),handler:function(){Ext.getCmp(this.comp_id).insertIntoLine(2,"end","\n<!-- EN-Revision: XX Maintainer: "+PhDOE.userLogin+" Status: ready -->");Ext.getCmp(this.comp_id).focus()}}]})})}});ui.component._FilePanel.tbar.menu.en=function(c){Ext.apply(this,c);this.init();ui.component._FilePanel.tbar.menu.en.superclass.constructor.call(this)};Ext.extend(ui.component._FilePanel.tbar.menu.en,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Description section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,[' <refsect1 role="description"><!-- {{{ -->\r\n  ',"&reftitle.description;\r\n  ","<methodsynopsis>\r\n   ","<!-- Example: All functions have this -->\r\n   ","<type>thereturned type</type><methodname>func_name</methodname>\r\n   ","<!-- Example: Required parameter -->\r\n   ","<methodparam><type>param1type</type><parameter>firstparameter</parameter></methodparam>\r\n   ","<!-- Example: Optional parameter, also by reference -->\r\n   ",'<methodparam choice="opt"><type>int</type><parameter role="reference">secondparameter</parameter></methodparam>\r\n   ',"<!-- Example: If no methodparams exist (void), use this -->\r\n   ","<void />\r\n  ","</methodsynopsis>\r\n  ","<para>\r\n   ","The function description goes here.\r\n  ","</para>\r\n ","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Parameters section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="parameters"><!-- {{{ -->\r\n',"&reftitle.parameters;\r\n","<para>\r\n","<variablelist>\r\n","<varlistentry>\r\n","<term><parameter>firstparameter</parameter></term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","<varlistentry>\r\n","<term>\r\n","<parameter>secondparameter</parameter>\r\n","</term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","</variablelist>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Return section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="returnvalues"><!-- {{{ -->\r\n',"&reftitle.returnvalues;\r\n","<para>\r\n","What this function returns, first on success, then failure.\r\n","If simply true on success and false on failure, just use &return.success; here.\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Error section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="errors"><!-- {{{ -->\r\n',"&reftitle.errors;\r\n","<para>\r\n","When does this function issue E_* level errors, and/or throw exceptions.\r\n","</para>\r\n","</refsect1><!-- }}} -->\r\n"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Unicode section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="unicode"><!-- {{{ -->\r\n',"&reftitle.unicode;\r\n","<para>\r\n","Information specific to unicode, from the PHP 6 changes.\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Changelog section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="changelog"><!-- {{{ -->\r\n',"&reftitle.changelog;\r\n","<para>\r\n","<informaltable>\r\n",'<tgroup cols="2">\r\n',"<thead>\r\n","<row>\r\n","<entry>&Version;</entry>\r\n","<entry>&Description;</entry>\r\n","</row>\r\n","</thead>\r\n","<tbody>\r\n","<row>\r\n","<entry>Enter the version of change here</entry>\r\n","<entry>\r\n","Describe the change\r\n","</entry>\r\n","</row>\r\n","</tbody>\r\n","</tgroup>\r\n","</informaltable>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Examples section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="examples"><!-- {{{ -->\r\n',"&reftitle.examples;\r\n","<para>\r\n",'<example xml:id="function-name.example.basic"><!-- {{{ -->\r\n',"<title><function>function-name</function> example</title>\r\n","<para>\r\n","Any text that describes the purpose of the example, or what\r\n","goes on in the example should be here. (Inside the <example> tag, not out).\r\n","</para>\r\n",'<programlisting role="php">\r\n',"<![CDATA[\r\n","<?php\r\n","if ($anexample === true) {\r\n","echo 'Use the PEAR Coding standards';\r\n","}\r\n","if ($thereisoutput === 'and it is multiple lines') {\r\n","echo 'Use a screen like we did below';\r\n","}\r\n","?>\r\n","]]>\r\n","</programlisting>\r\n","&example.outputs.similar;\r\n","<screen>\r\n","<![CDATA[\r\n","Use the PEAR Coding standards\r\n","Use a screen like we did below\r\n","]]>\r\n","</screen>\r\n","</example><!-- }}} -->\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Notes section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="notes"><!-- {{{ -->\r\n',"&reftitle.notes;\r\n","<caution>\r\n","<para>\r\n","Any notes that don't fit anywhere else should go here.\r\n","90% of the time, notes, warnings or cautions are better placed in the\r\n","parameters section. Consider that before using this section!\r\n","</para>\r\n","</caution>\r\n","&note.language-construct;\r\n","&note.not-bin-safe;\r\n","&note.registerglobals;\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("SeeAlso section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="seealso"><!-- {{{ -->\r\n',"&reftitle.seealso;\r\n","<para>\r\n","<simplelist>\r\n","<member><function>somefunc</function></member>\r\n","<member><function>another_func</function></member>\r\n",'<member>The <link linkend="something">something appendix</link></member>\r\n',"</simplelist>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}}]})})}});ui.component._FilePanel.tbar.items.reindentTags=function(c){Ext.apply(this,c);this.init();ui.component._FilePanel.tbar.items.reindentTags.superclass.constructor.call(this)};Ext.extend(ui.component._FilePanel.tbar.items.reindentTags,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{scope:this,tooltip:_("<b>Enable / Disable</b> spellChecking"),enableToggle:true,iconCls:"iconSpellCheck",pressed:PhDOE.userConf[this.spellCheckConf],handler:function(c){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).setSpellcheck(c.pressed);new ui.task.UpdateConfTask({item:this.spellCheckConf,value:c.pressed,notify:false})}},{scope:this,tooltip:_("<b>Re-indent</b> all this file"),iconCls:"iconIndent",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).reIndentAll()}},(this.lang==="en")?new ui.component._FilePanel.tbar.menu.en({comp_id:this.id_prefix+"-FILE-"+this.fid}):new ui.component._FilePanel.tbar.menu.lang({comp_id:this.id_prefix+"-FILE-"+this.fid})]})}});ui.component.FilePanel=Ext.extend(Ext.form.FormPanel,{activeScroll:false,goToPreviousTab:function(){var c=this.prefix+"-"+this.fid,e=Ext.getCmp("main-panel").layout.container.items.items,g,f,d;for(d=0;d<e.length;d++){if(e[d].id===c){f=d}}if(f===1){g="MainInfoTabPanel"}else{g=e[f-1].id}Ext.getCmp("main-panel").setActiveTab(g)},goToNextTab:function(){var d=this.prefix+"-"+this.fid,f=Ext.getCmp("main-panel").layout.container.items.items,c=false,g,e;for(e=0;e<f.length;e++){if(f[e].id===d){g=e}}if(f[g+1]){c=f[g+1].id;Ext.getCmp("main-panel").setActiveTab(c)}},initComponent:function(){var c=this.prefix+"-"+this.ftype;this.bbar=(this.syncScrollCB)?[{height:22,xtype:"checkbox",name:"needUpdateScrollbars",hideLabel:true,checked:PhDOE.userConf[this.syncScrollConf],boxLabel:_("Synchronize scroll bars"),listeners:{scope:this,check:function(d){new ui.task.UpdateConfTask({item:this.syncScrollConf,value:d.getValue(),notify:false})},render:function(d){Ext.DomHelper.insertHtml("beforeBegin",d.el.dom,['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',c,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',c,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join(""))}}}]:[{xtype:"panel",height:22,baseCls:"",bodyStyle:"padding-top:5px;",html:['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',c,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',c,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join("")}];if(!this.readOnly){this.tbar=(this.isPatch)?[new ui.component._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),{xtype:"buttongroup",items:[{id:c+"-FILE-"+this.fid+"-btn-save",scope:this,tooltip:_("<b>Accept</b> this patch and <b>Save</b> the file (CTRL+s)"),iconCls:"iconSaveFile",handler:function(){new ui.task.AcceptPatchTask({fid:this.fid,fpath:this.fpath,fname:this.fname,fuid:this.fuid,storeRecord:this.storeRecord})}},{id:c+"-FILE-"+this.fid+"-btn-reject",scope:this,tooltip:_("<b>Reject</b> this patch"),iconCls:"iconPageDelete",handler:function(){new ui.task.RejectPatchTask({fid:this.fid,fuid:this.fuid,storeRecord:this.storeRecord})}}]},new ui.component._FilePanel.tbar.items.undoRedo({id_prefix:c,fid:this.fid}),new ui.component._FilePanel.tbar.items.reindentTags({id_prefix:c,fid:this.fid,lang:this.lang,spellCheck:this.spellCheck,spellCheckConf:this.spellCheckConf})]:[new ui.component._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),{xtype:"buttongroup",items:[{id:c+"-FILE-"+this.fid+"-btn-save",scope:this,tooltip:_("<b>Save</b> this file (CTRL+s)"),iconCls:"iconSaveFile",disabled:true,handler:function(){if(this.prefix==="AF"){new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();return}if(this.prefix==="FNT"){new ui.task.SaveTransFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();return}if(!PhDOE.userConf.onSaveFile){PhDOE.userConf.onSaveFile="ask-me"}switch(PhDOE.userConf.onSaveFile){case"always":new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();break;case"never":new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();break;case"ask-me":Ext.MessageBox.show({title:_("Confirm"),msg:_("Do you want to check for error before saving?"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,scope:this,fn:function(d){if(d==="no"){new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode()}else{if(d==="yes"){new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode()}}}});break}}},{id:c+"-FILE-"+this.fid+"-btn-saveas",scope:this,tooltip:_("<b>Save as</b> a patch"),iconCls:"iconSaveAsFile",disabled:true,handler:function(){new ui.component.PatchPrompt({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,defaultEmail:(PhDOE.userLogin!=="anonymous")?PhDOE.userLogin+"@php.net":""}).show()}}]},new ui.component._FilePanel.tbar.items.undoRedo({id_prefix:c,fid:this.fid}),new ui.component._FilePanel.tbar.items.reindentTags({id_prefix:c,fid:this.fid,lang:this.lang,spellCheck:this.spellCheck,spellCheckConf:this.spellCheckConf})]}else{this.tbar=[new ui.component._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab})]}Ext.apply(this,{title:this.title,cls:"code-mirror-panel",originTitle:this.title,items:[{xtype:"codemirror",id:c+"-FILE-"+this.fid,readOnly:this.readOnly,parser:this.parser,spellCheck:this.spellCheck,isModified:false,listeners:{scope:this,initialize:function(){var e,d;if(this.isPatch){e=this.fpath;d=this.fname+"."+this.fuid+".patch"}else{if(this.isTrans){if(this.storeRecord.data.needcommit){e=this.lang+this.fpath;d=this.fname+".new"}else{e="en"+this.fpath;d=this.fname}}else{e=this.lang+this.fpath;d=this.fname}}new ui.task.GetFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:e,fname:d})},coderestored:function(){if(Ext.getCmp(c+"-FILE-"+this.fid).isModified){Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).permlink+Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);if((this.ftype==="LANG"&&PhDOE.userLang!=="en")||this.ftype==="EN"){if((this.ftype==="EN"&&!Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid).isModified)||(this.ftype==="LANG"&&!Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid).isModified)){Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}}else{Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}if(!this.isPatch){Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid+"-btn-saveas").disable()}Ext.getCmp(c+"-FILE-"+this.fid).isModified=false}},codemodified:function(){var e=Ext.getCmp(c+"-FILE-"+this.fid),d=Ext.getCmp(c+"-PANEL-"+this.fid);if(!e.isModified){d.setTitle(d.permlink+d.originTitle+' <span style="color:#ff0000; font-weight: bold;">['+_("modified")+"]</span>");Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');if(!this.isPatch){Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").enable();Ext.getCmp(c+"-FILE-"+this.fid+"-btn-saveas").enable()}Ext.getCmp(c+"-FILE-"+this.fid+"-btn-undo").enable();e.isModified=true}},cursormove:function(d,e){Ext.get(c+"-status-line-"+this.fid).dom.innerHTML=d;Ext.get(c+"-status-col-"+this.fid).dom.innerHTML=e},scroll:function(g){var e,f,d;if(this.syncScroll&&PhDOE.userConf[this.syncScrollConf]){switch(this.ftype){case"EN":e=this.prefix+"-LANG";break;case"LANG":e=this.prefix+"-EN";break;case"PATCH":e=this.prefix+"-ORIGIN";break;case"ORIGIN":e=this.prefix+"-PATCH";break;case"TRANS":e=this.prefix+"-GGTRANS";break;case"GGTRANS":e=this.prefix+"-TRANS";break}f=Ext.getCmp(e+"-PANEL-"+this.fid);d=Ext.getCmp(e+"-FILE-"+this.fid);if(f.activeScroll===false){this.activeScroll=true;d.scrollTo(g)}else{f.activeScroll=false}}}}}]});ui.component.FilePanel.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._GoogleTranslationPanel");ui.component.GoogleTranslationPanel=Ext.extend(Ext.FormPanel,{border:false,labelAlign:"top",bodyStyle:"padding:5px",autoScroll:true,getTranslation:function(c){new ui.task.GetGGTranslation({str:c})},initComponent:function(){Ext.apply(this,{items:[{xtype:"textarea",anchor:"90%",fieldLabel:String.format(_("String to translate (en => {0})"),PhDOE.userLang),name:"GGTranslate-string",id:"GGTranslate-string",allowBlank:false},{scope:this,xtype:"button",text:_("Translate !"),id:"GGTranslate-btn",handler:function(){this.getTranslation(Ext.getCmp("GGTranslate-string").getValue())}},{xtype:"panel",anchor:"100%",border:false,bodyStyle:"padding:5px",html:'<div id="GGTranslate-result" style="width: 90%; font: 12px tahoma,arial,sans-serif"></div>'}]});ui.component.GoogleTranslationPanel.superclass.initComponent.call(this)}});ui.component._GoogleTranslationPanel.instance=null;ui.component.GoogleTranslationPanel.getInstance=function(c){if(!ui.component._GoogleTranslationPanel.instance){if(!c){c={}}ui.component._GoogleTranslationPanel.instance=new ui.component.GoogleTranslationPanel(c)}return ui.component._GoogleTranslationPanel.instance};Ext.namespace("ui","ui.component","ui.component._MainMenu");ui.component.MainMenu=function(c){Ext.apply(this,c);this.init();ui.component.MainMenu.superclass.constructor.call(this)};ui.component._MainMenu.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getAvailableLanguage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"code"},Ext.data.Record.create([{name:"code",mapping:"code"},{name:"iconCls",mapping:"iconCls"},{name:"name",mapping:"name"}]))});ui.component._MainMenu.store.on("load",function(c){Ext.getDom("Info-Language").innerHTML=c.getById(PhDOE.userLang).data.name;c.each(function(d){var e=new Ext.menu.Item({text:d.data.name,iconCls:"mainMenuLang flags "+d.data.iconCls,disabled:(d.data.code===PhDOE.userLang),handler:function(){XHR({params:{task:"switchLang",lang:d.data.code},success:function(){window.location.reload()}})}});Ext.getCmp("MenuLang-ct").add(e)})},this);Ext.extend(ui.component.MainMenu,Ext.menu.Menu,{id:"mainMenu",init:function(){var c=new Ext.menu.Menu({id:"MenuLang-ct"});Ext.apply(this,{items:[{text:_("Refresh all data"),disabled:(PhDOE.userLogin==="anonymous")?true:false,iconCls:"iconRefresh",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an update in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFiles:"project_"+PhDOE.project+"_lock_update_repository|project_"+PhDOE.project+"_lock_apply_tools"},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently an update in progress.<br/>You can't perform an update now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();new ui.component.SystemUpdatePrompt().show(Ext.get("acc-need-update"))}})}},{text:_("Build tools"),handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("Check Build"),disabled:(PhDOE.userLogin==="anonymous"),iconCls:"iconCheckBuild",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is a check in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.userLang},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for this language.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();new ui.component.CheckBuildPrompt().show(Ext.get("acc-need-update"))}})}},{text:_("Last failed build"),iconCls:"iconBuildStatus",handler:function(){var d=Ext.getCmp("tab-build-status");if(!d){Ext.getCmp("main-panel").add({id:"tab-build-status",title:_("Last failed build"),iconCls:"iconBuildStatus",layout:"fit",closable:true,items:[new ui.component.BuildStatus()]})}Ext.getCmp("main-panel").setActiveTab("tab-build-status")}}]})},{text:_("EN tools"),handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("Script Check Entities"),iconCls:"iconCheckEntities",handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("View the last result"),id:"btn-check-entities-view-last-result",iconCls:"iconTabView",handler:function(){var d=Ext.getCmp("tab-check-entities");if(!d){Ext.getCmp("main-panel").add({id:"tab-check-entities",title:_("Check Entities"),iconCls:"iconCheckEntities",layout:"fit",closable:true,items:[new ui.component.CheckEntities()]})}Ext.getCmp("main-panel").setActiveTab("tab-check-entities")}},{text:_("Run this script"),iconCls:"iconRun",disabled:(PhDOE.userLogin==="anonymous"),handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an entities check in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for the entities.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();if(!Ext.getCmp("win-check-entities")){new ui.component.CheckEntitiesPrompt()}Ext.getCmp("win-check-entities").show(Ext.get("mainMenu"))}})}}]})},{text:_("Script Check doc"),iconCls:"iconCheckDoc",handler:function(){var d=Ext.getCmp("tab-check-doc");if(!d){Ext.getCmp("main-panel").add({id:"tab-check-doc",title:"Check Doc",iconCls:"iconCheckDoc",layout:"fit",closable:true,items:[new ui.component.CheckDoc()]})}Ext.getCmp("main-panel").setActiveTab("tab-check-doc")}}]})},"-",{text:_("Configure"),iconCls:"iconConf",tooltip:"<b>Configure</b> this tool",id:"winconf-btn",handler:function(){if(!Ext.getCmp("win-conf")){new ui.component.EditorConf()}Ext.getCmp("win-conf").show(Ext.get("mainMenu"))}},"-",{id:"menuLang",iconCls:"iconSwitchLang",text:_("Switch to language..."),handler:function(){return false},menu:c},{text:_("Erase my personal data"),disabled:(PhDOE.userLogin==="anonymous")?true:false,iconCls:"iconErasePersonalData",handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("This action will erase your personal data. All content about this account will be deleted definitively. Are you sure you want to do that ?"),function(d){if(d==="yes"){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({params:{task:"erasePersonalData"},success:function(e){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Thanks !"),msg:_("Thank you for using this application !"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function(){window.location.href="./do/logout"}})},failure:function(e){PhDOE.winForbidden()}})}})}},{text:_("Log out"),iconCls:"iconLogOut",handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("Are you sure you want to logout?"),function(d){if(d==="yes"){window.location.href="./do/logout"}})}},"-",{id:"tab-report-bug-btn",text:_("Report bugs"),iconCls:"iconBugs",handler:function(){if(!Ext.getCmp("main-panel").findById("tab-report-bug")){Ext.getCmp("main-panel").add({id:"tab-report-bug",xtype:"panel",title:_("Report bugs"),iconCls:"iconBugs",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-report-bug",url:"http://bugs.php.net/"})]});Ext.getCmp("main-panel").setActiveTab("tab-report-bug")}else{Ext.getCmp("main-panel").setActiveTab("tab-report-bug")}}},{id:"tab-documentation-btn",text:_("Documentation"),iconCls:"iconBook",handler:function(){if(!Ext.getCmp("main-panel").findById("tab-documentation")){Ext.getCmp("main-panel").add({id:"tab-documentation",xtype:"panel",title:_("Documentation"),iconCls:"iconBook",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-documentation",url:"http://wiki.php.net/doc/editor/"})]});Ext.getCmp("main-panel").setActiveTab("tab-documentation")}else{Ext.getCmp("main-panel").setActiveTab("tab-documentation")}}},"-",{id:"winabout-btn",text:_("About"),iconCls:"iconHelp",handler:function(){new ui.component.About().show(Ext.get("winabout-btn"))}}]})}});Ext.namespace("ui","ui.component","ui.component.MainPanel");ui.component.MainPanel=Ext.extend(Ext.ux.SlidingTabPanel,{activeTab:0,enableTabScroll:true,plugins:["tabclosemenu","dblclickclosetabs"],initComponent:function(c){Ext.apply(this,c);ui.component.MainPanel.superclass.initComponent.call(this);this.addEvents({tabLoaded:true});this.on("beforeremove",this.onBeforeRemove,this);this.on("tabchange",this.onTabChange,this);this.on("endDrag",this.onTabChange,this);this.on("tabLoaded",this.onTabLoaded,this)},onTabLoaded:function(d,e){var c=Ext.getCmp(d+"-"+e);if(d=="FNT"){if(c.panTRANSLoaded&&c.panGGTRANSLoaded){c.tabLoaded=true;c.panTRANSLoaded=panGGTRANSLoaded=false;if(PhDOE.FNTfilePendingOpen[0]){ui.component.PendingTranslateGrid.getInstance().openFile(PhDOE.FNTfilePendingOpen[0].id);PhDOE.FNTfilePendingOpen.shift()}}}if(d=="FNU"){if(c.panLANGLoaded&&c.panENLoaded&&c.panDiffLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panDiffLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FNUfilePendingOpen[0]){ui.component.StaleFileGrid.getInstance().openFile(PhDOE.FNUfilePendingOpen[0].id);PhDOE.FNUfilePendingOpen.shift()}}}if(d=="FE"){if(c.panLANGLoaded&&c.panENLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FEfilePendingOpen[0]){ui.component.ErrorFileGrid.getInstance().openFile(PhDOE.FEfilePendingOpen[0].id);PhDOE.FEfilePendingOpen.shift()}}}if(d=="FNR"){if(c.panLANGLoaded&&c.panENLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FNRfilePendingOpen[0]){ui.component.PendingReviewGrid.getInstance().openFile(PhDOE.FNRfilePendingOpen[0].id);PhDOE.FNRfilePendingOpen.shift()}}}if(d=="FNIEN"){if(c.panLANGLoaded){c.tabLoaded=true;c.panLANGLoaded=false;if(PhDOE.FNIENfilePendingOpen[0]){ui.component.NotInENGrid.getInstance().openFile(PhDOE.FNIENfilePendingOpen[0].id);PhDOE.FNIENfilePendingOpen.shift()}}}if(d=="AF"){if(c.panLoaded&&c.panVCS&&c.panEntities&&c.panAcronyms){c.tabLoaded=true;c.panLoaded=c.panVCS=false;if(PhDOE.AFfilePendingOpen[0]){ui.component.RepositoryTree.getInstance().openFile((PhDOE.AFfilePendingOpen[0].nodeID)?"byId":"byPath",(PhDOE.AFfilePendingOpen[0].nodeID)?PhDOE.AFfilePendingOpen[0].nodeID:PhDOE.AFfilePendingOpen[0].fpath,(PhDOE.AFfilePendingOpen[0].nodeID)?false:PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift()}}}if(d=="PP"){if(c.panPatchLoaded&&c.panOriginLoaded&&c.panVCS&&c.panPatchContent){c.tabLoaded=true;c.panPatchLoaded=c.panOriginLoaded=c.panVCS=c.panPatchContent=false;if(PhDOE.PPfilePendingOpen[0]){ui.component.PendingPatchGrid.getInstance().openFile(PhDOE.PPfilePendingOpen[0].id);PhDOE.PPfilePendingOpen.shift()}}}},onTabChange:function(d,g){if(Ext.getCmp(g.id+"-btn-tabRight-LANG")||Ext.getCmp(g.id+"-btn-tabRight-EN")||Ext.getCmp(g.id+"-btn-tabRight-ALL")||Ext.getCmp(g.id+"-btn-tabRight-NotInEN")||Ext.getCmp(g.id+"-btn-tabRight-PATCH")||Ext.getCmp(g.id+"-btn-tabRight-TRANS")){var c=g.id,f=Ext.getCmp("main-panel").layout.container.items.items,h,e;for(e=0;e<f.length;e++){if(f[e].id===c){h=e}}if(f[h+1]){if(Ext.getCmp(g.id+"-btn-tabRight-LANG")){Ext.getCmp(g.id+"-btn-tabRight-LANG").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-EN")){Ext.getCmp(g.id+"-btn-tabRight-EN").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-ALL")){Ext.getCmp(g.id+"-btn-tabRight-ALL").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-NotInEN")){Ext.getCmp(g.id+"-btn-tabRight-NotInEN").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-PATCH")){Ext.getCmp(g.id+"-btn-tabRight-PATCH").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-TRANS")){Ext.getCmp(g.id+"-btn-tabRight-TRANS").enable()}}}},onBeforeRemove:function(f,g){var d,e,h,c=g.id.split("-");if((c[0]==="FE"||c[0]==="FNU"||c[0]==="FNR"||c[0]==="PP"||c[0]==="AF"||c[0]==="FNT")&&c[1]!=="help"){if(c[0]==="FE"){d=Ext.getCmp("FE-LANG-FILE-"+c[1]).isModified;e=(PhDOE.userLang==="en")?false:Ext.getCmp("FE-EN-FILE-"+c[1]).isModified}if(c[0]==="FNU"){d=Ext.getCmp("FNU-LANG-FILE-"+c[1]).isModified;e=Ext.getCmp("FNU-EN-FILE-"+c[1]).isModified}if(c[0]==="FNR"){d=Ext.getCmp("FNR-LANG-FILE-"+c[1]).isModified;e=Ext.getCmp("FNR-EN-FILE-"+c[1]).isModified}if(c[0]==="PP"){h=Ext.getCmp("PP-PATCH-FILE-"+c[1]).isModified}if(c[0]==="AF"){h=Ext.getCmp("AF-ALL-FILE-"+c[1]).isModified}if(c[0]==="FNT"){h=Ext.getCmp("FNT-TRANS-FILE-"+c[1]).isModified}if(e||d||h){Ext.Msg.show({scope:this,title:_("Confirm"),msg:_("This file has been modified without being saved.<br/>Do you really want to close?"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(i,j){if(i==="yes"){f.un("beforeremove",this.onBeforeRemove,this);f.remove(g);f.addListener("beforeremove",this.onBeforeRemove,this)}}});return false}else{return true}}else{return true}}});Ext.reg("mainpanel",ui.component.MainPanel);Ext.namespace("ui","ui.component","ui.component._NotInENGrid");ui.component._NotInENGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNotInEn"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"needcommit"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-notInEn-nb").innerHTML=c.getCount()}}});ui.component._NotInENGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._NotInENGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",getRowClass:function(c,f,e,d){if(c.data.needcommit){return"file-need-commit"}return false}});ui.component._NotInENGrid.menu=function(c){Ext.apply(this,c);this.init();ui.component._NotInENGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.component._NotInENGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new Tab")+"</b>",iconCls:"iconView",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,text:_("Remove this file"),iconCls:"iconDelete",handler:function(){var e=this.grid.store.getAt(this.rowIdx),d=e.data.path,c=e.data.name;new ui.task.MarkDeleteTask({fpath:d,fname:c,storeRecord:e})}}]})}});ui.component.NotInENGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",view:ui.component._NotInENGrid.view,columns:ui.component._NotInENGrid.columns,onRowContextMenu:function(c,f,d){d.stopEvent();c.getSelectionModel().selectRow(f);if(!c.store.getAt(f).data.needcommit){new ui.component._NotInENGrid.menu({grid:c,rowIdx:f,event:d}).showAt(d.getXY())}},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNIEN-"+PhDOE.userLang+d+c);if(!Ext.getCmp("main-panel").findById("FNIEN-"+f)){Ext.getCmp("main-panel").add({id:"FNIEN-"+f,layout:"border",title:c,originTitle:c,iconCls:"iconTabView",closable:true,tabLoaded:false,panLANGLoaded:false,defaults:{split:true},tabTip:String.format(_("Not In EN: in {0}"),d),items:[new ui.component.FilePanel({id:"FNIEN-NotInEN-PANEL-"+f,region:"center",title:_("File: ")+d+c,prefix:"FNIEN",ftype:"NotInEN",fid:f,fpath:d,fname:c,readOnly:true,lang:PhDOE.userLang,parser:"xml",storeRecord:"",syncScroll:false})]})}Ext.getCmp("main-panel").setActiveTab("FNIEN-"+f)},initComponent:function(){Ext.apply(this,{store:ui.component._NotInENGrid.store});ui.component.NotInENGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._NotInENGrid.instance=null;ui.component.NotInENGrid.getInstance=function(c){if(!ui.component._NotInENGrid.instance){if(!c){c={}}ui.component._NotInENGrid.instance=new ui.component.NotInENGrid(c)}return ui.component._NotInENGrid.instance};Ext.namespace("ui","ui.component");ui.component.PatchPrompt=Ext.extend(Ext.Window,{title:_("Do you want to be alerted ?"),iconCls:"iconPatchAlert",layout:"form",bodyStyle:"padding: 5px;",labelWidth:50,width:350,height:150,resizable:false,modal:true,autoScroll:true,initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",baseCls:"x-plain",bodyStyle:"padding-bottom: 10px;",html:_("If you want to be notified when your patch will be dealt with, thank you to leave an email address below.")},{id:"patch-email-alert",xtype:"textfield",name:"patch-email-alert",fieldLabel:_("Email"),anchor:"100%",value:this.defaultEmail}],buttons:[{scope:this,text:_("Save"),handler:function(){new ui.task.SavePatchTask({prefix:this.prefix,fid:this.fid,ftype:this.ftype,lang:this.lang,fpath:this.fpath,fname:this.fname,email:Ext.getCmp("patch-email-alert").getValue()});this.close()}},{scope:this,text:_("Cancel"),handler:function(){this.close()}}]});ui.component.PatchPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component","ui.component._PendingCommitGrid");ui.component._PendingCommitGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesPendingCommit"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"by"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"type"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{add:function(c){Ext.getDom("acc-pendingCommit-nb").innerHTML=c.getCount()},datachanged:function(c){Ext.getDom("acc-pendingCommit-nb").innerHTML=c.getCount()}}});ui.component._PendingCommitGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Modified by"),width:45,sortable:true,dataIndex:"by"},{header:_("Date"),width:45,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._PendingCommitGrid.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',emptyText:'<div style="text-align: center;">'+_("No pending for Commit")+"</div>",deferEmptyText:false,getRowClass:function(c,f,e,d){if(c.data.type==="update"){return"file-needcommit-update"}if(c.data.type==="delete"){return"file-needcommit-delete"}if(c.data.type==="new"){return"file-needcommit-new"}return false}});Ext.namespace("ui.component._PendingCommitGrid.menu");ui.component._PendingCommitGrid.menu.common=function(c){Ext.apply(this,c);this.init();ui.component._PendingCommitGrid.menu.common.superclass.constructor.call(this)};Ext.extend(ui.component._PendingCommitGrid.menu.common,Ext.menu.Item,{init:function(){Ext.apply(this,{text:_("Commit..."),iconCls:"iconCommitFileVcs",disabled:(PhDOE.userLogin==="anonymous"),handler:function(){return false},menu:new Ext.menu.Menu({items:[{scope:this,text:_("...this file"),iconCls:"iconCommitFileVcs",handler:function(){var c=ui.component.PendingCommitGrid.getInstance().store.getAt(this.rowIdx),e=c.data.id,d=c.data.path,g=c.data.name,f=Ext.util.md5(d+g);new ui.component.CommitPrompt({files:[{fid:f,fpath:d,fname:g,fdbid:e}]}).show()}},{scope:this,text:_("...all files modified by me"),iconCls:"iconCommitFileVcs",handler:function(){var d=[],c=ui.component.PendingCommitGrid.getInstance();c.store.each(function(e){if(e.data.by===PhDOE.userLogin){var g=e.data.id,f=e.data.path,i=e.data.name,h=Ext.util.md5(f+i);d.push({fid:h,fpath:f,fname:i,fdbid:g})}});new ui.component.CommitPrompt({files:d}).show()}},{scope:this,text:_("...all files modified"),iconCls:"iconCommitFileVcs",handler:function(){var d=[],c=ui.component.PendingCommitGrid.getInstance();c.store.each(function(e){var g=e.data.id,f=e.data.path,i=e.data.name,h=Ext.util.md5(f+i);d.push({fid:h,fpath:f,fname:i,fdbid:g})});new ui.component.CommitPrompt({files:d}).show()}}]})})}});ui.component._PendingCommitGrid.menu.update=function(c){Ext.apply(this,c);this.init();ui.component._PendingCommitGrid.menu.update.superclass.constructor.call(this)};Ext.extend(ui.component._PendingCommitGrid.menu.update,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconPendingCommit",handler:function(){this.grid.openFile(this.grid.store.getAt(this.rowIdx).data.id)}},"-",{scope:this,text:_("View Diff"),iconCls:"iconViewDiff",handler:function(){if(!Ext.getCmp("main-panel").findById("diff_panel_pending_"+this.rowIdx)){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_pending_"+this.rowIdx,iconCls:"iconTabLink",title:_("Diff"),tabTip:String.format(_("Diff for file: {0}"),this.fpath+this.fname),closable:true,autoScroll:true,html:'<div id="diff_content_pending_'+this.rowIdx+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_pending_"+this.rowIdx);Ext.get("diff_panel_pending_"+this.rowIdx).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"getDiff",DiffType:"file",FilePath:this.fpath,FileName:this.fname},success:function(c){var d=Ext.util.JSON.decode(c.responseText);Ext.get("diff_content_pending_"+this.rowIdx).dom.innerHTML=d.content;Ext.get("diff_panel_pending_"+this.rowIdx).unmask()}})}else{Ext.getCmp("main-panel").setActiveTab("diff_panel_pending_"+this.rowIdx)}}},{scope:this,text:_("Download the diff as a patch"),iconCls:"iconDownloadDiff",handler:function(){window.location.href="./do/downloadPatch?FilePath="+this.fpath+"&FileName="+this.fname}},"-",{scope:this,text:_("Clear this change"),iconCls:"iconPageDelete",disabled:(PhDOE.userLogin==="anonymous"),handler:function(){new ui.task.ClearLocalChangeTask({storeRecord:this.grid.store.getAt(this.rowIdx),ftype:"update",fpath:this.fpath,fname:this.fname})}},"-",new ui.component._PendingCommitGrid.menu.common({rowIdx:this.rowIdx})]})}});ui.component._PendingCommitGrid.menu.del=function(c){Ext.apply(this,c);this.init();ui.component._PendingCommitGrid.menu.del.superclass.constructor.call(this)};Ext.extend(ui.component._PendingCommitGrid.menu.del,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new Tab")+"</b>",iconCls:"iconPendingCommit",handler:function(){this.grid.openFile(this.grid.store.getAt(this.rowIdx).data.id)}},{scope:this,text:_("Cancel this deletion"),iconCls:"iconPageDelete",disabled:(PhDOE.userLogin==="anonymous"),handler:function(){var e=this.grid.store.getAt(this.rowIdx),d=e.data.path,c=e.data.name;new ui.task.ClearLocalChangeTask({storeRecord:e,ftype:"delete",fpath:d,fname:c})}},"-",new ui.component._PendingCommitGrid.menu.common({rowIdx:this.rowIdx})]})}});ui.component._PendingCommitGrid.menu.newFile=function(c){Ext.apply(this,c);this.init();ui.component._PendingCommitGrid.menu.newFile.superclass.constructor.call(this)};Ext.extend(ui.component._PendingCommitGrid.menu.newFile,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconPendingCommit",handler:function(){this.grid.openFile(this.grid.store.getAt(this.rowIdx).data.id)}},"-",{scope:this,text:_("Clear this change"),iconCls:"iconPageDelete",disabled:(PhDOE.userLogin==="anonymous"),handler:function(){var e=this.grid.store.getAt(this.rowIdx),d=e.data.path,c=e.data.name;new ui.task.ClearLocalChangeTask({storeRecord:e,ftype:"new",fpath:d,fname:c})}},"-",new ui.component._PendingCommitGrid.menu.common({rowIdx:this.rowIdx})]})}});ui.component.PendingCommitGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",columns:ui.component._PendingCommitGrid.columns,view:ui.component._PendingCommitGrid.view,enableDragDrop:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),ddGroup:"mainPanelDDGroup",onRowContextMenu:function(f,j,i){i.stopEvent();var h=f.store.getAt(j),d=h.data.type,g=h.data.path,c=h.data.name;f.getSelectionModel().selectRow(j);if(d==="new"){new ui.component._PendingCommitGrid.menu.newFile({grid:f,rowIdx:j,event:i}).showAt(i.getXY())}if(d==="delete"){new ui.component._PendingCommitGrid.menu.del({grid:f,rowIdx:j,event:i}).showAt(i.getXY())}if(d==="update"){new ui.component._PendingCommitGrid.menu.update({fpath:g,fname:c,grid:f,rowIdx:j,event:i}).showAt(i.getXY())}},onRowDblClick:function(c,f,d){this.openFile(this.store.getAt(f).data.id)},openFile:function(j){var h=false;this.store.each(function(k){if(k.data.id===j){h=k}});var d=h.data.type,f=h.data.path,c=h.data.name,g,e,i;if(d==="new"){e=f.split("/");g=e[0];e.shift();f="/"+e.join("/");ui.component.PendingTranslateGrid.getInstance().store.each(function(k){if((k.data.path)===f&&k.data.name===c){ui.component.PendingTranslateGrid.getInstance().openFile(k.data.id);return}})}if(d==="update"){e=f.split("/");g=e[0];e.shift();f="/"+e.join("/");if(g==="en"){ui.component.RepositoryTree.getInstance().openFile("byPath",g+f,c)}else{i=false;ui.component.StaleFileGrid.getInstance().store.each(function(k){if((k.data.path)===f&&k.data.name===c){ui.component.StaleFileGrid.getInstance().openFile(k.data.id);i=true;return}});if(!i){ui.component.ErrorFileGrid.getInstance().store.each(function(k){if((k.data.path)===f&&k.data.name===c){ui.component.ErrorFileGrid.getInstance().openFile(k.data.id);i=true;return}})}if(!i){ui.component.PendingReviewGrid.getInstance().store.each(function(k){if((k.data.path)===f&&k.data.name===c){ui.component.PendingReviewGrid.getInstance().openFile(k.data.id);i=true;return}})}if(!i){ui.component.RepositoryTree.getInstance().openFile("byPath",g+f,c)}}}if(d==="delete"){e=f.split("/");g=e[0];e.shift();f="/"+e.join("/");ui.component.NotInENGrid.getInstance().store.each(function(k){if((k.data.path)===f&&k.data.name===c){ui.component.NotInENGrid.getInstance().openFile(k.data.id);return}})}},initComponent:function(){Ext.apply(this,{store:ui.component._PendingCommitGrid.store});ui.component.PendingCommitGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)},addRecord:function(f,c,g,e){var d=false;this.store.each(function(h){if(h.data.path===c&&h.data.name===g){d=true}});if(!d){this.store.insert(0,new this.store.recordType({id:f,path:c,name:g,by:PhDOE.userLogin,date:new Date(),type:e}));this.store.groupBy("path",true)}}});ui.component._PendingCommitGrid.instance=null;ui.component.PendingCommitGrid.getInstance=function(c){if(!ui.component._PendingCommitGrid.instance){if(!c){c={}}ui.component._PendingCommitGrid.instance=new ui.component.PendingCommitGrid(c)}return ui.component._PendingCommitGrid.instance};Ext.namespace("ui","ui.component","ui.component._PendingPatchGrid");ui.component._PendingPatchGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesPendingPatch"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"by"},{name:"uniqID"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{add:function(c){Ext.getDom("acc-pendingPatch-nb").innerHTML=c.getCount()},datachanged:function(c){Ext.getDom("acc-pendingPatch-nb").innerHTML=c.getCount()}}});ui.component._PendingPatchGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Posted by"),width:45,sortable:true,dataIndex:"by"},{header:_("Date"),width:45,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._PendingPatchGrid.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',emptyText:'<div style="text-align: center;">'+_("No pending Patch")+"</div>",deferEmptyText:false});ui.component._PendingPatchGrid.menu=function(c){Ext.apply(this,c);this.init();ui.component._PendingPatchGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.component._PendingPatchGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconPendingPatch",handler:function(){this.grid.openFile(this.grid.store.getAt(this.rowIdx).data.id)}},"-",{scope:this,text:_("Reject this patch"),disabled:(PhDOE.userLogin==="anonymous"),iconCls:"iconTrash",handler:function(){new ui.task.RejectPatchTask({fid:this.fid,fuid:this.fuid,storeRecord:this.grid.store.getAt(this.rowIdx)})}}]})}});ui.component.PendingPatchGrid=Ext.extend(Ext.grid.GridPanel,{columns:ui.component._PendingPatchGrid.columns,view:ui.component._PendingPatchGrid.view,loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",onRowDblClick:function(c,f,d){this.openFile(this.store.getAt(f).data.id)},openFile:function(h){var f=false;this.store.each(function(i){if(i.data.id===h){f=i}});var d=f.data.path,c=f.data.name,e=f.data.uniqID,g=Ext.util.md5("PP-"+e+d+c);if(!Ext.getCmp("main-panel").findById("PP-"+g)){Ext.getCmp("main-panel").add({id:"PP-"+g,layout:"border",iconCls:"iconPendingPatch",title:c,originTitle:c,tabTip:String.format(_("Patch for {0}"),d+c),closable:true,tabLoaded:false,panPatchContent:false,panVCS:!PhDOE.userConf.patchDisplayLog,panPatchLoaded:false,panOriginLoaded:false,defaults:{split:true},items:[{xtype:"panel",id:"PP-patch-desc-"+g,title:_("Patch content"),iconCls:"iconPendingPatch",collapsedIconCls:"iconPendingPatch",plugins:[Ext.ux.PanelCollapsedTitle],layout:"fit",region:"north",border:false,height:PhDOE.userConf.patchDisplayContentPanelHeight||150,autoScroll:true,collapsible:true,collapsed:!PhDOE.userConf.patchDisplayContentPanel,html:'<div id="diff_content_'+g+'" class="diff-content"></div>',listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"patchDisplayContentPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"patchDisplayContentPanel",value:true,notify:false})}},resize:function(k,i,j){if(this.ownerCt.tabLoaded&&j&&j>50&&j!=PhDOE.userConf.patchDisplayContentPanelHeight){new ui.task.UpdateConfTask({item:"patchDisplayContentPanelHeight",value:j,notify:false})}},render:function(){XHR({params:{task:"getDiff",FilePath:d,FileName:c,DiffType:"patch",uniqID:e},success:function(i){var j=Ext.util.JSON.decode(i.responseText);Ext.get("diff_content_"+g).dom.innerHTML=j.content},callback:function(){Ext.getCmp("PP-"+g).panPatchContent=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","PP",g)}})}}},{region:"west",xtype:"panel",title:_("VCS Log"),iconCls:"iconVCSLog",collapsedIconCls:"iconVCSLog",plugins:[Ext.ux.PanelCollapsedTitle],layout:"fit",bodyBorder:false,collapsible:true,collapsed:!PhDOE.userConf.patchDisplaylogPanel,width:PhDOE.userConf.patchDisplaylogPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"patchDisplaylogPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"patchDisplaylogPanel",value:true,notify:false})}},resize:function(i,j){if(this.ownerCt.tabLoaded&&j&&j!=PhDOE.userConf.patchDisplaylogPanelWidth){new ui.task.UpdateConfTask({item:"patchDisplaylogPanelWidth",value:j,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:new ui.component.VCSLogGrid({layout:"fit",title:_("Log"),prefix:"PP",fid:g,fpath:d,fname:c,loadStore:PhDOE.userConf.patchDisplayLog})}},new ui.component.FilePanel({id:"PP-PATCH-PANEL-"+g,region:"center",title:String.format(_("Proposed Patch for {0}"),d+c),prefix:"PP",ftype:"PATCH",spellCheck:PhDOE.userConf.patchSpellCheck,spellCheckConf:"patchSpellCheck",fid:g,fpath:d,fname:c,isPatch:true,fuid:e,parser:"xml",storeRecord:f,syncScrollCB:true,syncScroll:true,syncScrollConf:"patchScrollbars"}),new ui.component.FilePanel({id:"PP-ORIGIN-PANEL-"+g,region:"east",width:575,title:_("Original File: ")+d+c,prefix:"PP",ftype:"ORIGIN",fid:g,fpath:d,fname:c,lang:"",readOnly:true,parser:"xml",syncScroll:true,syncScrollConf:"patchScrollbars"})]})}Ext.getCmp("main-panel").setActiveTab("PP-"+g)},onRowContextMenu:function(d,j,i){i.stopEvent();var f=d.store.getAt(j).data.path,c=d.store.getAt(j).data.name,g=d.store.getAt(j).data.uniqID,h=Ext.util.md5("PP-"+g+f+c);d.getSelectionModel().selectRow(j);new ui.component._PendingPatchGrid.menu({grid:d,rowIdx:j,event:i,fid:h,fpath:f,fname:c,fuid:g}).showAt(i.getXY())},initComponent:function(){Ext.apply(this,{store:ui.component._PendingPatchGrid.store});ui.component.PendingPatchGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._PendingPatchGrid.instance=null;ui.component.PendingPatchGrid.getInstance=function(c){if(!ui.component._PendingPatchGrid.instance){if(!c){c={}}ui.component._PendingPatchGrid.instance=new ui.component.PendingPatchGrid(c)}return ui.component._PendingPatchGrid.instance};Ext.namespace("ui","ui.component","ui.component._PendingReviewGrid");ui.component._PendingReviewGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedReviewed"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"reviewed"},{name:"maintainer"},{name:"needcommit"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-reviewed-nb").innerHTML=c.getCount()}}});ui.component._PendingReviewGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Reviewed"),width:45,sortable:true,dataIndex:"reviewed"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._PendingReviewGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(c){if(c.data.needcommit){return"file-need-commit"}return false},deferEmptyText:false,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});Ext.namespace("ui.component._PendingReviewGrid.menu");ui.component._PendingReviewGrid.menu.diff=function(c){Ext.apply(this,c);this.init();ui.component._PendingReviewGrid.menu.diff.superclass.constructor.call(this)};Ext.extend(ui.component._PendingReviewGrid.menu.diff,Ext.menu.Item,{text:_("View Diff"),iconCls:"iconViewDiff",init:function(){Ext.apply(this,{handler:function(){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+this.rowIdx,title:_("Diff"),tabTip:_("Diff"),closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+this.rowIdx+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+this.rowIdx);Ext.get("diff_panel_"+this.rowIdx).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"getDiff",FilePath:PhDOE.userLang+this.fpath,FileName:this.fname},success:function(c){var d=Ext.util.JSON.decode(c.responseText);Ext.get("diff_content_"+this.rowIdx).dom.innerHTML=d.content;Ext.get("diff_panel_"+this.rowIdx).unmask()}})}})}});ui.component._PendingReviewGrid.menu.group=function(c){Ext.apply(this,c);this.init();ui.component._PendingReviewGrid.menu.group.superclass.constructor.call(this)};Ext.extend(ui.component._PendingReviewGrid.menu.group,Ext.menu.Item,{iconCls:"iconViewDiff",init:function(){Ext.apply(this,{text:String.format(_("Open all files about {0} extension"),this.gname),handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+String.format(_("Open all files about {0} extension"),this.gname)+". "+_("Please, wait..."));XHR({params:{task:"getAllFilesAboutExtension",ExtName:this.gname},success:function(c){var e=Ext.util.JSON.decode(c.responseText);PhDOE.AFfilePendingOpen=[];for(var d=0;d<e.files.length;d=d+1){PhDOE.AFfilePendingOpen[d]={fpath:PhDOE.userLang+e.files[d].path,fname:e.files[d].name}}ui.component.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();Ext.getBody().unmask()}})}})}});ui.component._PendingReviewGrid.menu.main=function(c){Ext.apply(this,c);this.init();ui.component._PendingReviewGrid.menu.main.superclass.constructor.call(this)};Ext.extend(ui.component._PendingReviewGrid.menu.main,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconFilesNeedReviewed",scope:this,handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},new ui.component._PendingReviewGrid.menu.diff({fpath:this.fpath,fname:this.fname,rowIdx:this.rowIdx,hidden:this.hideDiff}),new Ext.menu.Separator({hidden:this.hideGroup}),new ui.component._PendingReviewGrid.menu.group({gname:this.gname,hidden:this.hideGroup})]})}});ui.component.PendingReviewGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",columns:ui.component._PendingReviewGrid.columns,view:ui.component._PendingReviewGrid.view,onRowContextMenu:function(d,j,h){h.stopEvent();var g=d.store.getAt(j),f=g.data.path,c=g.data.name,i=f.split("/");d.getSelectionModel().selectRow(j);new ui.component._PendingReviewGrid.menu.main({grid:d,rowIdx:j,event:h,fpath:f,fname:c,hideDiff:(!g.data.needcommit),hideGroup:(i[1]!=="reference"),gname:i[2]}).showAt(h.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNR-"+PhDOE.userLang+d+c);if(!Ext.getCmp("main-panel").findById("FNR-"+f)){Ext.getCmp("main-panel").add({id:"FNR-"+f,title:c,layout:"border",iconCls:"iconTabNeedReviewed",closable:true,tabLoaded:false,panVCSLang:!PhDOE.userConf.reviewedDisplaylog,panVCSEn:!PhDOE.userConf.reviewedDisplaylog,panLANGLoaded:false,panENLoaded:false,originTitle:c,defaults:{split:true},tabTip:String.format(_("Need Reviewed in: {0}"),d),listeners:{resize:function(h){Ext.getCmp("FNR-EN-PANEL-"+f).setWidth(h.getWidth()/2)}},items:[{region:"west",xtype:"panel",title:_("VCS Log"),iconCls:"iconVCSLog",collapsedIconCls:"iconVCSLog",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:true,collapsed:!PhDOE.userConf.reviewedDisplaylogPanel,layout:"fit",bodyBorder:false,width:PhDOE.userConf.reviewedDisplaylogPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"reviewedDisplaylogPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"reviewedDisplaylogPanel",value:true,notify:false})}},resize:function(h,i){if(this.ownerCt.tabLoaded&&i&&i!=PhDOE.userConf.reviewedDisplaylogPanelWidth){new ui.task.UpdateConfTask({item:"reviewedDisplaylogPanelWidth",value:i,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[new ui.component.VCSLogGrid({layout:"fit",title:PhDOE.userLang,prefix:"FNR-LANG",fid:f,fpath:PhDOE.userLang+d,fname:c,loadStore:PhDOE.userConf.reviewedDisplaylog}),new ui.component.VCSLogGrid({layout:"fit",title:"en",prefix:"FNR-EN",fid:f,fpath:"en"+d,fname:c,loadStore:PhDOE.userConf.reviewedDisplaylog})]}},new ui.component.FilePanel({id:"FNR-LANG-PANEL-"+f,region:"center",title:String.format(_("{0} File: "),PhDOE.userLang)+d+c,prefix:"FNR",ftype:"LANG",spellCheck:PhDOE.userConf.reviewedSpellCheckLang,spellCheckConf:"reviewedSpellCheckLang",fid:f,fpath:d,fname:c,lang:PhDOE.userLang,parser:"xml",storeRecord:e,syncScrollCB:true,syncScroll:true,syncScrollConf:"reviewedScrollbars"}),new ui.component.FilePanel({id:"FNR-EN-PANEL-"+f,region:"east",title:_("en File: ")+d+c,prefix:"FNR",ftype:"EN",spellCheck:PhDOE.userConf.reviewedSpellCheckEn,spellCheckConf:"reviewedSpellCheckEn",fid:f,fpath:d,fname:c,lang:"en",parser:"xml",storeRecord:e,syncScroll:true,syncScrollConf:"reviewedScrollbars"})]})}Ext.getCmp("main-panel").setActiveTab("FNR-"+f)},initComponent:function(){Ext.apply(this,{store:ui.component._PendingReviewGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNR-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(d,c){if(c.getKey()==c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.component._PendingReviewGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue();if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);ui.component._PendingReviewGrid.instance.store.filter("maintainer",c)}})]});ui.component.PendingReviewGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._PendingReviewGrid.instance=null;ui.component.PendingReviewGrid.getInstance=function(c){if(!ui.component._PendingReviewGrid.instance){if(!c){c={}}ui.component._PendingReviewGrid.instance=new ui.component.PendingReviewGrid(c)}return ui.component._PendingReviewGrid.instance};Ext.namespace("ui","ui.component","ui.component._PendingTranslateGrid");ui.component._PendingTranslateGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedTranslate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"needcommit"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-translate-nb").innerHTML=c.getCount()}}});ui.component._PendingTranslateGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,getRowClass:function(c){if(c.data.needcommit){return"file-need-commit"}return false},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});ui.component._PendingTranslateGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._PendingTranslateGrid.menu=function(c){Ext.apply(this,c);this.init();ui.component._StaleFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.component._PendingTranslateGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconTabNeedTranslate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}}]})}});ui.component.PendingTranslateGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.component._PendingTranslateGrid.view,loadMask:true,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",border:false,onRowContextMenu:function(d,h,g){g.stopEvent();var f=d.store.getAt(h).data.path,c=d.store.getAt(h).data.name;d.getSelectionModel().selectRow(h);new ui.component._PendingTranslateGrid.menu({hideCommit:(d.store.getAt(h).data.needcommit===false),grid:d,event:g,rowIdx:h,lang:PhDOE.userLang,fpath:f,fname:c}).showAt(g.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNT-"+PhDOE.userLang+d+c);if(!Ext.getCmp("main-panel").findById("FNT-"+f)){Ext.getCmp("main-panel").add({id:"FNT-"+f,layout:"border",title:c,originTitle:c,iconCls:"iconTabNeedTranslate",closable:true,tabLoaded:false,panTRANSLoaded:false,panGGTRANSLoaded:false,defaults:{split:true},tabTip:String.format(_("Need Translate: in {0}"),d),listeners:{resize:function(h){Ext.getCmp("FNT-GGTRANS-PANEL-"+f).setWidth(h.getWidth()/2)}},items:[new ui.component.FilePanel({id:"FNT-TRANS-PANEL-"+f,region:"center",title:_("New File: ")+PhDOE.userLang+d+c,isTrans:true,prefix:"FNT",ftype:"TRANS",spellCheck:PhDOE.userConf.newFileSpellCheck,spellCheckConf:"newFileSpellCheck",fid:f,fpath:d,fname:c,lang:PhDOE.userLang,parser:"xml",storeRecord:e,syncScrollCB:true,syncScroll:true,syncScrollConf:"newFileScrollbars"}),new ui.component.FilePanel({id:"FNT-GGTRANS-PANEL-"+f,region:"east",title:_("Automatic translation: ")+PhDOE.userLang+d+c,isTrans:true,prefix:"FNT",ftype:"GGTRANS",fid:f,fpath:d,fname:c,readOnly:true,lang:PhDOE.userLang,parser:"xml",storeRecord:e,syncScroll:true,syncScrollConf:"newFileScrollbars"})]})}Ext.getCmp("main-panel").setActiveTab("FNT-"+f)},initComponent:function(){Ext.apply(this,{columns:ui.component._PendingTranslateGrid.columns,store:ui.component._PendingTranslateGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNT-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(d,c){if(c.getKey()==c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.component._PendingTranslateGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue();if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);ui.component._PendingTranslateGrid.instance.store.filter("maintainer",c)}})]});ui.component.PendingTranslateGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._PendingTranslateGrid.instance=null;ui.component.PendingTranslateGrid.getInstance=function(c){if(!ui.component._PendingTranslateGrid.instance){if(!c){c={}}ui.component._PendingTranslateGrid.instance=new ui.component.PendingTranslateGrid(c)}return ui.component._PendingTranslateGrid.instance};Ext.namespace("ui","ui.component","ui.component._PortletBugs");ui.component._PortletBugs.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getOpenBugs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"title",mapping:"title"},{name:"link",mapping:"link"},{name:"description",mapping:"description"},{name:"xmlID",mapping:"xmlID"}]))});ui.component._PortletBugs.gridFormatTitle=function(c){return String.format('<div class="topic"><b>{0}</b></div>',c)};ui.component._PortletBugs.gridColumns=[{id:"GridBugTitle",header:_("Title"),sortable:true,dataIndex:"title",renderer:ui.component._PortletBugs.gridFormatTitle}];ui.component._PortletBugs.gridView=new Ext.grid.GridView({forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:false,enableRowBody:true,showPreview:false,getRowClass:function(c,e,d){if(this.showPreview){d.body="<p>"+c.data.description+"</p>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}});ui.component._PortletBugs.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,height:250,autoExpandColumn:"GridBugTitle",id:"PortletBugs-grid-id",store:ui.component._PortletBugs.store,columns:ui.component._PortletBugs.gridColumns,view:ui.component._PortletBugs.gridView,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),onRowDblClick:function(f,i,h){var c=f.store.getAt(i).data.id,d=f.store.getAt(i).data.link,g=f.store.getAt(i).data.title;if(!Ext.getCmp("main-panel").findById("bugs-"+c)){Ext.getCmp("main-panel").add({id:"bugs-"+c,xtype:"panel",title:Ext.util.Format.substr(g,0,20)+"...",tabTip:g,iconCls:"iconBugs",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-bugs-"+c,url:d})]})}Ext.getCmp("main-panel").setActiveTab("bugs-"+c)},openRelatedFile:function(c){new ui.task.GetFileInfoByXmlID({xmlID:c})},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-bugs",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",c,this.ctxIndex,d);this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null;ui.component._PortletBugs.reloadData()}},{scope:this,text:_("Open the related file"),iconCls:"iconAllFiles",id:"bugs-open-related-file",handler:function(){this.openRelatedFile(this.ctxXmlID)}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxIndex){this.ctxIndex=null}if(this.ctxXmlID){this.ctxXmlID=null}this.ctxIndex=f;this.ctxXmlID=c.store.getAt(this.ctxIndex).data.xmlID;this.menu.showAt(d.getXY());if(!this.ctxXmlID){Ext.getCmp("bugs-open-related-file").disable()}else{Ext.getCmp("bugs-open-related-file").enable()}},togglePreview:function(c){this.view.showPreview=c;this.view.refresh()},initComponent:function(c){this.tbar=[{text:_("Summary"),pressed:false,enableToggle:true,iconCls:"iconSummary",scope:this,toggleHandler:function(d,e){this.togglePreview(e)}}];ui.component._PortletBugs.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._PortletBugs.reloadData=function(){ui.component._PortletBugs.store.reload({callback:function(c,e,d){if(!d){Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading open bugs from Php.net !")+"</div>");Ext.get("PortletBugs-grid-defaultMess-id").highlight()}else{if(ui.component._PortletBugs.store.getTotalCount()===0){Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("No open Bugs")+"</div>");Ext.get("PortletBugs-grid-defaultMess-id").highlight()}}}})};ui.component.PortletBugs=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconBugs",id:"portletBugs",layout:"fit",store:ui.component._PortletBugs.store,reloadData:ui.component._PortletBugs.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.component._PortletBugs.reloadData()}}],listeners:{expand:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:false,notify:false})}},collapse:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.userConf.portletBugsCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){ui.component.PortletBugs.superclass.initComponent.call(this);Ext.apply(this,c);this.title=String.format(_("Open bugs for {0}"),"doc-"+this.lang);this.add(new ui.component._PortletBugs.grid())}});ui.component._PortletBugs.instance=null;ui.component.PortletBugs.getInstance=function(c){if(!ui.component._PortletBugs.instance){if(!c){c={}}ui.component._PortletBugs.instance=new ui.component.PortletBugs(c)}return ui.component._PortletBugs.instance};Ext.namespace("ui","ui.component","ui.component._PortletInfo");ui.component._PortletInfo.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getInfos"}),baseParams:{start:0,limit:10},autoLoad:true,reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"field",mapping:"field"},{name:"value",mapping:"value"},{name:"date",mapping:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]))});ui.component._PortletInfo.store.setDefaultSort("date","desc");ui.component._PortletInfo.typeRenderer=function(j,h,f){var d,c,k,l,e,i,g;switch(j){case"updateData":d=f.data.value.user;return String.format(_("{0} update app's data"),d.ucFirst());break;case"checkEntities":d=f.data.value.user;return String.format(_("{0} check all entitites"),d.ucFirst());break;case"logout":d=f.data.value.user;return String.format(_("{0} is log out"),d.ucFirst());break;case"login":d=f.data.value.user;c=f.data.value.lang;return String.format(_("{0} is log in {1} language !"),d.ucFirst(),c.ucFirst());break;case"commitFolders":d=f.data.value.user;c=f.data.value.lang;k=f.data.value.nbFolders;return String.format(_("{0} commit {1} new folder(s) in {2} language"),d.ucFirst(),k,c.ucFirst());break;case"commitFiles":d=f.data.value.user;c=f.data.value.lang;l=f.data.value.nbFilesCreate;e=f.data.value.nbFilesDelete;i=f.data.value.nbFilesUpdate;g=l+e+i;return String.format(_("{0} commit {1} file(s) ({2} new, {3} update, {4} delete) in {5} language"),d.ucFirst(),g,l,i,e,c.ucFirst());break}};ui.component._PortletInfo.gridColumns=[new Ext.grid.RowNumberer(),{id:"Type",header:_("Type"),width:180,sortable:true,dataIndex:"field",renderer:ui.component._PortletInfo.typeRenderer},{header:_("Date"),width:110,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.component._PortletInfo.grid=Ext.extend(Ext.grid.GridPanel,{autoExpandColumn:"Type",loadMask:true,autoScroll:true,autoHeight:true,store:ui.component._PortletInfo.store,columns:ui.component._PortletInfo.gridColumns,view:ui.component._PortletInfo.gridView,initComponent:function(c){Ext.apply(this,{bbar:new Ext.PagingToolbar({pageSize:10,store:this.store,displayInfo:true})});ui.component._PortletInfo.grid.superclass.initComponent.call(this);this.on("rowdblclick",this.onRowdblclick,this)}});ui.component.PortletInfo=Ext.extend(Ext.ux.Portlet,{title:_("Infos"),id:"portletInfo",iconCls:"iconInfo",layout:"fit",store:ui.component._PortletInfo.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.component._PortletInfo.store.reload()}}],listeners:{expand:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:false,notify:false})}},collapse:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.userConf.portletInfoCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){ui.component.PortletInfo.superclass.initComponent.call(this);Ext.apply(this,c);this.add(new ui.component._PortletInfo.grid())}});ui.component._PortletInfo.instance=null;ui.component.PortletInfo.getInstance=function(c){if(!ui.component._PortletInfo.instance){if(!c){c={}}ui.component._PortletInfo.instance=new ui.component.PortletInfo(c)}return ui.component._PortletInfo.instance};Ext.namespace("ui","ui.component","ui.component._PortletLocalMail");ui.component._PortletLocalMail.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getLastNews"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"title",mapping:"title"},{name:"link",mapping:"link"},{name:"description",mapping:"description"},{name:"pubDate",mapping:"pubDate",type:"date",dateFormat:"Y/m/d H:i:s"}]))});ui.component._PortletLocalMail.store.setDefaultSort("pubDate","desc");ui.component._PortletLocalMail.columns=[new Ext.grid.RowNumberer(),{id:"GridMailingTitle",header:_("Title"),sortable:true,dataIndex:"title"},{header:_("By"),width:100,sortable:true,dataIndex:"description"},{header:_("Date"),width:100,sortable:true,dataIndex:"pubDate",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.component._PortletLocalMail.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,height:250,autoExpandColumn:"GridMailingTitle",id:"PortletLocalMail-grid-id",store:ui.component._PortletLocalMail.store,columns:ui.component._PortletLocalMail.columns,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true,enableRowBody:true,ignoreAdd:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:false}),onRowDblClick:function(d,i,g){var c=d.store.getAt(i).data.pubDate,h=d.store.getAt(i).data.link,f=d.store.getAt(i).data.title;if(!Ext.getCmp("main-panel").findById("mail-"+c)){Ext.getCmp("main-panel").add({xtype:"panel",id:"mail-"+c,title:Ext.util.Format.substr(f,0,20)+"...",tabTip:f,iconCls:"iconMailing",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-mail-"+c,url:h})]})}Ext.getCmp("main-panel").setActiveTab("mail-"+c)},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-mail",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",c,this.ctxIndex,d);this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null;ui.component._PortletLocalMail.reloadData()}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxIndex){this.ctxIndex=null}this.ctxIndex=f;this.menu.showAt(d.getXY())},initComponent:function(c){ui.component._PortletLocalMail.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._PortletLocalMail.reloadData=function(){ui.component._PortletLocalMail.store.reload({callback:function(c,e,d){if(!d){Ext.getCmp("PortletLocalMail-grid-id").getView().mainBody.update('<div id="PortletLocalMail-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading mails from this mailing list !")+"</div>");Ext.get("PortletLocalMail-grid-defaultMess-id").highlight()}}})};ui.component.PortletLocalMail=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconMailing",id:"portletLocalMail",layout:"fit",store:ui.component._PortletLocalMail.store,reloadData:ui.component._PortletLocalMail.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.component._PortletLocalMail.reloadData()}}],listeners:{expand:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:false,notify:false})}},collapse:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.userConf.portletLocalMailCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){ui.component.PortletLocalMail.superclass.initComponent.call(this);Ext.apply(this,c);this.title=String.format(_("Mails from {0}"),"doc-"+this.lang);this.add(new ui.component._PortletLocalMail.grid())}});ui.component._PortletLocalMail.instance=null;ui.component.PortletLocalMail.getInstance=function(c){if(!ui.component._PortletLocalMail.instance){if(!c){c={}}ui.component._PortletLocalMail.instance=new ui.component.PortletLocalMail(c)}return ui.component._PortletLocalMail.instance};Ext.namespace("ui","ui.component","ui.component._PortletSummary");ui.component._PortletSummary.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getSummaryInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"libel",mapping:"libel"},{name:"nbFiles",mapping:"nbFiles"},{name:"percentFiles",mapping:"percentFiles"},{name:"sizeFiles",mapping:"sizeFiles"},{name:"percentSize",mapping:"percentSize"}])),listeners:{load:function(){this.each(function(c){switch(c.id){case 1:c.set("libel",_("Up to date files"));break;case 2:c.set("libel",_("Stale files"));break;case 3:c.set("libel",_("Files available for translation"));break;case 4:c.set("libel",_("Total"));break;default:c.set("libel","");break}c.commit()})}}});ui.component._PortletSummary.gridColumns=[new Ext.grid.RowNumberer(),{id:"StatusType",header:_("File status type"),width:180,sortable:true,dataIndex:"libel"},{header:_("Number of files"),width:110,sortable:true,dataIndex:"nbFiles"},{header:_("Percent of files"),width:110,sortable:true,dataIndex:"percentFiles"},{header:_("Size of files (kB)"),width:110,sortable:true,dataIndex:"sizeFiles"},{header:_("Percent of size"),width:110,sortable:true,dataIndex:"percentSize"}];ui.component._PortletSummary.gridView=new Ext.grid.GridView({getRowClass:function(c){switch(c.data.id){case 1:return"summary_1";case 2:return"summary_2";case 3:return"summary_3";case 4:return"summary_4";default:return""}}});ui.component._PortletSummary.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,autoHeight:true,store:ui.component._PortletSummary.store,columns:ui.component._PortletSummary.gridColumns,view:ui.component._PortletSummary.gridView,onRowdblclick:function(c,e){var d=c.store.getAt(e).data.id;if(d===2){Ext.getCmp("acc-need-update").expand()}if(d===3){Ext.getCmp("acc-need-translate").expand()}},initComponent:function(c){ui.component._PortletSummary.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowdblclick",this.onRowdblclick,this)}});ui.component.PortletSummary=Ext.extend(Ext.ux.Portlet,{title:_("Summary"),iconCls:"",id:"portletSummary",layout:"fit",store:ui.component._PortletSummary.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.component._PortletSummary.store.reload()}}],listeners:{expand:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:false,notify:false})}},collapse:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:true,notify:false})}}},initComponent:function(c){ui.component.PortletSummary.superclass.initComponent.call(this);Ext.apply(this,c);this.add(new ui.component._PortletSummary.grid())},afterRender:function(){ui.component.PortletSummary.superclass.afterRender.call(this);this.header.insertFirst({tag:"div",id:Ext.id(),style:"float: left; margin-right: 2px;",cls:"flags flag-"+this.lang},"first");if(PhDOE.userConf.portletSummaryCollapsed){this.collapse()}else{this.expand()}}});ui.component._PortletSummary.instance=null;ui.component.PortletSummary.getInstance=function(c){if(!ui.component._PortletSummary.instance){if(!c){c={}}ui.component._PortletSummary.instance=new ui.component.PortletSummary(c)}return ui.component._PortletSummary.instance};Ext.namespace("ui","ui.component","ui.component._PortletTranslationGraph");function renderLibel(c){return _(c)}ui.component._PortletTranslationGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLang"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"libel",mapping:"libel",convert:renderLibel},{name:"total",mapping:"total"}]))});ui.component._PortletTranslationGraph.chart=Ext.extend(Ext.chart.PieChart,{height:400,url:"http://extjs.cachefly.net/ext-3.2.0/resources/charts.swf",dataField:"total",categoryField:"libel",store:ui.component._PortletTranslationGraph.store,series:[{style:{colors:["#68D888","#FF6347","#EEE8AA"]}}],extraStyle:{legend:{display:"bottom",padding:5,font:{family:"Tahoma",size:13}}},initComponent:function(c){ui.component._PortletTranslationGraph.chart.superclass.initComponent.call(this);Ext.apply(this,c)}});ui.component.PortletTranslationGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics"),id:"portletTranslationGraph",iconCls:"iconGraphic",layout:"fit",store:ui.component._PortletTranslationGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.component._PortletTranslationGraph.store.reload()}}],initComponent:function(c){ui.component.PortletTranslationGraph.superclass.initComponent.call(this);Ext.apply(this,c);this.add(new ui.component._PortletTranslationGraph.chart())}});ui.component._PortletTranslationGraph.instance=null;ui.component.PortletTranslationGraph.getInstance=function(c){if(!ui.component._PortletTranslationGraph.instance){if(!c){c={}}ui.component._PortletTranslationGraph.instance=new ui.component.PortletTranslationGraph(c)}return ui.component._PortletTranslationGraph.instance};Ext.namespace("ui","ui.component","ui.component._PortletTranslationsGraph");ui.component._PortletTranslationsGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLangs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"libel",mapping:"libel",type:"string"},{name:"fullLibel",mapping:"fullLibel",type:"string"},{name:"total",mapping:"total",type:"int"},{name:"percent",mapping:"percent",type:"float"}]))});ui.component._PortletTranslationsGraph.chart=Ext.extend(Ext.chart.ColumnChart,{height:400,url:"http://extjs.cachefly.net/ext-3.2.0/resources/charts.swf",xField:"libel",tipRenderer:function(f,c,d,e){return _("Lang:")+" "+c.data.fullLibel+"\r"+_("Total:")+" "+c.data.total+" "+_("files")+" ("+c.data.percent+"%)"},series:[{type:"column",displayName:"Total",yField:"total",style:{image:"themes/img/bar.gif",mode:"stretch",color:10075112}}],store:ui.component._PortletTranslationsGraph.store,initComponent:function(c){ui.component._PortletTranslationsGraph.chart.superclass.initComponent.call(this);Ext.apply(this,c)}});ui.component.PortletTranslationsGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics for all language"),id:"portletTranslationsGraph",iconCls:"iconGraphic",layout:"fit",store:ui.component._PortletTranslationsGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.component._PortletTranslationsGraph.store.reload()}}],initComponent:function(c){ui.component.PortletTranslationsGraph.superclass.initComponent.call(this);Ext.apply(this,c);this.add(new ui.component._PortletTranslationsGraph.chart())}});ui.component._PortletTranslationsGraph.instance=null;ui.component.PortletTranslationsGraph.getInstance=function(c){if(!ui.component._PortletTranslationsGraph.instance){if(!c){c={}}ui.component._PortletTranslationsGraph.instance=new ui.component.PortletTranslationsGraph(c)}return ui.component._PortletTranslationsGraph.instance};Ext.namespace("ui","ui.component","ui.component._PortletTranslator");ui.component._PortletTranslator.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getTranslatorInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"name",mapping:"name"},{name:"email",mapping:"mail"},{name:"nick",mapping:"nick"},{name:"vcs",mapping:"vcs"},{name:"uptodate",mapping:"uptodate",type:"int"},{name:"stale",mapping:"stale",type:"int"},{name:"sum",mapping:"sum",type:"int"}]))});ui.component._PortletTranslator.store.setDefaultSort("nick","asc");ui.component._PortletTranslator.translatorSumRenderer=function(d){if(d){var c=(d===0||d>1)?d:1;return String.format("("+_("{0} Translators")+")",c)}else{return false}};ui.component._PortletTranslator.uptodateRenderer=function(c){if(c==="0"){return false}else{return'<span style="color:green; font-weight: bold;">'+c+"</span>"}};ui.component._PortletTranslator.staleRenderer=function(c){if(c==="0"){return false}else{return'<span style="color:red; font-weight: bold;">'+c+"</span>"}};ui.component._PortletTranslator.sumRenderer=function(c){return(c==="0")?"":c};ui.component._PortletTranslator.gridColumns=[new Ext.grid.RowNumberer(),{id:"GridTransName",header:_("Name"),sortable:true,dataIndex:"name",summaryType:"count",summaryRenderer:ui.component._PortletTranslator.translatorSumRenderer},{header:_("Email"),width:110,sortable:true,dataIndex:"email"},{header:_("Nick"),width:70,sortable:true,dataIndex:"nick"},{header:_("VCS"),width:45,sortable:true,dataIndex:"vcs"},{header:_("UptoDate"),width:60,sortable:true,renderer:ui.component._PortletTranslator.uptodateRenderer,dataIndex:"uptodate",summaryType:"sum"},{header:_("Stale"),width:90,sortable:true,renderer:ui.component._PortletTranslator.staleRenderer,dataIndex:"stale",summaryType:"sum"},{header:_("Sum"),width:50,sortable:true,renderer:ui.component._PortletTranslator.sumRenderer,dataIndex:"sum",summaryType:"sum"}];ui.component._PortletTranslator.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,autoHeight:true,plugins:[new Ext.ux.grid.GridSummary()],store:ui.component._PortletTranslator.store,columns:ui.component._PortletTranslator.gridColumns,autoExpandColumn:"GridTransName",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),lang:this.lang,EmailPrompt:new ui.component.EmailPrompt(),onRowDblClick:function(d,e){this.getSelectionModel().selectRow(e);if(this.ctxTranslatorName){this.ctxTranslatorEmail=null;this.ctxTranslatorName=null}this.ctxTranslatorEmail=this.store.getAt(e).data.email;this.ctxTranslatorName=this.store.getAt(e).data.name;var c=this.store.getAt(e).data.nick;if(c=="nobody"){return}this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail);this.EmailPrompt.show("lastUpdateTime")},onContextClick:function(d,g,f){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-translators",items:[{scope:this,text:"",iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail);this.EmailPrompt.show("lastUpdateTime")}},"-",{scope:this,text:String.format(_("Send an email to the {0}"),String.format(PhDOE.appConf.projectMailList,this.lang)),iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData("Php Doc Team "+this.lang,String.format(PhDOE.appConf.projectMailList,this.lang));this.EmailPrompt.show("lastUpdateTime")}}]})}this.getSelectionModel().selectRow(g);f.stopEvent();if(this.ctxTranslatorName){this.ctxTranslatorName=null;this.ctxTranslatorEmail=null}this.ctxTranslatorName=this.store.getAt(g).data.name;this.ctxTranslatorEmail=this.store.getAt(g).data.email;var c=this.store.getAt(g).data.nick;if(c=="nobody"){return}this.menu.items.items[0].setText("<b>"+String.format(_("Send an email to {0}"),this.ctxTranslatorName)+"</b>");this.menu.showAt(f.getXY())},initComponent:function(c){ui.component._PortletTranslator.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component.PortletTranslator=Ext.extend(Ext.ux.Portlet,{title:_("Translators"),iconCls:"iconTranslator",id:"portletTranslator",layout:"fit",store:ui.component._PortletTranslator.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.component._PortletTranslator.store.reload()}}],listeners:{expand:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:false,notify:false})}},collapse:function(c){if(PhDOE.appLoaded){new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.userConf.portletTranslatorCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){ui.component.PortletTranslator.superclass.initComponent.call(this);Ext.apply(this,c);this.add(new ui.component._PortletTranslator.grid({lang:this.lang}))}});ui.component._PortletTranslator.instance=null;ui.component.PortletTranslator.getInstance=function(c){if(!ui.component._PortletTranslator.instance){if(!c){c={}}ui.component._PortletTranslator.instance=new ui.component.PortletTranslator(c)}return ui.component._PortletTranslator.instance};Ext.namespace("ui","ui.component","ui.component._RepositoryTree");ui.component._RepositoryTree.root={nodeType:"async",id:"/",text:_("Repository"),draggable:false};ui.component._RepositoryTree.loader=new Ext.tree.TreeLoader({dataUrl:"./do/getAllFiles"});Ext.namespace("ui.component._RepositoryTree.menu");ui.component._RepositoryTree.menu.folder=function(c){Ext.apply(this,c);this.init();ui.component._RepositoryTree.menu.folder.superclass.constructor.call(this)};Ext.extend(ui.component._RepositoryTree.menu.folder,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:_("Update this folder"),iconCls:"iconFilesNeedUpdate",scope:this,handler:function(){this.node.expand();new ui.task.UpdateSingleFolderTask(this.node)}},{text:(this.node.isExpanded())?"<b>"+_("Collapse")+"</b>":"<b>"+_("Expand")+"</b>",iconCls:"iconFolderClose",scope:this,handler:function(){if(this.node.isExpanded()){this.node.collapse()}else{this.node.expand()}}}]})}});ui.component._RepositoryTree.menu.file=function(c){Ext.apply(this,c);this.init();ui.component._RepositoryTree.menu.file.superclass.constructor.call(this)};Ext.extend(ui.component._RepositoryTree.menu.file,Ext.menu.Menu,{init:function(){var c=this.node.attributes.text,d=this.node.attributes.id.split("/"),f,e;d.shift();f=d[0];d.shift();d.pop();e=d.join("/")+"/";Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconTabNeedReviewed",scope:this,handler:function(){ui.component._RepositoryTree.instance.fireEvent("dblclick",this.node)}},{hidden:(this.node.attributes.from==="search"||PhDOE.userLang=="en"),text:(f==="en")?String.format(_("Open the same file in <b>{0}</b>"),Ext.util.Format.uppercase(PhDOE.userLang)):String.format(_("Open the same file in <b>{0}</b>"),"EN"),iconCls:"iconTabNeedReviewed",scope:this,handler:function(){if(f==="en"){ui.component._RepositoryTree.instance.openFile("byPath",PhDOE.userLang+"/"+e,c)}else{ui.component._RepositoryTree.instance.openFile("byPath","en/"+e,c)}}}]})}});ui.component.RepositoryTree=Ext.extend(Ext.ux.MultiSelectTreePanel,{animate:true,enableDD:true,ddGroup:"mainPanelDDGroup",useArrows:true,autoScroll:true,border:false,containerScroll:true,root:ui.component._RepositoryTree.root,loader:ui.component._RepositoryTree.loader,onContextMenu:function(c,d){d.stopEvent();c.select();if(c.attributes.type==="folder"||c.isRoot){new ui.component._RepositoryTree.menu.folder({node:c}).showAt(d.getXY())}else{if(c.attributes.type==="file"){new ui.component._RepositoryTree.menu.file({node:c}).showAt(d.getXY())}}},onDblClick:function(c,d){if(c.attributes.type==="file"){this.openFile("byId",c.attributes.id,false)}},openFile:function(q,l,g){if(q==="byPath"){Ext.getCmp("acc-all-files").expand();var f=l,i=g,s=f.split("/"),k=function(v){v.ensureVisible();if(s[0]&&s[0]!==""){for(var t=0;t<v.childNodes.length;++t){if(v.childNodes[t].text===s[0]){s.shift();v.childNodes[t].expand(false,true,k.createDelegate(this))}}}else{for(var u=0;u<v.childNodes.length;++u){if(v.childNodes[u].text===i){v.childNodes[u].ensureVisible();v.childNodes[u].ui.highlight();this.openFile("byId",v.childNodes[u].id,false)}}}};this.root.expand(false,true,k.createDelegate(this))}if(q==="byId"){var j=this.getNodeById(l),c=j.attributes.id,r=j.attributes.extension,s,o,h,e,d,m,p;s=c.split("/");s.shift();e=s.pop();h=s.shift();c=(s.length>0)?"/"+s.join("/")+"/":"/";o=Ext.util.md5("AF-"+h+c+e);if(!Ext.getCmp("main-panel").findById("AF-"+o)){if(r!=="html"){d=r}else{d="xml"}if(r==="gif"||r==="png"){m={};p={id:"AF-ALL-FILE-"+o,xtype:"panel",region:"center",layout:"fit",bodyStyle:"padding:5px 5px 0",html:'<img src="./do/getImageContent?FileLang='+h+"&FilePath="+c+"&FileName="+e+'" />'}}else{m={xtype:"panel",region:"west",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],layout:"fit",bodyBorder:false,split:true,collapsible:true,collapsed:!PhDOE.userConf.allFilesDisplaylogPanel,width:PhDOE.userConf.allFilesDisplaylogPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"allFilesDisplaylogPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"allFilesDisplaylogPanel",value:true,notify:false})}},resize:function(t,u){if(this.ownerCt.tabLoaded&&u&&u!=PhDOE.userConf.allFilesDisplaylogPanelWidth){new ui.task.UpdateConfTask({item:"allFilesDisplaylogPanelWidth",value:u,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,defaults:{autoScroll:true},items:[{title:_("Log"),layout:"fit",items:[new ui.component.VCSLogGrid({prefix:"AF",fid:o,fpath:h+c,fname:e,loadStore:PhDOE.userConf.allFilesDisplayLog})]},{title:_("Entities"),layout:"fit",items:[new ui.component.EntitiesAcronymsPanel({dataType:"entities",prefix:"AF",ftype:"ALL",fid:o,loadStore:PhDOE.userConf.allFilesEntitiesLoadData})]},{title:_("Acronyms"),layout:"fit",items:[new ui.component.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"AF",ftype:"ALL",fid:o,loadStore:PhDOE.userConf.allFilesAcronymsLoadData})]}]}};p=new ui.component.FilePanel({id:"AF-ALL-PANEL-"+o,region:"center",title:_("File: ")+h+c+e,prefix:"AF",ftype:"ALL",spellCheck:PhDOE.userConf.allFilesSpellCheck,spellCheckConf:"allFilesSpellCheck",fid:o,fpath:c,fname:e,lang:h,parser:d,storeRecord:j,syncScrollCB:false,syncScroll:false})}Ext.getCmp("main-panel").add({id:"AF-"+o,layout:"border",title:e,originTitle:e,closable:true,tabLoaded:false,panEntities:!PhDOE.userConf.allFilesEntitiesLoadData,panAcronyms:!PhDOE.userConf.allFilesAcronymsLoadData,panVCS:!PhDOE.userConf.allFilesDisplayLog,panLoaded:false,tabTip:String.format(_("in {0}"),c),iconCls:"iconAllFiles",items:[p,m]})}Ext.getCmp("main-panel").setActiveTab("AF-"+o)}},initComponent:function(){Ext.apply(this,{tbar:[_("Search: ")," ",new Ext.form.TwinTriggerField({id:"AF-search",validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,enableKeyEvents:true,listeners:{keypress:function(d,c){if(c.getKey()==c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){var c=ui.component._RepositoryTree.instance;this.setValue("");this.triggers[0].hide();this.setSize(180,10);c.root.setText(_("Repository"));delete c.loader.baseParams.search;c.root.reload()},onTrigger2Click:function(){var c=ui.component._RepositoryTree.instance,d=this.getValue();if(d===""||d.length<3){this.markInvalid(_("Your search must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);c.loader.baseParams.search=d;c.root.reload(function(){c.root.setText(String.format(_("Search result: {0}"),c.root.childNodes.length))})}})]});ui.component.RepositoryTree.superclass.initComponent.call(this);this.on("contextmenu",this.onContextMenu,this);this.on("dblclick",this.onDblClick,this);new Ext.tree.TreeSorter(this,{folderSort:true})}});ui.component._RepositoryTree.instance=null;ui.component.RepositoryTree.getInstance=function(c){if(!ui.component._RepositoryTree.instance){if(!c){c={}}ui.component._RepositoryTree.instance=new ui.component.RepositoryTree(c)}return ui.component._RepositoryTree.instance};Ext.namespace("ui","ui.component","ui.component._StaleFileGrid");ui.component._StaleFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedUpdate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"revision"},{name:"original_revision"},{name:"en_revision"},{name:"maintainer"},{name:"needCommitEN"},{name:"needCommitLang"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-update-nb").innerHTML=c.getCount()}}});ui.component._StaleFileGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,getRowClass:function(c){if(c.data.needCommitEN||c.data.needCommitLang){return"file-need-commit"}return false},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});ui.component._StaleFileGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("EN revision"),width:45,sortable:true,dataIndex:"en_revision"},{header:"",width:45,sortable:true,dataIndex:"revision"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.component._StaleFileGrid.menu=function(c){Ext.apply(this,c);this.init();ui.component._StaleFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.component._StaleFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new Tab")+"</b>",iconCls:"iconTabNeedUpdate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideCommit,text:_("View Diff..."),iconCls:"iconViewDiff",menu:new Ext.menu.Menu({items:[{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.needCommitEN===false),text:String.format(_("... of the {0} file"),"EN"),handler:function(){this.openTab(this.rowIdx,"en",this.fpath,this.fname)}},{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.needCommitLang===false),text:String.format(_("... of the {0} file"),PhDOE.userLang),handler:function(){this.openTab(this.rowIdx,PhDOE.userLang,this.fpath,this.fname)}}]})}]})},openTab:function(d,e,c,f){if(!Ext.getCmp("main-panel").findById("diff_panel_"+e+"_"+d)){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+e+"_"+d,title:_("Diff"),tabTip:String.format(_("Diff for file: {0}"),e+c+f),closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+e+"_"+d+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+e+"_"+d);Ext.get("diff_panel_"+e+"_"+d).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" />'+_("Please, wait..."));XHR({params:{task:"getDiff",DiffType:"file",FilePath:e+c,FileName:f},success:function(g){var h=Ext.util.JSON.decode(g.responseText);Ext.get("diff_content_"+e+"_"+d).dom.innerHTML=h.content;Ext.get("diff_panel_"+e+"_"+d).unmask()}})}else{Ext.getCmp("main-panel").setActiveTab("diff_panel_"+e+"_"+d)}}});ui.component.StaleFileGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.component._StaleFileGrid.view,loadMask:true,autoExpandColumn:"name",border:false,enableDragDrop:true,ddGroup:"mainPanelDDGroup",onRowContextMenu:function(d,h,g){g.stopEvent();var f=this.store.getAt(h).data.path,c=this.store.getAt(h).data.name;this.getSelectionModel().selectRow(h);new ui.component._StaleFileGrid.menu({hideCommit:(this.store.getAt(h).data.needCommitEN===false&&this.store.getAt(h).data.needCommitLang===false),grid:this,event:g,rowIdx:h,lang:PhDOE.userLang,fpath:f,fname:c}).showAt(g.getXY())},onRowDblClick:function(c,f,d){this.openFile(this.store.getAt(f).data.id)},openFile:function(e){var g=this.store.getById(e),c=g.data.path,d=g.data.name,i=g.data.en_revision,h=g.data.revision,k=g.data.original_revision,f=Ext.util.md5("FNU-"+PhDOE.userLang+c+d),j="";if(!Ext.getCmp("main-panel").findById("FNU-"+f)){if(PhDOE.userConf.needUpdateDiff==="using-viewvc"){j=ui.component.ViewVCDiff}else{if(PhDOE.userConf.needUpdateDiff==="using-exec"){j=ui.component.ExecDiff}}Ext.getCmp("main-panel").add({id:"FNU-"+f,layout:"border",title:d,originTitle:d,iconCls:"iconTabNeedUpdate",closable:true,tabLoaded:false,panVCSLang:!PhDOE.userConf.needUpdateDisplaylog,panVCSEn:!PhDOE.userConf.needUpdateDisplaylog,panDiffLoaded:(PhDOE.userConf.needUpdateDiff==="using-viewvc"),panLANGLoaded:false,panENLoaded:false,defaults:{split:true},tabTip:String.format(_("Need Update: in {0}"),c),listeners:{resize:function(l){Ext.getCmp("FNU-EN-PANEL-"+f).setWidth(l.getWidth()/2)}},items:[new j({region:"north",collapsible:true,height:PhDOE.userConf.needUpdateDiffPanelHeight||150,prefix:"FNU",collapsed:!PhDOE.userConf.needUpdateDiffPanel,fid:f,fpath:c,fname:d,rev1:(k)?k:h,rev2:i,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"needUpdateDiffPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"needUpdateDiffPanel",value:true,notify:false})}},resize:function(o,l,m){if(this.ownerCt.tabLoaded&&m&&m>50&&m!=PhDOE.userConf.needUpdateDiffPanelHeight){new ui.task.UpdateConfTask({item:"needUpdateDiffPanelHeight",value:m,notify:false})}}}}),{region:"west",xtype:"panel",title:_("VCS Log"),iconCls:"iconVCSLog",collapsedIconCls:"iconVCSLog",collapsible:true,collapsed:!PhDOE.userConf.needUpdateDisplaylogPanel,layout:"fit",bodyBorder:false,plugins:[Ext.ux.PanelCollapsedTitle],width:PhDOE.userConf.needUpdateDisplaylogPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"needUpdateDisplaylogPanel",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({item:"needUpdateDisplaylogPanel",value:true,notify:false})}},resize:function(l,m){if(this.ownerCt.tabLoaded&&m&&m!=PhDOE.userConf.needUpdateDisplaylogPanelWidth){new ui.task.UpdateConfTask({item:"needUpdateDisplaylogPanelWidth",value:m,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[new ui.component.VCSLogGrid({layout:"fit",title:PhDOE.userLang,prefix:"FNU-LANG",fid:f,fpath:PhDOE.userLang+c,fname:d,loadStore:PhDOE.userConf.needUpdateDisplaylog}),new ui.component.VCSLogGrid({layout:"fit",title:"en",prefix:"FNU-EN",fid:f,fpath:"en"+c,fname:d,loadStore:PhDOE.userConf.needUpdateDisplaylog})]}},new ui.component.FilePanel({id:"FNU-LANG-PANEL-"+f,region:"center",title:String.format(_("{0} File: "),PhDOE.userLang)+c+d,prefix:"FNU",ftype:"LANG",spellCheck:PhDOE.userConf.needUpdateSpellCheckLang,spellCheckConf:"needUpdateSpellCheckLang",fid:f,fpath:c,fname:d,lang:PhDOE.userLang,parser:"xml",storeRecord:g,syncScrollCB:true,syncScroll:true,syncScrollConf:"needUpdateScrollbars"}),new ui.component.FilePanel({id:"FNU-EN-PANEL-"+f,region:"east",title:_("en File: ")+c+d,prefix:"FNU",ftype:"EN",spellCheck:PhDOE.userConf.needUpdateSpellCheckEn,spellCheckConf:"needUpdateSpellCheckEn",fid:f,fpath:c,fname:d,lang:"en",parser:"xml",storeRecord:g,syncScroll:true,syncScrollConf:"needUpdateScrollbars"})]})}Ext.getCmp("main-panel").setActiveTab("FNU-"+f)},initComponent:function(){ui.component._StaleFileGrid.columns[2].header=String.format(_("{0} revision"),Ext.util.Format.uppercase(PhDOE.userLang));Ext.apply(this,{columns:ui.component._StaleFileGrid.columns,store:ui.component._StaleFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNU-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.component._StaleFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue();if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);ui.component._StaleFileGrid.instance.store.filter("maintainer",c)}})]});ui.component.StaleFileGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.component._StaleFileGrid.instance=null;ui.component.StaleFileGrid.getInstance=function(c){if(!ui.component._StaleFileGrid.instance){if(!c){c={}}ui.component._StaleFileGrid.instance=new ui.component.StaleFileGrid(c)}return ui.component._StaleFileGrid.instance};Ext.namespace("ui","ui.component");ui.component.SystemUpdatePrompt=Ext.extend(Ext.Window,{id:"sys-update-win",title:_("Refresh all data"),layout:"form",width:300,height:200,resizable:false,modal:true,bodyStyle:"padding:15px 15px 0",iconCls:"iconRefresh",html:['<div id="wizard-step-1" class="wizard-step-before">',_("Update all files from VCS"),"</div>",'<div id="wizard-step-1.1" class="wizard-wait">',_("This may take time. Thank you for your patience..."),"</div>",'<div id="wizard-step-2" class="wizard-step-before">',_("Apply all tools"),"</div>",'<div id="wizard-step-3" class="wizard-step-before">',_("Reload data"),"</div>"].join(""),buttons:[{id:"btn-start-refresh",text:_("Start"),iconCls:"iconStartRefresh",handler:function(){Ext.getCmp("btn-start-refresh").disable();this.ownerCt.ownerCt.tools.close.setVisible(false);new ui.task.SystemUpdateTask()}}]});Ext.namespace("ui","ui.component","ui.component._VCSLogGrid");ui.component._VCSLogGrid.store=Ext.extend(Ext.data.Store,{reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",id:"id"},Ext.data.Record.create([{name:"id",mapping:"id"},{name:"revision",mapping:"revision"},{name:"date",mapping:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author",mapping:"author"},{name:"content",mapping:"content"}]))});ui.component._VCSLogGrid.sm=Ext.extend(Ext.grid.CheckboxSelectionModel,{singleSelect:false,header:"",width:22,listeners:{beforerowselect:function(d){var c=d.getCount();if(c===2){return false}return true},rowselect:function(d){var c=d.getCount();if(c===2){Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).enable();Ext.get(d.prefix+"-PANEL-btn-log-"+d.fid).frame("3F8538")}else{Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).disable()}},rowdeselect:function(d){var c=d.getCount();if(c===2){Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).enable();Ext.get(d.prefix+"-PANEL-btn-log-"+d.fid).frame("3F8538")}else{Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).disable()}}}});ui.component._VCSLogGrid.columns=[{id:"id",header:_("Rev."),width:40,sortable:false,dataIndex:"revision"},{header:_("Content"),width:130,sortable:true,dataIndex:"content"},{header:_("By"),width:50,sortable:true,dataIndex:"author"},{header:_("Date"),width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.component.VCSLogGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,bodyBorder:false,border:false,autoExpandColumn:"content",initComponent:function(){var f=new ui.component._VCSLogGrid.sm({fid:this.fid,prefix:this.prefix}),c=new ui.component._VCSLogGrid.store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:"./do/getLog"}),baseParams:{Path:this.fpath,File:this.fname},listeners:{scope:this,load:function(h,g){if(this.prefix==="FNU-EN"){Ext.getCmp("FNU-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)}if(this.prefix==="FNU-LANG"){Ext.getCmp("FNU-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)}if(this.prefix==="FE-EN"){Ext.getCmp("FE-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)}if(this.prefix==="FE-LANG"){Ext.getCmp("FE-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)}if(this.prefix==="FNR-EN"){Ext.getCmp("FNR-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)}if(this.prefix==="FNR-LANG"){Ext.getCmp("FNR-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)}if(this.prefix==="AF"){Ext.getCmp("AF-"+this.fid).panVCS=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","AF",this.fid)}if(this.prefix==="PP"){Ext.getCmp("PP-"+this.fid).panVCS=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","PP",this.fid)}}}}),e=[];e.push(f);for(var d=0;d<ui.component._VCSLogGrid.columns.length;++d){e.push(ui.component._VCSLogGrid.columns[d])}c.setDefaultSort("date","desc");Ext.apply(this,{sm:f,store:c,columns:e,view:new Ext.grid.GridView({forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:false}),tbar:[{scope:this,id:this.prefix+"-PANEL-btn-refreshlog-"+this.fid,tooltip:_("<b>Load/Refresh</b> revisions"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},{scope:this,id:this.prefix+"-PANEL-btn-log-"+this.fid,tooltip:_("<b>View</b> the diff"),iconCls:"iconViewDiff",disabled:true,handler:function(){var i=this.getSelectionModel().getSelections(),h=i[0].data.revision,g=i[1].data.revision;Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Finding the diff. Please, wait..."));XHR({params:{task:"getDiff",DiffType:"vcs",FilePath:this.fpath,FileName:this.fname,Rev1:h,Rev2:g},success:function(k){var l=Ext.util.JSON.decode(k.responseText);Ext.getBody().unmask();var j=new Ext.Window({title:String.format(_("Diff between {0} & {1}"),h,g),width:650,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:'<div class="diff-content">'+l.content+"</div>",buttons:[{text:_("Close"),handler:function(){j.close()}}]});j.show()}})}}]});ui.component.VCSLogGrid.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.component");ui.component.ViewVCDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",plugins:[Ext.ux.PanelCollapsedTitle],initComponent:function(){Ext.apply(this,{items:{id:this.prefix+"-diff-"+this.fid,xtype:"panel",layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+this.prefix+"-diff-"+this.fid,url:String.format(PhDOE.appConf.viewVcUrl,this.fpath+this.fname,this.rev1,this.rev2)})]}});ui.component.ViewVCDiff.superclass.initComponent.call(this)}});var PhDOE=function(){Ext.QuickTips.init();return{userLogin:null,userLang:null,appName:"Php Docbook Online Editor",appVer:"X.XX",appLoaded:false,uiRevision:"$Revision: 297450 $",userConf:"",project:"",FNTfilePendingOpen:[],FNUfilePendingOpen:[],FEfilePendingOpen:[],FNRfilePendingOpen:[],FNIENfilePendingOpen:[],AFfilePendingOpen:[],PPfilePendingOpen:[],init:function(){new ui.task.LoadConfigTask()},notify:function(d,g,e){var f,c;if(d=="info"){c="iconInfo"}if(d=="error"){c="iconError"}f=new Ext.ux.Notification({iconCls:c,title:g,html:e,autoDestroy:true,hideDelay:5000});f.show(document)},winForbidden:function(c){var d=_("Forbidden"),e=_("You can't do this action as anonymous user.");switch(c){case"fs_error":d=_("Error");e=_("File system error. Check read/write permission under data folder.");break;case"encoding_error":d=_("Error");e=_('You have used characters that require the use of UTF-8 despite the XML header.<br>Please delete these characters or change the header of the XML file in UTF-8 ; i.e.:<br><br><center><i>&lt;?xml version="1.0" encoding="utf-8"?&gt;</i></center>');break}Ext.MessageBox.alert(d,e)},runDirectAccess:function(){if(directAccess){ui.component.RepositoryTree.getInstance().openFile(directAccess.lang+directAccess.path,directAccess.name)}},afterLoadAllStore:function(){this.appLoaded=true;this.runDirectAccess();if(this.userConf.mainAppLoadMailsAtStartUp){ui.component.PortletLocalMail.getInstance().reloadData()}if(this.userConf.mainAppLoadBugsAtStartUp){ui.component.PortletBugs.getInstance().reloadData()}},loadAllStore:function(){var c=new Ext.ProgressBar({width:300,renderTo:"loading-progressBar"});c.show();if(PhDOE.userLang!=="en"){document.getElementById("loading-msg").innerHTML="Loading data...";c.updateProgress(1/12,"1 of 12...");ui.component._MainMenu.store.load({callback:function(){c.updateProgress(2/12,"2 of 12...");ui.component.StaleFileGrid.getInstance().store.load({callback:function(){c.updateProgress(3/12,"3 of 12...");ui.component.ErrorFileGrid.getInstance().store.load({callback:function(){c.updateProgress(4/12,"4 of 12...");ui.component.PendingReviewGrid.getInstance().store.load({callback:function(){c.updateProgress(5/12,"5 of 12...");ui.component.NotInENGrid.getInstance().store.load({callback:function(){c.updateProgress(6/12,"6 of 12...");ui.component.PendingCommitGrid.getInstance().store.load({callback:function(){c.updateProgress(7/12,"7 of 12...");ui.component.PendingPatchGrid.getInstance().store.load({callback:function(){c.updateProgress(8/12,"8 of 12...");ui.component.PortletSummary.getInstance().store.load({callback:function(){c.updateProgress(9/12,"9 of 12...");ui.component.PortletTranslationGraph.getInstance().store.load({callback:function(){c.updateProgress(10/12,"10 of 12...");ui.component.PortletTranslationsGraph.getInstance().store.load({callback:function(){c.updateProgress(11/12,"11 of 12...");ui.component.PortletTranslator.getInstance().store.load({callback:function(){c.updateProgress(12/12,"12 of 12...");ui.component.PendingTranslateGrid.getInstance().store.load({callback:function(){Ext.get("loading").remove();Ext.fly("loading-mask").fadeOut({remove:true});c.destroy();PhDOE.afterLoadAllStore()}})}})}})}})}})}})}})}})}})}})}})}})}else{document.getElementById("loading-msg").innerHTML="Loading data...";c.updateProgress(1/4,"1 of 5...");ui.component._MainMenu.store.load({callback:function(){c.updateProgress(2/4,"2 of 5...");ui.component.PendingPatchGrid.getInstance().store.load({callback:function(){c.updateProgress(3/4,"3 of 5...");ui.component.PortletTranslationsGraph.getInstance().store.load({callback:function(){c.updateProgress(4/4,"4 of 5...");ui.component.PendingCommitGrid.getInstance().store.load({callback:function(){c.updateProgress(4/4,"5 of 5...");ui.component.ErrorFileGrid.getInstance().store.load({callback:function(){Ext.get("loading").remove();Ext.fly("loading-mask").fadeOut({remove:true});c.destroy();PhDOE.afterLoadAllStore()}})}})}})}})}})}},reloadAllStore:function(){if(PhDOE.userLang!=="en"){ui.component.PendingTranslateGrid.getInstance().store.reload({callback:function(){ui.component.StaleFileGrid.getInstance().store.reload({callback:function(){ui.component.ErrorFileGrid.getInstance().store.reload({callback:function(){ui.component.PendingReviewGrid.getInstance().store.reload({callback:function(){ui.component.NotInENGrid.getInstance().store.reload({callback:function(){ui.component.PendingCommitGrid.getInstance().store.reload({callback:function(){ui.component.PendingPatchGrid.getInstance().store.reload({callback:function(){ui.component.PortletSummary.getInstance().store.reload({callback:function(){ui.component.PortletTranslator.getInstance().store.reload({callback:function(){ui.component.PortletTranslationGraph.getInstance().store.reload({callback:function(){ui.component.PortletTranslationsGraph.getInstance().store.reload()}})}})}})}})}})}})}})}})}})}})}else{ui.component.PendingCommitGrid.getInstance().store.reload({callback:function(){ui.component.PendingPatchGrid.getInstance().store.reload()}})}},drawInterface:function(){var c,h,j,d=[],f=[],g=[];h={col1:["portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationsGraph"]};j={col1:["portletSummary","portletTranslator","portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationGraph","portletTranslationsGraph"]};if(this.userLang==="en"){(this.userConf.portalSortEN)?c=Ext.util.JSON.decode(this.userConf.portalSortEN):c=h;g.portletLocalMail=ui.component.PortletLocalMail.getInstance({lang:this.userLang});g.portletBugs=ui.component.PortletBugs.getInstance({lang:this.userLang});g.portletInfo=ui.component.PortletInfo.getInstance();g.portletTranslationsGraph=ui.component.PortletTranslationsGraph.getInstance()}else{(this.userConf.portalSortLANG)?c=Ext.util.JSON.decode(this.userConf.portalSortLANG):c=j;g.portletSummary=ui.component.PortletSummary.getInstance({lang:this.userLang});g.portletTranslator=ui.component.PortletTranslator.getInstance({lang:this.userLang});g.portletLocalMail=ui.component.PortletLocalMail.getInstance({lang:this.userLang});g.portletBugs=ui.component.PortletBugs.getInstance({lang:this.userLang});g.portletInfo=ui.component.PortletInfo.getInstance();g.portletTranslationGraph=ui.component.PortletTranslationGraph.getInstance();g.portletTranslationsGraph=ui.component.PortletTranslationsGraph.getInstance()}for(var e=0;e<c.col1.length;e++){d.push(g[c.col1[e]])}for(var e=0;e<c.col2.length;e++){f.push(g[c.col2[e]])}ui.task.PingTask.getInstance().delay(30000);new Ext.Viewport({layout:"border",id:"main-app",items:[{region:"north",html:'<h1 class="x-panel-header"><img src="themes/img/mini_php.png" style="vertical-align: middle;" />&nbsp;&nbsp;'+this.appName+"</h1>",autoHeight:true,border:false,margins:"0 0 5 0"},{region:"west",id:"main-menu-panel",layout:"accordion",collapsible:true,collapseMode:"mini",animate:true,split:true,width:PhDOE.userConf.mainAppMainMenuWidth||300,header:false,listeners:{resize:function(i,l){if(l&&l!=PhDOE.userConf.mainAppMainMenuWidth){var k=new ui.task.UpdateConfTask({item:"mainAppMainMenuWidth",value:l,notify:false})}}},tbar:[{text:_("Main Menu"),iconCls:"MainMenu",menu:new ui.component.MainMenu()}],items:[{id:"acc-need-translate",title:_("Files Need Translate")+' (<em id="acc-need-translate-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedTranslate",hidden:(this.userLang==="en"),items:[ui.component.PendingTranslateGrid.getInstance()],collapsed:true},{id:"acc-need-update",title:_("Files Need Update")+' (<em id="acc-need-update-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedUpdate",hidden:(this.userLang==="en"),items:[ui.component.StaleFileGrid.getInstance()],collapsed:true},{id:"acc-error",title:(this.userLang==="en")?"Number of failures to meet 'strict standards' (<em id=\"acc-error-nb\">0</em>)":_("Error in current translation")+' (<em id="acc-error-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesError",items:[ui.component.ErrorFileGrid.getInstance()],collapsed:true},{id:"acc-need-reviewed",title:_("Files Need Reviewed")+' (<em id="acc-need-reviewed-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedReviewed",hidden:(this.userLang==="en"),items:[ui.component.PendingReviewGrid.getInstance()],collapsed:true},{id:"acc-notInEn",title:_("Not in EN tree")+' (<em id="acc-notInEn-nb">0</em>)',layout:"fit",border:false,iconCls:"iconNotInEn",hidden:(this.userLang==="en"),items:[ui.component.NotInENGrid.getInstance()],collapsed:true},{id:"acc-all-files",title:_("All files"),layout:"fit",border:false,iconCls:"iconAllFiles",items:[ui.component.RepositoryTree.getInstance()],collapsed:true},{id:"acc-need-pendingCommit",tools:[{id:"gear",hidden:(this.userLogin=="anonymous"),qtip:_("Open the Log Message Manager"),handler:function(){if(!Ext.getCmp("commit-log-win")){var i=new ui.component.CommitLogManager()}Ext.getCmp("commit-log-win").show("acc-need-pendingCommit")}}],title:_("Pending for commit")+' (<em id="acc-pendingCommit-nb">0</em>)',layout:"fit",border:false,iconCls:"iconPendingCommit",items:[ui.component.PendingCommitGrid.getInstance()],collapsed:true},{id:"acc-need-pendingPatch",title:_("Pending Patch")+' (<em id="acc-pendingPatch-nb">0</em>)',layout:"fit",border:false,iconCls:"iconPendingPatch",items:[ui.component.PendingPatchGrid.getInstance()],collapsed:true},{id:"acc-google-translate",title:_("Google Translation"),layout:"fit",border:false,iconCls:"iconGoogle",hidden:(this.userLang==="en"),items:[ui.component.GoogleTranslationPanel.getInstance()],collapsed:true}]},{xtype:"mainpanel",id:"main-panel",region:"center",items:[{xtype:"panel",id:"MainInfoTabPanel",title:_("Home"),baseCls:"MainInfoTabPanel",autoScroll:true,plain:true,items:[{xtype:"panel",border:false,html:'<div class="res-block"><div class="res-block-inner"><h3>'+((this.userLogin!="anonymous")?String.format(_("Connected as <em>{0}</em>"),this.userLogin):String.format(_("Connected as <em>{0}</em>"),_("anonymous")))+"<br/><br/>"+_("Project / Language: ")+'<em id="Info-Project">'+this.project+'</em> / <em id="Info-Language">-</em></h3></div></div>'},{xtype:"portal",border:false,items:[{columnWidth:0.5,style:"padding:10px 5px 10px 5px",items:d},{columnWidth:0.5,style:"padding:10px 5px 10px 5px",items:f}],listeners:{drop:function(l){var k,m=[],p=[],q;for(var o=0;o<l.portal.items.items[0].items.items.length;o++){q=l.portal.items.items[0].items.items[o].id;m.push(q)}for(var o=0;o<l.portal.items.items[1].items.items.length;o++){q=l.portal.items.items[1].items.items[o].id;p.push(q)}k={col1:m,col2:p};new ui.task.UpdateConfTask({item:(PhDOE.userLang==="en")?"portalSortEN":"portalSortLANG",value:Ext.util.JSON.encode(k),notify:false})}}}]}]}]});new Ext.dd.DropTarget(Ext.get("main-panel"),{ddGroup:"mainPanelDDGroup",notifyDrop:function(p,o,m){var l,k;if(m.nodes){for(l=0;l<m.nodes.length;l++){PhDOE.AFfilePendingOpen[l]={nodeID:m.nodes[l].attributes.id}}ui.component.RepositoryTree.getInstance().openFile("byId",PhDOE.AFfilePendingOpen[0].nodeID,false);PhDOE.AFfilePendingOpen.shift();return true}if(m.grid.ownerCt.id==="acc-need-pendingCommit"){m.grid.openFile(m.selections[0].data.id);return true}for(l=0;l<m.selections.length;l++){if(m.grid.ownerCt.id==="acc-need-translate"){PhDOE.FNTfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-need-update"){PhDOE.FNUfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-error"){PhDOE.FEfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-need-reviewed"){PhDOE.FNRfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-notInEn"){PhDOE.FNIENfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-need-pendingPatch"){PhDOE.PPfilePendingOpen[l]={id:m.selections[l].data.id}}if(m.grid.ownerCt.id==="acc-need-pendingPatch"){PhDOE.PPfilePendingOpen[l]={id:m.selections[l].data.id}}}if(m.grid.ownerCt.id==="acc-need-translate"){k=PhDOE.FNTfilePendingOpen[0];PhDOE.FNTfilePendingOpen.shift()}if(m.grid.ownerCt.id==="acc-need-update"){k=PhDOE.FNUfilePendingOpen[0];PhDOE.FNUfilePendingOpen.shift()}if(m.grid.ownerCt.id==="acc-error"){k=PhDOE.FEfilePendingOpen[0];PhDOE.FEfilePendingOpen.shift()}if(m.grid.ownerCt.id==="acc-need-reviewed"){k=PhDOE.FNRfilePendingOpen[0];PhDOE.FNRfilePendingOpen.shift()}if(m.grid.ownerCt.id==="acc-notInEn"){k=PhDOE.FNIENfilePendingOpen[0];PhDOE.FNIENfilePendingOpen.shift()}if(m.grid.ownerCt.id==="acc-need-pendingPatch"){k=PhDOE.PPfilePendingOpen[0];PhDOE.PPfilePendingOpen.shift()}m.grid.openFile(k.id);return true}});this.loadAllStore()}}}();Ext.EventManager.onDocumentReady(PhDOE.init,PhDOE,true);