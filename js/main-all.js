Ext.BLANK_IMAGE_URL="js/ExtJs/resources/images/default/s.gif";String.prototype.ucFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1,this.length)};Ext.override(Ext.grid.CheckboxSelectionModel,{handleMouseDown:function(h,k,j){if(j.button!==0||this.isLocked()){return}var c=this.grid.getView();if(j.shiftKey&&this.last!==false){var f=this.last;this.selectRange(f,k,j.ctrlKey);this.last=f;c.focusRow(k)}else{var d=this.isSelected(k);if(d){this.deselectRow(k)}else{if(!d){this.selectRow(k,!this.singleSelect);c.focusRow(k)}}}}});function log(){if(console){console.log.apply(this,arguments)}}function _(c){try{var f=i18n[c];if(f===undefined){f=c;log("FIX ME : i18n not found for the string: "+c)}return f}catch(d){return c}}function XHR(e){var d=e.success,f=e.failure,c=e.callback;e.url="./do/"+e.params.task;delete e.params.task;e.params=Ext.applyIf({csrfToken:csrfToken},e.params);e.failure=e.success=Ext.emptyFn;e.callback=function(h,l,g){var k=null;try{k=Ext.decode(g.responseText)}catch(j){log("Invalid XHR JSON Response:"+g.responseText)}if(l&&k&&k.success){if(d!==undefined){Ext.callback(d,e.scope,[g,h])}}else{if(f!==undefined){Ext.callback(f,e.scope,[g,h])}}if(c!==undefined){Ext.callback(c,e.scope,[h,l,g])}};Ext.Ajax.request(e)}
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(c,d){this.portal=c;Ext.dd.ScrollManager.register(c.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,c.bwrap.dom,d);c.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(d,h,g,f,k,j){return{portal:this.portal,panel:g.panel,columnIndex:f,column:k,position:j,data:g,source:d,rawEvent:h,status:this.dropAllowed}},notifyOver:function(z,x,A){var j=x.getXY(),d=this.portal,s=z.proxy;if(!this.grid){this.grid=this.getGrid()}var f=d.body.dom.clientWidth;if(!this.lastCW){this.lastCW=f}else{if(this.lastCW!=f){this.lastCW=f;d.doLayout();this.grid=this.getGrid()}}var g=0,q=this.grid.columnX,r=false;for(var w=q.length;g<w;g++){if(j[0]<(q[g].x+q[g].w)){r=true;break}}if(!r){g--}var u,o=false,l=0,y=d.items.itemAt(g),t=y.items.items,m=false;for(var w=t.length;l<w;l++){u=t[l];var v=u.el.getHeight();if(v===0){m=true}else{if((u.el.getY()+(v/2))>j[1]){o=true;break}}}l=(o&&u?l:y.items.getCount())+(m?-1:0);var k=this.createEvent(z,x,A,g,y,l);if(d.fireEvent("validatedrop",k)!==false&&d.fireEvent("beforedragover",k)!==false){s.getProxy().setWidth("auto");if(u){s.moveProxy(u.el.dom.parentNode,o?u.el.dom:null)}else{s.moveProxy(y.el.dom,null)}this.lastPos={c:y,col:g,p:m||(o&&u)?l:false};this.scrollPos=d.body.getScroll();d.fireEvent("dragover",k);return k.status}else{return k.status}},notifyOut:function(){delete this.grid},notifyDrop:function(o,j,h){delete this.grid;if(!this.lastPos){return}var l=this.lastPos.c,g=this.lastPos.col,m=this.lastPos.p;var f=this.createEvent(o,j,h,g,l,m!==false?m:l.items.getCount());if(this.portal.fireEvent("validatedrop",f)!==false&&this.portal.fireEvent("beforedrop",f)!==false){o.proxy.getProxy().remove();o.panel.el.dom.parentNode.removeChild(o.panel.el.dom);if(m!==false){if(l==o.panel.ownerCt&&(l.items.items.indexOf(o.panel)<=m)){m++}l.insert(m,o.panel)}else{l.add(o.panel)}l.doLayout();this.portal.fireEvent("drop",f);var p=this.scrollPos.top;if(p){var k=this.portal.body.dom;setTimeout(function(){k.scrollTop=p},10)}}delete this.lastPos},getGrid:function(){var c=this.portal.bwrap.getBox();c.columnX=[];this.portal.items.each(function(d){c.columnX.push({x:d.el.getX(),w:d.el.getWidth()})});return c},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(c){this.grid=c;this.ownerCt=c;if(this.clicksToEdit===2){c.on("rowdblclick",this.onRowDblClick,this)}else{c.on("rowclick",this.onRowClick,this);if(Ext.isIE){c.on("rowdblclick",this.onRowDblClick,this)}}c.getStore().on("remove",function(){this.stopEditing(false)},this);c.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});c.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});c.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var c;this.items.each(function(d){if(String(this.values[d.id])!==String(d.getValue())){c=true;return false}},this);return c},startEditing:function(m,s){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(m)){m=this.grid.getStore().indexOf(m)}if(this.fireEvent("beforeedit",this,m)!==false){this.editing=true;var j=this.grid,o=j.getView(),r=o.getRow(m),e=j.store.getAt(m);this.record=e;this.rowIndex=m;this.values={};if(!this.rendered){this.render(o.getEditorParent())}var p=Ext.fly(r).getWidth();this.setSize(p);if(!this.initialized){this.initFields()}var q=j.getColumnModel(),h=this.items.items,l,c;for(var d=0,k=q.getColumnCount();d<k;d++){c=this.preEditValue(e,q.getDataIndex(d));l=h[d];l.setValue(c);this.values[l.id]=Ext.isEmpty(c)?"":c}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(r).getXY())}else{this.el.setXY(Ext.fly(r).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(s!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(o){this.editing=false;if(!this.isVisible()){return}if(o===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,o===false);return}var j={},d=this.record,k=false,m=this.grid.colModel,g=this.items.items;for(var f=0,h=m.getColumnCount();f<h;f++){if(!m.isHidden(f)){var e=m.getDataIndex(f);if(!Ext.isEmpty(e)){var c=d.data[e],l=this.postEditValue(g[f].getValue(),c,d,e);if(String(c)!==String(l)){j[e]=l;k=true}}}}if(k&&this.fireEvent("validateedit",this,j,d,this.rowIndex)!==false){d.beginEdit();Ext.iterate(j,function(p,q){d.set(p,q)});d.endEdit();this.fireEvent("afteredit",this,j,d,this.rowIndex)}this.hide()},verifyLayout:function(g){if(this.el&&(this.isVisible()||g===true)){var j=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(j).getWidth(),Ext.isIE?Ext.fly(j).getHeight()+9:undefined);var e=this.grid.colModel,d=this.items.items;for(var f=0,c=e.getColumnCount();f<c;f++){if(!e.isHidden(f)){var h=0;if(f===(c-1)){h+=3}else{h+=1}d[f].show();d[f].setWidth(e.getColumnWidth(f)-h)}else{d[f].hide()}}this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var e=this.grid.getColumnModel(),h=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var g=0,d=e.getColumnCount();g<d;g++){var j=e.getColumnAt(g),f=j.getEditor();if(!f){f=j.displayEditor||new Ext.form.DisplayField()}if(g==0){f.margins=h("0 1 2 1")}else{if(g==d-1){f.margins=h("0 0 2 1")}else{if(Ext.isIE){f.margins=h("0 0 2 0")}else{f.margins=h("0 1 2 0")}}}f.setWidth(e.getColumnWidth(g));f.column=j;if(f.ownerCt!==this){f.on("focus",this.ensureVisible,this);f.on("specialkey",this.onKey,this)}this.insert(g,f)}this.initialized=true},onKey:function(c,d){if(d.getKey()===d.ENTER){this.stopEditing(true);d.stopPropagation()}},onGridKey:function(f){if(f.getKey()===f.ENTER&&!this.isVisible()){var d=this.grid.getSelectionModel().getSelected();if(d){var c=this.grid.store.indexOf(d);this.startEditing(c);f.stopPropagation()}}},ensureVisible:function(c){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(c.column.id),true)}},onRowClick:function(d,h,f){if(this.clicksToEdit=="auto"){var c=this.lastClickIndex;this.lastClickIndex=h;if(c!=h&&!this.isVisible()){return}}this.startEditing(h,false);this.doFocus.defer(this.focusDelay,this,[f.getPoint()])},onRowDblClick:function(c,f,d){this.startEditing(f,false);this.doFocus.defer(this.focusDelay,this,[d.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var j=this.grid,f=this.el.dom.clientHeight,d=j.getView(),c=d.scroller.dom.scrollLeft,k=this.btns.getWidth(),e=Math.min(j.getWidth(),j.getColumnModel().getTotalWidth());this.btns.el.shift({left:(e/2)-(k/2)+c,top:f-2,stopFx:true,duration:0.2})}},preEditValue:function(c,e){var d=c.data[e];return this.autoEncode&&typeof d==="string"?Ext.util.Format.htmlDecode(d):d},postEditValue:function(e,c,d,f){return this.autoEncode&&typeof e=="string"?Ext.util.Format.htmlEncode(e):e},doFocus:function(h){if(this.isVisible()){var f=0,e=this.grid.getColumnModel(),j;if(h){f=this.getTargetColumnIndex(h)}for(var g=f||0,d=e.getColumnCount();g<d;g++){j=e.getColumnAt(g);if(!j.hidden&&j.getEditor()){j.getEditor().focus();break}}}},getTargetColumnIndex:function(m){var d=this.grid,l=d.view,k=m.left,h=d.colModel.config,e=0,f=false;for(var g=h.length,j;j=h[e];e++){if(!j.hidden){if(Ext.fly(l.getHeaderCell(e)).getRegion().right>=k){f=e;break}}}return f},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var c=true;this.items.each(function(d){if(!d.isValid(true)){c=false;return false}});return c},bindHandler:function(){if(!this.bound){return false}var c=this.isValid();if(!c&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!c);this.fireEvent("validation",this,c)},lastVisibleColumn:function(){var d=this.items.getCount()-1,e;for(;d>=0;d--){e=this.items.items[d];if(!e.hidden){return e}}},showTooltip:function(j){var e=this.tooltip;if(!e){e=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var d=this.grid.getView(),g=parseInt(this.el.dom.style.top,10),c=d.scroller.dom.scrollTop,f=this.el.getHeight();if(g+f>=c){e.initTarget(this.lastVisibleColumn().getEl());if(!e.rendered){e.show();e.hide()}e.body.update(j);e.doAutoWidth(20);e.show()}else{if(e.rendered){e.hide()}}},getErrorText:function(){var c=["<ul>"];this.items.each(function(d){if(!d.isValid(true)){c.push("<li>",d.getActiveError(),"</li>")}});c.push("</ul>");return c}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(c){Ext.ux.Spinner.superclass.constructor.call(this,c);Ext.apply(this,c);this.mimicing=false},init:function(c){this.field=c;c.afterMethod("onRender",this.doRender,this);c.afterMethod("onEnable",this.doEnable,this);c.afterMethod("onDisable",this.doDisable,this);c.afterMethod("afterRender",this.doAfterRender,this);c.afterMethod("onResize",this.doResize,this);c.afterMethod("onFocus",this.doFocus,this);c.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(d,c){var e=this.el=this.field.getEl();var g=this.field;if(!g.wrap){g.wrap=this.wrap=e.wrap({cls:"x-form-field-wrap"})}else{this.wrap=g.wrap.addClass("x-form-field-wrap")}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!g.width){this.wrap.setWidth(e.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var c;if(Ext.isIE&&this.el.getY()!=(c=this.trigger.getY())){this.el.position();this.el.setY(c)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(c,d){if(typeof c=="number"){this.el.setWidth(c-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this)}},checkTab:function(c){if(c.getKey()==c.TAB){this.triggerBlur()}},mimicBlur:function(c){if(!this.wrap.contains(c.target)&&this.field.validateBlur(c)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(c){c.preventDefault();this.onSpinUp()},down:function(c){c.preventDefault();this.onSpinDown()},pageUp:function(c){c.preventDefault();this.onSpinUpAlternate()},pageDown:function(c){c.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var c=this.getMiddle();if(((Ext.EventObject.getPageY()>c)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<c)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var d=this.getMiddle();var c=(Ext.EventObject.getPageY()<d)?"Up":"Down";this["onSpin"+c]()},getMiddle:function(){var d=this.trigger.getTop();var e=this.trigger.getHeight();var c=d+(e/2);return c},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(c){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return}var d=c.getWheelDelta();if(d>0){this.onSpinUp();c.stopEvent()}else{if(d<0){this.onSpinDown();c.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var d=Ext.fly(this.dd.getDragEl()).getTop();var c="";if(this._previousY>d){c="Up"}if(this._previousY<d){c="Down"}if(c!=""){this["onSpin"+c]()}this._previousY=d},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},spin:function(f,d){var c=parseFloat(this.field.getValue());var e=(d==true)?this.alternateIncrementValue:this.incrementValue;(f==true)?c-=e:c+=e;c=(isNaN(c))?this.defaultValue:c;c=this.fixBoundries(c);this.field.setRawValue(c)},fixBoundries:function(d){var c=d;if(this.field.minValue!=undefined&&c<this.field.minValue){c=this.field.minValue}if(this.field.maxValue!=undefined&&c>this.field.maxValue){c=this.field.maxValue}return this.fixPrecision(c)},fixPrecision:function(d){var c=isNaN(d);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||c||!d){return c?"":d}return parseFloat(parseFloat(d).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.Spinner=Ext.ux.Spinner;
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.form");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(e){var d=Ext.copyTo({},e,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var f=this.spinner=new Ext.ux.Spinner(d);var c=e.plugins?(Ext.isArray(e.plugins)?e.plugins.push(f):[e.plugins,f]):f;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(e,{plugins:c}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},validateBlur:function(){return true}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right"){this.cls+=" x-status-right"}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var c=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(c){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}this.doLayout()},setStatus:function(f){f=f||{};if(typeof f=="string"){f={text:f}}if(f.text!==undefined){this.setText(f.text)}if(f.iconCls!==undefined){this.setIcon(f.iconCls)}if(f.clear){var g=f.clear,e=this.autoClear,d={useDefaults:true,anim:true};if(typeof g=="object"){g=Ext.applyIf(g,d);if(g.wait){e=g.wait}}else{if(typeof g=="number"){e=g;g=d}else{if(typeof g=="boolean"){g=d}}}g.threadId=this.activeThreadId;this.clearStatus.defer(e,this,[g])}return this},clearStatus:function(e){e=e||{};if(e.threadId&&e.threadId!==this.activeThreadId){return this}var d=e.useDefaults?this.defaultText:this.emptyText,c=e.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(e.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:d,iconCls:c});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:d,iconCls:c});this.statusEl.show()}return this},setText:function(c){this.activeThreadId++;this.text=c||"";if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(c){this.activeThreadId++;c=c||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(c.length>0){this.statusEl.addClass(c);this.currIconCls=c}}else{this.currIconCls=c}return this},showBusy:function(c){if(typeof c=="string"){c={text:c}}c=Ext.applyIf(c||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(c)}});Ext.reg("statusbar",Ext.ux.StatusBar);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:_("Close Tab"),closeOtherTabsText:_("Close Other Tabs"),showCloseAll:true,closeAllTabsText:_("Close All Tabs"),constructor:function(c){Ext.apply(this,c||{})},init:function(c){this.tabs=c;c.on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy})},destroy:function(){Ext.destroy(this.menu);delete this.menu;delete this.tabs;delete this.active},onContextMenu:function(d,f,j){this.active=f;var c=this.createMenu(),g=true,k=true,h=c.getComponent("closeall");c.getComponent("close").setDisabled(!f.closable);d.items.each(function(){if(this.closable){g=false;if(this!=f){k=false;return false}}});c.getComponent("closeothers").setDisabled(k);if(h){h.setDisabled(g)}j.stopEvent();c.showAt(j.getPoint())},createMenu:function(){if(!this.menu){var c=[{itemId:"close",text:this.closeTabText,scope:this,handler:this.onClose}];if(this.showCloseAll){c.push("-")}c.push({itemId:"closeothers",iconCls:"iconCloseOthersTabs",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});if(this.showCloseAll){c.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll})}this.menu=new Ext.menu.Menu({items:c})}return this.menu},onClose:function(){this.tabs.remove(this.active)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(d){var c=[];this.tabs.items.each(function(e){if(e.closable){if(!d||e!=this.active){c.push(e)}}},this);Ext.each(c,function(e){this.tabs.remove(e)},this)}});Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.tree");Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(c,d){if(!Ext.isObject(d)){d={property:c.columns[0].dataIndex||"text",folderSort:true}}Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);this.tree=c;c.on("headerclick",this.onHeaderClick,this);c.ddAppendOnly=true;me=this;this.defaultSortFn=function(m,l){var h=me.dir&&me.dir.toLowerCase()=="desc";var e=me.property||"text";var g=me.sortType;var j=me.folderSort;var k=me.caseSensitive===true;var f=me.leafAttr||"leaf";if(j){if(m.attributes[f]&&!l.attributes[f]){return 1}if(!m.attributes[f]&&l.attributes[f]){return -1}}var q=g?g(m):(k?m.attributes[e]:m.attributes[e].toUpperCase());var o=g?g(l):(k?l.attributes[e]:l.attributes[e].toUpperCase());if(q<o){return h?+1:-1}else{if(q>o){return h?-1:+1}else{return 0}}};c.on("afterrender",this.onAfterTreeRender,this,{single:true});c.on("headermenuclick",this.onHeaderMenuClick,this)},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"})}this.updateSortIcon(0,"asc")},onHeaderMenuClick:function(f,e,d){if(e==="asc"||e==="desc"){this.onHeaderClick(f,null,d);return false}},onHeaderClick:function(g,e,d){if(g&&!this.tree.headersDisabled){var f=this;f.property=g.dataIndex;f.dir=g.dir=(g.dir==="desc"?"asc":"desc");f.sortType=g.sortType;f.caseSensitive===Ext.isBoolean(g.caseSensitive)?g.caseSensitive:this.caseSensitive;f.sortFn=g.sortFn||this.defaultSortFn;this.tree.root.cascade(function(c){if(!c.isLeaf()){f.updateSort(f.tree,c)}});this.updateSortIcon(d,g.dir)}},updateSortIcon:function(d,c){var f=this.sortClasses;var e=this.tree.innerHd.select("td").removeClass(f);e.item(d).addClass(f[c=="desc"?1:0])}});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.tree.ColumnResizer=Ext.extend(Ext.util.Observable,{minWidth:14,constructor:function(c){Ext.apply(this,c);Ext.tree.ColumnResizer.superclass.constructor.call(this)},init:function(c){this.tree=c;c.on("render",this.initEvents,this)},initEvents:function(c){c.mon(c.innerHd,"mousemove",this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(c.innerHd);c.on("beforedestroy",this.tracker.destroy,this.tracker)},handleHdMove:function(h,m){var j=5,l=h.getPageX(),g=h.getTarget(".x-treegrid-hd",3,true);if(g){var d=g.getRegion(),o=g.dom.style,f=g.dom.parentNode;if(l-d.left<=j&&g.dom!==f.firstChild){var c=g.dom.previousSibling;while(c&&Ext.fly(c).hasClass("x-treegrid-hd-hidden")){c=c.previousSibling}if(c){this.activeHd=Ext.get(c);o.cursor=Ext.isWebKit?"e-resize":"col-resize"}}else{if(d.right-l<=j){var k=g.dom;while(k&&Ext.fly(k).hasClass("x-treegrid-hd-hidden")){k=k.previousSibling}if(k){this.activeHd=Ext.get(k);o.cursor=Ext.isWebKit?"w-resize":"col-resize"}}else{delete this.activeHd;o.cursor=""}}}},onBeforeStart:function(c){this.dragHd=this.activeHd;return !!this.dragHd},onStart:function(d){this.tree.headersDisabled=true;this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"});this.proxy.setHeight(this.tree.body.getHeight());var c=this.tracker.getXY()[0];this.hdX=this.dragHd.getX();this.hdIndex=this.tree.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(c-this.hdX);this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left},onDrag:function(d){var c=this.tracker.getXY()[0];this.proxy.setWidth((c-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(f){var d=this.proxy.getWidth(),c=this.tree;this.proxy.remove();delete this.dragHd;c.columns[this.hdIndex].width=d;c.updateColumnWidths();setTimeout(function(){c.headersDisabled=false},100)}});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGridNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(e,m,j,o){var p=e.getOwnerTree(),l=p.columns,k=l[0],f,d,h;this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"";d=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf ',m.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',m.icon||this.emptyIcon,'" class="x-tree-node-icon',(m.icon?" x-tree-node-inline-icon":""),(m.iconCls?" "+m.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',m.href?m.href:"#",'" tabIndex="1" ',m.hrefTarget?' target="'+m.hrefTarget+'"':"",">",'<span unselectable="on">',(k.tpl?k.tpl.apply(m):m[k.dataIndex]||k.text),"</span></a>","</td>"];for(f=1,h=l.length;f<h;f++){k=l[f];d.push('<td class="x-treegrid-col ',(k.cls?k.cls:""),'">','<div unselectable="on" class="x-treegrid-text"',(k.align?' style="text-align: '+k.align+';"':""),">",(k.tpl?k.tpl.apply(m):m[k.dataIndex]),"</div>","</td>")}d.push('</tr><tr class="x-tree-node-ct"><td colspan="',l.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',p.innerCt.getWidth(),'px;"><colgroup>');for(f=0,h=l.length;f<h;f++){d.push('<col style="width: ',(l[f].hidden?0:l[f].width),'px;" />')}d.push("</colgroup></table></td></tr></tbody>");if(o!==true&&e.nextSibling&&e.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",e.nextSibling.ui.getEl(),d.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",j,d.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;var g=this.elNode.firstChild.childNodes;this.indentNode=g[0];this.ecNode=g[1];this.iconNode=g[2];this.anchor=g[3];this.textNode=g[3].firstChild},animExpand:function(c){this.ctNode.style.display="";Ext.ux.tree.TreeGridNodeUI.superclass.animExpand.call(this,c)}});Ext.ux.tree.TreeGridRootNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true}if(Ext.isWebKit){var c=this.ctNode;c.style.tableLayout=null;(function(){c.style.tableLayout="fixed"}).defer(1)}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id)}delete this.node},collapse:Ext.emptyFn,expand:Ext.emptyFn});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGridLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(c){if(!c.uiProvider){c.uiProvider=Ext.ux.tree.TreeGridNodeUI}return Ext.tree.TreeLoader.prototype.createNode.call(this,c)}});
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){Ext.override(Ext.list.Column,{init:function(){var d=Ext.data.Types,c=this.sortType;if(this.type){if(Ext.isString(this.type)){this.type=Ext.data.Types[this.type.toUpperCase()]||d.AUTO}}else{this.type=d.AUTO}if(Ext.isString(c)){this.sortType=Ext.data.SortTypes[c]}else{if(Ext.isEmpty(c)){this.sortType=this.type.sortType}}}});Ext.tree.Column=Ext.extend(Ext.list.Column,{});Ext.tree.NumberColumn=Ext.extend(Ext.list.NumberColumn,{});Ext.tree.DateColumn=Ext.extend(Ext.list.DateColumn,{});Ext.tree.BooleanColumn=Ext.extend(Ext.list.BooleanColumn,{});Ext.reg("tgcolumn",Ext.tree.Column);Ext.reg("tgnumbercolumn",Ext.tree.NumberColumn);Ext.reg("tgdatecolumn",Ext.tree.DateColumn);Ext.reg("tgbooleancolumn",Ext.tree.BooleanColumn)})();
/*
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGrid=Ext.extend(Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:true,enableSort:true,reserveScrollOffset:true,enableHdMenu:true,columnsText:"Columns",initComponent:function(){if(!this.root){this.root=new Ext.tree.AsyncTreeNode({text:"Root"})}var d=this.loader;if(!d){d=new Ext.ux.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store})}else{if(Ext.isObject(d)&&!d.load){d=new Ext.ux.tree.TreeGridLoader(d)}else{if(d){d.createNode=function(c){if(!c.uiProvider){c.uiProvider=Ext.ux.tree.TreeGridNodeUI}return Ext.tree.TreeLoader.prototype.createNode.call(this,c)}}}}this.loader=d;Ext.ux.tree.TreeGrid.superclass.initComponent.call(this);this.initColumns();if(this.enableSort){this.treeGridSorter=new Ext.ux.tree.TreeGridSorter(this,this.enableSort)}if(this.columnResize){this.colResizer=new Ext.tree.ColumnResizer(this.columnResize);this.colResizer.init(this)}var e=this.columns;if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</div></table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>")}if(!this.colgroupTpl){this.colgroupTpl=new Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>')}},initColumns:function(){var g=this.columns,d=g.length,f=[],e,h;for(e=0;e<d;e++){h=g[e];if(!h.isColumn){h.xtype=h.xtype?(/^tg/.test(h.xtype)?h.xtype:"tg"+h.xtype):"tgcolumn";h=Ext.create(h)}h.init(this);f.push(h);if(this.enableSort!==false&&h.sortable!==false){h.sortable=true;this.enableSort=true}}this.columns=f},onRender:function(){Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);this.el.addClass("x-treegrid");this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")});this.internalTpl.overwrite(this.outerCt,{columns:this.columns});this.mainHd=Ext.get(this.outerCt.dom.firstChild);this.innerHd=Ext.get(this.mainHd.dom.firstChild);this.innerBody=Ext.get(this.outerCt.dom.lastChild);this.innerCt=Ext.get(this.innerBody.dom.firstChild);this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});if(this.hideHeaders){this.header.dom.style.display="none"}else{if(this.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:this.id+"-hctx"});if(this.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:this.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add({itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}}},setRootNode:function(c){c.attributes.uiProvider=Ext.ux.tree.TreeGridRootNodeUI;c=Ext.ux.tree.TreeGrid.superclass.setRootNode.call(this,c);if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns})}return c},clearInnerCt:function(){if(Ext.isIE){var c=this.innerCt.dom;while(c.firstChild){c.removeChild(c.firstChild)}}else{Ext.ux.tree.TreeGrid.superclass.clearInnerCt.call(this)}},initEvents:function(){Ext.ux.tree.TreeGrid.superclass.initEvents.apply(this,arguments);this.mon(this.innerBody,"scroll",this.syncScroll,this);this.mon(this.innerHd,"click",this.handleHdDown,this);this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})},onResize:function(d,e){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var g=this.innerBody.dom;var j=this.innerHd.dom;if(!g){return}if(Ext.isNumber(e)){g.style.height=this.body.getHeight(true)-j.offsetHeight+"px"}if(Ext.isNumber(d)){var c=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((g.offsetWidth-g.clientWidth)>10)){this.setScrollOffset(c)}else{var f=this;setTimeout(function(){f.setScrollOffset(g.offsetWidth-g.clientWidth>10?c:0)},10)}}},updateColumnWidths:function(){var m=this.columns,p=m.length,d=this.outerCt.query("colgroup"),o=d.length,l,h,f,e;for(f=0;f<p;f++){l=m[f];for(e=0;e<o;e++){h=d[e];h.childNodes[f].style.width=(l.hidden?0:l.width)+"px"}}for(f=0,d=this.innerHd.query("td"),len=d.length;f<len;f++){l=Ext.fly(d[f]);if(m[f]&&m[f].hidden){l.addClass("x-treegrid-hd-hidden")}else{l.removeClass("x-treegrid-hd-hidden")}}var k=this.getTotalColumnWidth();Ext.fly(this.innerHd.dom.firstChild).setWidth(k+(this.scrollOffset||0));this.outerCt.select("table").setWidth(k);this.syncHeaderScroll()},getVisibleColumns:function(){var e=[],f=this.columns,c=f.length,d;for(d=0;d<c;d++){if(!f[d].hidden){e.push(f[d])}}return e},getTotalColumnWidth:function(){var f=0;for(var d=0,e=this.getVisibleColumns(),c=e.length;d<c;d++){f+=e[d].width}return f},setScrollOffset:function(c){this.scrollOffset=c;this.updateColumnWidths()},handleHdDown:function(l,h){var k=l.getTarget(".x-treegrid-hd");if(k&&Ext.fly(h).hasClass("x-grid3-hd-btn")){var f=this.hmenu.items,j=this.columns,d=this.findHeaderIndex(k),m=j[d],g=m.sortable;l.stopEvent();Ext.fly(k).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=d;this.fireEvent("headerbuttonclick",f,m,k,d);this.hmenu.on("hide",function(){Ext.fly(k).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(h,"tl-bl?")}else{if(k){var d=this.findHeaderIndex(k);this.fireEvent("headerclick",this.columns[d],k,d)}}},handleHdOver:function(g,c){var f=g.getTarget(".x-treegrid-hd");if(f&&!this.headersDisabled){index=this.findHeaderIndex(f);this.activeHdRef=c;this.activeHdIndex=index;var d=Ext.get(f);this.activeHdRegion=d.getRegion();d.addClass("x-grid3-hd-over");this.activeHdBtn=d.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(f.firstChild.offsetHeight-1)+"px"}}},handleHdOut:function(f,c){var d=f.getTarget(".x-treegrid-hd");if(d&&(!Ext.isIE||!f.within(d,true))){this.activeHdRef=null;Ext.fly(d).removeClass("x-grid3-hd-over");d.style.cursor=""}},findHeaderIndex:function(f){f=f.dom||f;var e=f.parentNode.childNodes;for(var d=0,g;g=e[d];d++){if(g==f){return d}}return -1},beforeColMenuShow:function(){var f=this.columns,e=f.length,d,g;this.colMenu.removeAll();for(d=1;d<e;d++){g=f[d];if(g.hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+d,text:g.header,checked:!g.hidden,hideOnClick:false,disabled:g.hideable===false}))}}},handleHdMenuClick:function(d){var c=this.hdCtxIndex,e=d.getItemId();if(this.fireEvent("headermenuclick",this.columns[c],e,c)!==false){c=e.substr(4);if(c>0&&this.columns[c]){this.setColumnVisible(c,!d.checked)}}return true},setColumnVisible:function(c,d){this.columns[c].hidden=!d;this.updateColumnWidths()},scrollToTop:function(){this.innerBody.dom.scrollTop=0;this.innerBody.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var c=this.innerBody.dom;this.fireEvent("bodyscroll",c.scrollLeft,c.scrollTop)},syncHeaderScroll:function(){var c=this.innerBody.dom;this.innerHd.dom.scrollLeft=c.scrollLeft;this.innerHd.dom.scrollLeft=c.scrollLeft},registerNode:function(c){Ext.ux.tree.TreeGrid.superclass.registerNode.call(this,c);if(!c.uiProvider&&!c.isRoot&&!c.ui.isTreeGridNodeUI){c.ui=new Ext.ux.tree.TreeGridNodeUI(c)}}});Ext.reg("treegrid",Ext.ux.tree.TreeGrid);Ext.override(Ext.ux.tree.TreeGrid,{onResize:function(d,f){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var j=this.innerBody.dom;var k=this.innerHd.dom;if(!j){return}if(Ext.isNumber(f)){j.style.height=this.body.getHeight(true)-24+"px"}if(Ext.isNumber(d)){if(Ext.isIE&&!(Ext.isStrict&&Ext.isIE8)){var e=this.body.getWidth(true)+"px";j.style.width=e;k.style.width=e}var c=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((j.offsetWidth-j.clientWidth)>10)){this.setScrollOffset(c)}else{var g=this;setTimeout(function(){g.setScrollOffset(j.offsetWidth-j.clientWidth>10?c:0)},10)}}}});Ext.ux.DblClickCloseTabs=Ext.extend(Object,{init:function(c){this.panel=c;c.initEvents=c.initEvents.createSequence(this.initEvents,this)},initEvents:function(){this.panel.mon(this.panel.strip,{dblclick:this.onDblClick.createDelegate(this,[this.panel],0)});delete this.panel},onDblClick:function(c,d){if(c.getActiveTab().closable){c.remove(c.getActiveTab())}}});Ext.preg("dblclickclosetabs",Ext.ux.DblClickCloseTabs);Ext.util.md5=function(u,c,q,m){c=(typeof c==="undefined"?false:c);q=(typeof q==="undefined"?false:q);m=(typeof m==="undefined"?8:m);function k(r,w){var v=((r&65535)+(w&65535)),s=((r>>16)+(w>>16)+(v>>16));return(s<<16)|(v&65535)}function p(r,s){return(r<<s)|(r>>>(32-s))}function f(A,w,v,r,z,y){return k(p(k(k(w,A),k(r,y)),z),v)}function l(w,v,B,A,r,z,y){return f((v&B)|((~v)&A),w,v,r,z,y)}function e(w,v,B,A,r,z,y){return f((v&A)|(B&(~A)),w,v,r,z,y)}function o(w,v,B,A,r,z,y){return f(v^B^A,w,v,r,z,y)}function j(w,v,B,A,r,z,y){return f(B^(v|(~A)),w,v,r,z,y)}function h(E,z){var D=1732584193,C=-271733879,B=-1732584194,A=271733878,v,y,w,s,r;E[z>>5]|=128<<((z)%32);E[(((z+64)>>>9)<<4)+14]=z;for(v=0;v<E.length;v+=16){y=D;w=C;s=B;r=A;D=l(D,C,B,A,E[v+0],7,-680876936);A=l(A,D,C,B,E[v+1],12,-389564586);B=l(B,A,D,C,E[v+2],17,606105819);C=l(C,B,A,D,E[v+3],22,-1044525330);D=l(D,C,B,A,E[v+4],7,-176418897);A=l(A,D,C,B,E[v+5],12,1200080426);B=l(B,A,D,C,E[v+6],17,-1473231341);C=l(C,B,A,D,E[v+7],22,-45705983);D=l(D,C,B,A,E[v+8],7,1770035416);A=l(A,D,C,B,E[v+9],12,-1958414417);B=l(B,A,D,C,E[v+10],17,-42063);C=l(C,B,A,D,E[v+11],22,-1990404162);D=l(D,C,B,A,E[v+12],7,1804603682);A=l(A,D,C,B,E[v+13],12,-40341101);B=l(B,A,D,C,E[v+14],17,-1502002290);C=l(C,B,A,D,E[v+15],22,1236535329);D=e(D,C,B,A,E[v+1],5,-165796510);A=e(A,D,C,B,E[v+6],9,-1069501632);B=e(B,A,D,C,E[v+11],14,643717713);C=e(C,B,A,D,E[v+0],20,-373897302);D=e(D,C,B,A,E[v+5],5,-701558691);A=e(A,D,C,B,E[v+10],9,38016083);B=e(B,A,D,C,E[v+15],14,-660478335);C=e(C,B,A,D,E[v+4],20,-405537848);D=e(D,C,B,A,E[v+9],5,568446438);A=e(A,D,C,B,E[v+14],9,-1019803690);B=e(B,A,D,C,E[v+3],14,-187363961);C=e(C,B,A,D,E[v+8],20,1163531501);D=e(D,C,B,A,E[v+13],5,-1444681467);A=e(A,D,C,B,E[v+2],9,-51403784);B=e(B,A,D,C,E[v+7],14,1735328473);C=e(C,B,A,D,E[v+12],20,-1926607734);D=o(D,C,B,A,E[v+5],4,-378558);A=o(A,D,C,B,E[v+8],11,-2022574463);B=o(B,A,D,C,E[v+11],16,1839030562);C=o(C,B,A,D,E[v+14],23,-35309556);D=o(D,C,B,A,E[v+1],4,-1530992060);A=o(A,D,C,B,E[v+4],11,1272893353);B=o(B,A,D,C,E[v+7],16,-155497632);C=o(C,B,A,D,E[v+10],23,-1094730640);D=o(D,C,B,A,E[v+13],4,681279174);A=o(A,D,C,B,E[v+0],11,-358537222);B=o(B,A,D,C,E[v+3],16,-722521979);C=o(C,B,A,D,E[v+6],23,76029189);D=o(D,C,B,A,E[v+9],4,-640364487);A=o(A,D,C,B,E[v+12],11,-421815835);B=o(B,A,D,C,E[v+15],16,530742520);C=o(C,B,A,D,E[v+2],23,-995338651);D=j(D,C,B,A,E[v+0],6,-198630844);A=j(A,D,C,B,E[v+7],10,1126891415);B=j(B,A,D,C,E[v+14],15,-1416354905);C=j(C,B,A,D,E[v+5],21,-57434055);D=j(D,C,B,A,E[v+12],6,1700485571);A=j(A,D,C,B,E[v+3],10,-1894986606);B=j(B,A,D,C,E[v+10],15,-1051523);C=j(C,B,A,D,E[v+1],21,-2054922799);D=j(D,C,B,A,E[v+8],6,1873313359);A=j(A,D,C,B,E[v+15],10,-30611744);B=j(B,A,D,C,E[v+6],15,-1560198380);C=j(C,B,A,D,E[v+13],21,1309151649);D=j(D,C,B,A,E[v+4],6,-145523070);A=j(A,D,C,B,E[v+11],10,-1120210379);B=j(B,A,D,C,E[v+2],15,718787259);C=j(C,B,A,D,E[v+9],21,-343485551);D=k(D,y);C=k(C,w);B=k(B,s);A=k(A,r)}return[D,C,B,A]}function d(w){var v=[],r=((1<<m)-1),s;for(s=0;s<w.length*m;s+=m){v[s>>5]|=(w.charCodeAt(s/m)&r)<<(s%32)}return v}function g(v){var w="",r=((1<<m)-1),s;for(s=0;s<v.length*32;s+=m){w+=String.fromCharCode((v[s>>5]>>>(s%32))&r)}return w}function t(v){var s=((q)?"0123456789ABCDEF":"0123456789abcdef"),w="",r;for(r=0;r<v.length*4;r++){w+=s.charAt((v[r>>2]>>((r%4)*8+4))&15)+s.charAt((v[r>>2]>>((r%4)*8))&15)}return w}return(c?g(h(d(u),u.length*m)):t(h(d(u),u.length*m)))};Ext.ux.CodeMirror=Ext.extend(Ext.BoxComponent,{readOnly:(this.readOnly)?this.readOnly:false,width:"auto",height:"auto",autoResize:true,initialised:false,documentDurty:false,spellCheck:(this.spellCheck)?this.spellCheck:false,parser:(this.parser)?this.parser:"xml",parserFile:"parsexml.js",parserStylesheet:"js/ux/codemirror/css/xmlcolors.css",initComponent:function(){Ext.ux.CodeMirror.superclass.initComponent.apply(this);this.addEvents({initialize:true,codemodified:true,coderestored:true,cursormove:true,scroll:true});if(this.parser==="xml"){this.parserFile="parsexml.js";this.parserStylesheet="js/ux/codemirror/css/xmlcolors.css"}if(this.parser==="html"){this.parserFile=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","parsehtmlmixed.js"];this.parserStylesheet=["js/ux/codemirror/css/xmlcolors.css","js/ux/codemirror/css/jscolors.css","js/ux/codemirror/css/csscolors.css"]}if(this.parser==="php"){this.parserFile=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","../contrib/php/js/tokenizephp.js","../contrib/php/js/parsephp.js","../contrib/php/js/parsephphtmlmixed.js"];this.parserStylesheet=["js/ux/codemirror/css/xmlcolors.css","js/ux/codemirror/css/jscolors.css","js/ux/codemirror/css/csscolors.css","js/ux/codemirror/contrib/php/css/phpcolors.css"]}},onRender:function(d,c){Ext.ux.CodeMirror.superclass.onRender.apply(this,[d,c])},resize:function(f,d){var c=(f)?f+"px":this.ownerCt.lastSize.width-35+"px",e=(d)?d+"px":this.ownerCt.lastSize.height-89+"px";this.mirror.frame.style.height=e;this.mirror.frame.style.width=c},onInit:function(c,d){var e=Ext.getCmp(d),f=e.mirror;e.ownerCt.fireEvent("resize");e.fireEvent("initialize");e.initialised=true;e.documentDurty=false;f.editor.keyUp=function(j){var h=f.cursorPosition(),g=f.lineNumber(h.line),k=h.character;e.fireEvent("cursormove",g,k);if(Ext.getCmp(d).documentDurty===true&&j.keyCode!==8&&j.keyCode!==46){}else{e.manageCodeChange(d)}};Ext.EventManager.addListener(f.frame.contentWindow,"scroll",function(g){e.monitorScroll(g,e)},this)},onCursorActivity:function(d){var f=Ext.getCmp(d),g=f.mirror,e=g.cursorPosition(),c=g.lineNumber(e.line),h=e.character;f.fireEvent("cursormove",c,h)},manageCodeChange:function(e,g){var f=Ext.getCmp(e),j=f.mirror,c=j.originalContent,d=j.getCode(),h=Ext.getCmp(e+"-btn-undo");if(c){if(c===d){if(f.documentDurty===true){f.fireEvent("coderestored");f.documentDurty=false}}else{if(h){h.enable()}if(f.documentDurty===false){f.fireEvent("codemodified");f.documentDurty=true}}}},saveFunction:function(c){var d=Ext.getCmp(c+"-btn-save");if(!d.disabled){d.handler.call(d.scope||d,d)}},monitorScroll:function(d,c){c.fireEvent("scroll",d.target.body.scrollTop,this)},afterRender:function(){this.mirror=new CodeMirror(CodeMirror.replace(Ext.get(this.id).dom),{textWrapping:false,saveFunction:this.saveFunction,width:"100%",height:this.ownerCt.lastSize.height,readOnly:this.readOnly,content:this.value,originalContent:false,parserfile:this.parserFile,parserConfig:{alignCDATA:true,useHTMLKludges:false},indentUnit:1,cmId:this.id,lineNumbers:true,continuousScanning:(this.readOnly)?false:500,stylesheet:this.parserStylesheet,path:"js/ux/codemirror/js/",initCallback:this.onInit,autoMatchParens:true,disableSpellcheck:!this.spellCheck,onChange:this.manageCodeChange,cursorActivity:this.onCursorActivity});this.ownerCt.on("resize",function(d,e,g,c,f){this.resize()},this)},getCode:function(){return this.mirror.getCode()},setCode:function(c){if(!this.initialised){var d=new Ext.util.DelayedTask(function(){this.setCode(c)},this);d.delay(500)}else{this.mirror.setCode(c);this.mirror.originalContent=c}},reIndentAll:function(){this.mirror.reindent()},undo:function(c,d){this.mirror.undo();Ext.getCmp(c+"-FILE-"+d+"-btn-redo").enable();if(!this.mirror.editor.history.history.length){Ext.getCmp(c+"-FILE-"+d+"-btn-undo").disable()}},redo:function(c,d){this.mirror.redo();Ext.getCmp(c+"-FILE-"+d+"-btn-undo").enable();if(!this.mirror.editor.history.redoHistory.length){Ext.getCmp(c+"-FILE-"+d+"-btn-redo").disable()}},setLineContent:function(c,e){var d=this.mirror.nthLine(c);this.mirror.setLineContent(d,e)},insertIntoLine:function(d,c,f){var e=this.mirror.nthLine(d);this.mirror.insertIntoLine(e,c,f)},scrollTo:function(c){this.mirror.frame.contentWindow.document.body.scrollTop=c},focus:function(){this.mirror.focus()},setOriginalCode:function(){this.mirror.originalContent=this.getCode();this.documentDurty=false},getCursorPosition:function(){var d=this.mirror.cursorPosition(),c=this.mirror.lineNumber(d.line),e=d.character;return"{line:"+c+", caracter:"+e+"}"},nthLine:function(c){return this.mirror.nthLine(c)},setSpellcheck:function(c){return this.mirror.setSpellcheck(c)}});Ext.reg("codemirror",Ext.ux.CodeMirror);Ext.ux.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(d,c){d.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));var e=document.createElement("iframe"),f=function(g){d.unmask()};e.id=this.id;e.name=this.id;e.src=this.url;e.frameBorder=0;this.el=d.appendChild(e);if(Ext.isIE){document.frames[this.url].name=this.id}e[Ext.isIE?"onreadystatechange":"onload"]=f.createDelegate(e)}});Ext.ux.FixedMultiSelectionModel=Ext.extend(Ext.tree.MultiSelectionModel,{normalClick:false,init:function(c){this.tree=c;c.getTreeEl().on("keydown",this.onKeyDown,this);c.on("dblclick",this.onDoubleClick,this);c.on("click",this.onNodeClick,this)},onDrag:function(){this.normalClick=false},onNodeClick:function(c,d){if(d.shiftKey){d.preventDefault()}if(!this.tree.dragZone||!this.tree.dragZone.isMultiSelect){this.onMouseDown(c,d);this.onMouseUp(c,d)}},onMouseDown:function(c,d){if(c.isSelected()){if(d.ctrlKey){this.unselect(c);this.normalClick=false;return}this.normalClick=!d.shiftKey}else{this.select(c,d,d.ctrlKey);this.normalClick=false}},onMouseUp:function(c,d){if(this.normalClick){this.select(c,d,d.ctrlKey);this.normalClick=false}},onDoubleClick:function(){this.normalClick=false},compareNodeOrder:document.compareDocumentPosition?function(d,c){return 3-(d.ui.elNode.compareDocumentPosition(c.ui.elNode)&6)}:(typeof document.documentElement.sourceIndex!=="undefined"?function(d,c){return d.ui.elNode.sourceIndex-c.ui.elNode.sourceIndex}:function(f,e){if(f==e){return 0}var d=document.createRange();d.selectNode(a.ui.elNode);d.collapse(true);var c=document.createRange();c.selectNode(b.ui.elNode);c.collapse(true);return d.compareBoundaryPoints(Range.START_TO_END,c)}),sortSelNodes:function(){if(this.selNodes.length>1){if(!this.selNodes[0].ui.elNode){return}this.selNodes.sort(this.compareNodeOrder)}},selectNode:function(d,c){if(!this.isSelected(d)){this.selNodes.push(d);this.selMap[d.id]=d;d.ui.onSelectedChange(true)}},select:function(d,h,m){if(d instanceof Array){for(var j=0;j<d.length;j++){this.selectNode(d[j])}this.sortSelNodes();this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode);return d}if(h&&h.shiftKey&&this.selNodes.length>0){this.lastSelNode=this.lastSelNode||this.selNodes[0];var k=this.compareNodeOrder(this.lastSelNode,d)>0;this.clearSelections(true);var o=true;var f=false;var l=this.lastSelNode;do{for(var g=l;g!=null;g=(k?g.previousSibling:g.nextSibling)){f=f||(k&&(g==d||g.contains(d)));if(g.isExpanded()){g.cascade(function(c){if(o!=f){this.selectNode(c)}o=(o&&c!=d);return true},this)}else{this.selectNode(g);o=(g!=d)}if(!o){break}}if(!o){break}while((l=l.parentNode)!=null){if(k){this.selectNode(l)}o=(o&&l!=d);if(k&&l.previousSibling){l=l.previousSibling;break}if(!k&&l.nextSibling){l=l.nextSibling;break}}if(!o){break}}while(l!=null);this.selectNode(d);this.sortSelNodes();this.fireEvent("selectionchange",this,this.selNodes,d);h.preventDefault();return d}else{if(m!==true){this.clearSelections(true)}}if(this.isSelected(d)){if(m===true){this.unselect(d);if(this.lastSelNode===d){this.lastSelNode=this.selNodes[0]}return d}this.lastSelNode=d;return d}this.selectNode(d);this.sortSelNodes();this.lastSelNode=d;this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode);return d},getUniqueSelectedNodes:function(){var d=[];for(var f=0;f<this.selNodes.length;f++){var e=this.selNodes[f];d.push(e);while((f+1)<this.selNodes.length&&e.contains(this.selNodes[f+1])){f++}}return d},unselect:function(d,e){if(e){for(var f=this.selNodes.length-1;f>=0;f--){if(this.selNodes[f].isAncestor(d)){Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,this.selNodes[f])}}}return Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,d)},selectPrevious:function(e){var c=this.selNodes[0];if(!c){return null}var f=c.previousSibling;if(f){if(!f.isExpanded()||f.childNodes.length<1){return this.select(f,null,e)}else{var d=f.lastChild;while(d&&d.isExpanded()&&d.childNodes.length>0){d=d.lastChild}return this.select(d,null,e)}}else{if(c.parentNode&&(this.tree.rootVisible||!c.parentNode.isRoot)){return this.select(c.parentNode,null,e)}}return null},selectNext:function(e){var d=this.selNodes[this.selNodes.length-1];if(!d){return null}if(d.firstChild&&d.isExpanded()){return this.select(d.firstChild,null,e)}else{if(d.nextSibling){return this.select(d.nextSibling,null,e)}else{if(d.parentNode){var c=null;d.parentNode.bubble(function(){if(this.nextSibling){c=this.getOwnerTree().selModel.select(this.nextSibling,null,e);return false}});return c}}}return null},onKeyDown:function(f){var d=this.selNode||this.lastSelNode;var g=this;if(!d){return}var c=f.getKey();switch(c){case f.DOWN:f.stopEvent();this.selectNext(f.shiftKey||f.ctrlKey);break;case f.UP:f.stopEvent();this.selectPrevious(f.shiftKey||f.ctrlKey);break;case f.RIGHT:f.preventDefault();if(d.hasChildNodes()){if(!d.isExpanded()){d.expand()}else{if(d.firstChild){this.select(d.firstChild,f,f.shiftKey||f.ctrlKey)}}}break;case f.LEFT:f.preventDefault();if(d.hasChildNodes()&&d.isExpanded()){d.collapse()}else{if(d.parentNode&&(this.tree.rootVisible||d.parentNode!=this.tree.getRootNode())){this.select(d.parentNode,f,f.shiftKey||f.ctrlKey)}}break}}});Ext.ux.MultiSelectTreeDragZone=Ext.extend(Ext.tree.TreeDragZone,{isMultiSelect:true,onBeforeDrag:function(d,f){if(d.nodes&&d.nodes.length>0){for(var g=0;g<d.nodes.length;g++){n=d.nodes[g];if(n.draggable===false||n.disabled){return false}}return true}else{if(d.node){if(d.node.draggable===false||d.node.disabled){return false}}}return false},alignElWithMouse:function(d,f,e){Ext.ux.MultiSelectTreeDragZone.superclass.alignElWithMouse.apply(this,arguments);if(Ext.fly(d).isVisible()){var c=this.tree.getSelectionModel();if(c&&c.onDrag){c.onDrag.call(c)}}},onMouseUp:function(f){var c=this.tree.getSelectionModel();if(c&&c.onMouseUp){var d=Ext.dd.Registry.getHandleFromEvent(f);if(d!=null){c.onMouseUp.call(c,d.node,f)}}Ext.ux.MultiSelectTreeDragZone.superclass.onMouseUp.apply(this,arguments)},getDragData:function(p){var q=Ext.dd.Registry.getHandleFromEvent(p);if(q==null){return}var h=[];var l=this.tree.getSelectionModel();if(l.onMouseDown){l.onMouseDown.call(l,q.node,p);h=l.getUniqueSelectedNodes()}else{h=[q.node]}if(!h||h.length<1){return}var j={nodes:h};var f=document.createElement("ul");f.className="x-tree-node-ct x-tree-lines";var x=0;for(var k=0,m=h.length;k<m;k++){var v=h[k].ui.wrap.cloneNode(true);var u=h[k].ui.indentNode.childNodes.length+1;if(u>0){var w=Ext.query(h[k].ui.indentNode.nodeName+".x-tree-node-indent",v);for(var s=0,t=w.length;s<t;s++){var g=w[s];var o=g.childNodes.length;if(o<=u){g.innerHTML="";if(o<u){g.parentNode.removeChild(w[s].nextSibling)}}else{for(var d=0;d<u;d++){w[s].removeChild(w[s].firstChild)}}}}f.appendChild(v);Ext.fly(v).removeClass(["x-tree-selected","x-tree-node-over"])}j.ddel=f;return j},onInitDrag:function(d){var c=this.dragData;this.tree.eventModel.disable();this.proxy.update("");this.proxy.ghost.dom.appendChild(c.ddel);this.tree.fireEvent("startdrag",this.tree,c.nodes,d)},getTreeNode:function(){return this.dragData.nodes},getRepairXY:function(d,c){return c.nodes[0].ui.getDDRepairXY()},onEndDrag:function(c,d){this.tree.eventModel.enable.defer(100,this.tree.eventModel);this.tree.fireEvent("enddrag",this.tree,c.nodes||[c.node],d)},onValidDrop:function(c,d,f){this.tree.fireEvent("dragdrop",this.tree,this.dragData.nodes,c,d);this.hideProxy()},beforeInvalidDrop:function(c,f){var d=this.tree.getSelectionModel()}});Ext.ux.MultiSelectTreeDropZone=Ext.extend(Ext.tree.TreeDropZone,{isValidDropPoint:function(f,p,m,j,h){if(!f||!h){return false}var k=f.node;var d=h.nodes?h.nodes:[h.node];if(!(k&&k.isTarget&&p)){return false}if(p=="append"&&k.allowChildren===false){return false}if((p=="above"||p=="below")&&(k.parentNode&&k.parentNode.allowChildren===false)){return false}for(var l=0;l<d.length;l++){if(d[l]&&(k==d[l]||d[l].contains(k))){return false}}var g=this.dragOverData;g.tree=this.tree;g.target=k;g.data=h;g.point=p;g.source=m;g.rawEvent=j;g.dropNode=d;g.cancel=false;var o=this.tree.fireEvent("nodedragover",g);return g.cancel===false&&o!==false},getDropPoint:function(j,g,o,h){var p=g.node;if(p.isRoot){return this.isValidDropPoint(g,"append",o,j,h)?"append":false}var d=g.ddel;var r=Ext.lib.Dom.getY(d),l=r+d.offsetHeight;var k=Ext.lib.Event.getPageY(j);var m=p.allowChildren===false||p.isLeaf()||!this.isValidDropPoint(g,"append",o,j,h);if(!this.appendOnly&&p.parentNode.allowChildren!==false){var f=false;if(!this.allowParentInsert){f=p.hasChildNodes()&&p.isExpanded()}var c=(l-r)/(m?2:3);if(k>=r&&k<(r+c)&&this.isValidDropPoint(g,"above",o,j,h)){return"above"}else{if(!f&&(m||k>=l-c&&k<=l)&&this.isValidDropPoint(g,"below",o,j,h)){return"below"}}}return m?false:"append"},onNodeOver:function(d,k,j,h){var m=this.getDropPoint(j,d,k,h);var f=d.node;if(!this.expandProcId&&m=="append"&&f.hasChildNodes()&&!d.node.isExpanded()){this.queueExpand(f)}else{if(m!="append"){this.cancelExpand()}}var g=this.dropNotAllowed;if(m){var c=d.ddel;var l;if(m=="above"){g=d.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";l="x-tree-drag-insert-above"}else{if(m=="below"){g=d.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";l="x-tree-drag-insert-below"}else{g="x-tree-drop-ok-append";l="x-tree-drag-append"}}if(this.lastInsertClass!=l){Ext.fly(c).replaceClass(this.lastInsertClass,l);this.lastInsertClass=l}}return g},onNodeDrop:function(f,m,h,g){var l=this.getDropPoint(h,f,m,g);var j=f.node;j.ui.startDrop();if(l===false){j.ui.endDrop();return false}var k=g.node||(m.getTreeNode?m.getTreeNode(g,j,l,h):null);var d={tree:this.tree,target:j,data:g,point:l,source:m,rawEvent:h,dropNode:k,cancel:!k,dropStatus:false};var c=this.tree.fireEvent("beforenodedrop",d);if(c===false||d.cancel===true||!d.dropNode){j.ui.endDrop();return d.dropStatus}j=d.target;if(l=="append"&&!j.isExpanded()){j.expand(false,null,function(){this.completeDrop(d)}.createDelegate(this))}else{this.completeDrop(d)}return true},afterRepair:function(f){if(f&&Ext.enableFx){var e=f.nodes?f.nodes:[f.node];for(var g=0,d=e.length;g<d;g++){e[g].ui.highlight()}}this.hideProxy()},onContainerDrop:function(c,k,h){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",c,k,h)){var j=this.tree.getRootNode();j.ui.startDrop();var f=h.node||(c.getTreeNode?c.getTreeNode(h,j,"append",k):null);var g={tree:this.tree,target:j,data:h,point:"append",source:c,rawEvent:k,dropNode:f,cancel:!f,dropStatus:false};var d=this.tree.fireEvent("beforenodedrop",g);if(d===false||g.cancel===true||!g.dropNode){j.ui.endDrop();return g.dropStatus}j=g.target;if(!j.isExpanded()){j.expand(false,null,function(){this.completeDrop(g)}.createDelegate(this))}else{this.completeDrop(g)}return true}return false},onContainerOver:function(c,f,d){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",c,f,d)){return this.dropAllowed}return this.dropNotAllowed}});Ext.ux.MultiSelectTreePanel=Ext.extend(Ext.tree.TreePanel,{getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.ux.FixedMultiSelectionModel()}return this.selModel},initEvents:function(){if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new Ext.ux.MultiSelectTreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.ddAppendOnly===true})}if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new Ext.ux.MultiSelectTreeDragZone(this,{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})}Ext.ux.MultiSelectTreePanel.superclass.initEvents.apply(this,arguments);this.on("remove",function(c,d,e){c.getSelectionModel().unselect(e,true)})}});Ext.reg("multiselecttreepanel",Ext.ux.MultiSelectTreePanel);Ext.namespace("Ext.ux");Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",cls:"x-notification",width:250,autoHeight:true,draggable:false,bodyStyle:"text-align:center; padding: 10px;"});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(c){this.body.update(c)},setTitle:function(d,c){Ext.ux.Notification.superclass.setTitle.call(this,d,c||this.iconCls)},onRender:function(d,c){Ext.ux.Notification.superclass.onRender.call(this,d,c)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass("fixed");if(this.autoDestroy){this.task.cancel()}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on("click",this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,"br-br",[-20,-20-((this.getSize().height+10)*this.pos)]);this.el.slideIn("b",{duration:1,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.el.shadow.hide();this.el.ghost("b",{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn});Ext.ns("Ext.ux");Ext.ux.PanelCollapsedTitle=(function(){var c="x-panel-header-rotated";var e=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var d=function(){var k=((this.region=="east")||(this.region=="west"));var l="overflow: visible; padding: 0; border: none; background: none;";if(k&&e){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"});var j="http://www.w3.org/2000/svg";var h=document.createElementNS(j,"svg");this.collapsedHeader.dom.appendChild(h);h.setAttribute("width","100%");h.setAttribute("height","100%");var m=document.createElementNS(j,"text");m.setAttribute("x",6);m.setAttribute("y",1);m.setAttribute("transform","rotate(90 6 1)");m.setAttribute("class","x-panel-header "+c);h.appendChild(m);this.collapsedHeaderText=document.createTextNode(this.title);m.appendChild(this.collapsedHeaderText);var g=Ext.fly(m).getStyle("color");m.setAttribute("style",l+";fill: "+g+";")}else{var f="position: relative;";if(k){f+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;"}else{f+="top: 2px;";l+="padding-left: 4px; margin-right: 18px;"}this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:l,cls:"x-panel-header "+c,html:'<span style="'+f+'">'+this.title+"</span>"});this.collapsedHeaderText=this.collapsedHeader.first()}if(this.collapsedIconCls){this.setCollapsedIconClass(this.collapsedIconCls)}};this.init=function(g){if(g.collapsible){var f=((g.region=="east")||(g.region=="west"));g.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(h){if(this.rendered&&this.collapsedHeaderText){if(this.collapsedHeaderText.dom){this.collapsedHeaderText.dom.innerHTML=h}else{if(this.collapsedHeaderText.replaceData){this.collapsedHeaderText.nodeValue=h}}}});g.setCollapsedIconClass=function(j){var h=this.collapsedIconCls;this.collapsedIconCls=j;if(this.rendered&&this.collapsedHeader){var l=this.collapsedHeader,k=l.child("img.x-panel-inline-icon");if(k){if(this.collapsedIconCls){Ext.fly(k).replaceClass(h,this.collapsedIconCls)}else{Ext.fly(k).remove()}}else{if(this.collapsedIconCls){Ext.DomHelper.insertBefore(l.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:f?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"})}}}};g.on("render",function(){if(this.ownerCt.rendered&&this.ownerCt.layout.hasLayout){d.call(g)}else{this.ownerCt.on("afterlayout",d,g,{single:true})}},g)}};return this})();Ext.ux.SlidingTabPanel=Ext.extend(Ext.TabPanel,{initTab:function(d,c){Ext.ux.SlidingTabPanel.superclass.initTab.call(this,d,c);this.addEvents({startDrag:true,endDrag:true});var e=this.getTemplateArgs(d);if(!this.slidingTabsID){this.slidingTabsID=Ext.id()}new Ext.ux.DDSlidingTab(e,this.slidingTabsID,{tabpanel:this})}});Ext.ux.DDSlidingTab=Ext.extend(Ext.dd.DDProxy,{constructor:function(){Ext.ux.DDSlidingTab.superclass.constructor.apply(this,arguments);this.setYConstraint(0,0,0);this.tabpanel=this.config.tabpanel;this.slideDuration=this.tabpanel.slideDuration;if(!this.slideDuration){this.slideDuration=0.1}},handleMouseDown:function(f,d){if(this.primaryButtonOnly&&f.button!=0){return}if(this.isLocked()){return}this.DDM.refreshCache(this.groups);var c=new Ext.lib.Point(Ext.lib.Event.getPageX(f),Ext.lib.Event.getPageY(f));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(c,this)){}else{if(this.clickValidator(f)){this.setStartPosition();this.b4MouseDown(f);this.onMouseDown(f);this.DDM.handleMouseDown(f,this)}}},startDrag:function(c,k){this.tabpanel.fireEvent("startDrag",this.tabpanel,this.tabpanel.getActiveTab());Ext.dd.DDM.useCache=false;Ext.dd.DDM.mode=1;this.proxyWrapper=Ext.get(this.getDragEl());this.proxyWrapper.update();this.proxyWrapper.applyStyles("z-index:1001;border:0 none;");this.proxyWrapper.addClass("tab-proxy");this.stripWrap=this.proxyWrapper.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',true);this.dragEl=this.stripWrap.insertHtml("afterBegin","<div></div>",true);this.tab=Ext.get(this.getEl());this.tab.applyStyles("visibility:hidden;");this.dragEl.insertHtml("afterBegin",this.tab.dom.innerHTML,false);this.dragEl.dom.className=this.tab.dom.className;var j=this.tabpanel.el.getWidth();var g=this.tabpanel.el.getX();var h=this.tab.getX();var d=this.tab.getWidth();var f=h-g;var e=g+j-h-d;this.resetConstraints();this.setXConstraint(f,e)},onDragOver:function(f,j){f.stopEvent();var g=Ext.get(j[0].id);var l=g.getWidth();var k=g.getX();var h=k+(l/2);var d=this.tab.getX();var m=this.proxyWrapper.getX();var c=this.proxyWrapper.getWidth();if(m<k&&((m+c)>h)){if(g.next()!=this.tab){g.applyStyles("visibility:hidden;");this.tab.insertAfter(g);this.targetProxy=this.createSliderProxy(k,g);if(!this.targetProxy.hasActiveFx()){this.animateSliderProxy(g,this.targetProxy,d)}}}if(m>k&&(m<h)){if(this.tab.next()!=g){g.applyStyles("visibility:hidden;");this.tab.insertBefore(g);this.targetProxy=this.createSliderProxy(k,g);if(!this.targetProxy.hasActiveFx()){this.animateSliderProxy(g,this.targetProxy,d)}}}},animateSliderProxy:function(d,c,e){c.shift({x:e,easing:"easeOut",duration:this.slideDuration,callback:function(){c.remove();d.applyStyles("visibility:visible;")},scope:this})},createSliderProxy:function(d,f){var e=Ext.getBody().insertHtml("afterBegin",'<div class="tab-proxy" style="position:absolute;visibility:visible;z-index:999;left:'+d+'px;"></div>',true);e.stripWrapper=e.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',true);e.dragEl=e.stripWrapper.insertHtml("afterBegin","<div></div>",true);e.dragEl.update(f.dom.innerHTML);e.dragEl.dom.className=f.dom.className;var c=parseInt(f.getTop(false));e.setTop(c);return e},onDragDrop:function(d,c){d.stopEvent()},endDrag:function(c){var d=this.tab.getX();this.proxyWrapper.applyStyles("visibility:visible;");this.proxyWrapper.shift({x:d,easing:"easeOut",duration:this.slideDuration,callback:function(){this.proxyWrapper.applyStyles("visibility:hidden;");this.tab.applyStyles("visibility:visible;");this.stripWrap.remove();this.dragEl.remove();if(!this.targetProxy){return}this.targetProxy.stripWrapper.remove();this.targetProxy.dragEl.remove()},scope:this});Ext.dd.DDM.useCache=true;this.reorderTab();this.tabpanel.fireEvent("endDrag",this.tabpanel,this.tabpanel.getActiveTab())},reorderTab:function(){var e=this.tabpanel.header.child("ul").dom.children,c=[],f=[];for(var d=0;d<e.length;d++){if(e[d].id.substr(0,this.tabpanel.id.length)==this.tabpanel.id){c.push(e[d].id.substr((this.tabpanel.id.length+2),e[d].id.length))}}for(var d=0;d<this.tabpanel.items.items.length;d++){f[this.tabpanel.items.items[d].id]=this.tabpanel.items.items[d]}for(var d=0;d<c.length;d++){this.tabpanel.items.keys[d]=c[d];this.tabpanel.items.items[d]=f[c[d]]}}});Ext.ux.UserNotes=Ext.extend(Ext.Button,{originalTitle:_("Notes (<b>{0}</b>)"),text:String.format(_("Notes (<b>{0}</b>)"),"-"),initComponent:function(){Ext.ux.UserNotes.superclass.initComponent.apply(this);Ext.apply(this,{iconCls:"iconUserNotes",id:this.fid+"-userNotes",menu:new Ext.menu.Menu({showSeparator:false,allowOtherMenus:true,plain:true,autoHeight:true,forceLayout:true,enableScrolling:false,items:[{xtype:"grid",loadMask:true,width:500,height:200,contextMenuFrom:false,contextMenuRowIndex:false,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),winNotes:new Ext.Window({scope:this,title:_("Add a new note"),iconCls:"iconUserNotes",closeAction:"hide",width:600,height:300,layout:"form",hideLabel:true,modal:true,items:[{xtype:"htmleditor",hideLabel:true,enableLinks:false,anchor:"100%"}],listeners:{show:function(c){c.items.items[0].setValue("")}},buttons:[{text:_("Add"),handler:function(){var e=this.ownerCt.ownerCt.scope,f=this.ownerCt.ownerCt;e.menu.show(e.el);var d=this.ownerCt.ownerCt.items.items[0].getValue();var c=e.file;XHR({scope:this,params:{task:"addUserNote",file:c,note:d},success:function(){f.hide();e.menu.items.items[0].store.reload();PhDOE.notify("info",_("Note added"),_("The note was added successfully !"))},failure:function(){PhDOE.winForbidden()}})}},{text:_("Cancel"),handler:function(){var c=this.ownerCt.ownerCt.scope;c.menu.show(c.el);this.ownerCt.ownerCt.hide()}}]}),contextMenu:new Ext.menu.Menu({scope:this,listeners:{show:function(c){if(this.scope.menu.items.items[0].contextMenuFrom==="containercontextmenu"){this.items.items[2].disable()}else{var d=this.scope.menu.items.items[0];var e=d.store.getAt(d.contextMenuRowIndex).data.user;if(PhDOE.userLogin==e){this.items.items[2].enable()}else{this.items.items[2].disable()}}if(PhDOE.userLogin=="anonymous"){this.items.items[0].disable();this.items.items[2].disable()}}},items:[{text:_("Add a new note"),iconCls:"iconUserNotes",handler:function(){var c=this.ownerCt.scope.menu.items.items[0];c.winNotes.show()}},"-",{text:_("Delete this note"),iconCls:"iconDelete",handler:function(){var d=this.ownerCt.scope.menu.items.items[0],c=d.store.getAt(d.contextMenuRowIndex).data.id;XHR({scope:this,params:{task:"delUserNote",noteID:c},success:function(e){var f=Ext.util.JSON.decode(e.responseText);d.store.reload();if(f.result){PhDOE.notify("info",_("Note deleted"),_("The note was deleted successfully !"))}},failure:function(){PhDOE.winForbidden()}})}},"-",{text:_("Reload data"),iconCls:"iconRefresh",handler:function(){var c=this.ownerCt.scope.menu.items.items[0];c.store.reload()}}]}),store:new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"./do/getUserNotes"}),baseParams:{file:this.file},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"user"},{name:"note"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]}),sortInfo:{field:"date",direction:"DESC"},listeners:{scope:this,datachanged:function(d){var c=d.getCount();this.setText(String.format(this.originalTitle,c))}}}),listeners:{scope:this,rowclick:function(c){if(!c.contextMenu.hidden){c.contextMenu.hide()}},containercontextmenu:function(d,f){f.stopEvent();d.getSelectionModel().clearSelections();d.contextMenuFrom="containercontextmenu";d.contextMenu.showAt(f.getXY());this.menu.show(this.el);var c=this.menu.el.zindex+2000;d.contextMenu.el.setStyle("z-index",c)},rowcontextmenu:function(d,g,f){f.stopEvent();d.getSelectionModel().selectRow(g);d.contextMenuFrom="rowcontextmenu";d.contextMenuRowIndex=g;d.contextMenu.showAt(f.getXY());this.menu.show(this.el);var c=this.menu.el.zindex+2000;d.contextMenu.el.setStyle("z-index",c)}},colModel:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"user",header:_("By"),sortable:true,dataIndex:"user"},{header:_("Date"),dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}]}),autoExpandColumn:"user",viewConfig:{forceFit:true,deferEmptyText:false,emptyText:'<div style="text-align: center;">'+_("No user notes")+"<br><br>"+_("Right click to add a new note")+"</div>",enableRowBody:true,getRowClass:function(c,e,d){d.body='<p class="x-usernotes-content">'+c.data.note+"</p>";return"x-grid3-row-expanded"}}}]})})}});Ext.reg("usernotes",Ext.ux.UserNotes);Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(c){Ext.apply(this,c)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(d){this.grid=d;this.cm=d.getColumnModel();this.view=d.getView();var c=this.view;c.onLayout=this.onLayout;c.afterMethod("render",this.refreshSummary,this);c.afterMethod("refresh",this.refreshSummary,this);c.afterMethod("syncScroll",this.syncSummaryScroll,this);c.afterMethod("onColumnWidthUpdated",this.doWidth,this);c.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);c.afterMethod("onColumnHiddenUpdated",this.doHidden,this);d.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(e,o){var g={},m=o.config,h,d,k,f,c,l,p;for(h=0,l=m.length;h<l;h++){d=m[h];k=d.dataIndex;g[k]=0;if(d.summaryType){for(f=0,p=e.length;f<p;f++){c=e[f];g[k]=Ext.ux.grid.GridSummary.Calculations[d.summaryType](c.get(k),c,k,g,f)}}}return g},onLayout:function(c,d){if(Ext.type(d)!=="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(d-this.summary.getHeight())}},syncSummaryScroll:function(){var c=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft},doWidth:function(e,c,d){var f=this.view.summary.dom;f.firstChild.style.width=d;f.firstChild.rows[0].childNodes[e].style.width=c},doAllWidths:function(c,d){var g=this.view.summary.dom,h=c.length,f,e;g.firstChild.style.width=d;f=g.firstChild.rows[0].childNodes;for(e=0;e<h;e++){f[e].style.width=c[e]}},doHidden:function(d,f,c){var e=this.view.summary.dom,g=f?"none":"";e.firstChild.style.width=c;e.firstChild.rows[0].childNodes[d].style.display=g},renderSummary:function(f,k,q){k=k||this.view.getColumnData();var l=q.config,g=[],r=k.length-1,m,e,d,h,j;for(h=0,j=k.length;h<j;h++){m=k[h];e=l[h];d={};d.id=m.id;d.style=m.style;d.css=h===0?"x-grid3-cell-first ":(h===r?"x-grid3-cell-last ":"");if(e.summaryType||e.summaryRenderer){d.value=(e.summaryRenderer||m.renderer)(f.data[m.name],d,f)}else{d.value=""}if(d.value===undefined||d.value===""){d.value="&#160;"}g[g.length]=this.cellTpl.apply(d)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:g.join("")})},refreshSummary:function(){var h=this.grid,k=h.store,f=this.view.getColumnData(),c=this.cm,d=k.getRange(),j=this.calculate(d,c),e=this.renderSummary({data:j},f,c);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(e).first()},toggleSummary:function(d){var c=this.grid.getGridEl();if(c){if(d===undefined){d=c.hasClass("x-grid-hide-gridsummary")}c[d?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(d,c,e,g,f){return g[e]+Ext.num(d,0)},count:function(d,c,e,g,f){return f+1},max:function(d,c,e,g,f){return Math.max(Ext.num(d,0),g[e])},min:function(d,c,e,g,f){return Math.min(Ext.num(d,0),g[e])},average:function(d,c,f,j,h){var e=j[f]+Ext.num(d,0),g=c.store.getCount();return h===g-1?(e/g):e}};Ext.namespace("ui","ui.task");ui.task.ChangeFileOwner=function(c){Ext.apply(this,c);var d=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"setFileOwner",fileIdDB:this.fileIdDB,newOwner:this.newOwner},success:function(e){var f=Ext.util.JSON.decode(e.responseText);ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload()});ui.cmp.PortletInfo.getInstance().store.reload();d.hide();if(Ext.isDefined(this.fromType)&&this.fromType==="tab"){Ext.getCmp("main-panel").remove(this.from.curTab)}this.from.close();PhDOE.notify("info",_("Owner changed"),_("The owner for this file have been changed successfully !"))},failure:function(e){var f=Ext.util.JSON.decode(e.responseText);d.hide();PhDOE.winForbidden(f.type);if(Ext.isDefined(this.fromType)&&this.fromType==="tab"){Ext.getCmp("main-panel").remove(this.from.curTab)}this.from.close()}})};Ext.namespace("ui","ui.task","ui.task._CheckBuildTask");ui.task._CheckBuildTask.display=function(){XHR({params:{task:"getLogFile",file:"project_"+PhDOE.project+"_log_check_build_"+PhDOE.user.lang},success:function(c){var d=Ext.util.JSON.decode(c.responseText);Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);if(Ext.getCmp("main-panel").findById("check_build_panel_"+PhDOE.user.lang)){Ext.getCmp("main-panel").remove("check_build_panel_"+PhDOE.user.lang)}Ext.getCmp("main-panel").add({xtype:"panel",id:"check_build_panel_"+PhDOE.user.lang,title:String.format(_("Check build result for {0}"),Ext.util.Format.uppercase(PhDOE.user.lang)),tabTip:String.format(_("Check build result for the documentation {0}"),Ext.util.Format.uppercase(PhDOE.user.lang)),closable:true,autoScroll:true,iconCls:"iconCheckBuild",html:'<div class="check-build-content">'+d.mess+"</div>"});Ext.getCmp("main-panel").setActiveTab("check_build_panel_"+PhDOE.user.lang)}})};ui.task._CheckBuildTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.user.lang},success:function(){ui.task._CheckBuildTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._CheckBuildTask.display()}else{ui.task._CheckBuildTask.poll.delay(5000)}}})});ui.task.CheckBuildTask=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until the build is checked..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"checkBuild",xmlDetails:Ext.getCmp("option-xml-details").checked},success:function(){new ui.task._CheckBuildTask.display()},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden(d.type)}else{ui.task._CheckBuildTask.poll.delay(5000)}}})};Ext.namespace("ui","ui.task","ui.task._CheckEntitiesTask");ui.task._CheckEntitiesTask.display=function(){BtnViewResult=Ext.getCmp("btn-check-entities-view-last-result");Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);if(Ext.getCmp("main-panel").findById("tab-check-entities")){Ext.getCmp("main-panel").remove("tab-check-entities")}BtnViewResult.handler.call(BtnViewResult.scope||BtnViewResult,BtnViewResult)};ui.task._CheckEntitiesTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){ui.task._CheckEntitiesTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._CheckEntitiesTask.display()}else{ui.task._CheckEntitiesTask.poll.delay(5000)}}})});ui.task.CheckEntitiesTask=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until entities are checked..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"checkEntities"},success:function(){new ui.task._CheckEntitiesTask.display()},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._CheckEntitiesTask.poll.delay(5000)}}})};Ext.namespace("ui","ui.task");ui.task.CheckFileTask=function(c){Ext.apply(this,c);Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Checking for error. Please, wait..."));XHR({scope:this,params:{task:"checkFileError",FilePath:this.fpath,FileName:this.fname,FileLang:this.lang,FileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(d){Ext.getBody().unmask();var e=Ext.util.JSON.decode(d.responseText);if(e.error&&e.error_first!=="-No error-"){Ext.getCmp("main-panel").add({id:"FE-help-"+this.fid,title:"Error in "+this.fname,iconCls:"iconFilesError",closable:true,autoScroll:true,autoLoad:"./error?dir="+this.fpath+"&file="+this.fname});Ext.getCmp("main-panel").setActiveTab("FE-help-"+this.fid)}else{Ext.MessageBox.show({title:_("Check for errors"),msg:_("There is no error."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});if(this.prefix==="FE"){Ext.getCmp("FE-error-desc-"+this.fid).body.updateManager.refresh()}ui.cmp.ErrorFileGrid.getInstance().store.reload()}})};Ext.namespace("ui","ui.task");ui.task.CheckXml=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("XML check. Please, wait..."));XHR({scope:this,params:{task:"checkXml",fileContent:Ext.getCmp(this.idPrefix+"-FILE-"+this.fid).getCode()},success:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.errors!=="no_error"){new ui.cmp.CheckXmlWin({errors:g.errors})}else{PhDOE.notify("info",_("XML check"),_("There is no error."))}},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide()}})};Ext.namespace("ui","ui.task");ui.task.ClearLocalChangeTask=function(d){Ext.apply(this,d);var c=this.ftype,e=this.fpath,f=this.fname;goClear=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));var g=["FNT","FNU","FE","FNR","FNIEN","AF"];for(var h=0;h<g.length;h++){if(Ext.getCmp("main-panel").findById(g[h]+"-"+Ext.util.md5(g[h]+"-"+e+f))){Ext.getCmp("main-panel").remove(g[h]+"-"+Ext.util.md5(g[h]+"-"+e+f))}}XHR({params:{task:"clearLocalChange",FileType:c,FilePath:e,FileName:f},success:function(k){var l=Ext.util.JSON.decode(k.responseText),j;ui.cmp.WorkTreeGrid.getInstance().delRecord(l.oldIdDB);ui.cmp.PatchesTreeGrid.getInstance().delRecord(l.oldIdDB);j=false;j=ui.cmp.RepositoryTree.getInstance().getNodeById("/"+e+f);if(j){j.getUI().removeClass(["fileModifiedByMe","fileModifiedByAnother"])}if(l.lang==="en"&&c==="update"){ui.cmp.StaleFileGrid.getInstance().store.each(function(m){if((m.data.path)==="/"+l.path&&m.data.name===l.name){m.set("fileModifiedEN",false);m.set("en_revision",l.revision);m.commit()}},this);ui.cmp.ErrorFileGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModifiedEN",false)}},this);Ext.getBody().unmask();return}ui.cmp.PendingTranslateGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModified",false);m.commit()}},this);ui.cmp.StaleFileGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModifiedLang",false);m.set("revision",l.revision);m.set("maintainer",l.maintainer);m.commit()}},this);ui.cmp.ErrorFileGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModifiedLang",false);m.commit()}},this);ui.cmp.PendingReviewGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModifiedLang",false);m.commit()}},this);ui.cmp.NotInENGrid.getInstance().store.each(function(m){if((PhDOE.user.lang+m.data.path)===e&&m.data.name===f){m.set("fileModified",false)}},this);Ext.getBody().unmask()},failure:function(j){Ext.getBody().unmask();var k=Ext.util.JSON.decode(j.responseText);if(k.err){PhDOE.winForbidden(k.err)}}})};if(Ext.isDefined(this.noConfirm)){goClear()}else{Ext.MessageBox.confirm(_("Confirm"),_("This action will clear your local modification and take back this file from his original stats.<br/>You need confirm."),function(g){if(g==="yes"){goClear()}},this)}};Ext.namespace("ui","ui.task");ui.task.DeletePatchTask=function(c){Ext.apply(this,c);Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"deletePatch",patchID:this.patchID},success:function(){Ext.getBody().unmask();ui.cmp.PatchesTreeGrid.getInstance().deletePatch(this.patchID);PhDOE.notify("info",_("Patch deleted"),_("The patch have been deleted !"))},failure:function(d){var e=Ext.util.JSON.decode(d.responseText);Ext.getBody().unmask();if(e.err){PhDOE.winForbidden(e.err)}else{PhDOE.winForbidden()}}})};Ext.namespace("ui","ui.task");ui.task.GetFileInfoByXmlID=function(c){Ext.apply(this,c);XHR({scope:this,params:{task:"getFileInfoByXmlID",xmlID:this.xmlID},success:function(d){var e=Ext.util.JSON.decode(d.responseText);ui.cmp.RepositoryTree.getInstance().openFile(e.lang+e.path,e.name)}})};Ext.namespace("ui","ui.task");ui.task.GetFileTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,f=(this.ftype==="NotInEN")?true:false,e=(this.ftype==="GGTRANS")?true:false,g=(this.ftype==="NEW")?this.skeleton:false;Ext.get(c+"-PANEL-"+this.fid).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));XHR({scope:this,params:{task:"getFile",FilePath:this.fpath,FileName:this.fname,readOriginal:f,ggTranslate:e,skeleton:g},success:function(h){var k=Ext.util.JSON.decode(h.responseText),v="http://"+window.location.host+":"+window.location.port+window.location.pathname+"?perm=/"+this.fpath.split("/")[0]+"/"+k.xmlid.split("|")[0]+".php&project="+PhDOE.project,m='<a href="'+v+'" target="_blank"><img src="themes/img/anchor.png" alt="permlink" style="vertical-align: middle;" ext:qtip="'+_("Permanent link to this page")+'" /></a>&nbsp;',j=Ext.getCmp(c+"-PANEL-"+this.fid),u=Ext.get(c+"-PANEL-"+this.fid),t=Ext.getCmp(c+"-FILE-"+this.fid),l=(k.fileModified)?Ext.util.JSON.decode(k.fileModified):false,q,s;if(this.prefix==="PP"||this.ftype==="TRANS"||this.prefix==="FNIEN"){j.permlink=""}else{if(this.ftype==="GGTRANS"){j.setTitle(j.originTitle);j.setIconClass("iconGoogle")}else{j.permlink=(k.xmlid!=="NULL")?m:"";j.setTitle(j.permlink+j.originTitle)}}t.setCode(k.content);if(this.ftype==="GGTRANS"){t.reIndentAll()}u.unmask();if(k.warn_tab&&!this.freadOnly){Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The file <b> {0}</b> contains some tab characters.<br>The editor have replace it with space characters."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});t.manageCodeChange(c+"-FILE-"+this.fid)}if(k.warn_encoding&&!this.freadOnly){Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The editor have modified automatically the file {0} into UTF-8 encoding."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});t.setLineContent(1,'<?xml version="1.0" encoding="utf-8"?>');Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").enable()}if(this.prefix==="FNT"||this.prefix==="FNIEN"){q="fileModified"}if(this.prefix==="FNU"){q=(this.ftype==="LANG")?"fileModifiedLang":"fileModifiedEN"}if(this.prefix==="FE"){q=(this.ftype==="LANG")?"fileModifiedLang":"fileModifiedEN"}if(this.prefix==="FNR"){q=(this.ftype==="LANG")?"fileModifiedLang":"fileModifiedEN"}if(k.fileModified&&this.prefix!=="AF"){this.storeRecord.set(q,k.fileModified);this.storeRecord.commit()}if(this.prefix==="AF"){this.storeRecord.data={};this.storeRecord.data.fileModified=false;if(k.fileModified){this.storeRecord.data.fileModified=k.fileModified}}if(k.fileModified&&((!PhDOE.user.isAnonymous&&l.user!==PhDOE.user.login)||(PhDOE.user.isAnonymous&&l.anonymousIdent!==PhDOE.user.anonymousIdent))){if(l.isAnonymous&&!PhDOE.user.isAnonymous&&l.fromModule==="workInProgress"){Ext.MessageBox.show({title:_("Information"),msg:String.format(_("File modified by {0} (anonymous user) but you are an authenticated user, so you can modify it."),l.user.ucFirst()),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{if(l.isAnonymous&&!PhDOE.user.isAnonymous&&l.fromModule==="PatchesForReview"){new ui.cmp.AnonymousPatchWin({fidDB:l.fidDB,fid:this.fid,prefix:this.prefix,ftype:l.ftype,fpath:this.fpath,fname:this.fname,curTab:Ext.getCmp(this.prefix+"-"+this.fid)})}else{if(!this.freadOnly){Ext.getCmp(c+"-FILE-"+this.fid+"-grp-save").disable();Ext.getCmp(c+"-FILE-"+this.fid+"-grp-undoRedo").disable();Ext.getCmp(c+"-FILE-"+this.fid+"-grp-tools").disable()}s=Ext.MessageBox.show({title:_("Information"),msg:String.format(_("File modified by {0}."),l.user.ucFirst()),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});s.getDialog().mask.resize(u.getSize().width,u.getSize().height);s.getDialog().mask.alignTo(u.dom,"tl")}}}},callback:function(){var h=Ext.getCmp(this.prefix+"-"+this.fid);if(this.prefix==="FNT"){if(this.ftype==="TRANS"){h.panTRANSLoaded=true}if(this.ftype==="GGTRANS"){h.panGGTRANSLoaded=true}}if(this.prefix==="FNU"){if(this.ftype==="LANG"){h.panLANGLoaded=true}if(this.ftype==="EN"){h.panENLoaded=true}}if(this.prefix==="FE"){if(this.ftype==="LANG"){h.panLANGLoaded=true}if(this.ftype==="EN"){h.panENLoaded=true}}if(this.prefix==="FNR"){if(this.ftype==="LANG"){h.panLANGLoaded=true}if(this.ftype==="EN"){h.panENLoaded=true}}if(this.prefix==="FNIEN"){h.panLANGLoaded=true}if(this.prefix==="AF"){h.panLoaded=true}Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})};Ext.namespace("ui","ui.task");ui.task.GetGGTranslation=function(c){Ext.apply(this,c);Ext.get("GGTranslate-result").dom.innerHTML="";Ext.getCmp("GGTranslate-btn").disable();Ext.getCmp("GGTranslate-btn").setText(_("Please, wait..."));XHR({scope:this,params:{task:"getGGTranslation",str:this.str},success:function(d){var e=Ext.util.JSON.decode(d.responseText);Ext.get("GGTranslate-result").dom.innerHTML=Ext.util.Format.htmlEncode(e.translation);Ext.getCmp("GGTranslate-btn").setText(_("Translate !"));Ext.getCmp("GGTranslate-btn").enable()}})};Ext.namespace("ui","ui.task");ui.task.LoadConfigTask=function(c){Ext.apply(this,c);XHR({params:{task:"getConf"},success:function(d){var e=Ext.decode(d.responseText);PhDOE.user.login=e.mess.userLogin;PhDOE.user.lang=e.mess.userLang;PhDOE.user.isAnonymous=e.mess.userIsAnonymous;PhDOE.user.isGlobalAdmin=e.mess.userIsGlobalAdmin;PhDOE.user.isLangAdmin=e.mess.userIsLangAdmin;PhDOE.user.conf=e.mess.userConf;PhDOE.project=e.mess.project;PhDOE.app.conf=e.mess.appConf;Ext.get("appTheme").dom.href=PhDOE.user.conf.main.theme;PhDOE.drawInterface()}})};Ext.namespace("ui","ui.task");ui.task.MarkDeleteTask=function(c){Ext.apply(this,c);Ext.MessageBox.confirm(_("Confirm"),_("This action will mark this file as need deleted.<br/><br/>You need commit this change to take it effect.<br/><br/>Please, confirm this action."),function(d){if(d==="yes"){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"markAsNeedDelete",FilePath:PhDOE.user.lang+this.fpath,FileName:this.fname},success:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask();ui.cmp.WorkTreeGrid.getInstance().addRecord(f.id,PhDOE.user.lang+this.fpath,this.fname,"delete");this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}')}})}},this)};Ext.namespace("ui","ui.task");ui.task.MoveToPatch=function(c){Ext.apply(this,c);var d=[];Ext.each(this.nodesToAdd,function(e){d.push(e.attributes.idDB)});Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"moveToPatch",patchID:this.patchID,filesID:d.join(",")},success:function(){Ext.getBody().unmask();ui.cmp.PatchesTreeGrid.getInstance().addToPatch(this.patchID,this.patchName,this.nodesToAdd);if(this.nodesToAdd){Ext.each(this.nodesToAdd,function(e){ui.cmp.WorkTreeGrid.getInstance().delRecord(e.attributes.idDB)})}},failure:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask();Ext.MessageBox.alert("Error",f.err)}})};Ext.namespace("ui","ui.task");ui.task.MoveToWork=function(c){Ext.apply(this,c);var d=[];Ext.each(this.nodesToAdd,function(e){d.push(e.attributes.idDB)});Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({scope:this,params:{task:"moveToWork",filesID:d.join(",")},success:function(){Ext.getBody().unmask();ui.cmp.WorkTreeGrid.getInstance().addToWork(this.nodesToAdd);if(this.nodesToAdd){Ext.each(this.nodesToAdd,function(e){ui.cmp.PatchesTreeGrid.getInstance().delRecord(e.attributes.idDB)})}},failure:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask();Ext.MessageBox.alert("Error",f.err)}})};Ext.namespace("ui","ui.task","ui.task._PingTask");ui.task.PingTask=function(){this.task=new Ext.util.DelayedTask(function(){XHR({params:{task:"ping"},success:function(d){var e=Ext.util.JSON.decode(d.responseText),c;if(e.ping!=="pong"){window.location.href="./"}else{if(PhDOE.user.lang!=="en"){c=false;if(ui.cmp.PendingTranslateGrid.getInstance().store.getTotalCount()!==e.totalData.NbPendingTranslate){ui.cmp.PendingTranslateGrid.getInstance().store.reload();c=true}if(ui.cmp.StaleFileGrid.getInstance().store.getTotalCount()!==e.totalData.NbPendingUpdate){ui.cmp.StaleFileGrid.getInstance().store.reload();c=true}if(ui.cmp.ErrorFileGrid.getInstance().store.getTotalCount()!==e.totalData.NbFilesError){ui.cmp.ErrorFileGrid.getInstance().store.reload();c=true}if(ui.cmp.PendingReviewGrid.getInstance().store.getTotalCount()!==e.totalData.NbPendingReview){ui.cmp.PendingReviewGrid.getInstance().store.reload();c=true}if(ui.cmp.NotInENGrid.getInstance().store.getTotalCount()!==e.totalData.NbNotInEn){ui.cmp.NotInENGrid.getInstance().store.reload();c=true}if(c){ui.cmp.PortletSummary.getInstance().store.reload()}}if(e.totalData.lastInfoDate!==PhDOE.lastInfoDate){ui.cmp.PortletInfo.getInstance().store.reload()}}},failure:function(){window.location.href="./"}});this.task.delay(30000)},this)};ui.task.PingTask.prototype.delay=function(d,f,e,c){this.task.delay(d,f,e,c)};ui.task.PingTask.prototype.cancel=function(){this.task.cancel()};ui.task._PingTask.instance=null;ui.task.PingTask.getInstance=function(){if(!ui.task._PingTask.instance){ui.task._PingTask.instance=new ui.task.PingTask()}return ui.task._PingTask.instance};Ext.namespace("ui","ui.task");ui.task.SaveFileTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"saveFile",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(g){var h=Ext.util.JSON.decode(g.responseText);if(this.prefix==="FNU"){if(this.ftype==="EN"){this.storeRecord.set("en_revision",h.revision);this.storeRecord.set("fileModifiedEN",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}')}else{this.storeRecord.set("revision",h.en_revision);this.storeRecord.set("fileModifiedLang",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.set("maintainer",h.maintainer)}this.storeRecord.commit()}if(this.prefix==="FE"){if(this.ftype==="EN"){this.storeRecord.set("fileModifiedEN",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.commit()}else{this.storeRecord.set("maintainer",h.maintainer);this.storeRecord.set("fileModifiedLang",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.commit()}}if(this.prefix==="FNR"){if(this.ftype==="EN"){this.storeRecord.set("reviewed",h.reviewed);this.storeRecord.set("fileModifiedEN",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.commit()}else{this.storeRecord.set("maintainer",h.maintainer);this.storeRecord.set("fileModifiedLang",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.commit()}}if(this.prefix==="AF"){this.storeRecord.getUI().addClass("fileModifiedByMe")}ui.cmp.WorkTreeGrid.getInstance().delRecord(h.id);ui.cmp.PatchesTreeGrid.getInstance().delRecord(h.id);ui.cmp.WorkTreeGrid.getInstance().addRecord(h.id,this.lang+this.fpath,this.fname,"update");Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false;Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).permlink+Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);var f;if(this.lang==="en"){f=Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid)}else{f=Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid)}if(this.ftype==="ALL"||!f.isModified){Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}e.hide();PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.XmlError&&g.XmlError!="no_error"){Ext.MessageBox.alert(_("XML Errors"),_("There is somes XML's errors.<br /><br />You must fix it before saving this file.<br /><br />Valid this window to show this errors."),function(){new ui.cmp.CheckXmlWin({errors:g.XmlError})})}if(g.type){PhDOE.winForbidden(g.type)}}})};Ext.namespace("ui","ui.task");ui.task.SaveTransFileTask=function(d){Ext.apply(this,d);var c=this.prefix+"-"+this.ftype,e=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"saveFile",type:"trans",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getCode()},success:function(f){var g=Ext.util.JSON.decode(f.responseText);if(this.ftype!="NEW"){this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}');this.storeRecord.commit()}else{this.storeRecord.data.node.reload()}ui.cmp.WorkTreeGrid.getInstance().addRecord(g.id,this.lang+this.fpath,this.fname,"new");Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false;Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle);e.hide();PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);e.hide();if(g.XmlError&&g.XmlError!="no_error"){Ext.MessageBox.alert(_("XML Errors"),_("There is somes XML's errors.<br /><br />You must fix it before saving this file.<br /><br />Valid this window to show this errors."),function(){new ui.cmp.CheckXmlWin({errors:g.XmlError})})}if(g.type){PhDOE.winForbidden(g.type)}}})};Ext.namespace("ui","ui.task");ui.task.SetFileProgressTask=function(c){Ext.apply(this,c);XHR({scope:this,params:{task:"SetFileProgress",idDB:this.idDB,progress:this.progress},failure:function(d){var e=Ext.util.JSON.decode(d.responseText),f;if(e.err){if(e.err=="file_dont_exist_in_workInProgress"){f=_("The file you want to change the estimated progress don't exist into the database.")}if(e.err=="file_isnt_owned_by_current_user"){f=_("The file you want to change the estimated progress isn't own by you.<br>You only can modify this information for yours files.")}}if(f){PhDOE.notify("error",_("Error"),f)}}})};Ext.namespace("ui","ui.task","ui.task._SystemUpdateTask");ui.task._SystemUpdateTask.refresh_ui=function(){Ext.get("wizard-step-3").replaceClass("wizard-step-before","wizard-step-working");PhDOE.reloadAllStore();Ext.get("wizard-step-3").replaceClass("wizard-step-working","wizard-step-done");Ext.getCmp("btn-start-refresh").setIconClass("iconFinishRefresh");Ext.getCmp("btn-start-refresh").setText(_("Finish !"));Ext.getCmp("btn-start-refresh").setHandler(function(){Ext.getCmp("sys-update-win").close()});Ext.getCmp("btn-start-refresh").enable();ui.task.PingTask.getInstance().delay(30000);Ext.getCmp("sys-update-win").tools.close.setVisible(true)};ui.task._SystemUpdateTask.poll_apply_tool=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_apply_tools"},success:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");new ui.task._SystemUpdateTask.refresh_ui()}else{ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)}}})});ui.task._SystemUpdateTask.apply_tool=function(){Ext.get("wizard-step-2").replaceClass("wizard-step-before","wizard-step-working");XHR({params:{task:"applyTools"},success:function(){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done");new ui.task._SystemUpdateTask.refresh_ui()},failure:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5000)}})};ui.task._SystemUpdateTask.vcs_poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_update_repository"},success:function(){ui.task._SystemUpdateTask.vcs_poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");new ui.task._SystemUpdateTask.apply_tool()}else{ui.task._SystemUpdateTask.vcs_poll.delay(5000)}}})});ui.task.SystemUpdateTask=function(){ui.task.PingTask.getInstance().cancel();Ext.get("wizard-step-1").replaceClass("wizard-step-before","wizard-step-working");Ext.get("wizard-step-1.1").replaceClass("wizard-wait","wizard-show");XHR({params:{task:"updateRepository"},success:function(){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done");Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait");new ui.task._SystemUpdateTask.apply_tool()},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){Ext.getCmp("sys-update-win").close();PhDOE.winForbidden(d.type)}else{ui.task._SystemUpdateTask.vcs_poll.delay(5000)}}})};Ext.namespace("ui","ui.task");ui.task.UpdateConfTask=function(c){Ext.apply(this,c);XHR({scope:this,params:{task:"confUpdate",module:this.module,itemName:this.itemName,value:this.value},success:function(){PhDOE.user.conf[this.module][this.itemName]=this.value;if(this.module=="newFile"&&this.itemName=="nbDisplay"){ui.cmp.PendingTranslateGrid.getInstance().store.reload()}if(this.module=="needUpdate"&&this.itemName=="nbDisplay"){ui.cmp.StaleFileGrid.getInstance().store.reload()}if(this.module=="error"&&(this.itemName=="skipNbLiteralTag"||this.itemName=="nbDisplay")){ui.cmp.ErrorFileGrid.getInstance().store.reload()}if(this.module=="reviewed"&&this.itemName=="nbDisplay"){ui.cmp.PendingReviewGrid.getInstance().store.reload()}if(this.module=="main"&&this.itemName=="displayENWork"){ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload()})}if(this.notify!==false){PhDOE.notify("info",_("Option saved"),_("Option has been saved successfully !"))}}})};Ext.namespace("ui","ui.task","ui.task._UpdateSingleFolderTask");ui.task._UpdateSingleFolderTask.getUpdateFolderResponse=function(c){XHR({params:{task:"getUpdateFolderResponse"},success:function(d){var e=Ext.util.JSON.decode(d.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(e,c)}})};ui.task._UpdateSingleFolderTask.poll=new Ext.util.DelayedTask(function(){var f=arguments[0],d=f.attributes.id.split("/"),c,e=new Array();d.shift();c=d[0];e.push(f);XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_"+c+"_lock_update_folder"},success:function(){ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,e)},failure:function(g){var h=Ext.util.JSON.decode(g.responseText);if(h&&h.success===false){new ui.task._UpdateSingleFolderTask.getUpdateFolderResponse(f)}else{ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,e)}}})});ui.task._UpdateSingleFolderTask.afterUpdate=function(e,d){Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);var c=Ext.util.JSON.decode(e.result);d.reload(function(){Ext.iterate(c.newFiles,function(g,f){d.findChild("text",g).getUI().addClass("treeFileUpdated")})},this);PhDOE.reloadAllStore()};ui.task._UpdateSingleFolderTask.update=function(d){var c=new Array();c.push(d);Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until update this folder..."));ui.task.PingTask.getInstance().cancel();XHR({params:{task:"updateFolder",path:d.id},success:function(e){var f=Ext.util.JSON.decode(e.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(f,d)},failure:function(e){var f=Ext.util.JSON.decode(e.responseText);if(f&&f.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._UpdateSingleFolderTask.poll.delay(5000,null,this,c)}}})};ui.task.UpdateSingleFolderTask=function(c){if(PhDOE.user.isAnonymous){Ext.getCmp("winVCSCommit").close();PhDOE.winForbidden();return}ui.task._UpdateSingleFolderTask.update(c)};Ext.namespace("ui","ui.task","ui.task._VCSCommitTask");ui.task._VCSCommitTask.getCommitResponse=function(){XHR({params:{task:"getCommitResponse"},success:function(c){var d=Ext.util.JSON.decode(c.responseText);ui.task._VCSCommitTask.afterCommit(d.mess)}})};ui.task._VCSCommitTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_"+PhDOE.user.login+"_commit"},success:function(){ui.task._VCSCommitTask.poll.delay(5000)},failure:function(c){var d=Ext.util.JSON.decode(c.responseText);if(d&&d.success===false){new ui.task._VCSCommitTask.getCommitResponse()}else{ui.task._VCSCommitTask.poll.delay(5000)}}})});ui.task._VCSCommitTask.afterCommit=function(c){Ext.getBody().unmask();ui.task.PingTask.getInstance().delay(30000);new Ext.Window({title:_("Status"),width:450,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:c.join("<br/>"),buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}]}).show();PhDOE.reloadAllStore()};ui.task._VCSCommitTask.commit=function(g){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until commit..."));var c=[],f,e,d;for(d=0;d<g.length;d=d+1){f=Ext.getCmp("commit-grid-panel").store.getById(g[d].id);c.push(parseInt(f.data.FileDBID,10))}if(c.length==0){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Error"),msg:_("You must choose at least one file."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}e=Ext.getCmp("form-commit-message-log").getValue();e=Ext.util.Format.trim(e);if(Ext.isEmpty(e)){Ext.getBody().unmask();Ext.getCmp("form-commit-message-log").markInvalid(_("The log message is required."));Ext.MessageBox.show({title:_("Error"),msg:_("The log message is required."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}Ext.getCmp("winVCSCommit").close();ui.task.PingTask.getInstance().cancel();XHR({params:{task:"vcsCommit",nodes:Ext.util.JSON.encode(c),logMessage:e},success:function(h){var j=Ext.util.JSON.decode(h.responseText);ui.task._VCSCommitTask.afterCommit(j.mess)},failure:function(h){var j=Ext.util.JSON.decode(h.responseText);if(j&&j.success===false){ui.task.PingTask.getInstance().delay(30000);Ext.getBody().unmask();PhDOE.winForbidden()}else{ui.task._VCSCommitTask.poll.delay(5000)}}})};ui.task.VCSCommitTask=function(){if(PhDOE.user.isAnonymous){Ext.getCmp("winVCSCommit").close();PhDOE.winForbidden();return}var c=Ext.getCmp("commit-grid-panel").selModel.getSelections(),k=[],p,m,r,d,o,f,e,q,l="",h,g;for(h=0;h<c.length;++h){p=c[h].data;m="AF-"+Ext.util.md5("AF-"+p.path+p.name);r="FE-"+Ext.util.md5("FE-"+p.path+p.name);d="FNU-"+Ext.util.md5("FNU-"+p.path+p.name);o="FNIEN-"+Ext.util.md5("FNIEN-"+p.path+p.name);f="FNR-"+Ext.util.md5("FNR-"+p.path+p.name);e="FNT-"+Ext.util.md5("FNT-"+p.path+p.name);if(Ext.getCmp("main-panel").findById(m)||Ext.getCmp("main-panel").findById(r)||Ext.getCmp("main-panel").findById(o)||Ext.getCmp("main-panel").findById(d)||Ext.getCmp("main-panel").findById(f)||Ext.getCmp("main-panel").findById(e)){if(Ext.getCmp("main-panel").findById(m)){q=m}if(Ext.getCmp("main-panel").findById(r)){q=r}if(Ext.getCmp("main-panel").findById(d)){q=d}if(Ext.getCmp("main-panel").findById(o)){q=o}if(Ext.getCmp("main-panel").findById(f)){q=f}if(Ext.getCmp("main-panel").findById(e)){q=e}k.push([q,p.name])}}if(k.length>0){for(g=0;g<k.length;++g){l+=k[g][1]+"<br/>"}Ext.MessageBox.show({title:"Warning",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,msg:(k.length>1)?String.format(_("There are {0} files to close before commit.<br><br>{1}<br/><br/>Would you like me to close them for you ?"),k.length,l):String.format(_("There is {0} file to close before commit.<br><br>{1}<br/><br/>Would you like me to close it for you ?"),k.length,l),fn:function(t){if(t==="yes"){for(var s=0;s<k.length;++s){Ext.getCmp("main-panel").remove(k[s][0])}ui.task._VCSCommitTask.commit(c)}}})}else{ui.task._VCSCommitTask.commit(c)}};Ext.namespace("ui","ui.cmp");ui.cmp.About=Ext.extend(Ext.Window,{id:"win-about",iconCls:"iconHelp",layout:"fit",width:515,height:320,modal:true,plain:true,bodyStyle:"color:#000",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-about").close()}}],initComponent:function(){Ext.apply(this,{title:String.format(_("About {0}"),PhDOE.app.name),items:{xtype:"tabpanel",activeTab:0,autoTabs:true,border:false,defaults:{autoScroll:true},items:[{title:_("About"),html:'<div id="phd-oe-about"><img src="themes/img/php.png" class="loading-php-logo" alt="PHP" />'+PhDOE.app.name+'</div><div id="phd-oe-about-info">'+PhDOE.app.name+" ver "+PhDOE.app.ver+"<br/>UI: "+PhDOE.app.uiRevision+"<br/> Copyright &copy; 2008-2010 The PHP Group<br/>"+_("Author:")+' <a href="mailto:yannick@php.net">Yannick Torr&egrave;s</a> '+_('and <a href="http://svn.php.net/viewvc/web/doc-editor/" target="_blank">others</a>')+"</div>"},{title:_("Help and support"),bodyStyle:"padding:15px",html:'<div id="phd-oe-support"><ul><li>'+_("Mailing list:")+'<a href="mailto:phpdoc@lists.php.net">phpdoc@lists.php.net</a></li><li>'+_("IRC:")+'<a href="irc://irc.efnet.org/#php.doc">EFnet: #php.doc</a></li></ul></div>'},{title:_("Credits"),bodyStyle:"padding:15px",html:'<div id="phd-oe-credit"><ul><li><a href="http://extjs.com" target="_blank">ExtJs Team</a><div class="phd-oe-credit-info">'+_("Javascript FrameWork")+'</div></li><li><a href="http://marijn.haverbeke.nl/codemirror/" target="_blank">CodeMirror</a><div class="phd-oe-credit-info">'+_("Code editor")+'</div></li><li><a href="http://www.oxygen-icons.org/" target="_blank">Oxygen project from KDE</a><div class="phd-oe-credit-info">'+_("Icon pack")+'</div></li><li><a href="http://www.mibbit.com/" target="_blank">Mibbit for donating their Premium IRC widget</a><div class="phd-oe-credit-info">'+_("Web IRC Chat")+"</div></li></ul></div>"},{title:_("License"),autoLoad:{url:"./LICENSE"}}]}});ui.cmp.About.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._AnonymousPatchWin");ui.cmp._AnonymousPatchWin.form=Ext.extend(Ext.FormPanel,{frame:true,labelWidth:5,bodyStyle:"padding:5px 5px 0",defaultType:"radio",initComponent:function(c){Ext.apply(this,{items:[{xtype:"displayfield",value:_("File: ")+this.fpath+this.fname+"<br><br>"+_('You have opened a modified file from the "Patch for review" module.<br>This file has been modified by an anonymous user.<br><br>Please choose one of the following actions:')},{boxLabel:_("Continue to modify this file"),name:"choice",inputValue:"continue",checked:true,listeners:{afterrender:function(){new Ext.ToolTip({title:_("Continue to modify this file"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action will open this file for modification. Once your modification finish, just save it and this file will be own by you."),width:250,autoHide:true})}}},{boxLabel:_("Reject this patch"),name:"choice",inputValue:"reject",listeners:{afterrender:function(){new Ext.ToolTip({title:_("Reject this patch"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action will close this file, and clear the local change. This file will return into his original version, as it is on VCS server."),width:250,autoHide:true})}}},{boxLabel:_("Validate this patch"),name:"choice",inputValue:"validate",listeners:{afterrender:function(){new Ext.ToolTip({title:_("Validate this patch"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action changes the owner of the modification and register it under your name. The file will appear under your name and you can then commit it."),width:250,autoHide:true})}}}]});ui.cmp._AnonymousPatchWin.form.superclass.initComponent.call(this)}});ui.cmp.AnonymousPatchWin=Ext.extend(Ext.Window,{id:"anonymous-patch-win",title:_("Anonymous patch manager"),iconCls:"iconPatch",width:450,height:250,layout:"fit",resizable:false,modal:true,autoScroll:true,closable:false,closeAction:"close",buttons:[{text:_("Next"),iconCls:"iconArrowRight",handler:function(){var d=this.ownerCt.ownerCt,c=d.items.items[0].getForm().getValues().choice;switch(c){case"continue":d.close();break;case"reject":ui.task.ClearLocalChangeTask({ftype:d.ftype,fpath:d.fpath,fname:d.fname,noConfirm:true});break;case"validate":ui.task.ChangeFileOwner({fileIdDB:d.fidDB,newOwner:PhDOE.user.login,from:d,fromType:"tab"});break}}}],initComponent:function(){Ext.apply(this,{items:[new ui.cmp._AnonymousPatchWin.form({fpath:this.fpath,fname:this.fname})]});ui.cmp.AnonymousPatchWin.superclass.initComponent.call(this);this.show()}});Ext.namespace("ui","ui.cmp","ui.cmp._BuildStatus");ui.cmp._BuildStatus.display=function(c){Ext.apply(this,c);if(Ext.getCmp("main-panel").findById("last_failed_build_"+this.lang)){Ext.getCmp("main-panel").remove("last_failed_build_"+this.lang)}Ext.getCmp("main-panel").add({xtype:"panel",id:"last_failed_build_"+this.lang,title:String.format(_("Last failed build for {0}"),Ext.util.Format.uppercase(this.lang)),tabTip:String.format(_("Last failed build for the documentation {0}"),Ext.util.Format.uppercase(this.lang)),closable:true,autoScroll:true,iconCls:"iconCheckBuild",html:'<div class="check-build-content" id="check-build-content"></div>'});Ext.getCmp("main-panel").setActiveTab("last_failed_build_"+this.lang);Ext.getCmp("main-panel").el.mask(_("Please, wait..."));XHR({scope:this,params:{task:"getFailedBuildData",idFailedBuild:this.idFailedBuild},success:function(d){var e=Ext.decode(d.responseText),f=e.mess.join("<br/>");if(e.state==="truncate"){Ext.get("check-build-content").dom.innerHTML=f+'<div style="text-align: center; margin: 20px 0 20px 0" class="x-toolbar">'+_("This log is too large and have been truncated. Use the following button to download the full content of it.")+'<div id="check-build-content-download-btn"></div></div>';new Ext.Button({scope:this,text:_("Download the full content of this log"),renderTo:"check-build-content-download-btn",style:{margin:"auto"},handler:function(){window.location.href="./do/downloadFailedBuildLog?idFailedBuild="+this.idFailedBuild}})}else{Ext.get("check-build-content").dom.innerHTML=f}Ext.getCmp("main-panel").el.unmask()}})};ui.cmp._BuildStatus.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getFailedBuild"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"lang"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]})});ui.cmp._BuildStatus.ds.setDefaultSort("date","desc");ui.cmp._BuildStatus.rendererLanguage=function(c){return'<div><div class="flags flag-'+c+'" style="float: left;"></div><div style="padding-left: 24px">'+c+"</div></div>"};ui.cmp._BuildStatus.columns=[{id:"date",header:_("Date"),sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Language"),width:45,sortable:true,dataIndex:"lang",renderer:ui.cmp._BuildStatus.rendererLanguage}];ui.cmp._BuildStatus.menu=Ext.extend(Ext.menu.Menu,{setRowIndex:function(c){this.rowIndex=c},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIndex,this.event)}}]});ui.cmp._BuildStatus.menu.superclass.initComponent.call(this)}});ui.cmp.BuildStatus=Ext.extend(Ext.grid.GridPanel,{loadMask:true,bodyBorder:false,autoExpandColumn:"date",store:ui.cmp._BuildStatus.ds,columns:ui.cmp._BuildStatus.columns,view:new Ext.grid.GridView({forceFit:true}),listeners:{render:function(){this.store.load.defer(20,this.store)}},onRowdblclick:function(c,g,f){var d=this.store.getAt(g);new ui.cmp._BuildStatus.display({idFailedBuild:d.id,lang:d.data.lang})},onRowContextMenu:function(c,f,d){if(!this.menu){this.menu=new ui.cmp._BuildStatus.menu({grid:c,rowIdx:"",event:d})}d.stopEvent();this.getSelectionModel().selectRow(f);this.menu.setRowIndex(f);this.menu.showAt(d.getXY())},initComponent:function(c){ui.cmp.BuildStatus.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowdblclick",this.onRowdblclick,this);this.on("rowcontextmenu",this.onRowContextMenu,this)}});Ext.namespace("ui","ui.cmp","ui.cmp._ChangeFileOwner");ui.cmp._ChangeFileOwner.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getVCSUsers"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",fields:[{name:"id"},{name:"userName"}]}),sortInfo:{field:"userName",direction:"ASC"}});ui.cmp.ChangeFileOwner=Ext.extend(Ext.Window,{title:_("Change file's owner"),iconCls:"iconSwitchLang",width:550,height:255,layout:"form",resizable:false,modal:true,autoScroll:true,closeAction:"close",padding:10,buttons:[{text:_("Save"),disabled:true,handler:function(){var d=this.ownerCt.ownerCt,c=d.items.items[1].items.items[0].getValue();new ui.task.ChangeFileOwner({fileIdDB:d.fileIdDB,newOwner:c,from:d})}},{text:_("Close"),handler:function(){var c=this.ownerCt.ownerCt;c.close()}}],initComponent:function(){var c=this;Ext.apply(this,{defaults:{labelWidth:120},items:[{xtype:"fieldset",title:_("Information"),iconCls:"iconInfo",width:515,items:[{xtype:"displayfield",fieldLabel:_("File"),value:this.fileFolder+this.fileName},{xtype:"displayfield",fieldLabel:_("Current owner"),value:this.currentOwner}]},{xtype:"fieldset",title:_("Action"),iconCls:"iconSwitchLang",width:515,items:[{xtype:"combo",name:"newOwner",fieldLabel:_("New owner"),editable:false,store:ui.cmp._ChangeFileOwner.store,triggerAction:"all",valueField:"userName",displayField:"userName",listeners:{afterrender:function(){this.store.load()},select:function(){c.fbar.items.items[0].enable()}}}]}]});ui.cmp.ChangeFileOwner.superclass.initComponent.call(this);this.show()}});Ext.namespace("ui","ui.cmp");ui.cmp.Chat=Ext.extend(Ext.Window,{id:"win-chat",iconCls:"iconChat",layout:"fit",width:800,height:600,modal:true,plain:true,bodyStyle:"color:#000",closeAction:"hide",initComponent:function(){var c=PhDOE.user.login;if(PhDOE.user.isAnonymous){c="an%3F%3F%3F"}Ext.apply(this,{title:_("Chat with us on IRC !"),items:[new Ext.ux.IFrameComponent({id:"frame-win-chat",url:"https://widget.mibbit.com/?settings=8eec4034df2eb666b0600bdfe151529a&server=irc.umich.edu&channel=%23php.doc&nick=poe_"+c})]});ui.cmp.Chat.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp");ui.cmp.CheckBuildPrompt=Ext.extend(Ext.Window,{title:_("Check build"),iconCls:"iconCheckBuild",layout:"form",width:350,height:200,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",buttons:[{id:"win-check-build-btn-submit",text:_("Go !"),handler:function(){new ui.task.CheckBuildTask();this.ownerCt.ownerCt.close()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:false,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check the build via this command:")+"<br/><br/>/usr/bin/php configure.php --with-lang="+PhDOE.user.lang+'<span id="option-xml-details-span" style="color: red; visibility: hidden;"> --enable-xml-details</span><br/><div id="option-xml-details-div" style="text-align: center; color: red; visibility: hidden;">'+_("<b>WARNING !</b><br/> This option use a lot of server ressource. If you don't know what are the consequence, please, don't use it.")+"</div>"},{xtype:"checkbox",id:"option-xml-details",name:"option-xml-details",checked:false,hideLabel:true,boxLabel:_("Enable detailed XML error messages"),listeners:{check:function(e,d){Ext.get("option-xml-details-span").dom.style.visibility=(d)?"visible":"hidden";Ext.get("option-xml-details-div").dom.style.visibility=(d)?"visible":"hidden"}}}]});ui.cmp.CheckBuildPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._CheckDoc");ui.cmp._CheckDoc.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckDocData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"extension"},{name:"check_oldstyle",type:"int"},{name:"check_undoc",type:"int"},{name:"check_roleerror",type:"int"},{name:"check_badorder",type:"int"},{name:"check_noseealso",type:"int"},{name:"check_noreturnvalues",type:"int"},{name:"check_noparameters",type:"int"},{name:"check_noexamples",type:"int"},{name:"check_noerrors",type:"int"}]})});ui.cmp._CheckDoc.ds.setDefaultSort("extension","asc");ui.cmp._CheckDoc.renderer=function(d,c){if(d>0){c.css="check_doc_cell";c.attr="ext:qtip=\"<img src='themes/img/help.png' style='vertical-align: middle;' /> "+_("Double-click the cell to open the file selection")+'"';return d}else{return}};ui.cmp._CheckDoc.columns=[new Ext.grid.RowNumberer(),{id:"extension",header:_("Extension"),sortable:true,dataIndex:"extension"},{header:_("Not documented"),width:45,sortable:true,dataIndex:"check_undoc",renderer:ui.cmp._CheckDoc.renderer},{header:_("Old style"),width:45,sortable:true,dataIndex:"check_oldstyle",renderer:ui.cmp._CheckDoc.renderer},{header:_("Bad refsect1 order"),width:45,sortable:true,dataIndex:"check_badorder",renderer:ui.cmp._CheckDoc.renderer},{header:_("No parameters"),width:45,sortable:true,dataIndex:"check_noparameters",renderer:ui.cmp._CheckDoc.renderer},{header:_("No return values"),width:45,sortable:true,dataIndex:"check_noreturnvalues",renderer:ui.cmp._CheckDoc.renderer},{header:_("No examples"),width:45,sortable:true,dataIndex:"check_noexamples",renderer:ui.cmp._CheckDoc.renderer},{header:_("No errors section"),width:45,sortable:true,dataIndex:"check_noerrors",renderer:ui.cmp._CheckDoc.renderer},{header:_("No see also"),width:45,sortable:true,dataIndex:"check_noseealso",renderer:ui.cmp._CheckDoc.renderer},{header:_("Refsect1 role error"),width:45,sortable:true,dataIndex:"check_roleerror",renderer:ui.cmp._CheckDoc.renderer}];ui.cmp._CheckDoc.fs=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"file"}]});ui.cmp._CheckDoc.FileGrid=Ext.extend(Ext.grid.GridPanel,{id:"check-doc-file-grid",store:ui.cmp._CheckDoc.fs,loadMask:true,bodyBorder:false,autoExpandColumn:"file",sm:new Ext.grid.RowSelectionModel({}),columns:[new Ext.grid.RowNumberer(),{id:"file",header:_("Files"),sortable:true,dataIndex:"file"}],onRowClick:function(){Ext.getCmp("check-doc-btn-open-selected-files").enable()},onRowContextMenu:function(c,f,d){d.stopEvent();c.getSelectionModel().selectRow(f)},onRowDblClick:function(c,d){ui.cmp.RepositoryTree.getInstance().openFile("byPath","en"+c.fpath,c.store.getAt(d).data.file);Ext.getCmp("check-doc-file-win").close()},initComponent:function(c){ui.cmp._CheckDoc.FileGrid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this);this.on("rowclick",this.onRowClick,this)}});ui.cmp._CheckDoc.FileWin=Ext.extend(Ext.Window,{id:"check-doc-file-win",title:_("Files"),width:450,height:350,labelWidth:50,resizable:false,modal:true,autoScroll:true,layout:"fit",iconCls:"iconFiles",buttons:[{text:_("Open all files"),handler:function(){var e=Ext.getCmp("check-doc-file-win"),c=ui.cmp._CheckDoc.fs,d;PhDOE.AFfilePendingOpen=[];for(d=0;d<c.getCount();++d){PhDOE.AFfilePendingOpen[d]={fpath:"en"+e.fpath,fname:c.getAt(d).data.file}}ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();e.close()}},{text:_("Open selected files"),id:"check-doc-btn-open-selected-files",disabled:true,handler:function(){var e=Ext.getCmp("check-doc-file-win"),d=Ext.getCmp("check-doc-file-grid").getSelectionModel().getSelections(),c;PhDOE.AFfilePendingOpen=[];for(c=0;c<d.length;++c){PhDOE.AFfilePendingOpen[c]={fpath:"en"+e.fpath,fname:d[c].data.file}}ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();e.close()}}]});ui.cmp.CheckDoc=Ext.extend(Ext.grid.GridPanel,{loadMask:true,bodyBorder:false,store:ui.cmp._CheckDoc.ds,columns:ui.cmp._CheckDoc.columns,autoExpandColumn:"extension",sm:new Ext.grid.CellSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true}),listeners:{render:function(c){this.store.load.defer(20,c.store)}},onCellContextMenu:function(d,g,c,f){f.stopEvent();this.sm.select(g,c)},onCellDblClick:function(f,l,g,k){var c=this.store.getAt(l),j=this.getColumnModel().getDataIndex(g),h=c.get(j),d=c.data.path;if(Ext.num(h,false)&&h!==0){this.el.mask(_("Please, wait..."));XHR({params:{task:"getCheckDocFiles",path:d,errorType:j},success:function(e){var p=Ext.decode(e.responseText),m;ui.cmp._CheckDoc.fs.removeAll();for(m=0;m<p.files.length;++m){ui.cmp._CheckDoc.fs.insert(0,new ui.cmp._CheckDoc.fs.recordType({id:m,file:p.files[m].name}))}ui.cmp._CheckDoc.fs.sort("file","asc");f.el.unmask();new ui.cmp._CheckDoc.FileWin({fpath:d,items:[new ui.cmp._CheckDoc.FileGrid({fpath:d})]}).show()}})}},initComponent:function(c){ui.cmp.CheckDoc.superclass.initComponent.call(this);Ext.apply(this,c);this.on("celldblclick",this.onCellDblClick,this);this.on("cellcontextmenu",this.onCellContextMenu,this)}});Ext.namespace("ui","ui.cmp","ui.cmp._CheckEntities");ui.cmp._CheckEntities.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckEntitiesData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"entities"},{name:"url"},{name:"result"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]})});ui.cmp._CheckEntities.ds.setDefaultSort("entities","asc");ui.cmp._CheckEntities.rendererEntities=function(d,c){return"&"+d+";"};ui.cmp._CheckEntities.columns=[new Ext.grid.RowNumberer(),{id:"entities",header:_("Entities"),sortable:true,dataIndex:"entities",width:30,renderer:ui.cmp._CheckEntities.rendererEntities},{header:_("Url"),sortable:true,dataIndex:"url"},{header:_("Result"),width:30,sortable:true,dataIndex:"result"},{header:_("Date"),width:30,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.cmp.CheckEntities=Ext.extend(Ext.grid.GridPanel,{id:"check-entities-grid",loadMask:true,bodyBorder:false,store:ui.cmp._CheckEntities.ds,columns:ui.cmp._CheckEntities.columns,autoExpandColumn:"url",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true}),onRender:function(d,c){ui.cmp.CheckEntities.superclass.onRender.call(this,d,c);this.store.load.defer(20,this.store)},openTab:function(h){var g=this.store.getAt(h),d=g.data.url,f=Ext.util.md5(d),c="tab-check-entities-"+f,e=Ext.getCmp(c);if(!e){Ext.getCmp("main-panel").add({id:c,xtype:"panel",title:Ext.util.Format.ellipsis(d,20),tabTip:d,iconCls:"iconCheckEntities",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+c,url:d})]})}Ext.getCmp("main-panel").setActiveTab(c)},onRowdblclick:function(c,d){this.openTab(d)},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-checkentities",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.openTab(this.ctxRowIndex);this.menu.hide()}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxRowIndex){this.ctxRowIndex=null}this.ctxRowIndex=f;this.menu.showAt(d.getXY())},initComponent:function(c){this.tbar=[{xtype:"label",text:_("Status: ")},{xtype:"combo",typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["all",_("All status")],["FTP_CONNECT","FTP_CONNECT"],["FTP_LOGIN","FTP_LOGIN"],["FTP_NO_FILE","FTP_NO_FILE"],["HTTP_CONNECT","HTTP_CONNECT"],["HTTP_INTERNAL_ERROR","HTTP_INTERNAL_ERROR"],["HTTP_NOT_FOUND","HTTP_NOT_FOUND"],["HTTP_MOVED","HTTP_MOVED"],["HTTP_WRONG_HEADER","HTTP_WRONG_HEADER"],["SUCCESS","SUCCESS"],["UNKNOWN_HOST","UNKNOWN_HOST"]]}),value:"all",valueField:"myId",displayField:"displayText",editable:false,listeners:{select:function(f,d){var e=d.id;if(e==="all"){Ext.getCmp("check-entities-grid").store.clearFilter()}else{Ext.getCmp("check-entities-grid").store.filter("result",d.id)}}}}];ui.cmp.CheckEntities.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowdblclick,this)}});Ext.namespace("ui","ui.cmp");ui.cmp.CheckEntitiesPrompt=Ext.extend(Ext.Window,{title:_("Check entities"),iconCls:"iconRun",id:"win-check-entities",layout:"fit",width:250,height:140,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0; text-align: center;",labelAlign:"top",closeAction:"hide",buttons:[{id:"win-check-entities-btn",text:_("Go !"),handler:function(){new ui.task.CheckEntitiesTask();Ext.getCmp("win-check-entities").hide()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:false,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check all entities.<br><br>This action takes time.")}]});ui.cmp.CheckEntitiesPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp");ui.cmp.CheckXmlWin=Ext.extend(Ext.Window,{title:_("XML Errors"),iconCls:"iconXml",width:650,height:350,layout:"fit",resizable:false,modal:true,autoScroll:true,closeAction:"close",buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],store:new Ext.data.JsonStore({root:"Items",totalProperty:"nbItems",fields:[{name:"line"},{name:"libel"}]}),addErrorsInStore:function(){var c=Ext.data.Record.create({name:"line"},{name:"libel"});this.store.removeAll();for(i=0;i<this.errors.length;i++){this.store.add(new c({line:this.errors[i].line,libel:this.errors[i].libel+"<br>"+Ext.util.Format.htmlEncode(this.errors[i].ctx1)}))}this.store.sort("line","desc")},initComponent:function(){Ext.apply(this,{items:[{xtype:"grid",store:this.store,loadMask:true,autoExpandColumn:"libel_id",colModel:new Ext.grid.ColumnModel([{header:_("Line"),dataIndex:"line",sortable:true},{id:"libel_id",header:_("Libel"),dataIndex:"libel"}]),sm:new Ext.grid.RowSelectionModel({singleSelect:true})}]});ui.cmp.CheckXmlWin.superclass.initComponent.call(this);this.addErrorsInStore();this.show()}});Ext.namespace("ui","ui.cmp","ui.cmp._CommitLogManager");ui.cmp._CommitLogManager.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCommitLogMessage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"text"}]})});ui.cmp._CommitLogManager.editor=new Ext.ux.grid.RowEditor({saveText:_("Update"),cancelText:_("Cancel"),listeners:{afteredit:function(e,d,c){XHR({params:{task:"saveLogMessage",messID:c.data.id,mess:c.data.text},success:function(){c.commit();PhDOE.notify("info",_("Message updated"),_("Log Message was updated successfully !"))},failure:function(){PhDOE.winForbidden()}})}}});ui.cmp._CommitLogManager.cm=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{id:"log_msg",header:_("Log message"),dataIndex:"text",editor:{xtype:"textarea"},renderer:function(c){return c.split("\n").join("<br/>")}}]);ui.cmp._CommitLogManager.sm=new Ext.grid.RowSelectionModel({singleSelect:true});ui.cmp._CommitLogManager.menu=Ext.extend(Ext.menu.Menu,{setRowIdx:function(c){this.rowIdx=c},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:_("Delete this Log Message"),iconCls:"iconTrash",handler:function(){XHR({scope:this,params:{task:"deleteLogMessage",messID:ui.cmp._CommitLogManager.store.getAt(this.rowIdx).data.id},success:function(){ui.cmp._CommitLogManager.store.remove(ui.cmp._CommitLogManager.store.getAt(this.rowIdx));PhDOE.notify("info",_("Message deleted"),_("Log Message was deleted successfully !"))},failure:function(){PhDOE.winForbidden()}})}}]});ui.cmp._CommitLogManager.menu.superclass.initComponent.call(this)}});ui.cmp._CommitLogManager.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoExpandColumn:"log_msg",cm:ui.cmp._CommitLogManager.cm,sm:ui.cmp._CommitLogManager.sm,store:ui.cmp._CommitLogManager.store,plugins:[ui.cmp._CommitLogManager.editor],viewConfig:{emptyText:'<div class="x-grid-empty" style="text-align:center;">'+_("No log message currently")+"</div>"},listeners:{render:function(c){c.store.load()}},onRowContextMenu:function(c,f,d){d.stopEvent();this.getSelectionModel().selectRow(f);if(!this.menu){this.menu=new ui.cmp._CommitLogManager.menu()}this.menu.setRowIdx(f);this.menu.showAt(d.getXY())},initComponent:function(c){ui.cmp._CommitLogManager.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onRowContextMenu,this)}});ui.cmp.CommitLogManager=Ext.extend(Ext.Window,{id:"commit-log-win",title:_("Manage Log Message"),iconCls:"iconWinManageLog",width:650,height:350,layout:"fit",resizable:false,modal:true,autoScroll:true,closeAction:"hide",store:ui.cmp._CommitLogManager.store,buttons:[{text:_("Close"),handler:function(){Ext.getCmp("commit-log-win").hide()}}],initComponent:function(){Ext.apply(this,{items:[new ui.cmp._CommitLogManager.grid()]});ui.cmp.CommitLogManager.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._CommitPrompt");ui.cmp._CommitPrompt.store=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"by"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"type"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path"});ui.cmp._CommitPrompt.columns=[new Ext.grid.CheckboxSelectionModel(),{id:"name",header:_("Files"),sortable:true,dataIndex:"name"},{header:_("Modified by"),width:45,sortable:true,dataIndex:"by"},{header:_("Date"),width:45,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._CommitPrompt.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})'});ui.cmp._CommitPrompt.grid=Ext.extend(Ext.grid.GridPanel,{id:"commit-grid-panel",loadMask:true,autoExpandColumn:"name",height:180,columns:ui.cmp._CommitPrompt.columns,view:ui.cmp._CommitPrompt.view,enableDragDrop:true,sm:new Ext.grid.CheckboxSelectionModel(),listeners:{viewready:function(){this.selModel.selectAll()}},initComponent:function(){Ext.apply(this,{store:ui.cmp._CommitPrompt.store});ui.cmp._CommitPrompt.grid.superclass.initComponent.call(this)}});ui.cmp.CommitPrompt=Ext.extend(Ext.Window,{id:"winVCSCommit",layout:"form",title:_("VCS commit"),iconCls:"iconPendingCommit",closable:false,width:600,height:480,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelAlign:"top",tools:[{id:"gear",qtip:_("Configure this tools"),handler:function(){if(!Ext.getCmp("commit-log-win")){new ui.cmp.CommitLogManager()}Ext.getCmp("commit-log-win").show(this.id)}}],buttons:[{id:"win-commit-btn-submit",text:_("Submit"),handler:function(){new ui.task.VCSCommitTask()}},{id:"win-commit-btn-close",text:_("Close"),handler:function(){Ext.getCmp("winVCSCommit").close()}}],listeners:{show:function(){var c=new Ext.util.DelayedTask(function(){Ext.getCmp("form-commit-message-log").focus()});c.delay(200)}},initComponent:function(){var c;ui.cmp._CommitPrompt.store.removeAll();for(c=0;c<this.files.length;++c){ui.cmp._CommitPrompt.store.insert(0,new ui.cmp._CommitPrompt.store.recordType({id:"need-commit-"+this.files[c].fid,path:this.files[c].fpath,name:this.files[c].fname,by:this.files[c].fby,date:this.files[c].fdate,type:this.files[c].ftype,FileDBID:this.files[c].fdbid}))}ui.cmp._CommitPrompt.store.groupBy("path",true);Ext.apply(this,{items:[new ui.cmp._CommitPrompt.grid(),{xtype:"combo",name:"first2",fieldLabel:_("Older messages"),editable:false,anchor:"100%",store:ui.cmp._CommitLogManager.store,triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.text.split("\n").join("<br/>")]}</div></tpl>',valueField:"id",displayField:"text",listEmptyText:'<div class="x-grid-empty" style="text-align:center;">'+_("No log message currently")+"</div>",listeners:{select:function(e,d){Ext.getCmp("form-commit-message-log").setValue(d.data.text)}}},{xtype:"textarea",id:"form-commit-message-log",name:"first3",fieldLabel:_("Log message"),anchor:"100%",height:150,value:""}]});ui.cmp.CommitPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._DictionaryGrid");ui.cmp._DictionaryGrid.store=Ext.extend(Ext.data.Store,{proxy:new Ext.data.HttpProxy({url:"./do/getDictionaryWords"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"valueEn"},{name:"valueLang"},{name:"lastUser",hideField:true},{name:"lastDate",type:"date",dateFormat:"Y-m-d H:i:s",hideField:true}]}),sortInfo:{field:"valueEn",direction:"ASC"},listeners:{load:function(){if(!PhDOE.user.isAnonymous){Ext.getCmp(this.fid+"-btn-new-word").enable()}}},initComponent:function(c){Ext.apply(this,c);ui.cmp._DictionaryGrid.store.superclass.initComponent.call(this)}});ui.cmp._DictionaryGrid.editor=Ext.extend(Ext.ux.grid.RowEditor,{saveText:_("Update"),cancelText:_("Cancel"),listeners:{afteredit:function(e,d,c,f){XHR({params:{task:"manageDictionaryWord",wordId:c.data.id,valueEn:c.data.valueEn,valueLang:c.data.valueLang},success:function(g){var h=Ext.util.JSON.decode(g.responseText);c.set("lastUser",PhDOE.user.login);c.set("lastDate",Date.parseDate(h.dateUpdate,"Y-m-d H:i:s"));c.commit();PhDOE.notify("info",_("Word in dictionary added/updated"),_("The word have been added/updated successfully !"))},failure:function(){PhDOE.winForbidden()}})},canceledit:function(c){if(c.record.data.id==="new"){c.record.store.remove(c.record)}}}});ui.cmp._DictionaryGrid.sm=Ext.extend(Ext.grid.RowSelectionModel,{singleSelect:true});ui.cmp._DictionaryGrid.viewConfig={forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:false};ui.cmp._DictionaryGrid.menu=Ext.extend(Ext.menu.Menu,{setRowIdx:function(c){this.rowIdx=c},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:_("Delete this word"),iconCls:"iconTrash",disabled:(PhDOE.user.isAnonymous),handler:function(){XHR({scope:this,params:{task:"delDictionaryWord",wordId:this.grid.store.getAt(this.rowIdx).data.id},success:function(){this.grid.store.remove(this.grid.store.getAt(this.rowIdx));PhDOE.notify("info",_("Word deleted"),_("The word was deleted successfully !"))},failure:function(){PhDOE.winForbidden()}})}}]});ui.cmp._DictionaryGrid.menu.superclass.initComponent.call(this)}});ui.cmp._DictionaryGrid.grid=Ext.extend(Ext.grid.GridPanel,{onRowContextMenu:function(c,f,d){d.stopEvent();this.getSelectionModel().selectRow(f);if(!this.menu){this.menu=new ui.cmp._DictionaryGrid.menu({grid:c})}this.menu.setRowIdx(f);this.menu.showAt(d.getXY())},initComponent:function(){Ext.apply(this,{region:"center",split:true,loadMask:true,autoScroll:true,bodyBorder:false,border:false,autoExpandColumn:this.dataType,columns:[{id:"id",header:_("En word"),sortable:true,dataIndex:"valueEn",editor:{xtype:"textfield"}},{header:String.format(_("{0} word"),PhDOE.user.lang.ucFirst()),sortable:true,dataIndex:"valueLang",editor:{xtype:"textfield"}},{header:_("Last User Update"),sortable:true,dataIndex:"lastUser",editor:{xtype:"displayfield",hideField:true}},{header:_("Last Date Update"),sortable:true,dataIndex:"lastDate",editor:{xtype:"displayfield",hideField:true},renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],viewConfig:ui.cmp._DictionaryGrid.viewConfig,sm:new ui.cmp._DictionaryGrid.sm(),store:new ui.cmp._DictionaryGrid.store({fid:this.fid}),plugins:[new ui.cmp._DictionaryGrid.editor()],tbar:[{scope:this,tooltip:_("<b>Load/Refresh</b>"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},"->",{scope:this,id:this.fid+"-btn-new-word",disabled:true,text:_("Add a new word"),iconCls:"iconNewWord",handler:function(){var c=Ext.data.Record.create([{name:"id"},{name:"valueEn"},{name:"valueLang"},{name:"lastUser"},{name:"lastDate"}]),d=new Date(),f=new c({id:"new",valueEn:"",valueLang:"",lastUser:PhDOE.user.login,lastDate:d});this.plugins[0].stopEditing();this.store.insert(0,f);this.getView().refresh();this.getSelectionModel().selectRow(0);this.plugins[0].startEditing(0)}}]});ui.cmp._DictionaryGrid.grid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this)}});ui.cmp.DictionaryGrid=Ext.extend(Ext.Panel,{initComponent:function(){Ext.apply(this,{layout:"border",border:false,items:[new ui.cmp._DictionaryGrid.grid({dataType:this.dataType,prefix:this.prefix,fid:this.fid,ftype:this.ftype,loadStore:this.loadStore})]});ui.cmp.DictionaryGrid.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._EditorConf");ui.cmp._EditorConf.tplMenu=new Ext.XTemplate('<tpl for=".">','<div class="menu-wrap" id="tplMenu-{id}">','<div class="menu {card}"></div>',"<span>{label}</span>","</div>","</tpl>");ui.cmp._EditorConf.tplMenu.compile();ui.cmp._EditorConf.menuDefEn=[["1","card1",_("Main")],["4","card4",_('Module "Files with error"')],["6","card6",_('Module "All files"')]];ui.cmp._EditorConf.menuDefNonEn=[["1","card1",_("Main")],["2","card2",_('Module "Files need translate"')],["3","card3",_('Module "Files need update"')],["4","card4",_('Module "Files with error"')],["5","card5",_('Module "Files need reviewed"')],["6","card6",_('Module "All files"')]];ui.cmp._EditorConf.menuStore=new Ext.data.SimpleStore({id:0,fields:[{name:"id"},{name:"card"},{name:"label"}]});ui.cmp._EditorConf.viewMenu=Ext.extend(Ext.DataView,{id:"conf-menu-view",tpl:ui.cmp._EditorConf.tplMenu,singleSelect:true,overClass:"x-view-over",itemSelector:"div.menu-wrap",store:ui.cmp._EditorConf.menuStore,listeners:{selectionchange:function(c){var d=c.getSelectedRecords();Ext.getCmp("confCard").layout.setActiveItem("conf-card-"+d[0].data.id)}}});ui.cmp._EditorConf.themeStore=new Ext.data.SimpleStore({fields:["themeFile",{name:"themeName",type:"string"}],data:[["themes/ExtJsThemes/black/css/xtheme-black.css",_("Black")],["themes/empty.css",_("Default")],["themes/ExtJsThemes/darkgray/css/xtheme-darkgray.css",_("DarkGray")],["js/ExtJs/resources/css/xtheme-gray.css",_("Gray")],["themes/ExtJsThemes/gray-extend/css/xtheme-gray-extend.css",_("Gray Extend")],["themes/ExtJsThemes/indigo/css/xtheme-indigo.css",_("Indigo")],["themes/ExtJsThemes/midnight/css/xtheme-midnight.css",_("Midnight")],["themes/ExtJsThemes/olive/css/xtheme-olive.css",_("Olive")],["themes/ExtJsThemes/purple/css/xtheme-purple.css",_("Purple")],["themes/ExtJsThemes/silverCherry/css/xtheme-silverCherry.css",_("SilverCherry")],["themes/ExtJsThemes/ubuntu_human/css/xtheme-human.css",_("Ubuntu Human")]]});ui.cmp._EditorConf.CommitChange=new Ext.util.DelayedTask(function(){new ui.task.UpdateConfTask({module:this.module,itemName:this.itemName,value:this.getValue()})});ui.cmp._EditorConf.card1=Ext.extend(Ext.TabPanel,{id:"conf-card-1",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("Main menu"),iconCls:"iconMenu",items:[{xtype:"spinnerfield",width:60,name:"PhDOE.user.conf.main.mainMenuWidth",module:"main",itemName:"mainMenuWidth",value:PhDOE.user.conf.main.mainMenuWidth||300,fieldLabel:_("Main menu width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){var c=Ext.getCmp("main-menu-panel"),d=this.getValue();PhDOE.user.conf.main.mainMenuWidth=d;c.setWidth(d);c.ownerCt.doLayout();ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){var c=Ext.getCmp("main-menu-panel"),d=this.getValue();PhDOE.user.conf.main.mainMenuWidth=d;c.setWidth(d);c.ownerCt.doLayout();ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]},{xtype:"fieldset",iconCls:"iconThemes",title:_("Appearance"),items:[{xtype:"combo",fieldLabel:_("Choose a theme"),id:"conf-combo-theme",valueField:"themeFile",displayField:"themeName",triggerAction:"all",mode:"local",forceSelection:true,editable:false,value:PhDOE.user.conf.main.theme,store:ui.cmp._EditorConf.themeStore,listeners:{render:function(){Ext.getCmp("conf-combo-theme").store.sort("themeName")},select:function(e){var d=e.getValue();Ext.get("appTheme").dom.href=d;new ui.task.UpdateConfTask({module:"main",itemName:"theme",value:d})}}}]},{xtype:"fieldset",title:_("On save file"),iconCls:"iconSaveFile",autoHeight:true,defaults:{hideLabel:true},defaultType:"radio",items:[{autoHeight:true,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:(PhDOE.user.conf.main.onSaveFile==="ask-me")?true:false,boxLabel:_("Ask me if I want to check for error before saving the file"),inputValue:"ask-me",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:c.getRawValue()})}}}},{autoHeight:true,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:(PhDOE.user.conf.main.onSaveFile==="always")?true:false,boxLabel:_("Always check for error before saving the file"),inputValue:"always",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:c.getRawValue()})}}}},{autoHeight:true,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:(PhDOE.user.conf.main.onSaveFile==="never")?true:false,boxLabel:_("Never check for error before saving the file"),inputValue:"never",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:c.getRawValue()})}}}}]},{xtype:"checkbox",name:"PhDOE.user.conf.main.displayENWork",checked:PhDOE.user.conf.main.displayENWork,boxLabel:_('Display EN work in "Work in progress" & "Patches for review" modules'),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"main",itemName:"displayENWork",value:c.getValue()})}}}]},{title:_("External Data"),iconCls:"iconExternalData",items:[{xtype:"fieldset",title:_("About mails"),iconCls:"iconMailing",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"PhDOE.user.conf.main.loadMailsAtStartUp",checked:PhDOE.user.conf.main.loadMailsAtStartUp,boxLabel:_("Load mail at startUp"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"main",itemName:"loadMailsAtStartUp",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("About bugs"),iconCls:"iconBugs",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"PhDOE.user.conf.main.loadBugsAtStartUp",checked:PhDOE.user.conf.main.loadBugsAtStartUp,boxLabel:_("Load bugs at startUp"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"main",itemName:"loadBugsAtStartUp",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card1.superclass.initComponent.call(this)}});ui.cmp._EditorConf.card2=Ext.extend(Ext.TabPanel,{id:"conf-card-2",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},items:[{xtype:"spinnerfield",width:60,name:"PhDOE.user.conf.newFile.nbDisplay",module:"newFile",itemName:"nbDisplay",value:PhDOE.user.conf.newFile.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"PhDOE.user.conf.newFile.syncScrollbars",checked:PhDOE.user.conf.newFile.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"newFile",itemName:"syncScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.newFile.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"newFile.toolsPanelWidth",module:"newFile",itemName:"toolsPanelWidth",value:PhDOE.user.conf.newFile.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Google translate Panel"),iconCls:"iconGoogle",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"PhDOE.user.conf.newFile.googlePanelDisplay",checked:PhDOE.user.conf.newFile.googlePanelDisplay,boxLabel:_("Display the Google Translation Panel"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"newFile",itemName:"googlePanelDisplay",value:c.getValue()})}}}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{autoHeight:true,name:"PhDOE.user.conf.newFile.enableSpellCheck",checked:PhDOE.user.conf.newFile.enableSpellCheck,boxLabel:_("Enable spell checking"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"newFile",itemName:"enableSpellCheck",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card2.superclass.initComponent.call(this)}});ui.cmp._EditorConf.card3=Ext.extend(Ext.TabPanel,{id:"conf-card-3",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},defaultType:"spinnerfield",items:[{width:60,name:"PhDOE.user.conf.needUpdate.nbDisplay",module:"needUpdate",itemName:"nbDisplay",value:PhDOE.user.conf.needUpdate.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdate.syncScrollbars",checked:PhDOE.user.conf.needUpdate.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"syncScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdate.toolsPanelLogLoad",checked:PhDOE.user.conf.needUpdate.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelLogLoad",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.needUpdate.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdate.toolsPanelWidth",module:"needUpdate",itemName:"toolsPanelWidth",value:PhDOE.user.conf.needUpdate.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Diff view"),iconCls:"iconDiffView",defaults:{hideLabel:true},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.needUpdate.diffPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdate.diffPanelHeight",module:"needUpdate",itemName:"diffPanelHeight",value:PhDOE.user.conf.needUpdate.diffPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]},{name:"needUpdate.diffMethod",checked:(PhDOE.user.conf.needUpdate.diffMethod==="using-viewvc")?true:false,boxLabel:_("Using ViewVc from php web site"),inputValue:"using-viewvc",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffMethod",value:c.getRawValue()})}}}},{name:"needUpdate.diffMethod",checked:(PhDOE.user.conf.needUpdate.diffMethod==="using-exec")?true:false,boxLabel:_("Using diff -u command line"),inputValue:"using-exec",listeners:{check:function(c){if(c.checked){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffMethod",value:c.getRawValue()})}}}}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"needUpdate.enableSpellCheckEn",checked:PhDOE.user.conf.needUpdate.enableSpellCheckEn,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"enableSpellCheckEn",value:c.getValue()})}}},{name:"needUpdate.enableSpellCheckLang",checked:PhDOE.user.conf.needUpdate.enableSpellCheckLang,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.user.lang)),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"enableSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card3.superclass.initComponent.call(this)}});ui.cmp._EditorConf.card4=Ext.extend(Ext.TabPanel,{id:"conf-card-4",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},defaultType:"spinnerfield",items:[{width:60,name:"PhDOE.user.conf.error.nbDisplay",module:"error",itemName:"nbDisplay",value:PhDOE.user.conf.error.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]},{hidden:(PhDOE.user.lang==="en"),xtype:"fieldset",title:_("Error type"),iconCls:"iconFilesError",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"error.skipNbLiteralTag",checked:PhDOE.user.conf.error.skipNbLiteralTag,boxLabel:_("Skip nbLiteralTag error"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"skipNbLiteralTag",value:c.getValue()})}}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"error.syncScrollbars",checked:PhDOE.user.conf.error.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"syncScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"error.toolsPanelLogLoad",checked:PhDOE.user.conf.error.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelLogLoad",value:c.getValue()})}}},{name:"error.toolsPanelEntitiesLoad",checked:PhDOE.user.conf.error.toolsPanelEntitiesLoad,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelEntitiesLoad",value:c.getValue()})}}},{name:"error.toolsPanelAcronymsLoad",checked:PhDOE.user.conf.error.toolsPanelAcronymsLoad,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelAcronymsLoad",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.error.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"error.toolsPanelWidth",module:"error",itemName:"toolsPanelWidth",value:PhDOE.user.conf.error.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]},{xtype:"fieldset",title:_("Error description"),iconCls:"iconFilesError",defaults:{hideLabel:true},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.error.descPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"error.descPanelHeight",module:"error",itemName:"descPanelHeight",value:PhDOE.user.conf.error.descPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{hidden:(PhDOE.user.lang==="en"),name:"error.enableSpellCheckEn",checked:PhDOE.user.conf.error.enableSpellCheckEn,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"enableSpellCheckEn",value:c.getValue()})}}},{name:"error.enableSpellCheckLang",checked:PhDOE.user.conf.error.enableSpellCheckLang,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.user.lang)),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"error",itemName:"enableSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card4.superclass.initComponent.call(this)}});ui.cmp._EditorConf.card5=Ext.extend(Ext.TabPanel,{id:"conf-card-5",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:true},defaultType:"spinnerfield",items:[{width:60,name:"reviewed.nbDisplay",module:"reviewed",itemName:"nbDisplay",value:PhDOE.user.conf.reviewed.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:"User Interface",iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewed.syncScrollbars",checked:PhDOE.user.conf.reviewed.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"reviewed",itemName:"syncScrollbars",value:c.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewed.toolsPanelLogLoad",checked:PhDOE.user.conf.reviewed.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelLogLoad",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.reviewed.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"reviewed.toolsPanelWidth",module:"reviewed",itemName:"toolsPanelWidth",value:PhDOE.user.conf.reviewed.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:"Editor",iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"reviewed.enableSpellCheckEn",checked:PhDOE.user.conf.reviewed.enableSpellCheckEn,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),"EN"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"reviewed",itemName:"enableSpellCheckEn",value:c.getValue()})}}},{name:"reviewed.enableSpellCheckLang",checked:PhDOE.user.conf.reviewed.enableSpellCheckLang,boxLabel:String.format(_("Enable spell checking for the <b>{0}</b> file"),Ext.util.Format.uppercase(PhDOE.user.lang)),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"reviewed",itemName:"enableSpellCheckLang",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card5.superclass.initComponent.call(this)}});ui.cmp._EditorConf.card6=Ext.extend(Ext.TabPanel,{id:"conf-card-6",autoScroll:true,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:true,autoScroll:true},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"allFiles.toolsPanelLogLoad",checked:PhDOE.user.conf.allFiles.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelLogLoad",value:c.getValue()})}}},{name:"allFiles.toolsPanelEntitiesLoad",checked:PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelEntitiesLoad",value:c.getValue()})}}},{name:"allFiles.toolsPanelAcronymsLoad",checked:PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelAcronymsLoad",value:c.getValue()})}}},{xtype:"fieldset",checkboxToggle:true,collapsed:!PhDOE.user.conf.allFiles.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:false})},expand:function(){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:true})}},items:[{xtype:"spinnerfield",width:60,name:"allFiles.toolsPanelWidth",module:"allFiles",itemName:"toolsPanelWidth",value:PhDOE.user.conf.allFiles.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:10000,accelerate:true,enableKeyEvents:true,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1000,null,this)}}}]}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("SpellChecking"),iconCls:"iconSpellCheck",defaults:{hideLabel:true},defaultType:"checkbox",items:[{name:"allFiles.enableSpellCheck",checked:PhDOE.user.conf.allFiles.enableSpellCheck,boxLabel:_("Enable spell checking"),listeners:{check:function(c){new ui.task.UpdateConfTask({module:"allFiles",itemName:"enableSpellCheck",value:c.getValue()})}}}]}]}]});ui.cmp._EditorConf.card6.superclass.initComponent.call(this)}});ui.cmp.EditorConf=Ext.extend(Ext.Window,{id:"win-conf",layout:"border",width:700,height:470,iconCls:"iconConf",title:_("Configuration"),modal:true,plain:true,bodyBorder:false,closeAction:"hide",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-conf").hide()}}],listeners:{show:function(){var c=Ext.getCmp("conf-menu-view");c.select(c.getNode(0))}},initComponent:function(){if(PhDOE.user.lang==="en"){ui.cmp._EditorConf.menuStore.loadData(ui.cmp._EditorConf.menuDefEn)}else{ui.cmp._EditorConf.menuStore.loadData(ui.cmp._EditorConf.menuDefNonEn)}Ext.apply(this,{items:[{id:"confMenu",region:"west",border:false,width:190,autoScroll:true,items:[new ui.cmp._EditorConf.viewMenu()]},{id:"confCard",region:"center",border:false,layout:"card",width:375,frame:true,activeItem:0,bbar:new Ext.ux.StatusBar({defaultText:_("All changes take effect immediately"),defaultIconCls:"confStatusBar"}),items:[new ui.cmp._EditorConf.card1(),new ui.cmp._EditorConf.card2(),new ui.cmp._EditorConf.card3(),new ui.cmp._EditorConf.card4(),new ui.cmp._EditorConf.card5(),new ui.cmp._EditorConf.card6()]}]});ui.cmp.EditorConf.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._EmailPrompt");ui.cmp.EmailPrompt=Ext.extend(Ext.Window,{title:_("Send an email"),width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",iconCls:"iconSendEmail",closeAction:"hide",buttons:[{text:_("Send"),handler:function(){var d=this.ownerCt.ownerCt,c=d.findByType("form").shift().getForm().getValues();XHR({params:{task:"sendEmail",to:c.to,subject:c.subject,msg:c.msg},success:function(){d.hide();Ext.Msg.alert(_("Status"),String.format(_("Email sent to {0} with success!"),d.name.ucFirst()),Ext.emptyFn)},failure:function(){PhDOE.winForbidden()}})}},{text:_("Cancel"),handler:function(){this.ownerCt.ownerCt.hide()}}],setData:function(d,c){this.name=d;this.email=c;this.items.items[0].items.items[0].setValue('"'+this.name.ucFirst()+'" <'+this.email+">");this.items.items[0].items.items[1].setValue("");this.items.items[0].items.items[2].setValue("")},initComponent:function(){Ext.apply(this,{items:new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,defaultType:"textfield",items:[{name:"to",fieldLabel:_("Send To"),readOnly:true,anchor:"100%",value:""},{name:"subject",fieldLabel:_("Subject"),anchor:"100%"},{name:"msg",xtype:"textarea",hideLabel:true,anchor:"100% -53"}]})});ui.cmp.EmailPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._EntitiesAcronymsPanel");ui.cmp._EntitiesAcronymsPanel.grid=Ext.extend(Ext.grid.GridPanel,{onRowClick:function(c){var d=c.getSelectionModel().getSelected().data;Ext.getCmp(this.dataType+"-details-"+this.fid).update(d.value)},onRowDblClick:function(d){var f=d.getSelectionModel().getSelected().data,e=Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid),c=Ext.util.JSON.decode(e.getCursorPosition()),g=(this.dataType==="entities")?"&"+f.items+";":"<acronym>"+f.items+"</acronym>";e.insertIntoLine(c.line,c.caracter,g)},initComponent:function(){var c;if(this.dataType==="entities"){c="./do/getEntities"}else{if(this.dataType==="acronyms"){c="./do/getAcronyms"}}Ext.apply(this,{region:"center",split:true,loadMask:true,autoScroll:true,bodyBorder:false,border:false,autoExpandColumn:this.dataType,columns:[{id:"items",header:_("Items"),sortable:true,dataIndex:"items"},{header:_("From"),sortable:true,dataIndex:"from",width:50}],viewConfig:{forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:false},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),store:new Ext.data.Store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:c}),listeners:{scope:this,load:function(){if(this.dataType==="entities"){Ext.getCmp(this.prefix+"-"+this.fid).panEntities=true}else{if(this.dataType==="acronyms"){Ext.getCmp(this.prefix+"-"+this.fid).panAcronyms=true}}Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"from"},{name:"items"},{name:"value"}]})}),tbar:[{scope:this,tooltip:_("<b>Load/Refresh</b>"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},_("Filter: ")," ",new Ext.form.TwinTriggerField({width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(d,g){if(g.getKey()===g.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);this.ownerCt.ownerCt.store.clearFilter()},onTrigger2Click:function(){var d=this.getValue(),e;if(d===""||d.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);e=new RegExp(d,"i");this.ownerCt.ownerCt.store.filterBy(function(f){if(e.test(f.data.from)||e.test(f.data.items)||e.test(f.data.value)){return true}else{return false}},this)}})]});ui.cmp._EntitiesAcronymsPanel.grid.superclass.initComponent.call(this);this.on("rowclick",this.onRowClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp.EntitiesAcronymsPanel=Ext.extend(Ext.Panel,{initComponent:function(){var c;if(this.dataType==="entities"){c=_("Click on a row to display the content of the entitie.<br>Double-click on it to insert it at the cursor position.")}else{if(this.dataType==="acronyms"){c=_("Click on a row to display the content of the acronym.<br>Double-click on it to insert it at the cursor position.")}}Ext.apply(this,{layout:"border",border:false,items:[new ui.cmp._EntitiesAcronymsPanel.grid({dataType:this.dataType,prefix:this.prefix,fid:this.fid,ftype:this.ftype,loadStore:this.loadStore}),{xtype:"panel",id:this.dataType+"-details-"+this.fid,region:"south",split:true,height:100,autoScroll:true,bodyBorder:false,bodyCssClass:this.dataType+"-details",html:c}]});ui.cmp.EntitiesAcronymsPanel.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._ErrorFileGrid");ui.cmp._ErrorFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesError"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"maintainer"},{name:"type"},{name:"value_en"},{name:"value_lang"},{name:"fileModifiedEN"},{name:"fileModifiedLang"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-error-nb").innerHTML=c.getCount()}}});ui.cmp._ErrorFileGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name",renderer:function(c,f,d){var h="",g,e;if(d.data.fileModifiedEN){g=Ext.util.JSON.decode(d.data.fileModifiedEN);if(g.user===PhDOE.user.login&&g.anonymousIdent===PhDOE.user.anonymousIdent){h=_("File EN modified by me")+"<br>"}else{h=String.format(_("File EN modified by {0}"),g.user.ucFirst())+"<br>"}}if(d.data.fileModifiedLang){e=Ext.util.JSON.decode(d.data.fileModifiedLang);if(e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent){h+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst())}else{h+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),e.user.ucFirst())}}if(h!==""){return"<span ext:qtip='"+h+"'>"+c+"</span>"}else{return c}}},{header:_("Type"),width:45,sortable:true,dataIndex:"type"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._ErrorFileGrid.view=new Ext.grid.GroupingView({emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",deferEmptyText:false,forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data.path]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(c){if(c.data.fileModifiedEN||c.data.fileModifiedLang){var e=Ext.util.JSON.decode(c.data.fileModifiedEN),d=Ext.util.JSON.decode(c.data.fileModifiedLang);return((e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent)||(d.user===PhDOE.user.login&&d.anonymousIdent===PhDOE.user.anonymousIdent))?"fileModifiedByMe":"fileModifiedByAnother"}return false}});ui.cmp._ErrorFileGrid.menu=function(c){Ext.apply(this,c);this.init();ui.cmp._ErrorFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.cmp._ErrorFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconFilesError",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff..."),iconCls:"iconViewDiff",menu:new Ext.menu.Menu({items:[{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedEN===false),text:String.format(_("... of the {0} file"),"EN"),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:"en"+this.fpath})}},{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedLang===false),text:String.format(_("... of the {0} file"),PhDOE.user.lang.ucFirst()),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}}]})},"-",{text:_("About error type"),iconCls:"iconHelp",handler:function(){if(!Ext.getCmp("main-panel").findById("FE-help")){Ext.getCmp("main-panel").add({id:"FE-help",title:_("About error type"),iconCls:"iconHelp",closable:true,autoScroll:true,autoLoad:"./error"})}Ext.getCmp("main-panel").setActiveTab("FE-help")}}]})}});ui.cmp.ErrorFileGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",view:ui.cmp._ErrorFileGrid.view,columns:ui.cmp._ErrorFileGrid.columns,listeners:{render:function(c){c.view.refresh()}},onRowContextMenu:function(d,j,h){h.stopEvent();var g=d.store.getAt(j).data,f=g.path,c=g.name;d.getSelectionModel().selectRow(j);new ui.cmp._ErrorFileGrid.menu({hideDiffMenu:(g.fileModifiedEN===false&&g.fileModifiedLang===false),grid:d,event:h,rowIdx:j,lang:PhDOE.user.lang,fpath:f,fname:c}).showAt(h.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(j){var g=this.store.getById(j),f=g.data.path,c=g.data.name,h=Ext.util.md5("FE-"+PhDOE.user.lang+f+c),d=[],k,e;if(!Ext.getCmp("main-panel").findById("FE-"+h)){d=[];this.store.each(function(l){if(l.data.path===f&&l.data.name===c&&!d[l.data.type]){d.push(l.data.type)}});k=(PhDOE.user.lang==="en")?[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FE-LANG",fid:h,fpath:PhDOE.user.lang+f,fname:c,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad})]:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FE-LANG",fid:h,fpath:PhDOE.user.lang+f,fname:c,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FE-EN",fid:h,fpath:"en"+f,fname:c,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad})];e=(PhDOE.user.lang==="en")?[new ui.cmp.FilePanel({id:"FE-LANG-PANEL-"+h,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang)+f+c,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.user.conf.error.enableSpellCheckLang,spellCheckConf:{module:"error",itemName:"enableSpellCheckLang"},fid:h,fpath:f,fname:c,lang:PhDOE.user.lang,parser:"xml",storeRecord:g,syncScrollCB:false,syncScroll:false})]:[new ui.cmp.FilePanel({id:"FE-LANG-PANEL-"+h,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang.ucFirst())+f+c,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.user.conf.error.enableSpellCheckLang,spellCheckConf:{module:"error",itemName:"enableSpellCheckLang"},fid:h,fpath:f,fname:c,lang:PhDOE.user.lang,parser:"xml",storeRecord:g,syncScrollCB:true,syncScroll:true,syncScrollConf:{module:"error",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FE-EN-PANEL-"+h,region:"east",title:_("en File: ")+f+c,prefix:"FE",ftype:"EN",spellCheck:PhDOE.user.conf.error.enableSpellCheckEn,spellCheckConf:{module:"error",itemName:"enableSpellCheckEn"},fid:h,fpath:f,fname:c,lang:"en",parser:"xml",storeRecord:g,syncScroll:true,syncScrollConf:{module:"error",itemName:"syncScrollbars"}})];Ext.getCmp("main-panel").add({id:"FE-"+h,title:c,layout:"border",iconCls:"iconTabError",closable:true,tabLoaded:false,panVCSLang:!PhDOE.user.conf.errorDisplayLog,panVCSEn:(PhDOE.user.lang==="en")?true:!PhDOE.user.conf.errorDisplayLog,panLANGLoaded:false,panENLoaded:(PhDOE.user.lang==="en")?true:false,originTitle:c,defaults:{split:true},tabTip:String.format(_("File with error : in {0}"),f),listeners:{resize:function(l){(PhDOE.user.lang!=="en")?Ext.getCmp("FE-EN-PANEL-"+h).setWidth(l.getWidth()/2):""}},items:[{xtype:"panel",id:"FE-error-desc-"+h,region:"north",layout:"fit",title:_("Error description"),iconCls:"iconFilesError",collapsedIconCls:"iconFilesError",plugins:[Ext.ux.PanelCollapsedTitle],height:PhDOE.user.conf.error.descPanelHeight||150,collapsible:true,collapsed:!PhDOE.user.conf.error.descPanelDisplay,autoScroll:true,autoLoad:"./error?dir="+f+"&file="+c,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:true})}},resize:function(o,l,m){if(this.ownerCt.tabLoaded&&m&&m>50&&m!=PhDOE.user.conf.error.descPanelHeight){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelHeight",value:m})}}}},{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:true,collapsed:!PhDOE.user.conf.error.toolsPanelDisplay,layout:"fit",bodyBorder:false,width:PhDOE.user.conf.error.toolsPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:true})}},resize:function(l,m){if(this.ownerCt.tabLoaded&&m&&m!=PhDOE.user.conf.error.toolsPanelWidth){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelWidth",value:m})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:true,defaults:{autoScroll:true},items:[k,new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FE",fid:h}),{title:_("Entities"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"entities",prefix:"FE",ftype:"LANG",fid:h,loadStore:PhDOE.user.conf.error.toolsPanelEntitiesLoad})]},{title:_("Acronyms"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"FE",ftype:"LANG",fid:h,loadStore:PhDOE.user.conf.error.toolsPanelAcronymsLoad})]}]}},e]})}Ext.getCmp("main-panel").setActiveTab("FE-"+h)},initComponent:function(){Ext.apply(this,{store:ui.cmp._ErrorFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FE-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(c,d){if(d.getKey()===d.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.cmp._ErrorFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue(),d;if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);d=new RegExp(c,"i");ui.cmp._ErrorFileGrid.instance.store.filterBy(function(e){if(d.test(e.data.path)||d.test(e.data.name)||d.test(e.data.maintainer)||d.test(e.data.type)){return true}else{return false}},this)}})]});ui.cmp.ErrorFileGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this);if(PhDOE.user.lang==="en"){this.getColumnModel().setHidden(2,true)}}});ui.cmp._ErrorFileGrid.instance=null;ui.cmp.ErrorFileGrid.getInstance=function(c){if(!ui.cmp._ErrorFileGrid.instance){if(!c){c={}}ui.cmp._ErrorFileGrid.instance=new ui.cmp.ErrorFileGrid(c)}return ui.cmp._ErrorFileGrid.instance};Ext.namespace("ui","ui.cmp");ui.cmp.ExecDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",autoScroll:true,plugins:[Ext.ux.PanelCollapsedTitle],onRender:function(d,c){ui.cmp.ExecDiff.superclass.onRender.call(this,d,c);this.el.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading..."));XHR({scope:this,params:{task:"getDiff",DiffType:"vcs",FilePath:"en"+this.fpath,FileName:this.fname,Rev1:this.rev1,Rev2:this.rev2},success:function(e){var f=Ext.util.JSON.decode(e.responseText);Ext.get(this.prefix+"-diff-"+this.fid).dom.innerHTML=f.content;this.el.unmask()},callback:function(){Ext.getCmp(this.prefix+"-"+this.fid).panDiffLoaded=true;Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})},initComponent:function(){Ext.apply(this,{html:'<div id="'+this.prefix+"-diff-"+this.fid+'" class="diff-content"></div>'});ui.cmp.ExecDiff.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._FilePanel");Ext.namespace("ui.cmp._FilePanel.tbar.menu");Ext.namespace("ui.cmp._FilePanel.tbar.items");ui.cmp._FilePanel.tbar.items.undoRedo=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.items.undoRedo.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.items.undoRedo,Ext.ButtonGroup,{init:function(){Ext.apply(this,{id:this.id_prefix+"-FILE-"+this.fid+"-grp-undoRedo",items:[{id:this.id_prefix+"-FILE-"+this.fid+"-btn-undo",scope:this,tooltip:_("<b>Undo</b>"),disabled:true,iconCls:"iconUndo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).undo(this.id_prefix,this.fid)}},{id:this.id_prefix+"-FILE-"+this.fid+"-btn-redo",scope:this,tooltip:_("<b>Redo</b>"),disabled:true,iconCls:"iconRedo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).redo(this.id_prefix,this.fid)}}]})}});ui.cmp._FilePanel.tbar.items.usernotes=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.items.usernotes.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.items.usernotes,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{xtype:"usernotes",file:this.file,fid:Ext.id()}]})}});ui.cmp._FilePanel.tbar.items.common=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.items.common.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.items.common,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{scope:this,tooltip:_("Close Tab"),iconCls:"iconClose",handler:function(){Ext.getCmp("main-panel").remove(this.prefix+"-"+this.fid)}},{id:this.prefix+"-"+this.fid+"-btn-tabLeft-"+this.ftype,scope:this,tooltip:_("Go to previous tab"),iconCls:"iconArrowLeft",handler:this.goToPreviousTab},{id:this.prefix+"-"+this.fid+"-btn-tabRight-"+this.ftype,scope:this,tooltip:_("Go to next tab"),disabled:true,iconCls:"iconArrowRight",handler:this.goToNextTab}]})}});ui.cmp._FilePanel.tbar.menu.lang=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.menu.lang.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.menu.lang,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Reviewed tag"),handler:function(){Ext.getCmp(this.comp_id).insertIntoLine(2,"end","\n<!-- Reviewed: no -->");Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Revcheck tag"),handler:function(){Ext.getCmp(this.comp_id).insertIntoLine(2,"end","\n<!-- EN-Revision: XX Maintainer: "+PhDOE.user.login+" Status: ready -->");Ext.getCmp(this.comp_id).focus()}}]})})}});ui.cmp._FilePanel.tbar.menu.en=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.menu.en.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.menu.en,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Description section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,[' <refsect1 role="description"><!-- {{{ -->\r\n  ',"&reftitle.description;\r\n  ","<methodsynopsis>\r\n   ","<!-- Example: All functions have this -->\r\n   ","<type>thereturned type</type><methodname>func_name</methodname>\r\n   ","<!-- Example: Required parameter -->\r\n   ","<methodparam><type>param1type</type><parameter>firstparameter</parameter></methodparam>\r\n   ","<!-- Example: Optional parameter, also by reference -->\r\n   ",'<methodparam choice="opt"><type>int</type><parameter role="reference">secondparameter</parameter></methodparam>\r\n   ',"<!-- Example: If no methodparams exist (void), use this -->\r\n   ","<void />\r\n  ","</methodsynopsis>\r\n  ","<para>\r\n   ","The function description goes here.\r\n  ","</para>\r\n ","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Parameters section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="parameters"><!-- {{{ -->\r\n',"&reftitle.parameters;\r\n","<para>\r\n","<variablelist>\r\n","<varlistentry>\r\n","<term><parameter>firstparameter</parameter></term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","<varlistentry>\r\n","<term>\r\n","<parameter>secondparameter</parameter>\r\n","</term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","</variablelist>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Return section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="returnvalues"><!-- {{{ -->\r\n',"&reftitle.returnvalues;\r\n","<para>\r\n","What this function returns, first on success, then failure.\r\n","If simply true on success and false on failure, just use &return.success; here.\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Error section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="errors"><!-- {{{ -->\r\n',"&reftitle.errors;\r\n","<para>\r\n","When does this function issue E_* level errors, and/or throw exceptions.\r\n","</para>\r\n","</refsect1><!-- }}} -->\r\n"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Unicode section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="unicode"><!-- {{{ -->\r\n',"&reftitle.unicode;\r\n","<para>\r\n","Information specific to unicode, from the PHP 6 changes.\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Changelog section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="changelog"><!-- {{{ -->\r\n',"&reftitle.changelog;\r\n","<para>\r\n","<informaltable>\r\n",'<tgroup cols="2">\r\n',"<thead>\r\n","<row>\r\n","<entry>&Version;</entry>\r\n","<entry>&Description;</entry>\r\n","</row>\r\n","</thead>\r\n","<tbody>\r\n","<row>\r\n","<entry>Enter the version of change here</entry>\r\n","<entry>\r\n","Describe the change\r\n","</entry>\r\n","</row>\r\n","</tbody>\r\n","</tgroup>\r\n","</informaltable>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Examples section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="examples"><!-- {{{ -->\r\n',"&reftitle.examples;\r\n","<para>\r\n",'<example xml:id="function-name.example.basic"><!-- {{{ -->\r\n',"<title><function>function-name</function> example</title>\r\n","<para>\r\n","Any text that describes the purpose of the example, or what\r\n","goes on in the example should be here. (Inside the <example> tag, not out).\r\n","</para>\r\n",'<programlisting role="php">\r\n',"<![CDATA[\r\n","<?php\r\n","if ($anexample === true) {\r\n","echo 'Use the PEAR Coding standards';\r\n","}\r\n","if ($thereisoutput === 'and it is multiple lines') {\r\n","echo 'Use a screen like we did below';\r\n","}\r\n","?>\r\n","]]>\r\n","</programlisting>\r\n","&example.outputs.similar;\r\n","<screen>\r\n","<![CDATA[\r\n","Use the PEAR Coding standards\r\n","Use a screen like we did below\r\n","]]>\r\n","</screen>\r\n","</example><!-- }}} -->\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Notes section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="notes"><!-- {{{ -->\r\n',"&reftitle.notes;\r\n","<caution>\r\n","<para>\r\n","Any notes that don't fit anywhere else should go here.\r\n","90% of the time, notes, warnings or cautions are better placed in the\r\n","parameters section. Consider that before using this section!\r\n","</para>\r\n","</caution>\r\n","&note.language-construct;\r\n","&note.not-bin-safe;\r\n","&note.registerglobals;\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("SeeAlso section"),handler:function(){var c=Ext.util.JSON.decode(Ext.getCmp(this.comp_id).getCursorPosition());Ext.getCmp(this.comp_id).insertIntoLine(c.line,0,['\r\n<refsect1 role="seealso"><!-- {{{ -->\r\n',"&reftitle.seealso;\r\n","<para>\r\n","<simplelist>\r\n","<member><function>somefunc</function></member>\r\n","<member><function>another_func</function></member>\r\n",'<member>The <link linkend="something">something appendix</link></member>\r\n',"</simplelist>\r\n","</para>\r\n","</refsect1><!-- }}} -->"].join(""));Ext.getCmp(this.comp_id).focus()}}]})})}});ui.cmp._FilePanel.tbar.items.reindentTags=function(c){Ext.apply(this,c);this.init();ui.cmp._FilePanel.tbar.items.reindentTags.superclass.constructor.call(this)};Ext.extend(ui.cmp._FilePanel.tbar.items.reindentTags,Ext.ButtonGroup,{init:function(){Ext.apply(this,{id:this.id_prefix+"-FILE-"+this.fid+"-grp-tools",items:[{scope:this,tooltip:_("<b>Check</b> XML with XmlLint"),iconCls:"iconXml",handler:function(c){new ui.task.CheckXml({idPrefix:this.id_prefix,fid:this.fid})}},{scope:this,tooltip:_("<b>Enable / Disable</b> spellChecking"),enableToggle:true,iconCls:"iconSpellCheck",pressed:PhDOE.user.conf[this.spellCheckConf.module][this.spellCheckConf.itemName],handler:function(c){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).setSpellcheck(c.pressed);new ui.task.UpdateConfTask({module:this.spellCheckConf.module,itemName:this.spellCheckConf.itemName,value:c.pressed,notify:false})}},{scope:this,tooltip:_("<b>Re-indent</b> all this file"),iconCls:"iconIndent",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).reIndentAll()}},(this.lang==="en")?new ui.cmp._FilePanel.tbar.menu.en({comp_id:this.id_prefix+"-FILE-"+this.fid}):new ui.cmp._FilePanel.tbar.menu.lang({comp_id:this.id_prefix+"-FILE-"+this.fid})]})}});ui.cmp.FilePanel=Ext.extend(Ext.form.FormPanel,{activeScroll:false,goToPreviousTab:function(){var c=this.prefix+"-"+this.fid,e=Ext.getCmp("main-panel").layout.container.items.items,g,f,d;for(d=0;d<e.length;d++){if(e[d].id===c){f=d}}if(f===1){g="MainInfoTabPanel"}else{g=e[f-1].id}Ext.getCmp("main-panel").setActiveTab(g)},goToNextTab:function(){var d=this.prefix+"-"+this.fid,f=Ext.getCmp("main-panel").layout.container.items.items,c=false,g,e;for(e=0;e<f.length;e++){if(f[e].id===d){g=e}}if(f[g+1]){c=f[g+1].id;Ext.getCmp("main-panel").setActiveTab(c)}},initComponent:function(){var c=this.prefix+"-"+this.ftype;this.bbar=(this.syncScrollCB)?[{height:22,xtype:"checkbox",name:"syncScrollConf.module",hideLabel:true,checked:PhDOE.user.conf[this.syncScrollConf.module][this.syncScrollConf.itemName],boxLabel:_("Synchronize scroll bars"),listeners:{scope:this,check:function(d){new ui.task.UpdateConfTask({module:this.syncScrollConf.module,itemName:this.syncScrollConf.itemName,value:d.getValue(),notify:false})},render:function(d){Ext.DomHelper.insertHtml("beforeBegin",d.el.dom,['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',c,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',c,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join(""))}}}]:[{xtype:"panel",height:22,baseCls:"",bodyStyle:"padding-top:5px;",html:['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',c,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',c,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join("")}];if(!this.readOnly){this.tbar=[new ui.cmp._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),{xtype:"buttongroup",id:c+"-FILE-"+this.fid+"-grp-save",items:[{id:c+"-FILE-"+this.fid+"-btn-save",scope:this,tooltip:_("<b>Save</b> this file (CTRL+s)"),iconCls:"iconSaveFile",disabled:true,handler:function(){if(this.prefix==="AF"){new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();return}if(this.prefix==="FNT"){new ui.task.SaveTransFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();return}if(!PhDOE.user.conf.main.onSaveFile){PhDOE.user.conf.main.onSaveFile="ask-me"}switch(PhDOE.user.conf.main.onSaveFile){case"always":new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();break;case"never":new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode();break;case"ask-me":Ext.MessageBox.show({title:_("Confirm"),msg:_("Do you want to check for errors before saving?"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,scope:this,fn:function(d){if(d==="no"){new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode()}else{if(d==="yes"){new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});Ext.getCmp(c+"-FILE-"+this.fid).setOriginalCode()}}}});break}}}]},new ui.cmp._FilePanel.tbar.items.undoRedo({id_prefix:c,fid:this.fid}),new ui.cmp._FilePanel.tbar.items.reindentTags({id_prefix:c,fid:this.fid,lang:this.lang,spellCheck:this.spellCheck,spellCheckConf:this.spellCheckConf}),{scope:this,iconCls:"iconZoom",tooltip:_("<b>Expand</b> in a popup"),handler:function(d){var e=new Ext.Window({title:this.originTitle,bodyStyle:"background-color:white",maximized:true,animateTarget:d.el,items:[{xtype:"codemirror",id:c+"-FILE-"+this.fid+"maximized",readOnly:false,parser:"xml",spellCheck:false,isModified:false,listeners:{scope:this,initialize:function(){var h=Ext.getCmp(c+"-FILE-"+this.fid+"maximized"),f=Ext.getCmp(c+"-FILE-"+this.fid).getCode();h.setCode(f);var g=new Ext.util.DelayedTask(function(){if(e.rendered){h.resize(false,e.getInnerHeight())}else{g.delay(500)}});g.delay(500)}}}],listeners:{scope:this,beforeclose:function(g){var f=g.items.items[0].mirror.getCode();Ext.getCmp(c+"-FILE-"+this.fid).setCode(f)}}});e.show()}},{scope:this,iconCls:"iconView",hidden:!(this.lang==="en"&&this.fname.substr(-3)==="xml"),tooltip:_("<b>Preview</b> in a popup"),handler:function(){var d=Ext.getCmp(c+"-FILE-"+this.fid).isModified;if(d){Ext.Msg.alert(_("Information"),_("You must save your file in order to preview the result."),function(e){if(e=="ok"){new ui.cmp.PreviewFile({path:this.lang+this.fpath+this.fname})}},this)}else{new ui.cmp.PreviewFile({path:this.lang+this.fpath+this.fname})}}},"->",new ui.cmp._FilePanel.tbar.items.usernotes({fid:this.fid,file:this.lang+this.fpath+this.fname})]}else{this.tbar=[new ui.cmp._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),"->",((this.ftype!=="GGTRANS")?new ui.cmp._FilePanel.tbar.items.usernotes({fid:this.fid,file:this.lang+this.fpath+this.fname}):"")]}Ext.apply(this,{title:this.title,cls:"code-mirror-panel",originTitle:this.title,items:[{xtype:"codemirror",id:c+"-FILE-"+this.fid,readOnly:this.readOnly,parser:this.parser,spellCheck:this.spellCheck,isModified:false,listeners:{scope:this,initialize:function(){var e,d;if(this.isTrans){if(this.storeRecord.data.fileModified){e=this.lang+this.fpath;d=this.fname}else{e="en"+this.fpath;d=this.fname}}else{e=this.lang+this.fpath;d=this.fname}new ui.task.GetFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:e,freadOnly:this.readOnly,fname:d,skeleton:this.skeleton,storeRecord:this.storeRecord})},coderestored:function(){if(this.readOnly){return}if(Ext.getCmp(c+"-FILE-"+this.fid).isModified){Ext.getCmp(c+"-PANEL-"+this.fid).setTitle(Ext.getCmp(c+"-PANEL-"+this.fid).permlink+Ext.getCmp(c+"-PANEL-"+this.fid).originTitle);if((this.ftype==="LANG"&&PhDOE.user.lang!=="en")||this.ftype==="EN"){if((this.ftype==="EN"&&!Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid).isModified)||(this.ftype==="LANG"&&!Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid).isModified)){Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}}else{Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle)}Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").disable();Ext.getCmp(c+"-FILE-"+this.fid).isModified=false}},codemodified:function(){if(this.readOnly){return}if(Ext.getCmp(c+"-FILE-"+this.fid+"-grp-save").disabled){return}var e=Ext.getCmp(c+"-FILE-"+this.fid),d=Ext.getCmp(c+"-PANEL-"+this.fid);if(!e.isModified){d.setTitle(d.permlink+d.originTitle+' <span style="color:#ff0000; font-weight: bold;">['+_("modified")+"]</span>");Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>');Ext.getCmp(c+"-FILE-"+this.fid+"-btn-save").enable();Ext.getCmp(c+"-FILE-"+this.fid+"-btn-undo").enable();e.isModified=true}},cursormove:function(d,e){Ext.get(c+"-status-line-"+this.fid).dom.innerHTML=d;Ext.get(c+"-status-col-"+this.fid).dom.innerHTML=e},scroll:function(g){var e,f,d;if(this.syncScroll&&PhDOE.user.conf[this.syncScrollConf.module][this.syncScrollConf.itemName]){switch(this.ftype){case"EN":e=this.prefix+"-LANG";break;case"LANG":e=this.prefix+"-EN";break;case"TRANS":e=this.prefix+"-GGTRANS";break;case"GGTRANS":e=this.prefix+"-TRANS";break}f=Ext.getCmp(e+"-PANEL-"+this.fid);d=Ext.getCmp(e+"-FILE-"+this.fid);if(f.activeScroll===false){this.activeScroll=true;d.scrollTo(g)}else{f.activeScroll=false}}}}}]});ui.cmp.FilePanel.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp");ui.cmp.GoogleTranslationPanel=Ext.extend(Ext.FormPanel,{border:false,labelAlign:"top",bodyStyle:"padding:5px",autoScroll:true,getTranslation:function(c){new ui.task.GetGGTranslation({str:c})},initComponent:function(){Ext.apply(this,{items:[{xtype:"textarea",anchor:"90%",fieldLabel:String.format(_("String to translate (en => {0})"),PhDOE.user.lang),name:"GGTranslate-string",id:"GGTranslate-string",allowBlank:false},{scope:this,xtype:"button",text:_("Translate !"),id:"GGTranslate-btn",handler:function(){this.getTranslation(Ext.getCmp("GGTranslate-string").getValue())}},{xtype:"panel",anchor:"100%",border:false,bodyStyle:"padding:5px",html:'<div id="GGTranslate-result" style="width: 90%; font: 12px tahoma,arial,sans-serif"></div>'}]});ui.cmp.GoogleTranslationPanel.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._MainMenu");ui.cmp.MainMenu=function(c){Ext.apply(this,c);this.init();ui.cmp.MainMenu.superclass.constructor.call(this)};ui.cmp._MainMenu.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getAvailableLanguage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"code",fields:[{name:"code"},{name:"iconCls"},{name:"name"}]})});ui.cmp._MainMenu.store.on("load",function(c){Ext.getDom("Info-Language").innerHTML=c.getById(PhDOE.user.lang).data.name;c.each(function(d){var e=new Ext.menu.Item({text:d.data.name+" ("+d.data.code+")",iconCls:"mainMenuLang flags "+d.data.iconCls,disabled:(d.data.code===PhDOE.user.lang),handler:function(){XHR({params:{task:"switchLang",lang:d.data.code},success:function(){window.location.reload()}})}});Ext.getCmp("MenuLang-ct").add(e)})},this);Ext.extend(ui.cmp.MainMenu,Ext.menu.Menu,{id:"mainMenu",init:function(){var c=new Ext.menu.Menu({id:"MenuLang-ct"});Ext.apply(this,{items:[{text:_("Refresh all data"),disabled:(!PhDOE.user.isGlobalAdmin),iconCls:"iconRefresh",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an update in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFiles:"project_"+PhDOE.project+"_lock_update_repository|project_"+PhDOE.project+"_lock_apply_tools"},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently an update in progress.<br/>You can't perform an update now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();new ui.cmp.SystemUpdatePrompt().show(Ext.get("acc-need-update"))}})}},{text:_("Build tools"),handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("Check build"),disabled:(!PhDOE.user.isGlobalAdmin&&!PhDOE.user.isLangAdmin),iconCls:"iconCheckBuild",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is a check in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.user.lang},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for this language.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();new ui.cmp.CheckBuildPrompt().show(Ext.get("acc-need-update"))}})}},{text:_("Show last failed build"),iconCls:"iconBuildStatus",handler:function(){var d=Ext.getCmp("tab-build-status");if(!d){Ext.getCmp("main-panel").add({id:"tab-build-status",title:_("Last failed build"),iconCls:"iconBuildStatus",layout:"fit",closable:true,items:[new ui.cmp.BuildStatus()]})}Ext.getCmp("main-panel").setActiveTab("tab-build-status")}}]})},{text:_("EN tools"),handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("Script check entities"),iconCls:"iconCheckEntities",handler:function(){return false},menu:new Ext.menu.Menu({items:[{text:_("View the last result"),id:"btn-check-entities-view-last-result",iconCls:"iconTabView",handler:function(){var d=Ext.getCmp("tab-check-entities");if(!d){Ext.getCmp("main-panel").add({id:"tab-check-entities",title:_("Check entities"),iconCls:"iconCheckEntities",layout:"fit",closable:true,items:[new ui.cmp.CheckEntities()]})}Ext.getCmp("main-panel").setActiveTab("tab-check-entities")}},{text:_("Run this script"),iconCls:"iconRun",disabled:(PhDOE.user.isAnonymous),handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an entities check in progress. Please, wait..."));XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for the entities.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask();if(!Ext.getCmp("win-check-entities")){new ui.cmp.CheckEntitiesPrompt()}Ext.getCmp("win-check-entities").show(Ext.get("mainMenu"))}})}}]})},{text:_("Script check document"),iconCls:"iconCheckDoc",handler:function(){var d=Ext.getCmp("tab-check-doc");if(!d){Ext.getCmp("main-panel").add({id:"tab-check-doc",title:"Check Doc",iconCls:"iconCheckDoc",layout:"fit",closable:true,items:[new ui.cmp.CheckDoc()]})}Ext.getCmp("main-panel").setActiveTab("tab-check-doc")}}]})},"-",{text:_("Configure"),iconCls:"iconConf",tooltip:"<b>Configure</b> this tool",id:"winconf-btn",handler:function(){if(!Ext.getCmp("win-conf")){new ui.cmp.EditorConf()}Ext.getCmp("win-conf").show(Ext.get("mainMenu"))}},"-",{id:"menuLang",iconCls:"iconSwitchLang",text:_("Switch to language..."),handler:function(){return false},menu:c},{text:_("Erase my personal data"),iconCls:"iconErasePersonalData",disabled:(PhDOE.user.isAnonymous),handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("This action will erase your personal data. All content about this account will be deleted definitively. Are you sure you want to do that ?"),function(d){if(d==="yes"){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));XHR({params:{task:"erasePersonalData"},success:function(){Ext.getBody().unmask();Ext.MessageBox.show({title:_("Thanks !"),msg:_("Thank you for using this application !"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function(){window.location.href="./do/logout?csrfToken="+csrfToken}})},failure:function(){Ext.getBody().unmask();PhDOE.winForbidden()}})}})}},{text:_("Log out"),iconCls:"iconLogOut",handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("Are you sure you want to logout?"),function(d){if(d==="yes"){window.location.href="./do/logout?csrfToken="+csrfToken}})}},"-",{id:"tab-report-bug-btn",text:_("Report bugs"),iconCls:"iconBugs",handler:function(){if(!Ext.getCmp("main-panel").findById("tab-report-bug")){Ext.getCmp("main-panel").add({id:"tab-report-bug",xtype:"panel",title:_("Report bugs"),iconCls:"iconBugs",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-report-bug",url:"http://bugs.php.net/"})]});Ext.getCmp("main-panel").setActiveTab("tab-report-bug")}else{Ext.getCmp("main-panel").setActiveTab("tab-report-bug")}}},{id:"tab-documentation-btn",text:_("Documentation"),iconCls:"iconBook",handler:function(){if(!Ext.getCmp("main-panel").findById("tab-documentation")){Ext.getCmp("main-panel").add({id:"tab-documentation",xtype:"panel",title:_("Documentation"),iconCls:"iconBook",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-documentation",url:"https://wiki.php.net/doc/editor/"})]});Ext.getCmp("main-panel").setActiveTab("tab-documentation")}else{Ext.getCmp("main-panel").setActiveTab("tab-documentation")}}},{id:"tab-chat-btn",text:_("Chat with us on IRC !"),iconCls:"iconChat",handler:function(){if(!Ext.getCmp("main-panel").findById("tab-chat")){var d=PhDOE.user.login;if(PhDOE.user.isAnonymous){d="an%3F%3F%3F"}Ext.getCmp("main-panel").add({id:"tab-chat",xtype:"panel",title:_("Chat"),iconCls:"iconChat",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-chat",url:"https://widget.mibbit.com/?settings=8eec4034df2eb666b0600bdfe151529a&server=irc.umich.edu&channel=%23php.doc&nick=poe_"+d})]})}Ext.getCmp("main-panel").setActiveTab("tab-chat")}},"-",{id:"winabout-btn",text:_("About"),iconCls:"iconHelp",handler:function(){new ui.cmp.About().show(Ext.get("winabout-btn"))}}]})}});Ext.namespace("ui","ui.cmp","ui.cmp.MainPanel");ui.cmp.MainPanel=Ext.extend(Ext.ux.SlidingTabPanel,{activeTab:0,enableTabScroll:true,plugins:["tabclosemenu","dblclickclosetabs"],initComponent:function(c){Ext.apply(this,c);ui.cmp.MainPanel.superclass.initComponent.call(this);this.addEvents({tabLoaded:true});this.on("beforeremove",this.onBeforeRemove,this);this.on("tabchange",this.onTabChange,this);this.on("endDrag",this.onTabChange,this);this.on("tabLoaded",this.onTabLoaded,this)},onTabLoaded:function(d,e){var c=Ext.getCmp(d+"-"+e);if(d==="FNT"){if(c.panTRANSLoaded&&c.panGGTRANSLoaded){c.tabLoaded=true;c.panTRANSLoaded=c.panGGTRANSLoaded=false;if(PhDOE.FNTfilePendingOpen[0]){ui.cmp.PendingTranslateGrid.getInstance().openFile(PhDOE.FNTfilePendingOpen[0].id);PhDOE.FNTfilePendingOpen.shift()}}}if(d==="FNU"){if(c.panLANGLoaded&&c.panENLoaded&&c.panDiffLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panDiffLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FNUfilePendingOpen[0]){ui.cmp.StaleFileGrid.getInstance().openFile(PhDOE.FNUfilePendingOpen[0].id);PhDOE.FNUfilePendingOpen.shift()}}}if(d==="FE"){if(c.panLANGLoaded&&c.panENLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FEfilePendingOpen[0]){ui.cmp.ErrorFileGrid.getInstance().openFile(PhDOE.FEfilePendingOpen[0].id);PhDOE.FEfilePendingOpen.shift()}}}if(d==="FNR"){if(c.panLANGLoaded&&c.panENLoaded&&c.panVCSLang&&c.panVCSEn){c.tabLoaded=true;c.panLANGLoaded=c.panENLoaded=c.panVCSLang=c.panVCSEn=false;if(PhDOE.FNRfilePendingOpen[0]){ui.cmp.PendingReviewGrid.getInstance().openFile(PhDOE.FNRfilePendingOpen[0].id);PhDOE.FNRfilePendingOpen.shift()}}}if(d==="FNIEN"){if(c.panLANGLoaded){c.tabLoaded=true;c.panLANGLoaded=false;if(PhDOE.FNIENfilePendingOpen[0]){ui.cmp.NotInENGrid.getInstance().openFile(PhDOE.FNIENfilePendingOpen[0].id);PhDOE.FNIENfilePendingOpen.shift()}}}if(d==="AF"){if(c.panLoaded&&c.panVCS&&c.panEntities&&c.panAcronyms){c.tabLoaded=true;c.panLoaded=c.panVCS=false;if(PhDOE.AFfilePendingOpen[0]){ui.cmp.RepositoryTree.getInstance().openFile((PhDOE.AFfilePendingOpen[0].nodeID)?"byId":"byPath",(PhDOE.AFfilePendingOpen[0].nodeID)?PhDOE.AFfilePendingOpen[0].nodeID:PhDOE.AFfilePendingOpen[0].fpath,(PhDOE.AFfilePendingOpen[0].nodeID)?false:PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift()}}}if(d==="PP"){if(c.panPatchLoaded&&c.panOriginLoaded&&c.panVCS&&c.panPatchContent){c.tabLoaded=true;c.panPatchLoaded=c.panOriginLoaded=c.panVCS=c.panPatchContent=false;if(PhDOE.PPfilePendingOpen[0]){ui.cmp.PendingPatchGrid.getInstance().openFile(PhDOE.PPfilePendingOpen[0].id);PhDOE.PPfilePendingOpen.shift()}}}},onTabChange:function(d,g){if(Ext.getCmp(g.id+"-btn-tabRight-LANG")||Ext.getCmp(g.id+"-btn-tabRight-EN")||Ext.getCmp(g.id+"-btn-tabRight-ALL")||Ext.getCmp(g.id+"-btn-tabRight-NotInEN")||Ext.getCmp(g.id+"-btn-tabRight-PATCH")||Ext.getCmp(g.id+"-btn-tabRight-TRANS")||Ext.getCmp(g.id+"-btn-tabRight-NEW")){var c=g.id,f=Ext.getCmp("main-panel").layout.container.items.items,h,e;for(e=0;e<f.length;e++){if(f[e].id===c){h=e}}if(f[h+1]){if(Ext.getCmp(g.id+"-btn-tabRight-LANG")){Ext.getCmp(g.id+"-btn-tabRight-LANG").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-EN")){Ext.getCmp(g.id+"-btn-tabRight-EN").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-ALL")){Ext.getCmp(g.id+"-btn-tabRight-ALL").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-NotInEN")){Ext.getCmp(g.id+"-btn-tabRight-NotInEN").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-PATCH")){Ext.getCmp(g.id+"-btn-tabRight-PATCH").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-TRANS")){Ext.getCmp(g.id+"-btn-tabRight-TRANS").enable()}if(Ext.getCmp(g.id+"-btn-tabRight-NEW")){Ext.getCmp(g.id+"-btn-tabRight-NEW").enable()}}}},onBeforeRemove:function(f,g){var d,e,h,c=g.id.split("-");if((c[0]==="FE"||c[0]==="FNU"||c[0]==="FNR"||c[0]==="PP"||c[0]==="AF"||c[0]==="FNT")&&c[1]!=="help"){if(c[0]==="FE"){d=Ext.getCmp("FE-LANG-FILE-"+c[1]).isModified;e=(PhDOE.user.lang==="en")?false:Ext.getCmp("FE-EN-FILE-"+c[1]).isModified}if(c[0]==="FNU"){d=Ext.getCmp("FNU-LANG-FILE-"+c[1]).isModified;e=Ext.getCmp("FNU-EN-FILE-"+c[1]).isModified}if(c[0]==="FNR"){d=Ext.getCmp("FNR-LANG-FILE-"+c[1]).isModified;e=Ext.getCmp("FNR-EN-FILE-"+c[1]).isModified}if(c[0]==="PP"){h=Ext.getCmp("PP-PATCH-FILE-"+c[1]).isModified}if(c[0]==="AF"){h=Ext.getCmp("AF-ALL-FILE-"+c[1]).isModified}if(c[0]==="FNT"){h=(Ext.getCmp("FNT-TRANS-FILE-"+c[1]))?Ext.getCmp("FNT-TRANS-FILE-"+c[1]).isModified:Ext.getCmp("FNT-NEW-FILE-"+c[1]).isModified}if(e||d||h){Ext.Msg.show({scope:this,title:_("Confirm"),msg:_("This file has been modified without being saved.<br/>Do you really want to close?"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(j,k){if(j==="yes"){f.un("beforeremove",this.onBeforeRemove,this);f.remove(g);f.addListener("beforeremove",this.onBeforeRemove,this)}}});return false}else{return true}}else{return true}},openDiffTab:function(g){var d=g.DiffType,c=g.FileName,f=g.FilePath,e=Ext.util.md5(f+c);if(!Ext.getCmp("main-panel").findById("diff_panel_"+e)){Ext.getCmp("main-panel").add({xtype:"panel",id:"diff_panel_"+e,title:_("Diff"),tabTip:String.format(_("Diff for file: {0}"),f+c),closable:true,autoScroll:true,iconCls:"iconTabLink",html:'<div id="diff_content_'+e+'" class="diff-content"></div>'});Ext.getCmp("main-panel").setActiveTab("diff_panel_"+e);Ext.get("diff_panel_"+e).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" />'+_("Please, wait..."));XHR({params:{task:"getDiff",DiffType:d,FilePath:f,FileName:c},success:function(h){var j=Ext.util.JSON.decode(h.responseText);j.content='<a href="http://'+window.location.host+":"+window.location.port+window.location.pathname+"?patch="+f+c+"&project="+PhDOE.project+'"><h2>'+_("Direct link to this patch")+" ; "+_("File: ")+f+c+"</h2></a>"+j.content;Ext.get("diff_content_"+e).dom.innerHTML=j.content;Ext.get("diff_panel_"+e).unmask()}})}else{Ext.getCmp("main-panel").setActiveTab("diff_panel_"+e)}}});Ext.reg("mainpanel",ui.cmp.MainPanel);Ext.namespace("ui","ui.cmp");ui.cmp.ManagePatchPrompt=Ext.extend(Ext.Window,{title:"",width:250,height:100,minWidth:250,minHeight:100,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",iconCls:"iconPatch",closeAction:"hide",nodesToAdd:false,defaultValue:"",patchID:false,buttons:[{text:_("Create"),handler:function(){var d=this.ownerCt.ownerCt,c=d.findByType("form").shift().getForm().getValues();XHR({params:{task:"managePatch",name:c.name,patchID:d.patchID},success:function(e){var f=Ext.util.JSON.decode(e.responseText);d.hide();if(d.patchID){ui.cmp.PatchesTreeGrid.getInstance().modPatchName({newPatchName:c.name,patchID:d.patchID})}if(d.nodesToAdd){ui.task.MoveToPatch({patchID:f.patchID,patchName:c.name,nodesToAdd:d.nodesToAdd})}}})}},{text:_("Cancel"),handler:function(){this.ownerCt.ownerCt.hide()}}],initComponent:function(){Ext.apply(this,{items:new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,defaultType:"textfield",items:[{name:"name",fieldLabel:_("Name"),anchor:"100%",value:this.defaultValue}]})});ui.cmp.ManagePatchPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._NotInENGrid");ui.cmp._NotInENGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNotInEn"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"fileModified"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-notInEn-nb").innerHTML=c.getCount()}}});ui.cmp._NotInENGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name",renderer:function(d,c,e){if(e.data.fileModified){var f=Ext.util.JSON.decode(e.data.fileModified);if(f.user===PhDOE.user.login&&f.anonymousIdent===PhDOE.user.anonymousIdent){return"<span ext:qtip='"+_("File removed by me")+"'>"+d+"</span>"}else{return"<span ext:qtip='"+String.format(_("File removed by {0}"),f.user.ucFirst())+"'>"+d+"</span>"}}else{return d}}},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._NotInENGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",getRowClass:function(c){if(c.data.fileModified){var d=Ext.util.JSON.decode(c.data.fileModified);return(d.user===PhDOE.user.login&&d.anonymousIdent===PhDOE.user.anonymousIdent)?"fileModifiedByMe":"fileModifiedByAnother"}return false}});ui.cmp._NotInENGrid.menu=function(c){Ext.apply(this,c);this.init();ui.cmp._NotInENGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.cmp._NotInENGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new tab")+"</b>",iconCls:"iconView",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,text:_("Remove this file"),hidden:(this.grid.store.getAt(this.rowIdx).data.fileModified),iconCls:"iconTrash",handler:function(){var e=this.grid.store.getAt(this.rowIdx),d=e.data.path,c=e.data.name;new ui.task.MarkDeleteTask({fpath:d,fname:c,storeRecord:e})}}]})}});ui.cmp.NotInENGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",view:ui.cmp._NotInENGrid.view,columns:ui.cmp._NotInENGrid.columns,onRowContextMenu:function(c,f,d){d.stopEvent();c.getSelectionModel().selectRow(f);new ui.cmp._NotInENGrid.menu({grid:c,rowIdx:f,event:d}).showAt(d.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNIEN-"+PhDOE.user.lang+d+c);if(!Ext.getCmp("main-panel").findById("FNIEN-"+f)){Ext.getCmp("main-panel").add({id:"FNIEN-"+f,layout:"border",title:c,originTitle:c,iconCls:"iconTabView",closable:true,tabLoaded:false,panLANGLoaded:false,defaults:{split:true},tabTip:String.format(_("Not In EN: in {0}"),d),items:[new ui.cmp.FilePanel({id:"FNIEN-NotInEN-PANEL-"+f,region:"center",title:_("File: ")+d+c,prefix:"FNIEN",ftype:"NotInEN",fid:f,fpath:d,fname:c,readOnly:true,lang:PhDOE.user.lang,parser:"xml",storeRecord:e,syncScroll:false})]})}Ext.getCmp("main-panel").setActiveTab("FNIEN-"+f)},initComponent:function(){Ext.apply(this,{store:ui.cmp._NotInENGrid.store});ui.cmp.NotInENGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._NotInENGrid.instance=null;ui.cmp.NotInENGrid.getInstance=function(c){if(!ui.cmp._NotInENGrid.instance){if(!c){c={}}ui.cmp._NotInENGrid.instance=new ui.cmp.NotInENGrid(c)}return ui.cmp._NotInENGrid.instance};Ext.namespace("ui","ui.cmp");ui.cmp.PatchPrompt=Ext.extend(Ext.Window,{title:_("Do you want to be alerted ?"),iconCls:"iconPatchAlert",layout:"form",bodyStyle:"padding: 5px;",labelWidth:50,width:350,height:150,resizable:false,modal:true,autoScroll:true,initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",baseCls:"x-plain",bodyStyle:"padding-bottom: 10px;",html:_("If you want to be notified when your patch will be dealt with, thank you to leave an email address below.")},{id:"patch-email-alert",xtype:"textfield",name:"patch-email-alert",fieldLabel:_("Email"),anchor:"100%",value:this.defaultEmail}],buttons:[{scope:this,text:_("Save"),handler:function(){new ui.task.SavePatchTask({prefix:this.prefix,fid:this.fid,ftype:this.ftype,lang:this.lang,fpath:this.fpath,fname:this.fname,email:Ext.getCmp("patch-email-alert").getValue()});this.close()}},{scope:this,text:_("Cancel"),handler:function(){this.close()}}]});ui.cmp.PatchPrompt.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._PatchesTreeGrid","ui.cmp._PatchesTreeGrid.menu");ui.cmp._PatchesTreeGrid.menu.users=function(c){Ext.apply(this,c);this.init();ui.cmp._PatchesTreeGrid.menu.users.superclass.constructor.call(this)};Ext.extend(ui.cmp._PatchesTreeGrid.menu.users,Ext.menu.Menu,{init:function(){var c=[];this.node.cascade(function(d){if(d.attributes.type!=="folder"&&d.attributes.type!=="patch"&&d.attributes.type!=="user"){c.push(d)}},this);Ext.apply(this,{items:[{scope:this,text:String.format(_("Send an email to {0}"),"<b>"+this.node.attributes.task.ucFirst()+"</b>"),iconCls:"iconSendEmail",hidden:(this.node.attributes.task===PhDOE.user.login||this.node.attributes.email==="false"),handler:function(){var d=new ui.cmp.EmailPrompt();d.setData(this.node.attributes.task,this.node.attributes.email);d.show(this.node.el)}},{text:_("Back all files to work in progress module"),hidden:(this.node.attributes.task!==PhDOE.user.login),disabled:Ext.isEmpty(c),iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:c})}},{xtype:"menuseparator",hidden:(this.node.attributes.task!==PhDOE.user.login||PhDOE.user.isAnonymous)},((this.node.attributes.task===PhDOE.user.login&&!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({module:"patches",from:"user",node:false,folderNode:false,patchNode:false,userNode:this.node}):"")]})}});ui.cmp._PatchesTreeGrid.menu.patches=function(c){Ext.apply(this,c);this.init();ui.cmp._PatchesTreeGrid.menu.patches.superclass.constructor.call(this)};Ext.extend(ui.cmp._PatchesTreeGrid.menu.patches,Ext.menu.Menu,{init:function(){var d=this.node,e=[],c=this.node.parentNode.attributes.task;if(c!==PhDOE.user.login&&!PhDOE.user.isGlobalAdmin){return false}this.node.cascade(function(f){if(f.attributes.type!=="folder"&&f.attributes.type!=="patch"&&f.attributes.type!=="user"){e.push(f)}},this);Ext.apply(this,{items:[{text:_("Edit the name of this patch"),iconCls:"iconPendingPatch",hidden:(c!==PhDOE.user.login),handler:function(){var f=new ui.cmp.ManagePatchPrompt({title:_("Modify this patch name"),defaultValue:d.attributes.task,patchID:d.attributes.idDB});f.show(this.el)}},{text:_("Delete this patch"),iconCls:"iconTrash",hidden:(c!==PhDOE.user.login),handler:function(){ui.task.DeletePatchTask({patchID:d.attributes.idDB})}},{xtype:"menuseparator",hidden:!((!PhDOE.user.isAnonymous&&c===PhDOE.user.login)||!PhDOE.user.isGlobalAdmin)},{text:_("Back all this patch to work in progress module"),iconCls:"iconWorkInProgress",hidden:(c!==PhDOE.user.login),disabled:Ext.isEmpty(e),handler:function(){ui.task.MoveToWork({nodesToAdd:e})}},{xtype:"menuseparator",hidden:!((!PhDOE.user.isAnonymous&&c===PhDOE.user.login)||!PhDOE.user.isGlobalAdmin)},((!PhDOE.user.isAnonymous&&c===PhDOE.user.login)?new ui.cmp._WorkTreeGrid.menu.commit({module:"patches",from:"patch",node:false,folderNode:false,patchNode:this.node,userNode:this.node.parentNode}):""),((PhDOE.user.isGlobalAdmin)?new ui.cmp._WorkTreeGrid.menu.admin({from:"patch",node:this.node}):"")]})}});ui.cmp._PatchesTreeGrid.menu.folders=function(c){Ext.apply(this,c);this.init();ui.cmp._PatchesTreeGrid.menu.folders.superclass.constructor.call(this)};Ext.extend(ui.cmp._PatchesTreeGrid.menu.folders,Ext.menu.Menu,{init:function(){var c=[];if(this.node.parentNode.parentNode.attributes.task!==PhDOE.user.login){return false}this.node.cascade(function(d){if(d.attributes.type!=="folder"&&d.attributes.type!=="patch"&&d.attributes.type!=="user"){c.push(d)}},this);Ext.apply(this,{items:[{text:_("Back all this folder to work in progress module"),iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:c})}},{xtype:"menuseparator",hidden:(PhDOE.user.isAnonymous)},((!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({module:"patches",from:"folder",node:false,folderNode:this.node,patchNode:this.node.parentNode,userNode:this.node.parentNode.parentNode}):"")]})}});ui.cmp._PatchesTreeGrid.menu.files=function(c){Ext.apply(this,c);this.init();ui.cmp._PatchesTreeGrid.menu.files.superclass.constructor.call(this)};Ext.extend(ui.cmp._PatchesTreeGrid.menu.files,Ext.menu.Menu,{init:function(){var h=this.node,m=h.attributes.type,g,c=h.parentNode.attributes.task,f=h.attributes.task,k=h.ownerTree,l=h.attributes.idDB,d=[],e=this.node.parentNode.parentNode.parentNode.attributes.task,j;j=h.parentNode.attributes.task.split("/");g=j[0];this.node.cascade(function(o){if(o.attributes.type!=="folder"&&o.attributes.type!=="patch"&&o.attributes.type!=="user"){d.push(o)}},this);Ext.apply(this,{items:[{text:"<b>"+((m==="delete")?_("View in a new tab"):_("Edit in a new tab"))+"</b>",iconCls:"iconEdit",handler:function(){ui.cmp.WorkTreeGrid.getInstance().openFile(h)}},{text:_("Back this file to work in progress module"),hidden:(e!==PhDOE.user.login),iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:d})}},"-",{text:_("View diff"),iconCls:"iconViewDiff",hidden:(m==="delete"||m==="new"),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:f,FilePath:c})}},{text:_("Download the diff as a patch"),iconCls:"iconDownloadDiff",hidden:(m==="delete"||m==="new"),handler:function(){window.location.href="./do/downloadPatch?FilePath="+c+"&FileName="+f}},{xtype:"menuseparator",hidden:(m==="delete"||m==="new"||e!==PhDOE.user.login)},{text:((m==="delete")?_("Cancel this deletion"):_("Clear this change")),hidden:(e!==PhDOE.user.login),iconCls:"iconPageDelete",handler:function(){new ui.task.ClearLocalChangeTask({ftype:m,fpath:c,fname:f})}},{xtype:"menuseparator",hidden:(PhDOE.user.isAnonymous||e!==PhDOE.user.login)},((e===PhDOE.user.login&&!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({module:"patches",from:"file",node:this.node,folderNode:this.node.parentNode,patchNode:this.node.parentNode.parentNode,userNode:this.node.parentNode.parentNode.parentNode}):""),{xtype:"menuseparator",hidden:(!PhDOE.user.isGlobalAdmin&&!(PhDOE.user.lang===g&&PhDOE.user.isLangAdmin))},((PhDOE.user.isGlobalAdmin||(PhDOE.user.lang===g&&PhDOE.user.isLangAdmin))?new ui.cmp._WorkTreeGrid.menu.admin({fileLang:g,from:"file",node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode.parentNode}):"")]})}});ui.cmp.PatchesTreeGrid=Ext.extend(Ext.ux.tree.TreeGrid,{onContextMenu:function(f,g){g.stopEvent();var d=f.attributes.type,c;switch(d){case"user":f.select();c=new ui.cmp._PatchesTreeGrid.menu.users({node:f});break;case"folder":f.select();c=new ui.cmp._PatchesTreeGrid.menu.folders({node:f});break;case"patch":f.select();c=new ui.cmp._PatchesTreeGrid.menu.patches({node:f});break;default:f.select();c=new ui.cmp._PatchesTreeGrid.menu.files({node:f});break}c.showAt(g.getXY())},modPatchName:function(c){var d=this.getRootNode(),e=d.findChild("idDB",c.patchID,true);e.setText(c.newPatchName)},initComponent:function(){Ext.apply(this,{animate:true,useArrows:true,autoScroll:true,border:false,containerScroll:true,selModel:new Ext.tree.MultiSelectionModel(),columns:[{header:_("Users"),dataIndex:"task",uiProvider:{editable:true,qtip:"help"},tpl:new Ext.XTemplate("{task:this.formatUserName}",{formatUserName:function(c,d){if(d.type==="user"){return c.ucFirst()}if(d.type==="patch"){if(d.creationDate){d.qtip=_("Creation date: ")+Date.parseDate(d.creationDate,"Y-m-d H:i:s").format(_("Y-m-d, H:i"))}return c}return c}})},{header:_("Last modified"),width:120,dataIndex:"last_modified",align:"center",tpl:new Ext.XTemplate("{last_modified:this.formatDate}",{formatDate:function(c,d){if(d.type!=="user"&&d.type!=="folder"&&d.type!=="patch"){return Date.parseDate(c,"Y-m-d H:i:s").format(_("Y-m-d, H:i"))}else{return""}}})}],loader:{dataUrl:"./do/getWork",baseParams:{module:"PatchesForReview"}}});ui.cmp.PatchesTreeGrid.superclass.initComponent.call(this);this.on("contextmenu",this.onContextMenu,this);this.on("resize",this.resizeCmp,this);this.on("dblclick",ui.cmp.WorkTreeGrid.getInstance().openFile,this);this.getRootNode().on("beforechildrenrendered",function(){this.updateFilesCounter.defer(200,this)},this)},resizeCmp:function(g,f,d,e){this.columns[0].width=e-(this.columns[1].width+5);this.updateColumnWidths()},deletePatch:function(q){var e=this.getRootNode(),o,c,d,f,r=[],p,m,h,g;for(p=0;p<e.childNodes.length;p++){o=e.childNodes[p];for(m=0;m<o.childNodes.length;m++){c=o.childNodes[m];if(c.attributes.idDB===q){if(!Ext.isEmpty(c.childNodes)){for(h=0;h<c.childNodes.length;h++){d=c.childNodes[h];for(g=0;g<d.childNodes.length;g++){f=d.childNodes[h];r.push(f)}}ui.cmp.WorkTreeGrid.getInstance().addToWork(r)}c.remove(true);if(Ext.isEmpty(o.childNodes)){o.remove(true)}this.updateFilesCounter();return}}}},delRecord:function(k){var e=this.getRootNode(),m,c,d,f,o,l,q,p;for(o=0;o<e.childNodes.length;o++){m=e.childNodes[o];for(l=0;l<m.childNodes.length;l++){c=m.childNodes[l];for(q=0;q<c.childNodes.length;q++){d=c.childNodes[q];for(p=0;p<d.childNodes.length;p++){f=d.childNodes[p];if(f.attributes.idDB===k){f.remove(true);if(Ext.isEmpty(d.childNodes)){d.remove(true);if(Ext.isEmpty(m.childNodes)){m.remove(true);this.updateFilesCounter();return}this.updateFilesCounter();return}this.updateFilesCounter();return}}}}}this.updateFilesCounter()},getUserPatchesList:function(){var c=this.getRootNode(),e=c.findChild("task",PhDOE.user.login),d=[];if(!e){return false}else{if(!e.hasChildNodes()){return false}else{e.eachChild(function(f){d.push(f)},this);return d}}},addToPatch:function(f,j,o){var c,m,p,e,h,l,g,k,d;c=this.getRootNode();m=c.findChild("task",PhDOE.user.login);if(!m){m=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:true});c.appendChild(m);c.expand()}p=m.findChild("task",j);if(!p){p=new Ext.tree.TreeNode({task:j,type:"patch",iconCls:"iconPatch",expanded:true,idDB:f});m.appendChild(p);m.expand()}if(o){for(d=0;d<o.length;d++){e=p.findChild("task",o[d].parentNode.attributes.task);if(!e){e=new Ext.tree.TreeNode({task:o[d].parentNode.attributes.task,type:"folder",iconCls:"iconFolderOpen",expanded:true});p.appendChild(e);p.expand()}h=o[d].attributes.type;if(h==="update"){l="iconRefresh"}if(h==="new"){l="iconNewFiles"}if(h==="delete"){l="iconTrash"}k=new Date();g=new Ext.tree.TreeNode({task:o[d].attributes.task,type:h,iconCls:l,expanded:true,last_modified:k.format("Y-m-d H:i:s"),progress:o[d].attributes.progress,idDB:o[d].attributes.idDB});e.appendChild(g);e.expand()}}this.updateFilesCounter()},addRecord:function(f,c,d,j){var e,m,g,h,k,l;e=this.getRootNode();m=e.findChild("task",PhDOE.user.login);if(!m){m=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:true,nbFiles:1});e.appendChild(m);e.expand()}g=m.findChild("task",c);if(!g){g=new Ext.tree.TreeNode({task:c,type:"folder",iconCls:"iconFolderOpen",expanded:true});m.appendChild(g);m.expand()}h=g.findChild("task",d);if(!h){if(j==="update"){l="iconRefresh"}if(j==="new"){l="iconNewFiles"}if(j==="delete"){l="iconTrash"}k=new Date();h=new Ext.tree.TreeNode({task:d,type:j,iconCls:l,expanded:true,last_modified:k.format("Y-m-d H:i:s"),progress:100,idDB:f});g.appendChild(h);g.expand()}this.updateFilesCounter()},countFiles:function(){var e=this.getRootNode(),p=0,k,d,c,l,f,m,o;e.cascade(function(g){if(!g.isRoot&&g.attributes.type!=="user"&&g.attributes.type!=="folder"&&g.attributes.type!=="patch"){if(g.parentNode.parentNode.parentNode.attributes.task===PhDOE.user.login){p++}}},this);return p},updateFilesCounter:function(){var c=this.countFiles();Ext.getDom("acc-patches-nb").innerHTML=c}});ui.cmp._PatchesTreeGrid.instance=null;ui.cmp.PatchesTreeGrid.getInstance=function(c){if(!ui.cmp._PatchesTreeGrid.instance){if(!c){c={}}ui.cmp._PatchesTreeGrid.instance=new ui.cmp.PatchesTreeGrid(c)}return ui.cmp._PatchesTreeGrid.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PendingReviewGrid");ui.cmp._PendingReviewGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedReviewed"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"reviewed"},{name:"maintainer"},{name:"fileModifiedEN"},{name:"fileModifiedLang"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-reviewed-nb").innerHTML=c.getCount()}}});ui.cmp._PendingReviewGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name",renderer:function(d,c,e){var h="",g,f;if(e.data.fileModifiedEN){g=Ext.util.JSON.decode(e.data.fileModifiedEN);if(g.user===PhDOE.user.login&&g.anonymousIdent===PhDOE.user.anonymousIdent){h=_("File EN modified by me")+"<br>"}else{h=String.format(_("File EN modified by {0}"),g.user.ucFirst())+"<br>"}}if(e.data.fileModifiedLang){f=Ext.util.JSON.decode(e.data.fileModifiedLang);if(f.user===PhDOE.user.login&&f.anonymousIdent===PhDOE.user.anonymousIdent){h+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst())}else{h+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),f.user.ucFirst())}}if(h!==""){return"<span ext:qtip='"+h+"'>"+d+"</span>"}else{return d}}},{header:_("Reviewed"),width:45,sortable:true,dataIndex:"reviewed"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._PendingReviewGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(c){if(c.data.fileModifiedEN||c.data.fileModifiedLang){var e=Ext.util.JSON.decode(c.data.fileModifiedEN),d=Ext.util.JSON.decode(c.data.fileModifiedLang);return((e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent)||(d.user===PhDOE.user.login&&d.anonymousIdent===PhDOE.user.anonymousIdent))?"fileModifiedByMe":"fileModifiedByAnother"}return false},deferEmptyText:false,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});Ext.namespace("ui.cmp._PendingReviewGrid.menu");ui.cmp._PendingReviewGrid.menu.group=function(c){Ext.apply(this,c);this.init();ui.cmp._PendingReviewGrid.menu.group.superclass.constructor.call(this)};Ext.extend(ui.cmp._PendingReviewGrid.menu.group,Ext.menu.Item,{iconCls:"iconViewDiff",init:function(){Ext.apply(this,{text:String.format(_("Open all files about {0} extension"),this.gname.ucFirst()),handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+String.format(_("Open all files about {0} extension"),this.gname.ucFirst())+". "+_("Please, wait..."));XHR({params:{task:"getAllFilesAboutExtension",ExtName:this.gname},success:function(d){var e=Ext.util.JSON.decode(d.responseText),c;PhDOE.AFfilePendingOpen=[];for(c=0;c<e.files.length;c=c+1){PhDOE.AFfilePendingOpen[c]={fpath:PhDOE.user.lang+e.files[c].path,fname:e.files[c].name}}ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname);PhDOE.AFfilePendingOpen.shift();Ext.getBody().unmask()}})}})}});ui.cmp._PendingReviewGrid.menu.main=function(c){Ext.apply(this,c);this.init();ui.cmp._PendingReviewGrid.menu.main.superclass.constructor.call(this)};Ext.extend(ui.cmp._PendingReviewGrid.menu.main,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconFilesNeedReviewed",scope:this,handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff..."),iconCls:"iconViewDiff",menu:new Ext.menu.Menu({items:[{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedEN===false),text:String.format(_("... of the {0} file"),"EN"),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:"en"+this.fpath})}},{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedLang===false),text:String.format(_("... of the {0} file"),PhDOE.user.lang.ucFirst()),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}}]})},new Ext.menu.Separator({hidden:this.hideGroup}),new ui.cmp._PendingReviewGrid.menu.group({gname:this.gname,hidden:this.hideGroup})]})}});ui.cmp.PendingReviewGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,border:false,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",columns:ui.cmp._PendingReviewGrid.columns,view:ui.cmp._PendingReviewGrid.view,onRowContextMenu:function(d,k,h){h.stopEvent();var g=d.store.getAt(k),f=g.data.path,c=g.data.name,j=f.split("/");d.getSelectionModel().selectRow(k);new ui.cmp._PendingReviewGrid.menu.main({grid:d,rowIdx:k,event:h,fpath:f,fname:c,hideDiffMenu:(g.data.fileModifiedEN===false&&g.data.fileModifiedLang===false),hideGroup:(j[1]!=="reference"),gname:(j[2])?j[2]:""}).showAt(h.getXY())},onRowDblClick:function(c,f,d){this.openFile(c.store.getAt(f).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNR-"+PhDOE.user.lang+d+c);if(!Ext.getCmp("main-panel").findById("FNR-"+f)){Ext.getCmp("main-panel").add({id:"FNR-"+f,title:c,layout:"border",iconCls:"iconTabNeedReviewed",closable:true,tabLoaded:false,panVCSLang:!PhDOE.user.conf.reviewed.toolsPanelLogLoad,panVCSEn:!PhDOE.user.conf.reviewed.toolsPanelLogLoad,panLANGLoaded:false,panENLoaded:false,originTitle:c,defaults:{split:true},tabTip:String.format(_("Need Reviewed in: {0}"),d),listeners:{resize:function(h){Ext.getCmp("FNR-EN-PANEL-"+f).setWidth(h.getWidth()/2)}},items:[{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:true,collapsed:!PhDOE.user.conf.reviewed.toolsPanelDisplay,layout:"fit",bodyBorder:false,width:PhDOE.user.conf.reviewed.toolsPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:true,notify:false})}},resize:function(h,j){if(this.ownerCt.tabLoaded&&j&&j!=PhDOE.user.conf.reviewed.toolsPanelWidth){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelWidth",value:j,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:true,defaults:{autoScroll:true},items:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FNR-LANG",fid:f,fpath:PhDOE.user.lang+d,fname:c,loadStore:PhDOE.user.conf.reviewed.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FNR-EN",fid:f,fpath:"en"+d,fname:c,loadStore:PhDOE.user.conf.reviewed.toolsPanelLogLoad}),new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNR",fid:f})]}},new ui.cmp.FilePanel({id:"FNR-LANG-PANEL-"+f,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang.ucFirst())+d+c,prefix:"FNR",ftype:"LANG",spellCheck:PhDOE.user.conf.reviewed.enableSpellCheckLang,spellCheckConf:{module:"reviewed",itemName:"enableSpellCheckLang"},fid:f,fpath:d,fname:c,lang:PhDOE.user.lang,parser:"xml",storeRecord:e,syncScrollCB:true,syncScroll:true,syncScrollConf:{module:"reviewed",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FNR-EN-PANEL-"+f,region:"east",title:_("en File: ")+d+c,prefix:"FNR",ftype:"EN",spellCheck:PhDOE.user.conf.reviewed.enableSpellCheckEn,spellCheckConf:{module:"reviewed",itemName:"enableSpellCheckEn"},fid:f,fpath:d,fname:c,lang:"en",parser:"xml",storeRecord:e,syncScroll:true,syncScrollConf:{module:"reviewed",itemName:"syncScrollbars"}})]})}Ext.getCmp("main-panel").setActiveTab("FNR-"+f)},initComponent:function(){Ext.apply(this,{store:ui.cmp._PendingReviewGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNR-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(d,c){if(c.getKey()===c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.cmp._PendingReviewGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue(),d;if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);d=new RegExp(c,"i");ui.cmp._PendingReviewGrid.instance.store.filterBy(function(e){if(d.test(e.data.path)||d.test(e.data.name)||d.test(e.data.reviewed)||d.test(e.data.maintainer)){return true}else{return false}},this)}})]});ui.cmp.PendingReviewGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._PendingReviewGrid.instance=null;ui.cmp.PendingReviewGrid.getInstance=function(c){if(!ui.cmp._PendingReviewGrid.instance){if(!c){c={}}ui.cmp._PendingReviewGrid.instance=new ui.cmp.PendingReviewGrid(c)}return ui.cmp._PendingReviewGrid.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PendingTranslateGrid");ui.cmp._PendingTranslateGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedTranslate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"fileModified"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-translate-nb").innerHTML=c.getCount()}}});ui.cmp._PendingTranslateGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,getRowClass:function(c){if(c.data.fileModified){var d=Ext.util.JSON.decode(c.data.fileModified);return(d.user===PhDOE.user.login&&d.anonymousIdent===PhDOE.user.anonymousIdent)?"fileModifiedByMe":"fileModifiedByAnother"}return false},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});ui.cmp._PendingTranslateGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name",renderer:function(c,f,d){if(d.data.fileModified){var e=Ext.util.JSON.decode(d.data.fileModified);if(e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent){return"<span ext:qtip='"+_("File modified by me")+"'>"+c+"</span>"}else{return"<span ext:qtip='"+String.format(_("File modified by {0}"),e.user.ucFirst())+"'>"+c+"</span>"}}else{return c}}},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._PendingTranslateGrid.menu=function(c){Ext.apply(this,c);this.init();ui.cmp._StaleFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.cmp._PendingTranslateGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedTranslate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}}]})}});ui.cmp.PendingTranslateGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.cmp._PendingTranslateGrid.view,loadMask:true,autoExpandColumn:"name",enableDragDrop:true,ddGroup:"mainPanelDDGroup",border:false,onRowContextMenu:function(c,f,d){d.stopEvent();c.getSelectionModel().selectRow(f);new ui.cmp._PendingTranslateGrid.menu({grid:c,event:d,rowIdx:f}).showAt(d.getXY())},onRowDblClick:function(c,d){this.openFile(c.store.getAt(d).data.id)},openFile:function(g){var e=this.store.getById(g),d=e.data.path,c=e.data.name,f=Ext.util.md5("FNT-"+PhDOE.user.lang+d+c);if(!Ext.getCmp("main-panel").findById("FNT-"+f)){Ext.getCmp("main-panel").add({id:"FNT-"+f,layout:"border",title:c,originTitle:c,iconCls:"iconTabNeedTranslate",closable:true,tabLoaded:false,panTRANSLoaded:false,panGGTRANSLoaded:!PhDOE.user.conf.newFile.googlePanelDisplay,defaults:{split:true},tabTip:String.format(_("Need translate: in {0}"),d),listeners:{resize:function(h){if(PhDOE.user.conf.newFile.googlePanelDisplay){Ext.getCmp("FNT-GGTRANS-PANEL-"+f).setWidth(h.getWidth()/2)}}},items:[{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:true,collapsed:!PhDOE.user.conf.newFile.toolsPanelDisplay,layout:"fit",bodyBorder:false,width:PhDOE.user.conf.newFile.toolsPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:true,notify:false})}},resize:function(h,j){if(this.ownerCt.tabLoaded&&j&&j!=PhDOE.user.conf.newFile.toolsPanelWidth){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelWidth",value:j,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:true},items:[new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNT",fid:f})]}},new ui.cmp.FilePanel({id:"FNT-TRANS-PANEL-"+f,region:"center",title:_("New file: ")+PhDOE.user.lang+d+c,isTrans:true,prefix:"FNT",ftype:"TRANS",spellCheck:PhDOE.user.conf.newFile.enableSpellCheck,spellCheckConf:{module:"newFile",itemName:"enableSpellCheck"},fid:f,fpath:d,fname:c,lang:PhDOE.user.lang,parser:"xml",storeRecord:e,syncScrollCB:PhDOE.user.conf.newFile.googlePanelDisplay,syncScroll:PhDOE.user.conf.newFile.googlePanelDisplay,syncScrollConf:{module:"newFile",itemName:"syncScrollbars"}}),((PhDOE.user.conf.newFile.googlePanelDisplay)?new ui.cmp.FilePanel({id:"FNT-GGTRANS-PANEL-"+f,region:"east",title:_("Automatic translation: ")+PhDOE.user.lang+d+c,isTrans:true,prefix:"FNT",ftype:"GGTRANS",fid:f,fpath:d,fname:c,readOnly:true,lang:PhDOE.user.lang,parser:"xml",storeRecord:e,syncScroll:true,syncScrollConf:{module:"newFile",itemName:"syncScrollbars"}}):false)]})}Ext.getCmp("main-panel").setActiveTab("FNT-"+f)},initComponent:function(){Ext.apply(this,{columns:ui.cmp._PendingTranslateGrid.columns,store:ui.cmp._PendingTranslateGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNT-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(d,c){if(c.getKey()===c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.cmp._PendingTranslateGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue(),d;if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);d=new RegExp(c,"i");ui.cmp._PendingTranslateGrid.instance.store.filterBy(function(e){if(d.test(e.data.path)||d.test(e.data.name)){return true}else{return false}},this)}})]});ui.cmp.PendingTranslateGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._PendingTranslateGrid.instance=null;ui.cmp.PendingTranslateGrid.getInstance=function(c){if(!ui.cmp._PendingTranslateGrid.instance){if(!c){c={}}ui.cmp._PendingTranslateGrid.instance=new ui.cmp.PendingTranslateGrid(c)}return ui.cmp._PendingTranslateGrid.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletBugs");ui.cmp._PortletBugs.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getOpenBugs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"title"},{name:"link"},{name:"description"},{name:"xmlID"}]})});ui.cmp._PortletBugs.gridFormatTitle=function(c){return String.format('<div class="topic"><b>{0}</b></div>',c)};ui.cmp._PortletBugs.gridColumns=[{id:"GridBugTitle",header:_("Title"),sortable:true,dataIndex:"title",renderer:ui.cmp._PortletBugs.gridFormatTitle}];ui.cmp._PortletBugs.gridView=new Ext.grid.GridView({forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:false,enableRowBody:true,showPreview:false,getRowClass:function(c,e,d){if(this.showPreview){d.body="<p>"+c.data.description+"</p>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}});ui.cmp._PortletBugs.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,height:250,autoExpandColumn:"GridBugTitle",id:"PortletBugs-grid-id",store:ui.cmp._PortletBugs.store,columns:ui.cmp._PortletBugs.gridColumns,view:ui.cmp._PortletBugs.gridView,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),onRowDblClick:function(e,g){var c=e.store.getAt(g).data.id,d=e.store.getAt(g).data.link,f=e.store.getAt(g).data.title;if(!Ext.getCmp("main-panel").findById("bugs-"+c)){Ext.getCmp("main-panel").add({id:"bugs-"+c,xtype:"panel",title:Ext.util.Format.substr(f,0,20)+"...",tabTip:f,iconCls:"iconBugs",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-bugs-"+c,url:d})]})}Ext.getCmp("main-panel").setActiveTab("bugs-"+c)},openRelatedFile:function(c){new ui.task.GetFileInfoByXmlID({xmlID:c})},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-bugs",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",c,this.ctxIndex,d);this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null;ui.cmp._PortletBugs.reloadData()}},{scope:this,text:_("Open the related file"),iconCls:"iconAllFiles",id:"bugs-open-related-file",handler:function(){this.openRelatedFile(this.ctxXmlID)}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxIndex){this.ctxIndex=null}if(this.ctxXmlID){this.ctxXmlID=null}this.ctxIndex=f;this.ctxXmlID=c.store.getAt(this.ctxIndex).data.xmlID;this.menu.showAt(d.getXY());if(!this.ctxXmlID){Ext.getCmp("bugs-open-related-file").disable()}else{Ext.getCmp("bugs-open-related-file").enable()}},togglePreview:function(c){this.view.showPreview=c;this.view.refresh()},initComponent:function(c){this.tbar=[{text:_("Summary"),pressed:false,enableToggle:true,iconCls:"iconSummary",scope:this,toggleHandler:function(d,e){this.togglePreview(e)}}];ui.cmp._PortletBugs.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._PortletBugs.reloadData=function(){ui.cmp._PortletBugs.store.reload({callback:function(c,e,d){if(!d){Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading open bugs from Php.net !")+"</div>");Ext.get("PortletBugs-grid-defaultMess-id").highlight()}else{if(ui.cmp._PortletBugs.store.getTotalCount()===0){Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("No open bugs")+"</div>");Ext.get("PortletBugs-grid-defaultMess-id").highlight()}}}})};ui.cmp.PortletBugs=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconBugs",layout:"fit",store:ui.cmp._PortletBugs.store,reloadData:ui.cmp._PortletBugs.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletBugs.reloadData()}}],listeners:{expand:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:false,notify:false})}},collapse:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.user.conf.portletBugsCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){this.id="portletBugs";this.title=String.format(_("Open bugs for {0}"),"doc-"+this.lang);Ext.apply(this,c);ui.cmp.PortletBugs.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletBugs.grid())}});ui.cmp._PortletBugs.instance=null;ui.cmp.PortletBugs.getInstance=function(c){if(!ui.cmp._PortletBugs.instance){if(!c){c={}}ui.cmp._PortletBugs.instance=new ui.cmp.PortletBugs(c)}return ui.cmp._PortletBugs.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletInfo");ui.cmp._PortletInfo.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getInfos"}),baseParams:{start:0,limit:10},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"field"},{name:"value"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"elapsedTime"}]}),listeners:{load:function(c){var e=c.data.items[0].data.date;PhDOE.lastInfoDate=e.format("Y-m-d H:i:s")}}});ui.cmp._PortletInfo.store.setDefaultSort("date","desc");ui.cmp._PortletInfo.typeRenderer=function(k,h,f){var d,c,l,m,e,j,g;switch(k){case"updateData":d=f.data.value.user;return String.format(_("{0} updated app's data"),d.ucFirst());break;case"changeFilesOwner":d=f.data.value.user;return String.format(_("{0} changed file's owner"),d.ucFirst());break;case"checkEntities":d=f.data.value.user;return String.format(_("{0} check all entitites"),d.ucFirst());break;case"logout":d=f.data.value.user;return String.format(_("{0} logged out"),d.ucFirst());break;case"login":d=f.data.value.user;c=f.data.value.lang;return String.format(_("{0} is logged in using the {1} language"),d.ucFirst(),c.ucFirst());break;case"commitFolders":d=f.data.value.user;c=f.data.value.lang;l=f.data.value.nbFolders;return String.format(_("{0} committed {1} new folder(s) in the {2} language"),d.ucFirst(),l,c.ucFirst());break;case"commitFiles":d=f.data.value.user;c=f.data.value.lang;m=f.data.value.nbFilesCreate;e=f.data.value.nbFilesDelete;j=f.data.value.nbFilesUpdate;g=m+e+j;return String.format(_("{0} committed {1} file(s) ({2} new, {3} update, {4} delete) in the language {5}"),d.ucFirst(),g,m,j,e,c.ucFirst());break}};ui.cmp._PortletInfo.gridColumns=[new Ext.grid.RowNumberer(),{id:"Type",header:_("Type"),width:180,sortable:true,dataIndex:"field",renderer:ui.cmp._PortletInfo.typeRenderer},{header:_("Since"),width:110,sortable:false,dataIndex:"elapsedTime",renderer:function(d,c,e){if(!d){d=_("Less than one second")}else{d=String.format(_("{0} "+d.units),d.value)}return"<span ext:qtip='"+e.data.date.format(_("Y-m-d, H:i"))+"'>"+d+"</span>"}},{header:_("Date"),width:110,sortable:true,dataIndex:"date",hidden:true,renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.cmp._PortletInfo.grid=Ext.extend(Ext.grid.GridPanel,{autoExpandColumn:"Type",loadMask:true,autoScroll:true,autoHeight:true,store:ui.cmp._PortletInfo.store,columns:ui.cmp._PortletInfo.gridColumns,view:ui.cmp._PortletInfo.gridView,initComponent:function(){Ext.apply(this,{bbar:new Ext.PagingToolbar({pageSize:10,store:this.store,displayInfo:true})});ui.cmp._PortletInfo.grid.superclass.initComponent.call(this);this.on("rowdblclick",this.onRowdblclick,this)}});ui.cmp.PortletInfo=Ext.extend(Ext.ux.Portlet,{title:_("Information"),iconCls:"iconInfo",layout:"fit",store:ui.cmp._PortletInfo.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletInfo.store.reload()}}],listeners:{expand:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:false,notify:false})}},collapse:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.user.conf.portletInfoCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){this.id="portletInfo";Ext.apply(this,c);ui.cmp.PortletInfo.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletInfo.grid())}});ui.cmp._PortletInfo.instance=null;ui.cmp.PortletInfo.getInstance=function(c){if(!ui.cmp._PortletInfo.instance){if(!c){c={}}ui.cmp._PortletInfo.instance=new ui.cmp.PortletInfo(c)}return ui.cmp._PortletInfo.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletLocalMail");ui.cmp._PortletLocalMail.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getLastNews"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"title"},{name:"link"},{name:"description"},{name:"pubDate",type:"date",dateFormat:"Y/m/d H:i:s"}]})});ui.cmp._PortletLocalMail.store.setDefaultSort("pubDate","desc");ui.cmp._PortletLocalMail.columns=[new Ext.grid.RowNumberer(),{id:"GridMailingTitle",header:_("Title"),sortable:true,dataIndex:"title"},{header:_("By"),width:100,sortable:true,dataIndex:"description"},{header:_("Date"),width:100,sortable:true,dataIndex:"pubDate",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.cmp._PortletLocalMail.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,height:250,autoExpandColumn:"GridMailingTitle",id:"PortletLocalMail-grid-id",store:ui.cmp._PortletLocalMail.store,columns:ui.cmp._PortletLocalMail.columns,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true,enableRowBody:true,ignoreAdd:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:false}),onRowDblClick:function(d,g){var c=d.store.getAt(g).data.pubDate,f=d.store.getAt(g).data.link,e=d.store.getAt(g).data.title;if(!Ext.getCmp("main-panel").findById("mail-"+c)){Ext.getCmp("main-panel").add({xtype:"panel",id:"mail-"+c,title:Ext.util.Format.substr(e,0,20)+"...",tabTip:e,iconCls:"iconMailing",closable:true,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-mail-"+c,url:f})]})}Ext.getCmp("main-panel").setActiveTab("mail-"+c)},onContextClick:function(c,f,d){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-mail",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",c,this.ctxIndex,d);this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null;ui.cmp._PortletLocalMail.reloadData()}}]})}this.getSelectionModel().selectRow(f);d.stopEvent();if(this.ctxIndex){this.ctxIndex=null}this.ctxIndex=f;this.menu.showAt(d.getXY())},initComponent:function(c){ui.cmp._PortletLocalMail.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._PortletLocalMail.reloadData=function(){ui.cmp._PortletLocalMail.store.reload({callback:function(d,e,c){if(!c){Ext.getCmp("PortletLocalMail-grid-id").getView().mainBody.update('<div id="PortletLocalMail-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading mails from this mailing list !")+"</div>");Ext.get("PortletLocalMail-grid-defaultMess-id").highlight()}}})};ui.cmp.PortletLocalMail=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconMailing",layout:"fit",store:ui.cmp._PortletLocalMail.store,reloadData:ui.cmp._PortletLocalMail.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletLocalMail.reloadData()}}],listeners:{expand:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:false,notify:false})}},collapse:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.user.conf.portletLocalMailCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){this.id="portletLocalMail";Ext.apply(this,c);ui.cmp.PortletLocalMail.superclass.initComponent.apply(this);this.title=String.format(_("Mail from {0}"),"doc-"+this.lang);this.add(new ui.cmp._PortletLocalMail.grid())}});ui.cmp._PortletLocalMail.instance=null;ui.cmp.PortletLocalMail.getInstance=function(c){if(!ui.cmp._PortletLocalMail.instance){if(!c){c={}}ui.cmp._PortletLocalMail.instance=new ui.cmp.PortletLocalMail(c)}return ui.cmp._PortletLocalMail.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletSummary");ui.cmp._PortletSummary.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getSummaryInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel"},{name:"nbFiles"},{name:"percentFiles"},{name:"sizeFiles"},{name:"percentSize"}]}),listeners:{load:function(){this.each(function(c){switch(c.id){case 1:c.set("libel",_("Up to date files"));break;case 2:c.set("libel",_("Stale files"));break;case 3:c.set("libel",_("Files available for translation"));break;case 4:c.set("libel",_("Total"));break;default:c.set("libel","");break}c.commit()})}}});ui.cmp._PortletSummary.gridColumns=[new Ext.grid.RowNumberer(),{id:"StatusType",header:_("File status type"),width:180,sortable:true,dataIndex:"libel"},{header:_("Number of files"),width:110,sortable:true,dataIndex:"nbFiles"},{header:_("Percent of files"),width:110,sortable:true,dataIndex:"percentFiles"},{header:_("Size of files (kB)"),width:110,sortable:true,dataIndex:"sizeFiles"},{header:_("Percent of size"),width:110,sortable:true,dataIndex:"percentSize"}];ui.cmp._PortletSummary.gridView=new Ext.grid.GridView({getRowClass:function(c){switch(c.data.id){case 1:return"summary_1";case 2:return"summary_2";case 3:return"summary_3";case 4:return"summary_4";default:return""}}});ui.cmp._PortletSummary.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,autoHeight:true,store:ui.cmp._PortletSummary.store,columns:ui.cmp._PortletSummary.gridColumns,view:ui.cmp._PortletSummary.gridView,onRowdblclick:function(c,e){var d=c.store.getAt(e).data.id;if(d===2){Ext.getCmp("acc-need-update").expand()}if(d===3){Ext.getCmp("acc-need-translate").expand()}},initComponent:function(c){ui.cmp._PortletSummary.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowdblclick",this.onRowdblclick,this)}});ui.cmp.PortletSummary=Ext.extend(Ext.ux.Portlet,{title:_("Summary"),iconCls:"",layout:"fit",store:ui.cmp._PortletSummary.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletSummary.store.reload()}}],listeners:{expand:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:false,notify:false})}},collapse:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:true,notify:false})}}},initComponent:function(c){this.id="portletSummary";Ext.apply(this,c);ui.cmp.PortletSummary.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletSummary.grid())},afterRender:function(){ui.cmp.PortletSummary.superclass.afterRender.call(this);this.header.insertFirst({tag:"div",id:Ext.id(),style:"float: left; margin-right: 2px;",cls:"flags flag-"+this.lang},"first");if(PhDOE.user.conf.portletSummaryCollapsed){this.collapse()}else{this.expand()}}});ui.cmp._PortletSummary.instance=null;ui.cmp.PortletSummary.getInstance=function(c){if(!ui.cmp._PortletSummary.instance){if(!c){c={}}ui.cmp._PortletSummary.instance=new ui.cmp.PortletSummary(c)}return ui.cmp._PortletSummary.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslationGraph");function renderLibel(c){return _(c)}ui.cmp._PortletTranslationGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLang"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel",convert:renderLibel},{name:"total"}]})});ui.cmp._PortletTranslationGraph.chart=Ext.extend(Ext.chart.PieChart,{height:400,url:"js/ExtJs/resources/charts.swf",dataField:"total",categoryField:"libel",store:ui.cmp._PortletTranslationGraph.store,series:[{style:{colors:["#68D888","#FF6347","#EEE8AA"]}}],extraStyle:{legend:{display:"bottom",padding:5,font:{family:"Tahoma",size:13}}},initComponent:function(c){ui.cmp._PortletTranslationGraph.chart.superclass.initComponent.call(this);Ext.apply(this,c)}});ui.cmp.PortletTranslationGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics"),iconCls:"iconGraphic",layout:"fit",store:ui.cmp._PortletTranslationGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.cmp._PortletTranslationGraph.store.reload()}}],initComponent:function(c){this.id="portletTranslationGraph";Ext.apply(this,c);ui.cmp.PortletTranslationGraph.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletTranslationGraph.chart())}});ui.cmp._PortletTranslationGraph.instance=null;ui.cmp.PortletTranslationGraph.getInstance=function(c){if(!ui.cmp._PortletTranslationGraph.instance){if(!c){c={}}ui.cmp._PortletTranslationGraph.instance=new ui.cmp.PortletTranslationGraph(c)}return ui.cmp._PortletTranslationGraph.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslationsGraph");ui.cmp._PortletTranslationsGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLangs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel",type:"string"},{name:"fullLibel",type:"string"},{name:"total",type:"int"},{name:"percent",type:"float"}]})});ui.cmp._PortletTranslationsGraph.chart=Ext.extend(Ext.chart.ColumnChart,{height:400,url:"js/ExtJs/resources/charts.swf",xField:"libel",tipRenderer:function(d,c){return _("Lang:")+" "+c.data.fullLibel+"\r"+_("Total:")+" "+c.data.total+" "+_("files")+" ("+c.data.percent+"%)"},series:[{type:"column",displayName:"Total",yField:"total",style:{image:"themes/img/bar.gif",mode:"stretch",color:10075112}}],store:ui.cmp._PortletTranslationsGraph.store,initComponent:function(c){ui.cmp._PortletTranslationsGraph.chart.superclass.initComponent.call(this);Ext.apply(this,c)}});ui.cmp.PortletTranslationsGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics for all languages"),iconCls:"iconGraphic",layout:"fit",store:ui.cmp._PortletTranslationsGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.cmp._PortletTranslationsGraph.store.reload()}}],initComponent:function(c){this.id="portletTranslationsGraph";Ext.apply(this,c);ui.cmp.PortletTranslationsGraph.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletTranslationsGraph.chart())}});ui.cmp._PortletTranslationsGraph.instance=null;ui.cmp.PortletTranslationsGraph.getInstance=function(c){if(!ui.cmp._PortletTranslationsGraph.instance){if(!c){c={}}ui.cmp._PortletTranslationsGraph.instance=new ui.cmp.PortletTranslationsGraph(c)}return ui.cmp._PortletTranslationsGraph.instance};Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslator");ui.cmp._PortletTranslator.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getTranslatorInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"name"},{name:"email",mapping:"mail"},{name:"nick"},{name:"vcs"},{name:"uptodate",type:"int"},{name:"stale",type:"int"},{name:"sum",type:"int"}]})});ui.cmp._PortletTranslator.store.setDefaultSort("nick","asc");ui.cmp._PortletTranslator.translatorSumRenderer=function(c){if(c){c=(c===0||c>1)?c:1;return String.format("("+_("{0} Translators")+")",c)}else{return false}};ui.cmp._PortletTranslator.uptodateRenderer=function(c){if(c==="0"){return false}else{return'<span style="color:green; font-weight: bold;">'+c+"</span>"}};ui.cmp._PortletTranslator.staleRenderer=function(c){if(c==="0"){return false}else{return'<span style="color:red; font-weight: bold;">'+c+"</span>"}};ui.cmp._PortletTranslator.sumRenderer=function(c){return(c==="0")?"":c};ui.cmp._PortletTranslator.gridColumns=[new Ext.grid.RowNumberer(),{id:"GridTransName",header:_("Name"),sortable:true,dataIndex:"name",summaryType:"count",summaryRenderer:ui.cmp._PortletTranslator.translatorSumRenderer},{header:_("Email"),width:110,sortable:true,dataIndex:"email"},{header:_("Nick"),width:70,sortable:true,dataIndex:"nick"},{header:_("VCS"),width:45,sortable:true,dataIndex:"vcs"},{header:_("UptoDate"),width:60,sortable:true,renderer:ui.cmp._PortletTranslator.uptodateRenderer,dataIndex:"uptodate",summaryType:"sum"},{header:_("Stale"),width:90,sortable:true,renderer:ui.cmp._PortletTranslator.staleRenderer,dataIndex:"stale",summaryType:"sum"},{header:_("Sum"),width:50,sortable:true,renderer:ui.cmp._PortletTranslator.sumRenderer,dataIndex:"sum",summaryType:"sum"}];ui.cmp._PortletTranslator.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,autoHeight:true,plugins:[new Ext.ux.grid.GridSummary()],store:ui.cmp._PortletTranslator.store,columns:ui.cmp._PortletTranslator.gridColumns,autoExpandColumn:"GridTransName",sm:new Ext.grid.RowSelectionModel({singleSelect:true}),lang:this.lang,EmailPrompt:new ui.cmp.EmailPrompt(),onRowDblClick:function(d,e){this.getSelectionModel().selectRow(e);if(this.ctxTranslatorName){this.ctxTranslatorEmail=null;this.ctxTranslatorName=null}this.ctxTranslatorEmail=this.store.getAt(e).data.email;this.ctxTranslatorName=this.store.getAt(e).data.name;var c=this.store.getAt(e).data.nick;if(c==="nobody"){return}this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail);this.EmailPrompt.show("lastUpdateTime")},onContextClick:function(d,g,f){if(!this.menu){this.menu=new Ext.menu.Menu({id:"submenu-translators",items:[{scope:this,text:"",iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail);this.EmailPrompt.show("lastUpdateTime")}},"-",{scope:this,text:String.format(_("Send an email to the {0}"),String.format(PhDOE.app.conf.projectMailList,this.lang)),iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData("Php Doc Team "+this.lang,String.format(PhDOE.app.conf.projectMailList,this.lang));this.EmailPrompt.show("lastUpdateTime")}}]})}this.getSelectionModel().selectRow(g);f.stopEvent();if(this.ctxTranslatorName){this.ctxTranslatorName=null;this.ctxTranslatorEmail=null}this.ctxTranslatorName=this.store.getAt(g).data.name;this.ctxTranslatorEmail=this.store.getAt(g).data.email;var c=this.store.getAt(g).data.nick;if(c==="nobody"){return}this.menu.items.items[0].setText("<b>"+String.format(_("Send an email to {0}"),this.ctxTranslatorName)+"</b>");this.menu.showAt(f.getXY())},initComponent:function(c){ui.cmp._PortletTranslator.grid.superclass.initComponent.call(this);Ext.apply(this,c);this.on("rowcontextmenu",this.onContextClick,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp.PortletTranslator=Ext.extend(Ext.ux.Portlet,{title:_("Translators"),iconCls:"iconTranslator",layout:"fit",store:ui.cmp._PortletTranslator.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletTranslator.store.reload()}}],listeners:{expand:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:false,notify:false})}},collapse:function(){if(PhDOE.app.loaded){new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:true,notify:false})}},afterrender:function(c){if(PhDOE.user.conf.portletTranslatorCollapsed){c.collapse()}else{c.expand()}}},initComponent:function(c){this.id="portletTranslator";Ext.apply(this,c);ui.cmp.PortletTranslator.superclass.initComponent.apply(this);this.add(new ui.cmp._PortletTranslator.grid({lang:this.lang}))}});ui.cmp._PortletTranslator.instance=null;ui.cmp.PortletTranslator.getInstance=function(c){if(!ui.cmp._PortletTranslator.instance){if(!c){c={}}ui.cmp._PortletTranslator.instance=new ui.cmp.PortletTranslator(c)}return ui.cmp._PortletTranslator.instance};Ext.namespace("ui","ui.cmp");ui.cmp.PreviewFile=Ext.extend(Ext.Window,{id:"winPreviewFile",layout:"fit",title:_("Preview"),iconCls:"iconView",closable:true,closeAction:"close",maximized:true,modal:true,buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],initComponent:function(){var c=this;ui.cmp.PreviewFile.superclass.initComponent.call(this);XHR({params:{task:"previewFile",path:this.path},success:function(d){var f=Ext.util.JSON.decode(d.responseText),e;f.url=f.url+"?"+Math.random();e=new Ext.ux.IFrameComponent({id:"frame-previewFile",url:f.url});c.add(e);c.show()},failure:function(){}})}});Ext.namespace("ui","ui.cmp","ui.cmp._RepositoryTree");ui.cmp._RepositoryTree.root={nodeType:"async",id:"/",text:_("Repository"),draggable:false};ui.cmp._RepositoryTree.loader=new Ext.tree.TreeLoader({dataUrl:"./do/getAllFiles"});ui.cmp._RepositoryTree.winAddNewFile=Ext.extend(Ext.Window,{title:_("Add a new file"),iconCls:"iconFilesNeedTranslate",id:"win-add-new-file",layout:"form",width:350,height:170,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelWidth:150,buttons:[{id:"win-add-new-file-btn",text:_("Open the editor"),disabled:true,handler:function(){var d=Ext.getCmp("win-add-new-file"),f=d.node.id,c=d.items.items[1].getValue(),e=d.items.items[2].getValue();if(d.node.findChild("id",f+"/"+c)){PhDOE.winForbidden("file_already_exist");return true}d.openFile(f+"/",c,e);d.close();return true}}],openFile:function(e,c,j){var h=Ext.util.md5("FNT-"+e+c),g={data:{fileModified:false,node:this.node}},d=e.split("/"),f;d.shift();f=d[0];d.shift();d.pop();e="/"+d.join("/")+"/";if(e==="//"){e="/"}h=Ext.util.md5("FNT-"+e+c);if(!Ext.getCmp("main-panel").findById("FNT-"+h)){Ext.getCmp("main-panel").add({id:"FNT-"+h,layout:"border",title:c,originTitle:c,iconCls:"iconTabNeedTranslate",closable:true,tabLoaded:false,panTRANSLoaded:false,panGGTRANSLoaded:true,defaults:{split:true},tabTip:String.format(_("New file: in {0}"),f+e),items:[new ui.cmp.FilePanel({id:"FNT-NEW-PANEL-"+h,region:"center",title:_("New file: ")+f+e+c,isTrans:true,prefix:"FNT",ftype:"NEW",spellCheck:PhDOE.user.conf.newFile.enableSpellCheck,spellCheckConf:{module:"newFile",itemName:"enableSpellCheck"},fid:h,fpath:e,fname:c,lang:f,parser:"xml",storeRecord:g,syncScrollCB:false,syncScroll:false,skeleton:j})]})}Ext.getCmp("main-panel").setActiveTab("FNT-"+h)},initComponent:function(){Ext.apply(this,{items:[{xtype:"displayfield",fieldLabel:_("Parent Folder"),value:this.node.id},{xtype:"textfield",fieldLabel:_("Name for the new file"),name:"newFolderName",listeners:{valid:function(){Ext.getCmp("win-add-new-file-btn").enable()},invalid:function(){Ext.getCmp("win-add-new-file-btn").disable()}}},{xtype:"combo",triggerAction:"all",width:160,editable:false,store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getSkeletonsNames"}),reader:new Ext.data.JsonReader({root:"Items",idProperty:"name",fields:[{name:"name"},{name:"path"}]})}),listeners:{select:function(f,d,e){if(f.ownerCt.items.items[1].getValue()===""){f.ownerCt.items.items[1].setValue(d.data.name)}}},valueField:"path",displayField:"name",fieldLabel:_("Chose a skeleton")}]});ui.cmp._RepositoryTree.winAddNewFile.superclass.initComponent.call(this)}});ui.cmp._RepositoryTree.winAddNewFolder=Ext.extend(Ext.Window,{title:_("Add a new folder"),iconCls:"iconFolderNew",id:"win-add-new-folder",layout:"form",width:350,height:200,resizable:false,modal:true,bodyStyle:"padding:5px 5px 0",labelWidth:150,buttons:[{id:"win-add-new-folder-btn",text:"Add",disabled:true,handler:function(){var c=Ext.getCmp("win-add-new-folder"),e=c.node.id,d=c.items.items[1].getValue();XHR({params:{task:"addNewFolder",parentFolder:e,newFolderName:d},success:function(){Ext.getCmp("win-add-new-folder").close();c.node.reload();PhDOE.notify("info",_("Folder created"),String.format(_("Folder <br><br><b>{0}</b><br><br> was created sucessfully under {1} !"),d,e))},failure:function(f){var g=Ext.util.JSON.decode(f.responseText);if(g.type){PhDOE.winForbidden(g.type)}else{PhDOE.winForbidden()}}})}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"displayfield",fieldLabel:_("Parent Folder"),value:this.node.id},{xtype:"textfield",fieldLabel:_("Name for the new folder"),name:"newFolderName",vtype:"alphanum",listeners:{valid:function(){Ext.getCmp("win-add-new-folder-btn").enable()},invalid:function(){Ext.getCmp("win-add-new-folder-btn").disable()}}},{xtype:"box",html:_("Info: This new folder won't be commited until a new file will be commited into it. If you don't commit any new file into it until 8 days, it will be automatically deleted.")}]});ui.cmp._RepositoryTree.winAddNewFolder.superclass.initComponent.call(this)}});Ext.namespace("ui.cmp._RepositoryTree.menu");ui.cmp._RepositoryTree.menu.folder=function(c){Ext.apply(this,c);this.init();ui.cmp._RepositoryTree.menu.folder.superclass.constructor.call(this)};Ext.extend(ui.cmp._RepositoryTree.menu.folder,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:(this.node.isExpanded())?"<b>"+_("Collapse")+"</b>":"<b>"+_("Expand")+"</b>",iconCls:"iconFolderClose",scope:this,handler:function(){if(this.node.isExpanded()){this.node.collapse()}else{this.node.expand()}}},"-",{text:_("Update this folder"),iconCls:"iconFilesNeedUpdate",scope:this,handler:function(){this.node.expand();new ui.task.UpdateSingleFolderTask(this.node)}},{text:_("Add a new folder"),iconCls:"iconFolderNew",hidden:(this.node.id==="/"||(Ext.util.Format.substr(this.node.id,0,3)!=="/en"&&Ext.util.Format.substr(this.node.id,0,9)!=="/doc-base")),scope:this,handler:function(){this.node.expand();var c=new ui.cmp._RepositoryTree.winAddNewFolder({node:this.node});c.show(this.node.ui.getEl())}},{text:_("Add a new file"),iconCls:"iconFilesNeedTranslate",hidden:(this.node.id==="/"||(Ext.util.Format.substr(this.node.id,0,3)!=="/en"&&Ext.util.Format.substr(this.node.id,0,9)!=="/doc-base")),scope:this,handler:function(){this.node.expand();var c=new ui.cmp._RepositoryTree.winAddNewFile({node:this.node});c.show(this.node.ui.getEl())}}]})}});ui.cmp._RepositoryTree.menu.file=function(c){Ext.apply(this,c);this.init();ui.cmp._RepositoryTree.menu.file.superclass.constructor.call(this)};Ext.extend(ui.cmp._RepositoryTree.menu.file,Ext.menu.Menu,{init:function(){var c=this.node.attributes.text,d=this.node.attributes.id.split("/"),f,e;d.shift();f=d[0];d.shift();d.pop();e=d.join("/")+"/";Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedReviewed",scope:this,handler:function(){ui.cmp._RepositoryTree.instance.fireEvent("dblclick",this.node)}},{hidden:(this.node.attributes.from==="search"||PhDOE.user.lang==="en"),text:(f==="en")?String.format(_("Open the same file in <b>{0}</b>"),Ext.util.Format.uppercase(PhDOE.user.lang)):String.format(_("Open the same file in <b>{0}</b>"),"EN"),iconCls:"iconTabNeedReviewed",scope:this,handler:function(){if(f==="en"){ui.cmp._RepositoryTree.instance.openFile("byPath",PhDOE.user.lang+"/"+e,c)}else{ui.cmp._RepositoryTree.instance.openFile("byPath","en/"+e,c)}}}]})}});ui.cmp.RepositoryTree=Ext.extend(Ext.ux.MultiSelectTreePanel,{animate:true,enableDD:true,ddGroup:"mainPanelDDGroup",useArrows:true,autoScroll:true,border:false,containerScroll:true,root:ui.cmp._RepositoryTree.root,loader:ui.cmp._RepositoryTree.loader,onContextMenu:function(c,d){d.stopEvent();c.select();if(c.attributes.type==="folder"||c.isRoot){new ui.cmp._RepositoryTree.menu.folder({node:c}).showAt(d.getXY())}else{if(c.attributes.type==="file"){new ui.cmp._RepositoryTree.menu.file({node:c}).showAt(d.getXY())}}},onDblClick:function(c){if(c.attributes.type==="file"){this.openFile("byId",c.attributes.id,false)}},openFile:function(r,m,g){if(r==="byPath"){Ext.getCmp("acc-all-files").expand();var f=m,j=g,u=f.split("/"),l=function(w){w.ensureVisible();if(u[0]&&u[0]!==""){for(var t=0;t<w.childNodes.length;++t){if(w.childNodes[t].text===u[0]){u.shift();w.childNodes[t].expand(false,true,l.createDelegate(this))}}}else{for(var v=0;v<w.childNodes.length;++v){if(w.childNodes[v].text===j){w.childNodes[v].ensureVisible();w.childNodes[v].ui.highlight();this.openFile("byId",w.childNodes[v].id,false)}}}};this.root.expand(false,true,l.createDelegate(this))}if(r==="byId"){var k=this.getNodeById(m),c=k.attributes.id,s=k.attributes.extension,u,p,h,e,d,o,q;u=c.split("/");u.shift();e=u.pop();h=u.shift();c=(u.length>0)?"/"+u.join("/")+"/":"/";p=Ext.util.md5("AF-"+h+c+e);if(!Ext.getCmp("main-panel").findById("AF-"+p)){if(s!=="html"){d=s}else{d="xml"}if(s==="gif"||s==="png"){o={};q={id:"AF-ALL-FILE-"+p,xtype:"panel",region:"center",layout:"fit",bodyStyle:"padding:5px 5px 0",html:'<img src="./do/getImageContent?FileLang='+h+"&FilePath="+c+"&FileName="+e+'" />'}}else{o={xtype:"panel",region:"west",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],layout:"fit",bodyBorder:false,split:true,collapsible:true,collapsed:!PhDOE.user.conf.allFiles.toolsPanelDisplay,width:PhDOE.user.conf.allFiles.toolsPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:true,notify:false})}},resize:function(t,v){if(this.ownerCt.tabLoaded&&v&&v!=PhDOE.user.conf.allFiles.toolsPanelWidth){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelWidth",value:v,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,defaults:{autoScroll:true},items:[{title:_("Log"),layout:"fit",items:[new ui.cmp.VCSLogGrid({prefix:"AF",fid:p,fpath:h+c,fname:e,loadStore:PhDOE.user.conf.allFiles.toolsPanelLogLoad})]},{title:_("Entities"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"entities",prefix:"AF",ftype:"ALL",fid:p,loadStore:PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad})]},{title:_("Acronyms"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"AF",ftype:"ALL",fid:p,loadStore:PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad})]}]}};q=new ui.cmp.FilePanel({id:"AF-ALL-PANEL-"+p,region:"center",title:_("File: ")+h+c+e,prefix:"AF",ftype:"ALL",spellCheck:PhDOE.user.conf.allFiles.enableSpellCheck,spellCheckConf:{module:"allFiles",itemName:"enableSpellCheck"},fid:p,fpath:c,fname:e,lang:h,parser:d,storeRecord:k,syncScrollCB:false,syncScroll:false})}Ext.getCmp("main-panel").add({id:"AF-"+p,layout:"border",title:e,originTitle:e,closable:true,tabLoaded:false,panEntities:!PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad,panAcronyms:!PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad,panVCS:!PhDOE.user.conf.allFiles.toolsPanelLogLoad,panLoaded:false,tabTip:String.format(_("in {0}"),c),iconCls:"iconAllFiles",items:[q,o]})}Ext.getCmp("main-panel").setActiveTab("AF-"+p)}},initComponent:function(){Ext.apply(this,{tbar:[_("Search: ")," ",new Ext.form.TwinTriggerField({id:"AF-search",validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,enableKeyEvents:true,listeners:{keypress:function(d,c){if(c.getKey()===c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){var c=ui.cmp._RepositoryTree.instance;this.setValue("");this.triggers[0].hide();this.setSize(180,10);c.root.setText(_("Repository"));delete c.loader.baseParams.search;c.root.reload()},onTrigger2Click:function(){var c=ui.cmp._RepositoryTree.instance,d=this.getValue();if(d===""||d.length<3){this.markInvalid(_("Your search must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);c.loader.baseParams.search=d;c.root.reload(function(){c.root.setText(String.format(_("Search result: {0}"),c.root.childNodes.length))})}})]});ui.cmp.RepositoryTree.superclass.initComponent.call(this);this.on("contextmenu",this.onContextMenu,this);this.on("dblclick",this.onDblClick,this);new Ext.tree.TreeSorter(this,{folderSort:true})}});ui.cmp._RepositoryTree.instance=null;ui.cmp.RepositoryTree.getInstance=function(c){if(!ui.cmp._RepositoryTree.instance){if(!c){c={}}ui.cmp._RepositoryTree.instance=new ui.cmp.RepositoryTree(c)}return ui.cmp._RepositoryTree.instance};Ext.namespace("ui","ui.cmp","ui.cmp._StaleFileGrid");ui.cmp._StaleFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedUpdate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"revision"},{name:"original_revision"},{name:"en_revision"},{name:"maintainer"},{name:"fileModifiedEN"},{name:"fileModifiedLang"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(c){Ext.getDom("acc-need-update-nb").innerHTML=c.getCount()}}});ui.cmp._StaleFileGrid.view=new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:false,getRowClass:function(c){if(c.data.fileModifiedEN||c.data.fileModifiedLang){var e=Ext.util.JSON.decode(c.data.fileModifiedEN),d=Ext.util.JSON.decode(c.data.fileModifiedLang);return((e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent)||(d.user===PhDOE.user.login&&d.anonymousIdent===PhDOE.user.anonymousIdent))?"fileModifiedByMe":"fileModifiedByAnother"}return false},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"});ui.cmp._StaleFileGrid.columns=[{id:"name",header:_("Files"),sortable:true,dataIndex:"name",renderer:function(c,f,d){var h="",g,e;if(d.data.fileModifiedEN){g=Ext.util.JSON.decode(d.data.fileModifiedEN);if(g.user===PhDOE.user.login&&g.anonymousIdent===PhDOE.user.anonymousIdent){h=_("File EN modified by me")+"<br>"}else{h=String.format(_("File EN modified by {0}"),g.user.ucFirst())+"<br>"}}if(d.data.fileModifiedLang){e=Ext.util.JSON.decode(d.data.fileModifiedLang);if(e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent){h+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst())}else{h+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),e.user.ucFirst())}}if(h!==""){return"<span ext:qtip='"+h+"'>"+c+"</span>"}else{return c}}},{header:_("EN revision"),width:45,sortable:true,dataIndex:"en_revision"},{header:"",width:45,sortable:true,dataIndex:"revision"},{header:_("Maintainer"),width:45,sortable:true,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:true}];ui.cmp._StaleFileGrid.menu=function(c){Ext.apply(this,c);this.init();ui.cmp._StaleFileGrid.menu.superclass.constructor.call(this)};Ext.extend(ui.cmp._StaleFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedUpdate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff..."),iconCls:"iconViewDiff",menu:new Ext.menu.Menu({items:[{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedEN===false),text:String.format(_("... of the {0} file"),"EN"),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:"en"+this.fpath})}},{scope:this,hidden:(this.grid.store.getAt(this.rowIdx).data.fileModifiedLang===false),text:String.format(_("... of the {0} file"),PhDOE.user.lang.ucFirst()),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}}]})}]})}});ui.cmp.StaleFileGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.cmp._StaleFileGrid.view,loadMask:true,autoExpandColumn:"name",border:false,enableDragDrop:true,ddGroup:"mainPanelDDGroup",onRowContextMenu:function(d,j,h){h.stopEvent();var g=this.store.getAt(j).data,f=g.path,c=g.name;this.getSelectionModel().selectRow(j);new ui.cmp._StaleFileGrid.menu({hideDiffMenu:(g.fileModifiedEN===false&&g.fileModifiedLang===false),grid:this,event:h,rowIdx:j,lang:PhDOE.user.lang,fpath:f,fname:c}).showAt(h.getXY())},onRowDblClick:function(c,d){this.openFile(this.store.getAt(d).data.id)},openFile:function(e){var g=this.store.getById(e),c=g.data.path,d=g.data.name,j=g.data.en_revision,h=g.data.revision,l=g.data.original_revision,f=Ext.util.md5("FNU-"+PhDOE.user.lang+c+d),k="";if(!Ext.getCmp("main-panel").findById("FNU-"+f)){if(PhDOE.user.conf.needUpdate.diffMethod==="using-viewvc"){k=ui.cmp.ViewVCDiff}else{if(PhDOE.user.conf.needUpdate.diffMethod==="using-exec"){k=ui.cmp.ExecDiff}}Ext.getCmp("main-panel").add({id:"FNU-"+f,layout:"border",title:d,originTitle:d,iconCls:"iconTabNeedUpdate",closable:true,tabLoaded:false,panVCSLang:!PhDOE.user.conf.needUpdate.toolsPanelLogLoad,panVCSEn:!PhDOE.user.conf.needUpdate.toolsPanelLogLoad,panDiffLoaded:(PhDOE.user.conf.needUpdate.diffMethod==="using-viewvc"),panLANGLoaded:false,panENLoaded:false,defaults:{split:true},tabTip:String.format(_("Need Update: in {0}"),c),listeners:{resize:function(m){Ext.getCmp("FNU-EN-PANEL-"+f).setWidth(m.getWidth()/2)}},items:[new k({region:"north",collapsible:true,height:PhDOE.user.conf.needUpdate.diffPanelHeight||150,prefix:"FNU",collapsed:!PhDOE.user.conf.needUpdate.diffPanelDisplay,fid:f,fpath:c,fname:d,rev1:(l)?l:h,rev2:j,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:true,notify:false})}},resize:function(p,m,o){if(this.ownerCt.tabLoaded&&o&&o>50&&o!=PhDOE.user.conf.needUpdate.diffPanelHeight){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelHeight",value:o,notify:false})}}}}),{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",collapsible:true,collapsed:!PhDOE.user.conf.needUpdate.toolsPanelDisplay,layout:"fit",bodyBorder:false,plugins:[Ext.ux.PanelCollapsedTitle],width:PhDOE.user.conf.needUpdate.toolsPanelWidth||375,listeners:{collapse:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:false,notify:false})}},expand:function(){if(this.ownerCt.tabLoaded){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:true,notify:false})}},resize:function(m,o){if(this.ownerCt.tabLoaded&&o&&o!=PhDOE.user.conf.needUpdate.toolsPanelWidth){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelWidth",value:o,notify:false})}}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:true,defaults:{autoScroll:true},items:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FNU-LANG",fid:f,fpath:PhDOE.user.lang+c,fname:d,loadStore:PhDOE.user.conf.needUpdate.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FNU-EN",fid:f,fpath:"en"+c,fname:d,loadStore:PhDOE.user.conf.needUpdate.toolsPanelLogLoad}),new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNU",fid:f})]}},new ui.cmp.FilePanel({id:"FNU-LANG-PANEL-"+f,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang)+c+d,prefix:"FNU",ftype:"LANG",spellCheck:PhDOE.user.conf.needUpdate.enableSpellCheckLang,spellCheckConf:{module:"needUpdate",itemName:"enableSpellCheckLang"},fid:f,fpath:c,fname:d,lang:PhDOE.user.lang,parser:"xml",storeRecord:g,syncScrollCB:true,syncScroll:true,syncScrollConf:{module:"needUpdate",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FNU-EN-PANEL-"+f,region:"east",title:_("en File: ")+c+d,prefix:"FNU",ftype:"EN",spellCheck:PhDOE.user.conf.needUpdate.enableSpellCheckEn,spellCheckConf:{module:"needUpdate",itemName:"enableSpellCheckEn"},fid:f,fpath:c,fname:d,lang:"en",parser:"xml",storeRecord:g,syncScroll:true,syncScrollConf:{module:"needUpdate",itemName:"syncScrollbars"}})]})}Ext.getCmp("main-panel").setActiveTab("FNU-"+f)},initComponent:function(){ui.cmp._StaleFileGrid.columns[2].header=String.format(_("{0} revision"),Ext.util.Format.uppercase(PhDOE.user.lang));Ext.apply(this,{columns:ui.cmp._StaleFileGrid.columns,store:ui.cmp._StaleFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNU-filter",width:180,hideTrigger1:true,enableKeyEvents:true,validateOnBlur:false,validationEvent:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(d,c){if(c.getKey()===c.ENTER){this.onTrigger2Click()}}},onTrigger1Click:function(){this.setValue("");this.triggers[0].hide();this.setSize(180,10);ui.cmp._StaleFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var c=this.getValue(),d;if(c===""||c.length<3){this.markInvalid(_("Your filter must contain at least 3 characters"));return}this.clearInvalid();this.triggers[0].show();this.setSize(180,10);d=new RegExp(c,"i");ui.cmp._StaleFileGrid.instance.store.filterBy(function(e){if(d.test(e.data.path)||d.test(e.data.name)||d.test(e.data.revision)||d.test(e.data.en_revision)||d.test(e.data.maintainer)){return true}else{return false}},this)}})]});ui.cmp.StaleFileGrid.superclass.initComponent.call(this);this.on("rowcontextmenu",this.onRowContextMenu,this);this.on("rowdblclick",this.onRowDblClick,this)}});ui.cmp._StaleFileGrid.instance=null;ui.cmp.StaleFileGrid.getInstance=function(c){if(!ui.cmp._StaleFileGrid.instance){if(!c){c={}}ui.cmp._StaleFileGrid.instance=new ui.cmp.StaleFileGrid(c)}return ui.cmp._StaleFileGrid.instance};Ext.namespace("ui","ui.cmp");ui.cmp.SystemUpdatePrompt=Ext.extend(Ext.Window,{id:"sys-update-win",title:_("Refresh all data"),layout:"form",width:300,height:200,resizable:false,modal:true,bodyStyle:"padding:15px 15px 0",iconCls:"iconRefresh",html:['<div id="wizard-step-1" class="wizard-step-before">',_("Update all files from VCS"),"</div>",'<div id="wizard-step-1.1" class="wizard-wait">',_("This may take time. Thank you for your patience..."),"</div>",'<div id="wizard-step-2" class="wizard-step-before">',_("Apply all tools"),"</div>",'<div id="wizard-step-3" class="wizard-step-before">',_("Reload data"),"</div>"].join(""),buttons:[{id:"btn-start-refresh",text:_("Start"),iconCls:"iconStartRefresh",handler:function(){Ext.getCmp("btn-start-refresh").disable();this.ownerCt.ownerCt.tools.close.setVisible(false);new ui.task.SystemUpdateTask()}}]});Ext.namespace("ui","ui.cmp","ui.cmp._VCSLogGrid");ui.cmp._VCSLogGrid.store=Ext.extend(Ext.data.Store,{reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"revision"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"author"},{name:"content"}]})});ui.cmp._VCSLogGrid.sm=Ext.extend(Ext.grid.CheckboxSelectionModel,{singleSelect:false,header:"",width:22,listeners:{beforerowselect:function(d){var c=d.getCount();if(c===2){return false}return true},rowselect:function(d){var c=d.getCount();if(c===2){Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).enable();Ext.get(d.prefix+"-PANEL-btn-log-"+d.fid).frame("3F8538")}else{Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).disable()}},rowdeselect:function(d){var c=d.getCount();if(c===2){Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).enable();Ext.get(d.prefix+"-PANEL-btn-log-"+d.fid).frame("3F8538")}else{Ext.getCmp(d.prefix+"-PANEL-btn-log-"+d.fid).disable()}}}});ui.cmp._VCSLogGrid.columns=[{id:"id",header:_("Rev."),width:40,sortable:false,dataIndex:"revision"},{header:_("Content"),width:130,sortable:true,dataIndex:"content"},{header:_("By"),width:50,sortable:true,dataIndex:"author"},{header:_("Date"),width:85,sortable:true,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}];ui.cmp.VCSLogGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:true,autoScroll:true,bodyBorder:false,border:false,autoExpandColumn:"content",initComponent:function(){var f=new ui.cmp._VCSLogGrid.sm({fid:this.fid,prefix:this.prefix}),c=new ui.cmp._VCSLogGrid.store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:"./do/getLog"}),baseParams:{Path:this.fpath,File:this.fname},listeners:{scope:this,load:function(h,g){if(this.prefix==="FNU-EN"){Ext.getCmp("FNU-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)}if(this.prefix==="FNU-LANG"){Ext.getCmp("FNU-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)}if(this.prefix==="FE-EN"){Ext.getCmp("FE-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)}if(this.prefix==="FE-LANG"){Ext.getCmp("FE-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)}if(this.prefix==="FNR-EN"){Ext.getCmp("FNR-"+this.fid).panVCSEn=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)}if(this.prefix==="FNR-LANG"){Ext.getCmp("FNR-"+this.fid).panVCSLang=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)}if(this.prefix==="AF"){Ext.getCmp("AF-"+this.fid).panVCS=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","AF",this.fid)}if(this.prefix==="PP"){Ext.getCmp("PP-"+this.fid).panVCS=true;Ext.getCmp("main-panel").fireEvent("tabLoaded","PP",this.fid)}}}}),e=[],d;e.push(f);for(d=0;d<ui.cmp._VCSLogGrid.columns.length;++d){e.push(ui.cmp._VCSLogGrid.columns[d])}c.setDefaultSort("date","desc");Ext.apply(this,{sm:f,store:c,columns:e,view:new Ext.grid.GridView({forceFit:true,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:false}),tbar:[{scope:this,id:this.prefix+"-PANEL-btn-refreshlog-"+this.fid,tooltip:_("<b>Load/Refresh</b> revisions"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},{scope:this,id:this.prefix+"-PANEL-btn-log-"+this.fid,tooltip:_("<b>View</b> the diff"),iconCls:"iconViewDiff",disabled:true,handler:function(){var j=this.getSelectionModel().getSelections(),h=j[0].data.revision,g=j[1].data.revision;Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Finding the diff. Please, wait..."));XHR({params:{task:"getDiff",DiffType:"vcs",FilePath:this.fpath,FileName:this.fname,Rev1:h,Rev2:g},success:function(l){var m=Ext.util.JSON.decode(l.responseText),k;Ext.getBody().unmask();k=new Ext.Window({title:String.format(_("Diff between {0} & {1}"),h,g),width:650,height:350,resizable:false,modal:true,autoScroll:true,bodyStyle:"background-color: white; padding: 5px;",html:'<div class="diff-content">'+m.content+"</div>",buttons:[{text:_("Close"),handler:function(){k.close()}}]});k.show()}})}}]});ui.cmp.VCSLogGrid.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp");ui.cmp.ViewVCDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",plugins:[Ext.ux.PanelCollapsedTitle],initComponent:function(){Ext.apply(this,{items:{id:this.prefix+"-diff-"+this.fid,xtype:"panel",layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+this.prefix+"-diff-"+this.fid,url:String.format(PhDOE.app.conf.viewVcUrl,this.fpath+this.fname,this.rev1,this.rev2)})]}});ui.cmp.ViewVCDiff.superclass.initComponent.call(this)}});Ext.namespace("ui","ui.cmp","ui.cmp._WorkTreeGrid","ui.cmp._WorkTreeGrid.menu");ui.cmp._WorkTreeGrid.SetProgress=new Ext.util.DelayedTask(function(){new ui.task.SetFileProgressTask({idDB:this.node.attributes.idDB,progress:this.node.attributes.progress})});ui.cmp._WorkTreeGrid.menu.admin=function(c){Ext.apply(this,c);this.init();ui.cmp._WorkTreeGrid.menu.admin.superclass.constructor.call(this)};Ext.extend(ui.cmp._WorkTreeGrid.menu.admin,Ext.menu.Item,{init:function(){var c;switch(this.from){case"file":c=[{scope:this,iconCls:"iconSwitchLang",text:_("Change file's owner"),handler:function(){new ui.cmp.ChangeFileOwner({fileIdDB:this.node.attributes.idDB,fileLang:this.fileLang,fileFolder:this.folderNode.attributes.task,fileName:this.node.attributes.task,currentOwner:this.userNode.attributes.task})}},{scope:this,iconCls:"iconPageDelete",text:((this.node.attributes.type==="delete")?_("Cancel this deletion"):_("Clear this change")),handler:function(){new ui.task.ClearLocalChangeTask({ftype:this.node.attributes.type,fpath:this.folderNode.attributes.task,fname:this.node.attributes.task})}}];break;case"patch":c=[{scope:this,iconCls:"iconTrash",text:_("Delete this patch"),handler:function(){ui.task.DeletePatchTask({patchID:this.node.attributes.idDB})}}];break}Ext.apply(this,{text:_("Administrator menu"),iconCls:"iconAdmin",handler:function(){return false},menu:new Ext.menu.Menu({items:c})})}});ui.cmp._WorkTreeGrid.menu.commit=function(c){Ext.apply(this,c);this.init();ui.cmp._WorkTreeGrid.menu.commit.superclass.constructor.call(this)};Ext.extend(ui.cmp._WorkTreeGrid.menu.commit,Ext.menu.Item,{init:function(){Ext.apply(this,{text:_("Commit..."),iconCls:"iconCommitFileVcs",disabled:(PhDOE.user.isAnonymous),handler:function(){return false},menu:new Ext.menu.Menu({items:[{scope:this,text:_("...this file"),hidden:(this.from==="user"||this.from==="folder"||this.from==="patch"),iconCls:"iconCommitFileVcs",handler:function(){var c=[{fid:Ext.util.md5(this.folderNode.attributes.task+this.node.attributes.task),fpath:this.folderNode.attributes.task,fname:this.node.attributes.task,fdbid:this.node.attributes.idDB,ftype:this.node.attributes.type,fdate:Date.parseDate(this.node.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task}];new ui.cmp.CommitPrompt({files:c}).show()}},{scope:this,text:_("...all files from this folder"),hidden:(this.from==="user"||this.from==="patch"),iconCls:"iconCommitFileVcs",handler:function(){var c=[];this.folderNode.cascade(function(d){if(d.attributes.type!=="folder"&&d.attributes.type!=="user"){c.push({fid:Ext.util.md5(this.folderNode.attributes.task+d.attributes.task),fpath:this.folderNode.attributes.task,fname:d.attributes.task,fdbid:d.attributes.idDB,ftype:d.attributes.type,fdate:Date.parseDate(d.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})}},this);new ui.cmp.CommitPrompt({files:c}).show()}},{scope:this,text:_("...all files from this patch"),hidden:(this.module!=="patches"||this.from==="user"),iconCls:"iconCommitFileVcs",handler:function(){var c=[];this.patchNode.cascade(function(d){if(d.attributes.type!=="folder"&&d.attributes.type!=="user"&&d.attributes.type!=="patch"){c.push({fid:Ext.util.md5(d.parentNode.attributes.task+d.attributes.task),fpath:d.parentNode.attributes.task,fname:d.attributes.task,fdbid:d.attributes.idDB,ftype:d.attributes.type,fdate:Date.parseDate(d.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})}},this);new ui.cmp.CommitPrompt({files:c}).show()}},{scope:this,text:_("...all files modified by me"),iconCls:"iconCommitFileVcs",handler:function(){var c=[];this.userNode.cascade(function(d){if(d.attributes.type!=="folder"&&d.attributes.type!=="user"&&d.attributes.type!=="patch"){c.push({fid:Ext.util.md5(d.parentNode.attributes.task+d.attributes.task),fpath:d.parentNode.attributes.task,fname:d.attributes.task,fdbid:d.attributes.idDB,ftype:d.attributes.type,fdate:Date.parseDate(d.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})}},this);new ui.cmp.CommitPrompt({files:c}).show()}}]})})}});ui.cmp._WorkTreeGrid.menu.usersPatch=function(d){Ext.apply(this,d);var f=Ext.getCmp(this.menuID),e,c;if(!f.itemRendered){f.removeAll();f.doLayout();c=ui.cmp.PatchesTreeGrid.getInstance().getUserPatchesList();if(c){Ext.each(c,function(g){e=new Ext.menu.Item({id:Ext.id(),text:g.attributes.task,handler:function(){ui.task.MoveToPatch({patchID:g.attributes.idDB,patchName:g.attributes.task,nodesToAdd:f.nodesToAdd})}});f.add(e)},this)}else{e=new Ext.menu.Item({disabled:true,text:_("You have no patch currently. You must create one.")});f.add(e)}e=new Ext.menu.Item({text:_("Create a new patch"),iconCls:"iconAdd",handler:function(){var g=new ui.cmp.ManagePatchPrompt({title:_("Create a new patch"),nodesToAdd:f.nodesToAdd});g.show(this.el)}});f.add("-",e);f.doLayout();f.itemRendered=true}};ui.cmp._WorkTreeGrid.menu.users=function(c){Ext.apply(this,c);this.init();ui.cmp._WorkTreeGrid.menu.users.superclass.constructor.call(this)};Ext.extend(ui.cmp._WorkTreeGrid.menu.users,Ext.menu.Menu,{listeners:{show:function(){if(this.node.attributes.task===PhDOE.user.login){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"usersPatchesMenu"})}}},init:function(){var d=[],c;this.node.cascade(function(e){if(e.attributes.type!=="user"&&e.attributes.type!=="folder"){d.push(e)}},this);c=(this.node.attributes.task===PhDOE.user.login)?[{text:_("Submit all files for review in patch:"),iconCls:"iconPendingPatch",handler:function(){return false},menu:new Ext.menu.Menu({id:"usersPatchesMenu",itemRendered:false,nodesToAdd:d})},{xtype:"menuseparator",hidden:(PhDOE.user.isAnonymous)},((!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({from:"user",node:false,folderNode:false,userNode:this.node}):"")]:[{scope:this,text:String.format(_("Send an email to {0}"),"<b>"+this.node.attributes.task.ucFirst()+"</b>"),iconCls:"iconSendEmail",hidden:(this.node.attributes.email==="false"),handler:function(){var e=new ui.cmp.EmailPrompt();e.setData(this.node.attributes.task,this.node.attributes.email);e.show(this.node.el)}}];Ext.apply(this,{items:c})}});ui.cmp._WorkTreeGrid.menu.folders=function(c){Ext.apply(this,c);this.init();ui.cmp._WorkTreeGrid.menu.folders.superclass.constructor.call(this)};Ext.extend(ui.cmp._WorkTreeGrid.menu.folders,Ext.menu.Menu,{listeners:{show:function(){if(this.node.parentNode.attributes.task===PhDOE.user.login){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"foldersPatchesMenu"})}}},init:function(){var c=[];if(this.node.parentNode.attributes.task!==PhDOE.user.login){return false}this.node.cascade(function(d){if(d.attributes.type!=="folder"){c.push(d)}},this);Ext.apply(this,{items:[{text:_("Submit all files in this directory in patch:"),iconCls:"iconPendingPatch",handler:function(){return false},menu:new Ext.menu.Menu({id:"foldersPatchesMenu",itemRendered:false,nodesToAdd:c})},{xtype:"menuseparator",hidden:(PhDOE.user.isAnonymous)},((!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({from:"folder",node:false,folderNode:this.node,userNode:this.node.parentNode}):"")]})}});ui.cmp._WorkTreeGrid.menu.files=function(c){Ext.apply(this,c);this.init();ui.cmp._WorkTreeGrid.menu.files.superclass.constructor.call(this)};Ext.extend(ui.cmp._WorkTreeGrid.menu.files,Ext.menu.Menu,{listeners:{show:function(){if(this.node.parentNode.parentNode.attributes.task===PhDOE.user.login){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"filePatchesMenu"})}}},init:function(){var h=this.node,l=h.attributes.type,g,c=h.parentNode.attributes.task,e=h.attributes.task,k=h.ownerTree,f=h.parentNode.parentNode.attributes.task,d=[],j;j=h.parentNode.attributes.task.split("/");g=j[0];d.push(this.node);Ext.apply(this,{items:[{text:"<b>"+((l==="delete")?_("View in a new tab"):_("Edit in a new tab"))+"</b>",iconCls:"iconEdit",handler:function(){k.openFile(h)}},{text:_("Submit as patch for review in:"),iconCls:"iconPendingPatch",hidden:(f!==PhDOE.user.login),handler:function(){return false},menu:new Ext.menu.Menu({id:"filePatchesMenu",itemRendered:false,nodesToAdd:d})},{text:_("Set the progress..."),iconCls:"iconProgress",hidden:(l==="delete"||f!==PhDOE.user.login),menu:{xtype:"menu",showSeparator:false,items:[{xtype:"slider",width:200,value:this.node.attributes.progress,increment:10,minValue:0,maxValue:100,plugins:new Ext.slider.Tip({getText:function(m){return String.format("<b>"+_("{0}% complete")+"</b>",m.value)}}),refreshNodeColumns:function(o){var x=o.getOwnerTree(),u=o.attributes,s=x.columns,m=o.ui.getEl().firstChild,y=m.childNodes,p,r,w,q;for(p=1,q=s.length;p<q;p++){r=s[p].dataIndex;w=(u[r]!==null)?u[r]:"";if(s[p].tpl&&s[p].tpl.html==="{progress:this.formatProgress}"){y[p].firstChild.innerHTML=s[p].tpl.apply("out:"+w)}}},listeners:{scope:this,change:function(m,o){this.node.attributes.progress=o;m.refreshNodeColumns(this.node);ui.cmp._WorkTreeGrid.SetProgress.delay(1000,null,this)}}}]}},"-",{scope:this,text:_("View diff"),iconCls:"iconViewDiff",hidden:(l==="delete"||l==="new"),handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:e,FilePath:c})}},{text:_("Download the diff as a patch"),iconCls:"iconDownloadDiff",hidden:(l==="delete"||l==="new"),handler:function(){window.location.href="./do/downloadPatch?FilePath="+c+"&FileName="+e}},{xtype:"menuseparator",hidden:f!==PhDOE.user.login},{text:((l==="delete")?_("Cancel this deletion"):_("Clear this change")),iconCls:"iconPageDelete",hidden:f!==PhDOE.user.login,handler:function(){new ui.task.ClearLocalChangeTask({ftype:l,fpath:c,fname:e})}},{xtype:"menuseparator",hidden:(PhDOE.user.isAnonymous||f!==PhDOE.user.login)},((f===PhDOE.user.login&&!PhDOE.user.isAnonymous)?new ui.cmp._WorkTreeGrid.menu.commit({from:"file",node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode}):""),{xtype:"menuseparator",hidden:(!PhDOE.user.isGlobalAdmin&&!(PhDOE.user.lang===g&&PhDOE.user.isLangAdmin))},((PhDOE.user.isGlobalAdmin||(PhDOE.user.lang===g&&PhDOE.user.isLangAdmin))?new ui.cmp._WorkTreeGrid.menu.admin({fileLang:g,from:"file",node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode}):"")]})}});ui.cmp.WorkTreeGrid=Ext.extend(Ext.ux.tree.TreeGrid,{onContextMenu:function(f,g){g.stopEvent();var d=f.attributes.type,c;switch(d){case"user":f.select();c=new ui.cmp._WorkTreeGrid.menu.users({node:f});break;case"folder":f.select();c=new ui.cmp._WorkTreeGrid.menu.folders({node:f});break;default:f.select();c=new ui.cmp._WorkTreeGrid.menu.files({node:f});break}c.showAt(g.getXY())},initComponent:function(){function c(d,e){e.css+=" x-grid3-progresscol";return String.format('<div class="x-progress-wrap"><div class="x-progress-inner"><div class="x-progress-bar{0}" style="width:{1}%;">{2}</div></div>',this.getStyle(d),(d/this.ceiling)*100,this.getText(d))}Ext.apply(this,{animate:true,useArrows:true,autoScroll:true,border:false,containerScroll:true,defaults:{autoScroll:true},selModel:new Ext.tree.MultiSelectionModel(),columns:[{header:_("Users"),dataIndex:"task",tpl:new Ext.XTemplate("{task:this.formatUserName}",{formatUserName:function(d,e){return(e.type==="user")?d.ucFirst():d}})},{header:_("Last modified"),width:120,dataIndex:"last_modified",align:"center",tpl:new Ext.XTemplate("{last_modified:this.formatDate}",{formatDate:function(d,e){if(e.type!=="user"&&e.type!=="folder"){return Date.parseDate(d,"Y-m-d H:i:s").format(_("Y-m-d, H:i"))}else{return""}}})},{header:_("Estimated progress"),dataIndex:"progress",width:100,align:"center",tpl:new Ext.XTemplate("{progress:this.formatProgress}",{formatProgress:function(f,h){if(Ext.util.Format.substr(h,0,4)==="out:"){var g=h.split(":");f=g[1]}if(!f&&f!==0){return""}function e(k){var j=(k<(100/2))?"x-progress-text-back":"x-progress-text-front"+(Ext.isIE6?"-ie6":""),l;l=String.format('</div><div class="x-progress-text {0}" style="width:100%;" id="{1}">{2}</div></div>',j,Ext.id(),k+"%");return(k<(100/1.05))?l.substring(0,l.length-6):l.substr(6)}function d(j){if(j<=100&&j>(100*0.67)){return"-green"}if(j<(100*0.67)&&j>(100*0.33)){return"-orange"}if(j<(100*0.33)){return"-red"}return""}return String.format('<div class="x-progress-wrap"><div class="x-progress-inner"><div class="x-progress-bar{0}" style="width:{1}%;">{2}</div></div>',d(f),(f/100)*100,e(f))}})}],loader:{dataUrl:"./do/getWork",baseParams:{module:"workInProgress"}}});ui.cmp.WorkTreeGrid.superclass.initComponent.call(this);this.on("contextmenu",this.onContextMenu,this);this.on("resize",this.resizeCmp,this);this.on("dblclick",this.openFile,this);this.getRootNode().on("beforechildrenrendered",function(){this.updateFilesCounter.defer(200,this)},this)},resizeCmp:function(g,f,d,e){this.columns[0].width=e-(this.columns[1].width+this.columns[2].width+5);this.updateColumnWidths()},delRecord:function(m){var d=this.getRootNode(),g,e,k,c,l,f;for(g=0;g<d.childNodes.length;g++){c=d.childNodes[g];for(e=0;e<c.childNodes.length;e++){l=c.childNodes[e];for(k=0;k<l.childNodes.length;k++){f=l.childNodes[k];if(f.attributes.idDB===m){f.remove(true);if(Ext.isEmpty(l.childNodes)){l.remove(true);if(Ext.isEmpty(c.childNodes)){c.remove(true);this.updateFilesCounter();return}this.updateFilesCounter();return}this.updateFilesCounter();return}}}}this.updateFilesCounter()},addToWork:function(l){var c,k,e,g,j,f,h,d;c=this.getRootNode();k=c.findChild("task",PhDOE.user.login);if(!k){k=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:true});c.appendChild(k);c.expand()}if(l){for(d=0;d<l.length;d++){e=k.findChild("task",l[d].parentNode.attributes.task);if(!e){e=new Ext.tree.TreeNode({task:l[d].parentNode.attributes.task,type:"folder",iconCls:"iconFolderOpen",expanded:true});k.appendChild(e);k.expand()}g=l[d].attributes.type;if(g==="update"){j="iconRefresh"}if(g==="new"){j="iconNewFiles"}if(g==="delete"){j="iconTrash"}h=new Date();f=new Ext.tree.TreeNode({task:l[d].attributes.task,type:g,iconCls:j,expanded:true,last_modified:h.format("Y-m-d H:i:s"),progress:l[d].attributes.progress,idDB:l[d].attributes.idDB});e.appendChild(f);e.expand()}}this.updateFilesCounter()},addRecord:function(f,c,d,j){var e=this.getRootNode(),m,g,h,k,l;m=e.findChild("task",PhDOE.user.login);if(!m){m=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:true,nbFiles:1});e.appendChild(m);e.expand()}g=m.findChild("task",c);if(!g){g=new Ext.tree.TreeNode({task:c,type:"folder",iconCls:"iconFolderOpen",expanded:true});m.appendChild(g);m.expand()}h=g.findChild("task",d);if(!h){if(j==="update"){l="iconRefresh"}if(j==="new"){l="iconNewFiles"}if(j==="delete"){l="iconTrash"}k=new Date();h=new Ext.tree.TreeNode({task:d,type:j,iconCls:l,expanded:true,last_modified:k.format("Y-m-d H:i:s"),progress:100,idDB:f});g.appendChild(h);g.expand()}this.updateFilesCounter()},countFiles:function(){var c=this.getRootNode(),d=0;c.cascade(function(e){if(!e.isRoot&&e.attributes.type!=="user"&&e.attributes.type!=="folder"){if(e.parentNode.parentNode.attributes.task===PhDOE.user.login){d++}}},this);return d},updateFilesCounter:function(){var c=this.countFiles();Ext.getDom("acc-work-in-progress-nb").innerHTML=c},openFile:function(g){var d=g.attributes.type,f=g.parentNode.attributes.task,c=g.attributes.task,e;if(d==="user"||d==="folder"){return false}e=f.split("/");FileLang=e[0];e.shift();f="/"+e.join("/");switch(d){case"new":ui.cmp.PendingTranslateGrid.getInstance().store.each(function(h){if((h.data.path)===f&&h.data.name===c){ui.cmp.PendingTranslateGrid.getInstance().openFile(h.data.id);return}});break;case"delete":ui.cmp.NotInENGrid.getInstance().store.each(function(h){if((h.data.path)===f&&h.data.name===c){ui.cmp.NotInENGrid.getInstance().openFile(h.data.id);return}});break;case"update":if(FileLang==="en"){ui.cmp.RepositoryTree.getInstance().openFile("byPath",FileLang+f,c)}else{found=false;ui.cmp.StaleFileGrid.getInstance().store.each(function(h){if((h.data.path)===f&&h.data.name===c){ui.cmp.StaleFileGrid.getInstance().openFile(h.data.id);found=true;return}});if(!found){ui.cmp.ErrorFileGrid.getInstance().store.each(function(h){if((h.data.path)===f&&h.data.name===c){ui.cmp.ErrorFileGrid.getInstance().openFile(h.data.id);found=true;return}})}if(!found){ui.cmp.PendingReviewGrid.getInstance().store.each(function(h){if((h.data.path)===f&&h.data.name===c){ui.cmp.PendingReviewGrid.getInstance().openFile(h.data.id);found=true;return}})}if(!found){ui.cmp.RepositoryTree.getInstance().openFile("byPath",FileLang+f,c)}}break}}});ui.cmp._WorkTreeGrid.instance=null;ui.cmp.WorkTreeGrid.getInstance=function(c){if(!ui.cmp._WorkTreeGrid.instance){if(!c){c={}}ui.cmp._WorkTreeGrid.instance=new ui.cmp.WorkTreeGrid(c)}return ui.cmp._WorkTreeGrid.instance};var PhDOE=function(){Ext.QuickTips.init();return{user:{login:null,anonymousIdent:Ext.util.Cookies.get("anonymousIdent"),isAnonymous:null,isAdmin:false,lang:null,conf:"",email:""},app:{name:"Php Docbook Online Editor",ver:"X.XX",loaded:false,uiRevision:"$Revision: 312427 $",conf:""},lastInfoDate:null,project:"",FNTfilePendingOpen:[],FNUfilePendingOpen:[],FEfilePendingOpen:[],FNRfilePendingOpen:[],FNIENfilePendingOpen:[],AFfilePendingOpen:[],PPfilePendingOpen:[],init:function(){new ui.task.LoadConfigTask();Ext.Ajax.extraParams={csrfToken:csrfToken};Ext.data.Connection.prototype.extraParams={csrfToken:csrfToken};Ext.data.ScriptTagProxy.prototype.extraParams={csrfToken:csrfToken}},notify:function(d,g,e){var f,c;if(d=="info"){c="iconInfo"}if(d=="error"){c="iconError"}f=new Ext.ux.Notification({iconCls:c,title:g,html:e,autoDestroy:true,hideDelay:5000});f.show(document)},winForbidden:function(c){var d=_("Forbidden"),e="";switch(c){case"fs_error":d=_("Error");e=_("File system error. Check read/write permission under data folder.");break;case"encoding_error":d=_("Error");e=_('You have used characters that require the use of UTF-8 despite the XML header.<br>Please delete these characters or change the header of the XML file in UTF-8 ; i.e.:<br><br><center><i>&lt;?xml version="1.0" encoding="utf-8"?&gt;</i></center>');break;case"tabs_found":d=_("Error");e=_('It seems that you have inserted some tabs caracters into this files. Please, replace each one by one space.<br>Tip: You can use the "Re-indent all this file" button to replace all tabs by spaces.');break;case"folder_already_exist":d=_("Error");e=_("This folder already exist in the current folder.");break;case"file_already_exist":d=_("Error");e=_("This file already exist in the current folder.");break;case"save_you_cant_modify_it":d=_("Error");e=_("You can't modify this file as it was modify by another user. Contact an administrator if you want to be able to modify it.");break;case"file_isnt_owned_by_current_user":d=_("Error");e=_("The file you want to clear local change isn't own by you.<br>You can only do this action for yours files.");break;case"file_localchange_didnt_exist":d=_("Error");e=_("The file you want to clear local change isn't exist as work in progress.");break;case"changeFilesOwnerNotAdmin":d=_("Error");e=_("You can't change file's owner. You must be a global administrator or an administrator for this lang.");break;case"patch_delete_dont_exist":d=_("Error");e=_("The patch you want to delete didn't exist.");break;case"patch_delete_isnt_own_by_current_user":d=_("Error");e=_("The patch you want to delete isn't own by you. Only the user how create it or a global administrator can delete it.");break;case"action_only_global_admin":d=_("Error");e=_("This action is available only to global administrator.");break;case"action_only_admin":d=_("Error");e=_("This action is available only to global administrator or to administrator for this lang.");break}Ext.MessageBox.alert(d,e)},runDirectAccess:function(){if(directAccess){if(directAccess.link=="perm"){ui.cmp.RepositoryTree.getInstance().openFile("byPath",directAccess.lang+directAccess.path,directAccess.name)}if(directAccess.link=="patch"){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FilePath:directAccess.path,FileName:directAccess.name})}}},afterLoadAllStore:function(){this.app.loaded=true;this.runDirectAccess();if(this.user.conf.main.loadMailsAtStartUp){ui.cmp.PortletLocalMail.getInstance().reloadData()}if(this.user.conf.main.loadBugsAtStartUp){ui.cmp.PortletBugs.getInstance().reloadData()}},loadAllStore:function(){var c=new Ext.ProgressBar({width:300,renderTo:"loading-progressBar"});c.show();if(PhDOE.userLang!=="en"){document.getElementById("loading-msg").innerHTML="Loading data...";c.updateProgress(1/11,"1 of 11...");ui.cmp._MainMenu.store.load({callback:function(){c.updateProgress(2/11,"2 of 11...");ui.cmp.StaleFileGrid.getInstance().store.load({callback:function(){c.updateProgress(3/11,"3 of 11...");ui.cmp.ErrorFileGrid.getInstance().store.load({callback:function(){c.updateProgress(4/11,"4 of 11...");ui.cmp.PendingReviewGrid.getInstance().store.load({callback:function(){c.updateProgress(5/11,"5 of 11...");ui.cmp.NotInENGrid.getInstance().store.load({callback:function(){c.updateProgress(6/11,"6 of 11...");ui.cmp.PortletSummary.getInstance().store.load({callback:function(){c.updateProgress(7/11,"7 of 11...");ui.cmp.PortletTranslationGraph.getInstance().store.load({callback:function(){c.updateProgress(8/11,"8 of 11...");ui.cmp.PortletTranslationsGraph.getInstance().store.load({callback:function(){c.updateProgress(9/11,"9 of 11...");ui.cmp.PortletTranslator.getInstance().store.load({callback:function(){c.updateProgress(10/11,"10 of 11...");ui.cmp.PendingTranslateGrid.getInstance().store.load({callback:function(){c.updateProgress(11/11,"11 of 11...");ui.cmp.PortletInfo.getInstance().store.load({callback:function(){Ext.get("loading").remove();Ext.fly("loading-mask").fadeOut({remove:true});c.destroy();PhDOE.afterLoadAllStore()}})}})}})}})}})}})}})}})}})}})}})}else{document.getElementById("loading-msg").innerHTML="Loading data...";c.updateProgress(1/4,"1 of 4...");ui.cmp._MainMenu.store.load({callback:function(){c.updateProgress(2/4,"2 of 4...");ui.cmp.PortletTranslationsGraph.getInstance().store.load({callback:function(){c.updateProgress(3/4,"3 of 4...");ui.cmp.ErrorFileGrid.getInstance().store.load({callback:function(){c.updateProgress(4/4,"4 of 4...");ui.cmp.PortletInfo.getInstance().store.load({callback:function(){Ext.get("loading").remove();Ext.fly("loading-mask").fadeOut({remove:true});c.destroy();PhDOE.afterLoadAllStore()}})}})}})}})}},reloadAllStore:function(){if(PhDOE.userLang!=="en"){ui.cmp.PendingTranslateGrid.getInstance().store.reload({callback:function(){ui.cmp.StaleFileGrid.getInstance().store.reload({callback:function(){ui.cmp.ErrorFileGrid.getInstance().store.reload({callback:function(){ui.cmp.PendingReviewGrid.getInstance().store.reload({callback:function(){ui.cmp.NotInENGrid.getInstance().store.reload({callback:function(){ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PortletSummary.getInstance().store.reload({callback:function(){ui.cmp.PortletTranslator.getInstance().store.reload({callback:function(){ui.cmp.PortletTranslationGraph.getInstance().store.reload({callback:function(){ui.cmp.PortletTranslationsGraph.getInstance().store.reload({callback:function(){ui.cmp.PortletInfo.getInstance().store.reload()}})}})}})}})})})}})}})}})}})}})}else{ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PortletInfo.getInstance().store.reload()})})}},drawInterface:function(){var c,k,l,d=[],g=[],h=[];k={col1:["portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationsGraph"]};l={col1:["portletSummary","portletTranslator","portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationGraph","portletTranslationsGraph"]};if(PhDOE.user.lang==="en"){c=(PhDOE.user.conf.main.portalSortEN)?Ext.util.JSON.decode(PhDOE.user.conf.main.portalSortEN):k;h.portletLocalMail=ui.cmp.PortletLocalMail.getInstance({lang:PhDOE.user.lang});h.portletBugs=ui.cmp.PortletBugs.getInstance({lang:PhDOE.user.lang});h.portletInfo=ui.cmp.PortletInfo.getInstance();h.portletTranslationsGraph=ui.cmp.PortletTranslationsGraph.getInstance()}else{c=(PhDOE.user.conf.main.portalSortLANG)?Ext.util.JSON.decode(PhDOE.user.conf.main.portalSortLANG):l;h.portletSummary=ui.cmp.PortletSummary.getInstance({lang:PhDOE.user.lang});h.portletTranslator=ui.cmp.PortletTranslator.getInstance({lang:PhDOE.user.lang});h.portletLocalMail=ui.cmp.PortletLocalMail.getInstance({lang:PhDOE.user.lang});h.portletBugs=ui.cmp.PortletBugs.getInstance({lang:PhDOE.user.lang});h.portletInfo=ui.cmp.PortletInfo.getInstance();h.portletTranslationGraph=ui.cmp.PortletTranslationGraph.getInstance();h.portletTranslationsGraph=ui.cmp.PortletTranslationsGraph.getInstance()}for(var f=0;f<c.col1.length;f++){d.push(h[c.col1[f]])}for(var e=0;e<c.col2.length;e++){g.push(h[c.col2[e]])}ui.task.PingTask.getInstance().delay(30000);new Ext.Viewport({layout:"border",id:"main-app",items:[{region:"north",html:'<h1 class="x-panel-header"><img src="themes/img/mini_php.png" style="vertical-align: middle;" />&nbsp;&nbsp;'+this.app.name+"</h1>",autoHeight:true,border:false,margins:"0 0 5 0"},{region:"west",id:"main-menu-panel",layout:"accordion",collapsible:true,collapseMode:"mini",animate:true,split:true,width:PhDOE.user.conf.main.mainMenuWidth||300,header:false,listeners:{resize:function(j,o){if(o&&o!=PhDOE.user.conf.main.mainMenuWidth){var m=new ui.task.UpdateConfTask({module:"main",itemName:"mainMenuWidth",value:o,notify:false})}}},tbar:[{text:_("Main menu"),iconCls:"MainMenu",menu:new ui.cmp.MainMenu()}],items:[{id:"acc-need-translate",title:_("Files need translate")+' (<em id="acc-need-translate-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedTranslate",hidden:(PhDOE.user.lang==="en"),items:[ui.cmp.PendingTranslateGrid.getInstance()],collapsed:true,listeners:{expand:function(j){Ext.getCmp("FNT-filter").wrap.setWidth(180);Ext.getCmp("FNT-filter").syncSize()}}},{id:"acc-need-update",title:_("Files need update")+' (<em id="acc-need-update-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedUpdate",hidden:(PhDOE.user.lang==="en"),items:[ui.cmp.StaleFileGrid.getInstance()],collapsed:true,listeners:{expand:function(j){Ext.getCmp("FNU-filter").wrap.setWidth(180);Ext.getCmp("FNU-filter").syncSize()}}},{id:"acc-error",title:(PhDOE.user.lang==="en")?"Number of failures to meet 'strict standards' (<em id=\"acc-error-nb\">0</em>)":_("Error in current translation")+' (<em id="acc-error-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesError",items:[ui.cmp.ErrorFileGrid.getInstance()],collapsed:true,listeners:{expand:function(j){Ext.getCmp("FE-filter").wrap.setWidth(180);Ext.getCmp("FE-filter").syncSize()}}},{id:"acc-need-reviewed",title:_("Files need reviewed")+' (<em id="acc-need-reviewed-nb">0</em>)',layout:"fit",border:false,iconCls:"iconFilesNeedReviewed",hidden:(PhDOE.user.lang==="en"),items:[ui.cmp.PendingReviewGrid.getInstance()],collapsed:true,listeners:{expand:function(j){Ext.getCmp("FNR-filter").wrap.setWidth(180);Ext.getCmp("FNR-filter").syncSize()}}},{id:"acc-notInEn",title:_("Not in EN tree")+' (<em id="acc-notInEn-nb">0</em>)',layout:"fit",border:false,iconCls:"iconNotInEn",hidden:(PhDOE.user.lang==="en"),items:[ui.cmp.NotInENGrid.getInstance()],collapsed:true},{id:"acc-all-files",title:_("All files"),layout:"fit",border:false,iconCls:"iconAllFiles",items:[ui.cmp.RepositoryTree.getInstance()],collapsed:true,listeners:{expand:function(j){Ext.getCmp("AF-search").wrap.setWidth(180);Ext.getCmp("AF-search").syncSize()}}},{id:"acc-work-in-progress",title:_("Work in progress")+' (<em id="acc-work-in-progress-nb" qtip="'+_("Total number of your files")+'">0</em>)',layout:"fit",border:false,iconCls:"iconWorkInProgress",items:[ui.cmp.WorkTreeGrid.getInstance()],collapsed:true},{id:"acc-patches",tools:[{id:"gear",hidden:(this.user.isAnonymous),qtip:_("Open the Log Message Manager"),handler:function(){if(!Ext.getCmp("commit-log-win")){var j=new ui.cmp.CommitLogManager()}Ext.getCmp("commit-log-win").show("acc-patches")}}],title:_("Patches for review")+' (<em id="acc-patches-nb" qtip="'+_("Total number of your files")+'">0</em>)',layout:"fit",border:false,iconCls:"iconPatch",items:[ui.cmp.PatchesTreeGrid.getInstance()],collapsed:true},{id:"acc-google-translate",title:_("Google translation"),layout:"fit",border:false,iconCls:"iconGoogle",hidden:(PhDOE.user.lang==="en"),items:[new ui.cmp.GoogleTranslationPanel()],collapsed:true}]},{xtype:"mainpanel",id:"main-panel",region:"center",items:[{xtype:"panel",id:"MainInfoTabPanel",title:_("Home"),baseCls:"MainInfoTabPanel",autoScroll:true,plain:true,items:[{xtype:"panel",border:false,html:'<div class="res-block"><div class="res-block-inner"><h3>'+String.format(_("Connected as {0}"),((PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin)?"<em class='userAdmin' ext:qtip='"+_("Administrator")+"'>"+PhDOE.user.login.ucFirst()+"</em>":"<em>"+PhDOE.user.login.ucFirst()+"</em>"))+", "+_("Project: ")+'<em id="Info-Project">'+PhDOE.project+"</em>, "+_("Language: ")+' <em id="Info-Language">-</em></h3></div></div>'},{xtype:"portal",border:false,items:[{columnWidth:0.5,style:"padding:10px 5px 10px 5px",items:d},{columnWidth:0.5,style:"padding:10px 5px 10px 5px",items:g}],listeners:{drop:function(o){var m,q=[],s=[],t;for(var r=0;r<o.portal.items.items[0].items.items.length;r++){t=o.portal.items.items[0].items.items[r].id;q.push(t)}for(var p=0;p<o.portal.items.items[1].items.items.length;p++){t=o.portal.items.items[1].items.items[p].id;s.push(t)}m={col1:q,col2:s};new ui.task.UpdateConfTask({module:"main",itemName:(PhDOE.userLang==="en")?"portalSortEN":"portalSortLANG",value:Ext.util.JSON.encode(m),notify:false})}}}]}]}]});new Ext.dd.DropTarget(Ext.get("main-panel"),{ddGroup:"mainPanelDDGroup",notifyDrop:function(q,p,o){var m,j;if(o.nodes){for(m=0;m<o.nodes.length;m++){PhDOE.AFfilePendingOpen[m]={nodeID:o.nodes[m].attributes.id}}ui.cmp.RepositoryTree.getInstance().openFile("byId",PhDOE.AFfilePendingOpen[0].nodeID,false);PhDOE.AFfilePendingOpen.shift();return true}if(o.grid.ownerCt.id==="acc-need-pendingCommit"){o.grid.openFile(o.selections[0].data.id);return true}for(m=0;m<o.selections.length;m++){if(o.grid.ownerCt.id==="acc-need-translate"){PhDOE.FNTfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-need-update"){PhDOE.FNUfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-error"){PhDOE.FEfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-need-reviewed"){PhDOE.FNRfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-notInEn"){PhDOE.FNIENfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-need-pendingPatch"){PhDOE.PPfilePendingOpen[m]={id:o.selections[m].data.id}}if(o.grid.ownerCt.id==="acc-need-pendingPatch"){PhDOE.PPfilePendingOpen[m]={id:o.selections[m].data.id}}}if(o.grid.ownerCt.id==="acc-need-translate"){j=PhDOE.FNTfilePendingOpen[0];PhDOE.FNTfilePendingOpen.shift()}if(o.grid.ownerCt.id==="acc-need-update"){j=PhDOE.FNUfilePendingOpen[0];PhDOE.FNUfilePendingOpen.shift()}if(o.grid.ownerCt.id==="acc-error"){j=PhDOE.FEfilePendingOpen[0];PhDOE.FEfilePendingOpen.shift()}if(o.grid.ownerCt.id==="acc-need-reviewed"){j=PhDOE.FNRfilePendingOpen[0];PhDOE.FNRfilePendingOpen.shift()}if(o.grid.ownerCt.id==="acc-notInEn"){j=PhDOE.FNIENfilePendingOpen[0];PhDOE.FNIENfilePendingOpen.shift()}if(o.grid.ownerCt.id==="acc-need-pendingPatch"){j=PhDOE.PPfilePendingOpen[0];PhDOE.PPfilePendingOpen.shift()}o.grid.openFile(j.id);return true}});this.loadAllStore()}}}();Ext.EventManager.onDocumentReady(PhDOE.init,PhDOE,true);